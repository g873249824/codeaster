# TITRE FISSURATION JOINT 3D : PENTA6
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SSNP118C', NIV_PUB_WEB='INTERNET', VISU_EFICAS='OUI'), DEBUG=_F(SDVERI='OUI'))

MA=LIRE_MAILLAGE(INFO=2 )

IMPR_RESU(FORMAT  = 'GMSH',RESU=_F(MAILLAGE=MA),UNITE=19)

MO=AFFE_MODELE(

                MAILLAGE=MA,
                VERIF='MAILLE',

                AFFE= (
                _F(
                        MAILLE = ('PRISM','DROITE'),
                        PHENOMENE = 'MECANIQUE',
                        MODELISATION = '3D'
                     ),
                 _F(
                   MAILLE = 'PRISMDEG',
                   PHENOMENE = 'MECANIQUE',
                   MODELISATION = '3D_JOINT'
                   )
                 )
              )


MAT=DEFI_MATERIAU(

     ELAS=_F(
              E =  0.5,
              NU = 0.0),
     RUPT_FRAG = _F(
                     GC = 0.9,
                     SIGM_C = 1.1,
                     PENA_ADHERENCE = 0.001
                    )
            )


CM=AFFE_MATERIAU(

               MAILLAGE=MA,
               AFFE=_F(
                       TOUT = 'OUI',
                       MATER = MAT),
              )

LIAISON=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
    _F(MAILLE='GAUCHE2', DX=0, DY=0, DZ=0 ),
    )
  )

# CHARGEMENT MODE I PUR
TRAC_1=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
    _F(MAILLE='DROITE', DX=2.16506350946110, DY= 1.250, DZ=0 ),
    ))

# CHARGEMENT MODE II PUR
TRAC_2=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
     _F(MAILLE='GAUCHE',  DX=-1.250, DY= 2.16506350946110, DZ=0 ),
     _F(MAILLE='DROITE',  DX=-1.250, DY= 2.16506350946110, DZ=0 ),
    )
  )

# CHARGEMENT MODE III PUR
TRAC_3=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
     _F(MAILLE='GAUCHE', DX=0.0, DY= 0.0, DZ= 2.5 ),
     _F(MAILLE='DROITE', DX=0.0, DY= 0.0, DZ= 2.5 ),
    ))


L_INST=DEFI_LIST_REEL(

                     DEBUT   = -1.,
     INTERVALLE=(
      _F( JUSQU_A = 0,       NOMBRE = 1 ),
      _F( JUSQU_A = 0.0001,  NOMBRE = 1 ),
      _F( JUSQU_A = 4.0,     NOMBRE = 40 ),
      )
     )

L_INST2=DEFI_LIST_REEL(

                     DEBUT   = 0.0001,
     INTERVALLE=(
      _F( JUSQU_A = 4.0,     NOMBRE = 40 ),
      )
     )



FCT = DEFI_FONCTION(
  NOM_PARA = 'INST',
  VALE     = (-1, 0, 0, 1.E-8),
  PROL_DROITE = 'LINEAIRE'
  )


FCT2 = DEFI_FONCTION(
  NOM_PARA = 'INST',
  VALE     = (-1, 0, 0, 1.E-8, 4, 4),
  PROL_DROITE = 'LINEAIRE'
  )

#----------------------------------------------------------------------------------
# CALCUL AVEC CHARGEMENT EN MODE I
#-----------------------------------------------------------------------------------

U_1=STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON , ),
    _F(CHARGE = TRAC_1, FONC_MULT = FCT),
  ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             MAILLE = 'PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = 0.),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 5),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  )

STAT_NON_LINE(reuse = U_1,
  ETAT_INIT  = _F(EVOL_NOLI = U_1),
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON),
    _F(CHARGE = TRAC_1 ,
                       TYPE_CHARGE = 'FIXE_PILO',
#                        FONC_MULT = FCT2
                                                  ),
  ),
  PILOTAGE   = _F(
    SELECTION = 'RESIDU',
    TYPE = 'PRED_ELAS',
    MAILLE = 'PRISMDEG',
    COEF_MULT = 1,
    ETA_PILO_R_MIN = 0.,
    ETA_PILO_MAX = 1
    ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             GROUP_MA = 'G_PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST,
#                  INST_FIN = 1.6
                  ),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 20),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  ARCHIVAGE  = _F(LIST_INST = L_INST2)
  )


#----------------------------------------------------------------------------------
# CALCUL AVEC CHARGEMENT EN MODE II
#-----------------------------------------------------------------------------------

U_2=STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON , ),
    _F(CHARGE = TRAC_2, FONC_MULT = FCT),
  ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             MAILLE = 'PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = 0.),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 5),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  )

STAT_NON_LINE(reuse = U_2,
  ETAT_INIT  = _F(EVOL_NOLI = U_2),
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON  , ),
    _F(CHARGE = TRAC_2 , TYPE_CHARGE = 'FIXE_PILO'),
  ),
  PILOTAGE   = _F(
    SELECTION = 'RESIDU',
    TYPE = 'PRED_ELAS',
    MAILLE = 'PRISMDEG',
    COEF_MULT = 1,
    ETA_PILO_R_MIN = 0.,
    ETA_PILO_MAX = 1
    ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             GROUP_MA = 'G_PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 5),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  ARCHIVAGE  = _F(LIST_INST = L_INST2)
  )


#----------------------------------------------------------------------------------
# CALCUL AVEC CHARGEMENT EN MODE III
#-----------------------------------------------------------------------------------

U_3=STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON , ),
    _F(CHARGE = TRAC_3, FONC_MULT = FCT),
  ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             MAILLE = 'PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = 0.),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 5),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  )

STAT_NON_LINE(reuse = U_3,
  ETAT_INIT  = _F(EVOL_NOLI = U_3),
  MODELE     = MO,
  CHAM_MATER = CM,
  EXCIT      = (
    _F(CHARGE = LIAISON  , ),
    _F(CHARGE = TRAC_3 , TYPE_CHARGE = 'FIXE_PILO'),
  ),
  PILOTAGE   = _F(
    SELECTION = 'RESIDU',
    TYPE = 'PRED_ELAS',
    MAILLE = 'PRISMDEG',
    COEF_MULT = 1,
    ETA_PILO_R_MIN = 0.,
    ETA_PILO_MAX = 1
    ),
  COMP_INCR  = (
          _F(RELATION = 'CZM_EXP_REG',
             MAILLE = 'PRISMDEG', ),
          _F(RELATION = 'ELAS',
             GROUP_MA = 'G_PRISM',),
          ),
  INCREMENT  = _F(LIST_INST = L_INST),
  CONVERGENCE= _F(ITER_GLOB_MAXI = 5),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  ARCHIVAGE  = _F(LIST_INST = L_INST2)
  )


#----------------------------------------------------------------------------------
# TESTS CALCUL MODE I
#-----------------------------------------------------------------------------------


F_DX_1=RECU_FONCTION( RESULTAT=U_1,
              NOM_CHAM='DEPL',NOM_CMP='DX',GROUP_NO='TOUTSEUL')
T_DX_1=CREA_TABLE(FONCTION=_F(FONCTION=F_DX_1))
IMPR_TABLE(TABLE=T_DX_1)


F_ETA_1=RECU_FONCTION( RESULTAT=U_1,
              NOM_PARA_RESU='ETA_PILOTAGE')
T_ETA_1=CREA_TABLE(FONCTION=_F(FONCTION=F_ETA_1))
IMPR_TABLE(TABLE=T_ETA_1)


F_SIGN_1=RECU_FONCTION( RESULTAT=U_1, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SIGN',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SIGN_1=CREA_TABLE(FONCTION=_F(FONCTION=F_SIGN_1))
IMPR_TABLE(TABLE=T_SIGN_1)


F_SITX_1=RECU_FONCTION( RESULTAT=U_1, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITX',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITX_1=CREA_TABLE(FONCTION=_F(FONCTION=F_SITX_1))
IMPR_TABLE(TABLE=T_SITX_1)


F_SITY_1=RECU_FONCTION( RESULTAT=U_1, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITY',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITY_1=CREA_TABLE(FONCTION=_F(FONCTION=F_SITY_1))
IMPR_TABLE(TABLE=T_SITY_1)




TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=1.E-3,
           VALE_CALC=2.165063509,
           VALE_REFE=2.16506,
           NOM_PARA='DX',
           TABLE=T_DX_1,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=2.20004,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=1.E-3,
           VALE_CALC=1.000000000,
           VALE_REFE=1.0,
           NOM_PARA='ETA_PILO',
           TABLE=T_ETA_1,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=2.20004,),
           )

TEST_RESU(RESU=_F(GROUP_NO='TOUTSEUL',
                  INST=0,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=U_1,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  VALE_CALC= 2.16506351E-08,
                  VALE_REFE=2.1650600000000001E-08,),
          )

TEST_RESU(RESU=_F(INST=2.2000449999999998,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_1,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIXX',
                  VALE_CALC=0.044991140,
                  VALE_REFE=0.044991099999999999,
                  MAILLE='PRISM',),
          )

TEST_RESU(RESU=_F(INST=1.7000575,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_1,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.156379309,
                  VALE_REFE=0.15637899999999999,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.800055,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_1,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITX',
                  VALE_CALC=-6.86489752E-18,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.800055,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_1,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITY',
                  VALE_CALC=-8.35892126E-18,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

#----------------------------------------------------------------------------------
# TESTS CALCUL MODE II
#-----------------------------------------------------------------------------------

F_DY_2=RECU_FONCTION( RESULTAT=U_2,
              NOM_CHAM='DEPL',NOM_CMP='DY',GROUP_NO='TOUTSEUL')
T_DY_2=CREA_TABLE(FONCTION=_F(FONCTION=F_DY_2))
IMPR_TABLE(TABLE=T_DY_2)


F_ETA_2=RECU_FONCTION( RESULTAT=U_2,
              NOM_PARA_RESU='ETA_PILOTAGE')
T_ETA_2=CREA_TABLE(FONCTION=_F(FONCTION=F_ETA_2))
IMPR_TABLE(TABLE=T_ETA_2)


F_SIGN_2=RECU_FONCTION( RESULTAT=U_2, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SIGN',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SIGN_2=CREA_TABLE(FONCTION=_F(FONCTION=F_SIGN_2))
IMPR_TABLE(TABLE=T_SIGN_2)


F_SITX_2=RECU_FONCTION( RESULTAT=U_2, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITX',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITX_2=CREA_TABLE(FONCTION=_F(FONCTION=F_SITX_2))
IMPR_TABLE(TABLE=T_SITX_2)


F_SITY_2=RECU_FONCTION( RESULTAT=U_2, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITY',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITY_2=CREA_TABLE(FONCTION=_F(FONCTION=F_SITY_2))
IMPR_TABLE(TABLE=T_SITY_2)


TEST_RESU(RESU=_F(INST=1.800055,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_2,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIGN',
                  VALE_CALC=-3.02888075E-13,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.7000575,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_2,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITX',
                  VALE_CALC=0.156379309,
                  VALE_REFE=0.15637899999999999,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.800055,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_2,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITY',
                  VALE_CALC=-3.58546562E-20,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

#----------------------------------------------------------------------------------
# TESTS CALCUL MODE III
#-----------------------------------------------------------------------------------

F_DZ_3=RECU_FONCTION( RESULTAT=U_3,
              NOM_CHAM='DEPL',NOM_CMP='DZ',GROUP_NO='TOUTSEUL')
T_DZ_3=CREA_TABLE(FONCTION=_F(FONCTION=F_DZ_3))
IMPR_TABLE(TABLE=T_DZ_3)


F_ETA_3=RECU_FONCTION( RESULTAT=U_3,
              NOM_PARA_RESU='ETA_PILOTAGE')
T_ETA_3=CREA_TABLE(FONCTION=_F(FONCTION=F_ETA_3))
IMPR_TABLE(TABLE=T_ETA_3)


F_SIGN_3=RECU_FONCTION( RESULTAT=U_3, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SIGN',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SIGN_3=CREA_TABLE(FONCTION=_F(FONCTION=F_SIGN_3))
IMPR_TABLE(TABLE=T_SIGN_3)


F_SITX_3=RECU_FONCTION( RESULTAT=U_3, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITX',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITX_3=CREA_TABLE(FONCTION=_F(FONCTION=F_SITX_3))
IMPR_TABLE(TABLE=T_SITX_3)


F_SITY_3=RECU_FONCTION( RESULTAT=U_3, NOM_CHAM = 'SIEF_ELGA',
          NOM_CMP = 'SITY',
          MAILLE  = 'PRISMDEG',POINT=1)
T_SITY_3=CREA_TABLE(FONCTION=_F(FONCTION=F_SITY_3))
IMPR_TABLE(TABLE=T_SITY_3)


TEST_RESU(RESU=_F(INST=1.1000725,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_3,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIGN',
                  VALE_CALC= 1.84092049E-21,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.1000725,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_3,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITX',
                  VALE_CALC=-4.27151562E-20,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=1.7000575,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_3,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITY',
                  VALE_CALC=0.156379309,
                  VALE_REFE=0.15637899999999999,
                  MAILLE='PRISMDEG',),
          )

IMPR_RESU(FORMAT='GMSH',RESU=(_F(RESULTAT=U_1,NOM_CHAM='DEPL',TYPE_CHAM='VECT_3D',NOM_CMP=('DX','DY','DZ')))),  
IMPR_RESU(FORMAT='GMSH',RESU=(_F(RESULTAT=U_2,NOM_CHAM='DEPL',TYPE_CHAM='VECT_3D',NOM_CMP=('DX','DY','DZ')))),  
IMPR_RESU(FORMAT='GMSH',RESU=(_F(RESULTAT=U_3,NOM_CHAM='DEPL',TYPE_CHAM='VECT_3D',NOM_CMP=('DX','DY','DZ')))),  

FIN()
