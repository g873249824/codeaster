# person_in_charge: sebastien.fayolle at edf.fr
# TITRE  : ENDOMMAGEMENT D UNE PLAQUE PLANE SOUS SOLLICITATIONS VARIEES
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# ======================================================================
#  DETAILS : MODELISATION :
#                           DKTG (GLRC_DM)
#            MAILLAGE     : TRIA3
#            CHARGEMENT   : THERMIQUE CYCLIQUE
#                           REFROIDISSEMENT-RECHAUFFEMENT EQUIVALENT A
#                           TRACTION - COMPRESSION DE LA MODELISATION A

DEBUT(CODE=_F(NOM='SSNS106L',
              NIV_PUB_WEB='INTERNET',),
      DEBUG=_F(SDVERI='OUI',),);

#PRE_GIBI();
EP = 0.1;

# ON MET LES DEPLACEMENTS A 0 POUR ENGENDRER DES CONTRAINTES THERMIQUES
#DEP0 = 0.0002;
DEP0 = 0.0;

t1 = 1.0;

t2 = (2 * t1);

t3 = (4 * t1);

dt = 0.05;

fx = 500000.0;


MAIL=LIRE_MAILLAGE();

MAIL=DEFI_GROUP(reuse =MAIL,
                MAILLAGE=MAIL,
                CREA_GROUP_NO=(_F(GROUP_MA='A1A2',),
                               _F(GROUP_MA='A4A3',),
                               _F(GROUP_MA='A2A4',),
                               _F(GROUP_MA='A3A1',),),);

MAIL=MODI_MAILLAGE(reuse =MAIL,
                   MAILLAGE=MAIL,
                   ORIE_NORM_COQUE=_F(GROUP_MA='DALLE',
                                      VECT_NORM=(0.,0.,1.,),
                                      GROUP_NO='A1',),);

MA=CREA_MAILLAGE(MAILLAGE=MAIL,
                 CREA_GROUP_MA=(_F(NOM='ACIER2L',
                                   GROUP_MA='DALLE',
                                   PREF_MAILLE='A2L',),
                                _F(NOM='ACIER1T',
                                   GROUP_MA='DALLE',
                                   PREF_MAILLE='A1T',),
                                _F(NOM='ACIER2T',
                                   GROUP_MA='DALLE',
                                   PREF_MAILLE='A2T',),
                                _F(NOM='ACIER1L',
                                   GROUP_MA='DALLE',
                                   PREF_MAILLE='A1L',),
                                _F(NOM='DALLE_G',
                                   GROUP_MA='DALLE',
                                   PREF_MAILLE='G',),),);


MO_G=AFFE_MODELE(MAILLAGE=MA,
                 INFO=1,
                 AFFE=_F(GROUP_MA='DALLE_G',
                         PHENOMENE='MECANIQUE',
                         MODELISATION='DKTG',),);

EGM = 35620000000.0;
EGF = 38700000000.0;

MAT_G=DEFI_MATERIAU(ELAS=_F(E=EGM,
                            NU=0.18, ALPHA = 1.E-5),
                    GLRC_DM=_F(GAMMA_T=0.02,
                               GAMMA_F=0.32,
                               NYT=3.7E5,
                               MYF=9.0E3,
                               EF=EGF,
                               NUF=0.17,),);

TEMP0=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_R', MAILLAGE=MA,
                   AFFE=_F( TOUT='OUI',
                            NOM_CMP=('TEMP_INF','TEMP_MIL','TEMP_SUP'),
#                            VALE=   (    0.   ,  0. ,    0.   ), ), )
                            VALE=   (    10.   ,  10. ,    10.   ), ), )

TEMP1=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_R', MAILLAGE=MA,
                   AFFE=_F( TOUT='OUI',
                            NOM_CMP=('TEMP_INF','TEMP_MIL','TEMP_SUP'),
#                            VALE=   (    -20.   ,  -20. ,    -20.   ), ), )
                            VALE=   (    -10.   ,  -10. ,    -10.   ), ), )

TEMP2=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_R', MAILLAGE=MA,
                   AFFE=_F( TOUT='OUI',
                            NOM_CMP=('TEMP_INF','TEMP_MIL','TEMP_SUP'),
#                            VALE=   (   20.   , 20. ,   20.   ), ), )
                            VALE=   (   30.   , 30. ,   30.   ), ), )

TEMPLI=CREA_RESU( OPERATION='AFFE',
                   TYPE_RESU='EVOL_THER',
                   NOM_CHAM='TEMP',
                   AFFE=(
                   _F( CHAM_GD=TEMP0,
                             INST=0.0,      ),
                   _F( CHAM_GD=TEMP1,
                             INST=1.0,      ),
                   _F( CHAM_GD=TEMP0,
                              INST=2.0,      ),
                   _F( CHAM_GD=TEMP2,
                             INST=3.0,      ),
                   _F( CHAM_GD=TEMP0,
                             INST=4.0,      ),
                          ), );

TEMPLI2=CREA_RESU( OPERATION='AFFE',
                   TYPE_RESU='EVOL_THER',
                   NOM_CHAM='TEMP',
                   AFFE=(
                   _F( CHAM_GD=TEMP0,
                             INST=0.0,      ),
                   _F( CHAM_GD=TEMP2,
                             INST=1.0,      ),
                   _F( CHAM_GD=TEMP0,
                             INST=2.0,      ),
                   _F( CHAM_GD=TEMP1,
                             INST=3.0,      ),
                   _F( CHAM_GD=TEMP0,
                             INST=4.0,      ),
                             ), );

MATER=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=_F(GROUP_MA='DALLE_G',
                             MATER=MAT_G,),
                    AFFE_VARC=_F(TOUT='OUI',EVOL=TEMPLI,NOM_VARC='TEMP',
                                     NOM_CHAM='TEMP',VALE_REF=(10.,)),)

MATER2=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=_F(GROUP_MA='DALLE_G',
                             MATER=MAT_G,),
                    AFFE_VARC=_F(TOUT='OUI',EVOL=TEMPLI2,NOM_VARC='TEMP',
                                     NOM_CHAM='TEMP',VALE_REF=(10.,)),)

COEF_DRZ = 1e-10;


CAEL_G=AFFE_CARA_ELEM(MODELE=MO_G,
                      COQUE=_F(GROUP_MA='DALLE_G',
                               EPAIS=EP,
                               ANGL_REP=(0.0,0.0,),
                               INER_ROTA='OUI',),);

COND_0G=AFFE_CHAR_MECA(MODELE=MO_G,
                       DDL_IMPO=(_F(GROUP_NO='A1',
                                    DX=0.0,
                                    DY=0.0,
                                    DZ=0.0,
                                    DRX=0.0,
                                    DRY=0.0,
                                    DRZ=0.0,),
                                 _F(GROUP_MA='A3A1',
                                    DX=0.0,
                                    DRY=0.0,),),);

COND_1G=AFFE_CHAR_MECA(MODELE=MO_G,
                       DDL_IMPO=_F(GROUP_MA='A2A4',
                                   DX=DEP0,),);

chf1=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,0.0,
                         t1,1.,
                         t2,-1.,
                         t3,0.0,
                         ),PROL_DROITE='CONSTANT',PROL_GAUCHE='CONSTANT',);

chf2=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,0.0,
                         t1,-1.,
                         t2,1.,
                         t3,0.0,
                         ),PROL_DROITE='CONSTANT',PROL_GAUCHE='CONSTANT',);

inst1=DEFI_LIST_REEL(DEBUT=0.0,
                     INTERVALLE=_F(JUSQU_A=t3,
                                   PAS=dt,),);

lisnt1=DEFI_LIST_INST(DEFI_LIST=_F(METHODE='MANUEL',
                                   LIST_INST=inst1,),
                      ECHEC=_F(ACTION        = 'DECOUPE',
                               SUBD_METHODE  = 'MANUEL',),);

#-----------------------------------------------
# CALCUL DES RESULTATS POUR LE CHARGEMENT chf1
#-----------------------------------------------

RESU_G1=STAT_NON_LINE(MODELE=MO_G,
                      CHAM_MATER=MATER,
                      CARA_ELEM=CAEL_G,
                      EXCIT=(_F(CHARGE=COND_0G,
                                FONC_MULT=chf1,),
                             _F(CHARGE=COND_1G,
                                FONC_MULT=chf1,),
                             ),
                      COMP_INCR=_F(RELATION='GLRC_DM',
                                   ITER_INTE_MAXI=30,),
                      INCREMENT=_F(LIST_INST=lisnt1,
                                   PRECISION=0.1,),
                      NEWTON=_F(REAC_ITER=1,),
                      CONVERGENCE=_F(ITER_GLOB_MAXI=26,),
                      ARCHIVAGE=_F(LIST_INST=inst1,),);

RESU_G1=CALC_CHAMP(reuse=RESU_G1,RESULTAT=RESU_G1,CONTRAINTE=('EFGE_ELNO',))

IMPR_RESU(RESU=_F(RESULTAT=RESU_G1,
                  NOM_CHAM=('DEPL','EFGE_ELNO',) , NUME_ORDRE=(20,40,60,80,),));

RESU_G1=CALC_CHAMP(reuse =RESU_G1,
                   RESULTAT=RESU_G1,
                   ENERGIE=('DISS_ELGA','DISS_ELNO','DISS_NOEU','DISS_ELEM'),
                   VARI_INTERNE=('VARI_ELNO','VARI_NOEU'),
                   FORCE=('FORC_NODA',),);


IMPR_RESU(RESU=_F(RESULTAT=RESU_G1,
                  NOM_CHAM='DISS_ELGA',NUME_ORDRE=(20,40,60,80,),));

TAB_DISS=POST_ELEM(RESULTAT=RESU_G1,
                   ENER_DISS=_F(TOUT='OUI'),);

IMPR_TABLE(TABLE=TAB_DISS,);


TFXA4_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A4FX',
                                 RESULTAT=RESU_G1,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A4',
                                 NOM_CMP='DX',),);

TFXA4_G1=CALC_TABLE(reuse =TFXA4_G1,
               TABLE=TFXA4_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TFXA2_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A2FX',
                                 RESULTAT=RESU_G1,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A2',
                                 NOM_CMP='DX',),);

TFXA2_G1=CALC_TABLE(reuse =TFXA2_G1,
               TABLE=TFXA2_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);


TFXA6_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A6FX',
                                 RESULTAT=RESU_G1,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A6',
                                 NOM_CMP='DX',),);


TFXA6_G1=CALC_TABLE(reuse =TFXA6_G1,
               TABLE=TFXA6_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TD_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                              INTITULE='A4FX',
                              RESULTAT=RESU_G1,
                              NOM_CHAM='VARI_NOEU',
                              GROUP_NO='A4',
                              NOM_CMP=('V1','V2',),),);

TD_G1=CALC_TABLE(reuse =TD_G1,
               TABLE=TD_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TD_G1=CALC_TABLE(reuse =TD_G1,
                 TABLE=TD_G1,
                 ACTION=(_F(OPERATION='EXTR',
                            NOM_PARA=('INST','V1','V2',),),
                         _F(OPERATION='RENOMME',
                            NOM_PARA=('V1','D1',),),
                         _F(OPERATION='RENOMME',
                            NOM_PARA=('V2','D2',),),),);

TDISS_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A5FX',
                                 RESULTAT=RESU_G1,
                                 NOM_CHAM='DISS_NOEU',
                                 GROUP_NO='A4',
                                 NOM_CMP=('ENDO',),),);

TDISS_G1=CALC_TABLE(reuse =TDISS_G1,
               TABLE=TDISS_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TDISS_G1=CALC_TABLE(reuse =TDISS_G1,
                    TABLE=TDISS_G1,
                    ACTION=_F(OPERATION='EXTR',
                              NOM_PARA=('INST','ENDO',),),);


TFXA2_G1=CALC_TABLE(reuse =TFXA2_G1,
                    TABLE=TFXA2_G1,
                    ACTION=(_F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA2',),),),);


TFXA4_G1=CALC_TABLE(reuse =TFXA4_G1,
                    TABLE=TFXA4_G1,
                    ACTION=(_F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA4',),),),);


TFXA6_G1=CALC_TABLE(reuse =TFXA6_G1,
                    TABLE=TFXA6_G1,
                    ACTION=(_F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA6',),),),);

SUM_FX = FORMULE(VALE='FXA2+FXA4+FXA6',
                 NOM_PARA=('FXA2','FXA4','FXA6',),);

D_REL_FX = FORMULE(VALE='(FXG-FX)/FX',
                   NOM_PARA=('FX','FXG',),);

D_REL_DY = FORMULE(VALE='(DYG-DY)/DY',
                   NOM_PARA=('DY','DYG',),);


TFX_G1=CALC_TABLE(TABLE=TFXA2_G1,
                  ACTION=(_F(OPERATION='FILTRE',
                             NOM_PARA='INST',
                             CRIT_COMP = 'GT',
                             VALE = 0.,),

                           _F(OPERATION='COMB',
                             TABLE=TFXA4_G1,
                             NOM_PARA='INST',),
                          _F(OPERATION='COMB',
                             TABLE=TFXA6_G1,
                             NOM_PARA='INST',),
                          _F(OPERATION='OPER',
                             FORMULE=SUM_FX,
                             NOM_PARA='FXG',),
                          _F(OPERATION='EXTR',
                             NOM_PARA=('INST','FXG',),),),);


TDY_G1=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                               INTITULE='A4DY',
                               RESULTAT=RESU_G1,
                               NOM_CHAM='DEPL',
                               GROUP_NO='A4',
                               NOM_CMP='DY',),);

TDY_G1=CALC_TABLE(reuse =TDY_G1,
               TABLE=TDY_G1,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TDY_G1=CALC_TABLE(reuse =TDY_G1,
                  TABLE=TDY_G1,
                  ACTION=(_F(OPERATION='EXTR',
                             NOM_PARA=('INST','DY',),),
                          _F(OPERATION='RENOMME',
                             NOM_PARA=('DY','DYG',),),),);


DETRUIRE(CONCEPT=_F(NOM=(TDY_G1,),),);


IMPR_TABLE(TABLE=TD_G1,);

IMPR_TABLE(TABLE=TDISS_G1,);

#----- TRACTION - PHASE ELASTIQUE -----


TEST_TABLE(CRITERE='ABSOLU',
           VALE_CALC=0.0,
           TOLE_MACHINE=1.E-3,
           NOM_PARA='ENDO',
           TABLE=TDISS_G1,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.050000000000000003,),
           )


TEST_TABLE(CRITERE='ABSOLU',
           VALE_CALC=8.2519176999999999,
           TOLE_MACHINE=1.E-3,
           NOM_PARA='ENDO',
           TABLE=TDISS_G1,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.75,),
           )

#----- TRACTION - PHASE ENDOMMAGEMENT -----

TEST_TABLE(CRITERE='ABSOLU',
           VALE_CALC=17.281652999999999,
           TOLE_MACHINE=1.E-3,
           NOM_PARA='ENDO',
           TABLE=TDISS_G1,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=1.0,),
           )




#-----------------------------------------------
#CALCUL DES RESULTATS POUR LE CHARGEMENT chf2
#-----------------------------------------------


RESU_G2=STAT_NON_LINE(MODELE=MO_G,
                      CHAM_MATER=MATER2,
                      CARA_ELEM=CAEL_G,
                      EXCIT=(_F(CHARGE=COND_0G,
                                FONC_MULT=chf2,),
                             _F(CHARGE=COND_1G,
                                FONC_MULT=chf2,),
                             ),
                      COMP_INCR=_F(RELATION='GLRC_DM',),
                      INCREMENT=_F(LIST_INST=inst1,
                                   PRECISION=0.1,),
                      NEWTON=_F(REAC_ITER=1,),
                      CONVERGENCE=_F(ITER_GLOB_MAXI=26,),
                      ARCHIVAGE=_F(LIST_INST=inst1,),);


IMPR_RESU(RESU=_F(RESULTAT=RESU_G2,
                  NOM_CHAM='DEPL', NUME_ORDRE=(20,40,),));

RESU_G2=CALC_CHAMP(reuse =RESU_G2,RESULTAT=RESU_G2,PRECISION=1.E-3,
             FORCE=('FORC_NODA',),
             VARI_INTERNE=('VARI_ELNO','VARI_NOEU',),
             )

TFXA4_G2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A4FX',
                                 RESULTAT=RESU_G2,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A4',
                                 NOM_CMP='DX',),);

TFXA4_G2=CALC_TABLE(reuse =TFXA4_G2,
               TABLE=TFXA4_G2,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TFXA2_G2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A2FX',
                                 RESULTAT=RESU_G2,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A2',
                                 NOM_CMP='DX',),);

TFXA2_G2=CALC_TABLE(reuse =TFXA2_G2,
               TABLE=TFXA2_G2,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);


TFXA6_G2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                 INTITULE='A6FX',
                                 RESULTAT=RESU_G2,
                                 NOM_CHAM='FORC_NODA',
                                 GROUP_NO='A6',
                                 NOM_CMP='DX',),);

TFXA6_G2=CALC_TABLE(reuse =TFXA6_G2,
               TABLE=TFXA6_G2,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TD_G2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                              INTITULE='A4FX',
                              RESULTAT=RESU_G2,
                              NOM_CHAM='VARI_NOEU',
                              GROUP_NO='A4',
                              NOM_CMP=('V1','V2',),),);

TD_G2=CALC_TABLE(reuse =TD_G2,
               TABLE=TD_G2,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TD_G2=CALC_TABLE(reuse =TD_G2,
                 TABLE=TD_G2,
                 ACTION=(_F(OPERATION='FILTRE',
                            NOM_PARA='INST',
                            CRIT_COMP = 'GT',
                            VALE = 0.,),
                         _F(OPERATION='EXTR',
                            NOM_PARA=('INST','V1','V2',),),
                         _F(OPERATION='RENOMME',
                            NOM_PARA=('V1','D1',),),
                         _F(OPERATION='RENOMME',
                            NOM_PARA=('V2','D2',),),),);

TFXA2_G2=CALC_TABLE(reuse =TFXA2_G2,
                    TABLE=TFXA2_G2,
                    ACTION=(_F(OPERATION='FILTRE',
                               NOM_PARA='INST',
                               CRIT_COMP = 'GT',
                               VALE = 0.,),
                            _F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA2',),),),);


TFXA4_G2=CALC_TABLE(reuse =TFXA4_G2,
                    TABLE=TFXA4_G2,
                    ACTION=(_F(OPERATION='FILTRE',
                               NOM_PARA='INST',
                               CRIT_COMP = 'GT',
                               VALE = 0.,),
                            _F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA4',),),),);

TFXA6_G2=CALC_TABLE(reuse =TFXA6_G2,
                    TABLE=TFXA6_G2,
                    ACTION=(_F(OPERATION='FILTRE',
                               NOM_PARA='INST',
                               CRIT_COMP = 'GT',
                               VALE = 0.,),
                            _F(OPERATION='EXTR',
                               NOM_PARA=('INST','DX',),),
                            _F(OPERATION='RENOMME',
                               NOM_PARA=('DX','FXA6',),),),);


TFX_G2=CALC_TABLE(TABLE=TFXA2_G2,
                  ACTION=(_F(OPERATION='FILTRE',
                             NOM_PARA='INST',
                             CRIT_COMP = 'GT',
                             VALE = 0.,),
                          _F(OPERATION='COMB',
                             TABLE=TFXA4_G2,
                             NOM_PARA='INST',),
                          _F(OPERATION='COMB',
                             TABLE=TFXA6_G2,
                             NOM_PARA='INST',),
                          _F(OPERATION='OPER',
                             FORMULE=SUM_FX,
                             NOM_PARA='FXG',),
                          _F(OPERATION='EXTR',
                             NOM_PARA=('INST','FXG',),),),);


DETRUIRE(CONCEPT=_F(NOM=(TFXA2_G2,TFXA4_G2,TFXA6_G2,TFX_G2,),),);

TDY_G2=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                               INTITULE='A4DY',
                               RESULTAT=RESU_G2,
                               NOM_CHAM='DEPL',
                               GROUP_NO='A4',
                               NOM_CMP='DY',),);

TDY_G2=CALC_TABLE(reuse =TDY_G2,
               TABLE=TDY_G2,
               ACTION=(_F(
                          OPERATION = 'FILTRE',
                          NOM_PARA  = 'NUME_ORDRE',
                          CRIT_COMP = 'GT',
                          VALE    = 0,
                         ),),);

TDY_G2=CALC_TABLE(reuse =TDY_G2,
                  TABLE=TDY_G2,
                  ACTION=(_F(OPERATION='FILTRE',
                             NOM_PARA='INST',
                             CRIT_COMP = 'GT',
                             VALE = 0.,),
                           _F(OPERATION='EXTR',
                             NOM_PARA=('INST','DY',),),
                          _F(OPERATION='RENOMME',
                             NOM_PARA=('DY','DYG',),),),);


DETRUIRE(CONCEPT=_F(NOM=(TDY_G2,),),);

IMPR_TABLE(TABLE=TD_G2,);

FIN()
