# MODIF  DATE 11/04/2013   AUTEUR BARGELLI R.BARGELLINI 
# TITRE PLAQUE FISSUREE EN THERMOELASTICITE: CALCUL DE DG
# hplp100b.para = tps_job 60 mem_job 64Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
# CALCUL DU TAUX DE RESTITUTION D'ENERGIE G(THETAF) EN 2D_PLAN
# (AVEC THETAF LA FONCTION THETA MODELISANT LA PROPAGATION DE
# FISSURE) ET DE SA DERIVEE PAR RAPPORT A UNE VARIATION DE DOMAINE
# PILOTEE PAR UNE FONCTION THETA SENSIBILITE, THETAS.
# ON EFFECTUE DEUX CALCULS AVEC DES CHARGEMENTS UTILISES EN POST
# TRAITEMENT PAR CALC_G, C'EST A DIRE QU'ILS N'ONT PAS
# SERVI POUR LE CALCUL ELASTIQUE LINEAIRE. UN MESSAGE D'ALARME
# EST EMIS POUR SIGNALER CETTE INCOHERENCE. D'AUTRE PART ILS
# SONT INTRINSEQUEMENT INDEPENDANTS DE LA VARIATION DE DOMAINE.
# POUR CHAQUE TYPE DE CHARGEMENT ON EFFECTUE DEUX SOUS-CALCULS
# (L'UN SUR LE MAILLAGE INITIAL, L'AUTRE SUR LE MAILLAGE DEPLACE)
# POUR LA DIFFERENCE FINIE. ON TESTE AINSI, EN TERME DE NON
# REGRESSION INFORMATIQUE, LES EVENTUELLES MODIFICATIONS EXTERNES
# IMPACTANT LE PROBLEME DIRECT ET/OU SA DERIVEE.
#

# -------------------------------------------------------------- #
# PREALABLES
# -------------------------------------------------------------- #

DEBUT(CODE=_F(NOM='HPLP100B', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='NON'))

MA=LIRE_MAILLAGE(   )

FONC1 = FORMULE(NOM_PARA=('X','Y'),VALE='1.E-8*(X**2)+1.E-6*Y+5.E-2')
FONC2 = FORMULE(NOM_PARA=('X','Y'),VALE='1.E-8*(Y**2)+1.E-6*X+5.E-2')
FONC3 = FORMULE(NOM_PARA=('X','Y'),VALE='1.E-8*(Y*X)+5.E-2')

# -------------------------------------------------------------- #
# PREMIER CALCUL AVEC LES DEUX TYPES DE CHARGEMENTS
# -------------------------------------------------------------- #

# DEFINITION DES MODELES, DES MATERIAUX, DU CHARGEMENT THERMIQUE


MOTH=AFFE_MODELE(       MAILLAGE=MA,
                             VERIF='MAILLE',
                              AFFE=_F( TOUT = 'OUI',
                                     PHENOMENE = 'THERMIQUE',
                                     MODELISATION = 'PLAN'))

MO=AFFE_MODELE(          MAILLAGE=MA, VERIF='MAILLE',
            AFFE=_F( TOUT = 'OUI', PHENOMENE = 'MECANIQUE', MODELISATION = 'D_PLAN'))

MATH=DEFI_MATERIAU( THER=_F(  RHO_CP = 0., LAMBDA = 1.0))

MAT=DEFI_MATERIAU(            ELAS=_F(  E = 20000.,
                                       NU = 0.3,
                                       RHO = 0.01,
                                       ALPHA = 0.000005))

CMTH=AFFE_MATERIAU(       MAILLAGE=MA,
                                AFFE=_F(  TOUT = 'OUI',
                                       MATER = MATH))

CHTH=AFFE_CHAR_THER(       MODELE=MOTH,TEMP_IMPO=(
                         _F( GROUP_NO = 'GRNM1',TEMP = -100.),
                         _F( GROUP_NO = 'GRNM3',TEMP = 100.)))

# AFFECTATION DU CHAMP THETA LIE A LA SENSIBILITE

THETAS=CALC_THETA(   OPTION='BANDE',
                      MODELE=MO,
                      THETA_BANDE=_F( MODULE = 1.,
                                   R_INF = -50.,
                                   R_SUP = -20.))

# CALCUL DE T ET DE SA DERIVEE LAGRANGIENNE LIEE A THETAS DL(T)

OUTTHL=THER_LINEAIRE(
              SENSIBILITE=(THETAS,),
                  MODELE=MOTH,
              CHAM_MATER=CMTH,
                  EXCIT=_F( CHARGE = CHTH))

# CHARGEMENT ET CALCUL MECANIQUE POUR OBTENIR U ET DL(U)

CH=AFFE_CHAR_MECA(  MODELE=MO,
                    #TEMP_CALCULEE=OUTTHL,
                    DDL_IMPO=(
                    _F(  GROUP_NO = 'GRNM2',      DY = 0.),
                    _F(  GROUP_NO = 'GRNM4',      DY = 0.),
                    _F(  NOEUD = 'N695',       DX = 0.)))

CM=AFFE_MATERIAU( MAILLAGE=MA,
                  AFFE=_F(  TOUT = 'OUI', MATER = MAT),
                  AFFE_VARC=_F(NOM_VARC='TEMP',TOUT = 'OUI', EVOL = OUTTHL, VALE_REF = 0.),)


OUTMES=MECA_STATIQUE(SENSIBILITE=(THETAS,),
                     MODELE=MO,
                     CHAM_MATER=CM,
                     EXCIT=_F( CHARGE = CH),
                     INFO=1,);

#CALC_ELEM( reuse= OUTMES ,RESULTAT= OUTMES , OPTION=('SIGM_ELNO', ),);

CALC_SENSI( reuse= OUTMES ,RESULTAT= OUTMES , SENSIBILITE=(THETAS,), INFO=1,
              OPTION=('SIGM_ELNO', ),);


# CREATION DE CHAMPS DE CONTRAINTES INITIALES
# SIXX=FONC1, SIYY=FONC2 ET SIZZ=FONC3

CHXN=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
                  NOM_CHAM='GEOMETRIE', MAILLAGE=MA )

CHXG=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELNO_GEOM_R',
                 MODELE=MO,   CHAM_GD=CHXN   )

SIG1=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='ELNO_NEUT_F',
                  MODELE=MO,  PROL_ZERO='OUI',
                  AFFE=_F( GROUP_MA=('GRSD1','GRSD2'), NOM_CMP = ('X1','X2','X3',),
                        VALE_F = (FONC1,FONC2,FONC3,)))

SIG2=CREA_CHAMP(OPERATION='EVAL', TYPE_CHAM='ELNO_NEUT_R',
                CHAM_F=SIG1,  CHAM_PARA=(CHXG,))

SIG3=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELNO_SIEF_R',
                  MODELE=MO,  PROL_ZERO='OUI',
                  ASSE=_F( TOUT = 'OUI',   CHAM_GD = SIG2,
                  NOM_CMP = ('X1','X2','X3',),
                  NOM_CMP_RESU = ('SIXX','SIYY','SIZZ',)))

# CHARGEMENTS SURFACIQUES ET DEFORMATIONS INITIALES

F1=AFFE_CHAR_MECA(       MODELE=MO,
                         PESANTEUR=_F(GRAVITE=10.,
                                       DIRECTION=(0.,-1.,0.,),),)

F2=AFFE_CHAR_MECA_F(           MODELE=MO,
                          FORCE_INTERNE=_F( TOUT = 'OUI',
                                    FX = FONC1,
                                    FY = FONC1),
                              EPSI_INIT=_F(  TOUT = 'OUI',
                                  EPXX = FONC1,
                                  EPYY = FONC2,
                                  EPXY = FONC3))


# AFFECTATION DU CHAMP THETA LIE A LA FISSURE

THETAF=CALC_THETA(      MODELE=MO,
                        THETA_2D=_F(  NOEUD = 'N3',
                                   MODULE = 1.0,
                                   R_INF = 10.,
                                   R_SUP = 45.),
                                  DIRECTION=(1.,0.,0.,))

# CALCULS DE G ET DG PROPREMENT DIT

G1=CALC_G(RESULTAT = OUTMES,
                  THETA=_F(THETA=THETAF),
                  EXCIT=(_F(CHARGE=CH),_F(CHARGE=F1),_F(CHARGE=F2),),
                  SYME_CHAR='SYME',)
IMPR_TABLE(TABLE=G1)

G1=CALC_G(reuse=G1,
                  SENSIBILITE=(THETAS,),
                  RESULTAT=OUTMES,
                  THETA=_F(THETA=THETAF),
                  EXCIT=(_F(CHARGE=CH),_F(CHARGE=F1),_F(CHARGE=F2),),
                  SYME_CHAR='SYME',)

IMPR_TABLE(TABLE=G1,SENSIBILITE=(THETAS,))

G2=CALC_G(RESULTAT=OUTMES,
                  THETA=_F(THETA=THETAF),
                  EXCIT=_F(CHARGE=CH,),
                  SYME_CHAR='SYME',
                  COMP_ELAS=_F(DEFORMATION = 'GROT_GDEP'),
                  ETAT_INIT=_F( SIGM = SIG3))
IMPR_TABLE(TABLE=G2)

G2=CALC_G( reuse=G2,
                   SENSIBILITE=(THETAS,),
                   RESULTAT=OUTMES,
                   THETA=_F(THETA=THETAF),
                   EXCIT=_F( CHARGE=CH,),
                   SYME_CHAR='SYME',
                   COMP_ELAS=_F(DEFORMATION = 'GROT_GDEP'),
                   ETAT_INIT=_F( SIGM = SIG3))
IMPR_TABLE(TABLE=G2,SENSIBILITE=(THETAS,))

# -------------------------------------------------------------- #
# SECOND CALCUL AVEC LES DEUX TYPES DE CHARGEMENTS
# -------------------------------------------------------------- #

# MODIFICATION DU MAILLAGE (M* = M + 1.D-3 * THETAS(M))

DEPL1=CREA_CHAMP(OPERATION='EXTR',  TYPE_CHAM='NOEU_DEPL_R',
                  NOM_CHAM='THETA', RESULTAT=THETAS, NUME_ORDRE=0)

DEPL2=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='NOEU_DEPL_R',
                   MAILLAGE=MA,
         ASSE=_F( TOUT = 'OUI', CHAM_GD = DEPL1, CUMUL = 'OUI', COEF_R = 1.E-3))

MODI_MAILLAGE(reuse=MA, MAILLAGE=MA,
                    DEFORME=_F( OPTION = 'TRAN', DEPL = DEPL2))

# DEFINITION DES MODELES, DES MATERIAUX, DU CHARGEMENT THERMIQUE

MOTH1=AFFE_MODELE(         MAILLAGE=MA,
                            VERIF='MAILLE',
                              AFFE=_F(  TOUT = 'OUI',
                                      PHENOMENE = 'THERMIQUE',
                                      MODELISATION = 'PLAN') )

MO1=AFFE_MODELE(            MAILLAGE=MA,
                                 VERIF='MAILLE',
                                AFFE=_F(  TOUT = 'OUI',
                                       PHENOMENE = 'MECANIQUE',
                                       MODELISATION = 'D_PLAN'))

CMTH1=AFFE_MATERIAU(       MAILLAGE=MA,
                                AFFE=_F(  TOUT = 'OUI',
                                       MATER = MATH))


CHTH1=AFFE_CHAR_THER(       MODELE=MOTH1,TEMP_IMPO=(
                         _F( GROUP_NO = 'GRNM1',TEMP = -100.),
                         _F( GROUP_NO = 'GRNM3',TEMP = 100.)))

# CALCUL DE T*

OUTTHL1=THER_LINEAIRE(
                  MODELE=MOTH1,
              CHAM_MATER=CMTH1,
                  EXCIT=_F( CHARGE = CHTH1))

# CHARGEMENT ET CALCUL MECANIQUE POUR OBTENIR U*

CH1=AFFE_CHAR_MECA(  MODELE=MO1,
                     #TEMP_CALCULEE=OUTTHL1,
                     DDL_IMPO=(
                     _F(  GROUP_NO = 'GRNM2',      DY = 0.),
                     _F(  GROUP_NO = 'GRNM4',      DY = 0.),
                     _F(  NOEUD = 'N695',       DX = 0.)))

CM1=AFFE_MATERIAU( MAILLAGE=MA,
                  AFFE=_F(  TOUT = 'OUI', MATER = MAT),
                  AFFE_VARC=_F(NOM_VARC='TEMP',TOUT = 'OUI', EVOL = OUTTHL1, VALE_REF = 0.),)

OUTMES1=MECA_STATIQUE(MODELE=MO1,
                      CHAM_MATER=CM1,
                      EXCIT=_F( CHARGE = CH1),);

CALC_ELEM( reuse= OUTMES1 ,RESULTAT= OUTMES1 , OPTION=('SIGM_ELNO',),)

# CREATION DE CHAMPS DE CONTRAINTES INITIALES
# SIXX=FONC1, SIYY=FONC2 ET SIZZ=FONC3

CHXN1=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
      NOM_CHAM='GEOMETRIE', MAILLAGE=MA )

CHXG1=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELNO_GEOM_R',
      MODELE=MO,   CHAM_GD=CHXN1   )

SIG4=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='ELNO_NEUT_F',
     MODELE=MO1,  PROL_ZERO='OUI',
     AFFE=_F( GROUP_MA=('GRSD1','GRSD2'), NOM_CMP = ('X1','X2','X3',),
                        VALE_F = (FONC1,FONC2,FONC3,)))

SIG5=CREA_CHAMP(OPERATION='EVAL', TYPE_CHAM='ELNO_NEUT_R',
      CHAM_F=SIG4,  CHAM_PARA=( CHXG1,)   )

SIG6=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELNO_SIEF_R',
      MODELE=MO1,  PROL_ZERO='OUI',
      ASSE=_F( TOUT = 'OUI',   CHAM_GD = SIG5,
            NOM_CMP = ('X1',  'X2',  'X3',),
            NOM_CMP_RESU = ('SIXX','SIYY','SIZZ',)))

# CHARGEMENTS SURFACIQUES ET DEFORMATIONS INITIALES

F11=AFFE_CHAR_MECA(       MODELE=MO1,
                             PESANTEUR=_F(GRAVITE=10.,
                                          DIRECTION=(0., -1., 0.,),),)

F21=AFFE_CHAR_MECA_F(           MODELE=MO1,
                               FORCE_INTERNE=_F( TOUT = 'OUI',
                             FX = FONC1,
                             FY = FONC1),
                          EPSI_INIT=_F(  TOUT = 'OUI',
                             EPXX = FONC1,
                             EPYY = FONC2,
                             EPXY = FONC3))

# CALCULS DE G* PROPREMENT DIT

G3=CALC_G(       RESULTAT = OUTMES1,
                            THETA=_F(THETA=THETAF),
                        EXCIT=(_F(CHARGE=CH1),_F(CHARGE=F11),_F(CHARGE=F21),),
                        SYME_CHAR='SYME',)

G4=CALC_G(         RESULTAT = OUTMES1,
                            THETA=_F(THETA=THETAF),
                           EXCIT=_F(CHARGE=CH1,),
                        SYME_CHAR='SYME',
                        COMP_ELAS=_F(DEFORMATION = 'GROT_GDEP'),
                       ETAT_INIT=_F( SIGM = SIG6))

# -------------------------------------------------------------- #
# VERIFICATIONS DES RESULTATS DE TYPE NON REGRESSION INFORMATIQUE
# VIS A VIS DE LA V6.0.19 SUR IRIX ET SOLARIS
# -------------------------------------------------------------- #

# PREMIER CHARGEMENT

TEST_TABLE(       TABLE=G1,
                NOM_PARA='G',
                     VALE=-1.7485815142480E+02,
               PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )


TEST_TABLE(       TABLE=G1,
             SENSIBILITE=(THETAS,),
                NOM_PARA='G',
                     VALE=-4.4234328022520E-01,
               PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )

# SECOND CHARGEMENT

TEST_TABLE(       TABLE=G2,
                NOM_PARA='G',
#                     VALE= 3.6523225110211-01,
              VALE = 0.36523225110211, 
              PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )

TEST_TABLE(       TABLE=G2,
             SENSIBILITE=(THETAS,),
                NOM_PARA='G',
                     VALE= 1.1050662977779E-02,
               PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )

# PREMIER CHARGEMENT AVEC LE MAILLAGE DECALE

TEST_TABLE(       TABLE=G3,
                NOM_PARA='G',
                     VALE=-1.7485859372839E+02,
               PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )

# SECOND CHARGEMENT AVEC LE MAILLAGE DECALE

TEST_TABLE(       TABLE=G4,
                NOM_PARA='G',
                     VALE= 3.6524330173584E-01,
               PRECISION=1.E-9,
               REFERENCE='NON_REGRESSION',
                 )

FIN()
#
#
