# TITRE TEST DES ONDES INCLINEES EN ISS 
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT( CODE=_F(NIV_PUB_WEB='INTERNET'))

MAIL0=LIRE_MAILLAGE(FORMAT='MED', );
MAILLAGE = CREA_MAILLAGE(MAILLAGE=MAIL0,
                  CREA_POI1 =_F(NOM_GROUP_MA = 'PC',
                                GROUP_NO = ('PC1','PC2','PC3',),
                                ),
                     );
#
MAILLAGE=DEFI_GROUP(reuse =MAILLAGE,
                MAILLAGE=MAILLAGE,
                CREA_GROUP_NO=_F(GROUP_MA=('SHAUT',),
                                ),
               );                            

MODELE = AFFE_MODELE( MAILLAGE= MAILLAGE,
          AFFE=(
                 _F( GROUP_MA=('SHAUT'),PHENOMENE= 'MECANIQUE',
                     MODELISATION= 'DST' ),
                 _F( GROUP_MA = 'PC',  PHENOMENE = 'MECANIQUE',
                     MODELISATION = 'DIS_T'),
                ),
                        ) ;
#

mat1     = DEFI_MATERIAU( ELAS=_F( E= 7.00E+7 , RHO= 2400.,
                                   AMOR_HYST = 0.1, 
                                   NU= 0.4  )    ) ;
                                    
                                    
 
champmat = AFFE_MATERIAU( MAILLAGE= MAILLAGE,
              AFFE=(
              _F( GROUP_MA= 'SHAUT' , MATER= mat1 ),
              )    
                           ) ;
                           
caraele=AFFE_CARA_ELEM( MODELE=MODELE,
 DISCRET=(
          _F( GROUP_MA = 'PC',    CARA = 'M_T_D_N',
              VALE = 0., ),
          _F( GROUP_MA = 'PC',    CARA = 'K_T_D_N',
              VALE = (0.,0.,0.) ),
          ),
 COQUE=(
          _F( GROUP_MA = 'SHAUT',  EPAIS=0.001, ),
          ),          
                        );
#
# La structure est encastree a l interface 
#-----------------------------------------
cond_lim = AFFE_CHAR_MECA( MODELE= MODELE,
                       DDL_IMPO=(
                                 _F( GROUP_NO = ('SHAUT'),
                                     DX = 0., DY = 0., DZ = 0.,
                                     #DRX=0.0, DRY=0.0, DRZ=0.0,
                                      ),
                                 _F( GROUP_NO = ('PC1','PC2','PC3',),
                                     DX = 0., DY = 0., DZ = 0., ),
                                 ),
                      #LIAISON_SOLIDE=_F(GROUP_MA=('SHAUT',),),
                                             ) ;
                                             
cond_li2 = AFFE_CHAR_MECA( MODELE= MODELE,
                       DDL_IMPO=(
                                 _F( GROUP_NO = ('PH'),
                                     DX = 0., DY = 0., DZ = 0.,
                                     DRX=0.0, DRY=0.0, DRZ=0.0, 
                                     ),
                                 _F( GROUP_NO = ('PC1','PC2','PC3',),
                                     DX = 0., DY = 0., DZ = 0., ),
                                 ),
                                             ) ;


ASSEMBLAGE(MODELE=MODELE,
                CHAM_MATER= champmat , CARA_ELEM= caraele,
                CHARGE= cond_lim,
                NUME_DDL=CO('nume_ddl'),
                SOLVEUR=_F(METHODE='MULT_FRONT',
                           RENUM='METIS',),
                MATR_ASSE=(_F(MATRICE=CO('rigidite'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('masse'),
                              OPTION='MASS_MECA',),
                           ),
                  );
                  
ASSEMBLAGE(MODELE=MODELE,
                CHAM_MATER= champmat , CARA_ELEM= caraele,
                CHARGE= cond_li2,
                NUME_DDL=CO('nume_dd2'),
                SOLVEUR=_F(METHODE='MULT_FRONT',
                           RENUM='METIS',),
                MATR_ASSE=(_F(MATRICE=CO('rigid2'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('masse2'),
                              OPTION='MASS_MECA',),
                           ),
                  );                  
#
# CALCUL DES MODES =
#---------------------------------------------



mode =MODE_ITER_SIMULT(MATR_RIGI=rigid2,
                       MATR_MASS=masse2,
                       PREC_SOREN=1.0,
                       NMAX_ITER_SOREN=100,
#                      CALC_FREQ=_F(NMAX_FREQ=1,),
                      CALC_FREQ=_F(OPTION='BANDE',FREQ=(-0.1,0.1,),),
                        );
                         

fo1 = DEFI_FONCTION ( NOM_PARA= 'FREQ', 
         VALE= ( 0., 1., 100., 1., ) );


mod_sta=MODE_STATIQUE(  MATR_RIGI=rigidite,
                     MODE_STAT=_F(
                     GROUP_NO = ('SHAUT',),
                     AVEC_CMP = ('DX','DY','DZ',),
                                 )
                     );
                                                                           
bamo=DEFI_BASE_MODALE( 
                    RITZ=( _F( MODE_MECA=mode, NMAX_MODE = 0),
                           _F( MODE_INTF = mod_sta,
                                     NMAX_MODE = 999)),
                         NUME_REF=nume_ddl);
                         
mael = MACR_ELEM_DYNA (BASE_MODALE= bamo,
                       MATR_RIGI=rigidite,
                       MATR_MASS=masse, 
                      );

                            
# ENTREE ACCELEROGRAMME

PAS1 = 1.0E-2 ;

TFIN = 4. ;

L_TEMP=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=_F(JUSQU_A=TFIN,
                                    PAS=PAS1,),);

OMEGA = 31.416 ;

FONSIN = FORMULE(NOM_PARA='INST',VALE='sin(OMEGA*INST) ')

ACCSIN=CALC_FONC_INTERP(FONCTION=FONSIN, NOM_PARA = 'INST',
                        NOM_RESU='EVOL', LIST_PARA=L_TEMP);
                        
FO2SIN = FORMULE(NOM_PARA='INST',VALE='0.00001*sin(OMEGA*INST) ')

AC2SIN=CALC_FONC_INTERP(FONCTION=FO2SIN, NOM_PARA = 'INST',
                        NOM_RESU='EVOL', LIST_PARA=L_TEMP);                        

IMPR_MACR_ELEM(MACR_ELEM_DYNA=mael,
               FORMAT='MISS_3D',
               UNITE=31,
               #AMOR_REDUIT=(0.05,),
               IMPR_MODE_MECA='NON',
               IMPR_MODE_STAT='OUI',
               GROUP_MA_INTERF= ('SHAUT'),
               GROUP_MA_CONTROL=('PC'),
               #FORMAT_R='1PE16.9',
               SOUS_TITRE= 'CYLINDRE SOL',
               );
               
               
IMPR_MISS_3D(MACR_ELEM_DYNA=mael,
             EXCIT_SOL=(
                        _F(DIRECTION=(1.0,0.0,0.0,),
                           FONC_SIGNAL=AC2SIN,
                           NOM_CHAM='ACCE',),
                        _F(DIRECTION=(0.0,1.0,0.0,),
                           FONC_SIGNAL=AC2SIN,
                           NOM_CHAM='ACCE',),
                        _F(DIRECTION=(0.0,0.0,1.0,),
                           FONC_SIGNAL=ACCSIN,
                           NOM_CHAM='ACCE',),
                        ),
             INST_INIT=0.0,
             INST_FIN=TFIN,
             PAS=1.E-2,
             UNITE=31,);

df = 1.0/TFIN
# fmax = 250*df 
fmax = 50.

MACRO_MISS_3D(OPTION=_F(TOUT='OUI',),
              PROJET= 'ZZZZ108B',
              REPERTOIRE= './ZZZZ108B',
              UNITE_IMPR_ASTER=31,
              UNITE_OPTI_MISS=21,
              UNITE_MODELE_SOL=22,
              VERSION='V1_4',
              PARAMETRE=_F(
               FREQ_MIN=df,
               FREQ_MAX=fmax,
               FREQ_PAS=df,
               Z0= 0.,
               SURF='OUI',
               # DREF=1.,
               ALGO='DEPL',
               OFFSET_MAX=60,
               OFFSET_NB=600,
               # DIRE_ONDE=(0.7071,0.,0.7071),
               DIRE_ONDE=(0.,0.,1.),
                           ),              
              );
              
MODESTAX=MODE_STATIQUE(  MATR_RIGI=rigidite,
                     MODE_STAT=_F(
                     GROUP_NO = ('PC1','PC2','PC3',),
                     AVEC_CMP = ('DX',),
                                 ));

MODESTAY=MODE_STATIQUE(  MATR_RIGI=rigidite,
                     MODE_STAT=_F(
                     GROUP_NO = ('PC1','PC2','PC3',),
                     AVEC_CMP = ('DY',),
                                 ));

MODESTAZ=MODE_STATIQUE(  MATR_RIGI=rigidite,
                     MODE_STAT=_F(
                     GROUP_NO = ('PC1','PC2','PC3',),
                     AVEC_CMP = ('DZ',),
                                 ));


bamo=DEFI_BASE_MODALE( reuse=bamo,
                    RITZ=( _F( BASE_MODALE=bamo),
                           _F( MODE_INTF = MODESTAX,
                                     NMAX_MODE = 999)),
                         NUME_REF=nume_ddl);

bamo=DEFI_BASE_MODALE( reuse=bamo,
                    RITZ=( _F( BASE_MODALE=bamo),
                           _F( MODE_INTF = MODESTAY,
                                     NMAX_MODE = 999)),
                         NUME_REF=nume_ddl);

bamo=DEFI_BASE_MODALE( reuse=bamo,
                    RITZ=( _F( BASE_MODALE=bamo),
                           _F( MODE_INTF = MODESTAZ,
                                     NMAX_MODE = 999)),
                         NUME_REF=nume_ddl);

DYNA=LIRE_MISS_3D(MACR_ELEM_DYNA=mael,
                     UNITE=27,
                     NOM = 'ZZZZ108B.01.t',
                     TYPE_RESU='TRANS',
                     TITRE='REPONSE SEISME X',
                     );
                     
                     
IMPR_RESU( RESU=_F(RESULTAT=DYNA, NOM_CHAM='ACCE', 
                   GROUP_NO=('PC1','PC2','PC3',),
                  ), );
                  
AZpc1 = RECU_FONCTION(RESULTAT=DYNA,NOM_CHAM='ACCE',NOM_CMP='DZ',GROUP_NO='PC1',);                  
AZpc2 = RECU_FONCTION(RESULTAT=DYNA,NOM_CHAM='ACCE',NOM_CMP='DZ',GROUP_NO='PC2',);
AZpc3 = RECU_FONCTION(RESULTAT=DYNA,NOM_CHAM='ACCE',NOM_CMP='DZ',GROUP_NO='PC3',);


IMPR_FONCTION ( UNITE  = 51,
                UNITE_DIGR= 83,
                FORMAT = 'AGRAF',
 COURBE= (
       _F(FONCTION= AZpc1 ),
       _F(FONCTION= AZpc2 ),
       _F(FONCTION= AZpc3 ),
       ),
           );                                          
                                                        
TEST_FONCTION(VALEUR=(_F(VALE_CALC=0.998536,
                         VALE_REFE=1.0,
                         CRITERE='RELATIF',
                         VALE_PARA=0.050000000000000003,
                         REFERENCE='ANALYTIQUE',
                         PRECISION=5.0000000000000001E-3,
                         FONCTION=AZpc1,),
                      _F(VALE_CALC=0.078022,
                         VALE_REFE=0.078619999999999995,
                         CRITERE='RELATIF',
                         VALE_PARA=0.20000000000000001,
                         REFERENCE='ANALYTIQUE',
                         PRECISION=1.E-2,
                         FONCTION=AZpc2,),
                      _F(VALE_CALC=-1.01066,
                         VALE_REFE=-1.0123599999999999,
                         CRITERE='RELATIF',
                         VALE_PARA=0.050000000000000003,
                         REFERENCE='ANALYTIQUE',
                         PRECISION=5.0000000000000001E-3,
                         FONCTION=AZpc3,),
                      ),
              )

FIN( );
