# TITRE ESTIMATEUR D'ERREUR SUR UNE PLAQUE TROUEE EN TRACTION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
# MODELISATION 1 : ELEMENTS MECANIQUE C_PLAN TRIA3
# ----------------------------------------------------------------------

DEBUT(CODE=_F(
              NIV_PUB_WEB='INTERNET',),
      DEBUG=_F(SDVERI='OUI',),);

MI=LIRE_MAILLAGE(FORMAT='MED',);

IMPR_RESU(FORMAT='MED',
          UNITE=80,
          RESU=_F(MAILLAGE=MI,),);

M=LIRE_MAILLAGE(UNITE=80,
                FORMAT='MED',
                INFO=2,);

MO=AFFE_MODELE(MAILLAGE=M,
               VERIF='MAILLE',
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='C_PLAN',),);

MA=DEFI_MATERIAU(ELAS=_F(E=1000.,
                         NU=0.3,
                         ALPHA=0.,),
                 THER=_F(LAMBDA=0.,
                         RHO_CP=1.,),);

CM=AFFE_MATERIAU(MAILLAGE=M,
                 AFFE=_F(TOUT='OUI',
                         MATER=MA,),);

F1 = FORMULE(VALE=
"""
1.-(1.5*cos(2.*atan2(Y,4.))+cos(4.*atan2(Y,4.))) /(16.+Y*Y)
                            +(3.*cos(4.*atan2(Y,4.)))/(2.*(16.+Y*Y)**2)
              """,
             NOM_PARA='Y',);

F2 = FORMULE(VALE=
"""
-(0.5*sin(2.*atan2(Y,4.))+sin(4.*atan2(Y,4.))) /(16.+Y*Y)
                             +(3.*sin(4.*atan2(Y,4.)))/(2.*(16.+Y*Y)**2)
              """,
             NOM_PARA='Y',);

F3 = FORMULE(VALE=
"""
-(0.5*sin(2.*atan2(4.,X))+sin(4.*atan2(4.,X))) /(16.+X*X)
                             +(3.*sin(4.*atan2(4.,X)))/(2.*(16.+X*X)**2)
              """,
             NOM_PARA='X',);

F4 = FORMULE(VALE=
"""
-(0.5*cos(2.*atan2(4.,X))-cos(4.*atan2(4.,X))) /(16.+X*X)
                             -(3.*cos(4.*atan2(4.,X)))/(2.*(16.+X*X)**2)
              """,
             NOM_PARA='X',);

SIXX = FORMULE(VALE="""
1.-(1.5*cos(2.*TH)+cos(4.*TH)) /(R*R)
          +(1.5*cos(4.*TH))/(R**4)
       """,
               NOM_PARA=('R','TH',),);

SIYY = FORMULE(VALE="""
-(0.5*cos(2.*TH)-cos(4.*TH)) /(R*R)
          -(1.5*cos(4.*TH))/(R**4)
              """,
               NOM_PARA=('R','TH',),);

SIXY = FORMULE(VALE="""
-(0.5*sin(2.*TH)+sin(4.*TH)) /(R*R)
          +(1.5*sin(4.*TH))/(R**4)
              """,
               NOM_PARA=('R','TH',),);

CH1=AFFE_CHAR_MECA(MODELE=MO,
                   FACE_IMPO=(_F(GROUP_MA='GRMA1',
                                 DY=0.,),
                              _F(GROUP_MA='GRMA2',
                                 DX=0.,),),);

CH2=AFFE_CHAR_MECA_F(MODELE=MO,
                     FORCE_CONTOUR=(_F(GROUP_MA='GRMA3',
                                       FX=F1,
                                       FY=F2,),
                                    _F(GROUP_MA='GRMA4',
                                       FX=F3,
                                       FY=F4,),),);

RESU=MECA_STATIQUE(MODELE=MO,
                   CHAM_MATER=CM,
                   EXCIT=(_F(CHARGE=CH1,),
                          _F(CHARGE=CH2,),),);

RESU=CALC_ERREUR(reuse =RESU,
                 RESULTAT=RESU,
                 TOUT_ORDRE='OUI',
                 SOLVEUR=_F(METHODE='MULT_FRONT'),
                 OPTION=('ERZ1_ELEM','ERZ2_ELEM','ERME_ELEM','ERME_ELNO',),);

SIGZZ1=CREA_CHAMP(TYPE_CHAM='NOEU_SIEF_R',
                  OPERATION='EXTR',
                  RESULTAT=RESU,
                  NOM_CHAM='SIZ1_NOEU',
                  NUME_ORDRE=1,);

SIGZZ2=CREA_CHAMP(TYPE_CHAM='NOEU_SIEF_R',
                  OPERATION='EXTR',
                  RESULTAT=RESU,
                  NOM_CHAM='SIZ2_NOEU',
                  NUME_ORDRE=1,);

TEST_RESU(CHAM_NO=(_F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO13',
                      PRECISION=0.059999999999999998,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=2.822741476,
                      VALE_REFE=SIXX(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO11',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=1.152000941,
                      VALE_REFE=SIXX(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO12',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=1.031685579,
                      VALE_REFE=SIXX(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO10',
                      PRECISION=0.29999999999999999,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.140296001,
                      VALE_REFE=SIXX(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO13',
                      PRECISION=0.29999999999999999,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=0.260830248,
                      VALE_REFE=SIYY(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO11',
                      PRECISION=0.040000000000000001,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.150296120,
                      VALE_REFE=SIYY(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO12',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.029763912,
                      VALE_REFE=SIYY(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO10',
                      PRECISION=0.14999999999999999,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.861529470,
                      VALE_REFE=SIYY(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO13',
                      PRECISION=0.10000000000000001,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-7.39333202E-03,
                      VALE_REFE=SIXY(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO11',
                      PRECISION=0.070000000000000007,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.117366721,
                      VALE_REFE=SIXY(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO12',
                      PRECISION=0.089999999999999997,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.016974311,
                      VALE_REFE=SIXY(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO10',
                      PRECISION=0.10000000000000001,
                      CHAM_GD=SIGZZ1,
                      VALE_CALC=-0.011194828,
                      VALE_REFE=SIXY(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   ),
          )

TEST_RESU(CHAM_NO=(_F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO13',
                      PRECISION=0.040000000000000001,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=2.884474068,
                      VALE_REFE=SIXX(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO11',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=1.144967713,
                      VALE_REFE=SIXX(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO12',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=1.028061328,
                      VALE_REFE=SIXX(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXX',
                      GROUP_NO='GRNO10',
                      PRECISION=0.29999999999999999,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.138947297,
                      VALE_REFE=SIXX(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO13',
                      PRECISION=0.29999999999999999,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=0.207365068,
                      VALE_REFE=SIYY(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO11',
                      PRECISION=0.070000000000000007,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.145315139,
                      VALE_REFE=SIYY(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO12',
                      PRECISION=0.080000000000000002,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.027429027489770,
                      VALE_REFE=SIYY(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIYY',
                      GROUP_NO='GRNO10',
                      PRECISION=0.12,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.889484484,
                      VALE_REFE=SIYY(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO13',
                      PRECISION=0.10000000000000001,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.061135284,
                      VALE_REFE=SIXY(1.0,1.57079632679,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO11',
                      PRECISION=1.E-2,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.124150510,
                      VALE_REFE=SIXY(2.0,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='RELATIF',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO12',
                      PRECISION=0.029999999999999999,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=-0.016009843430519,
                      VALE_REFE=SIXY(5.656854,0.785398163397,),
                      REFERENCE='ANALYTIQUE',),
                   _F(CRITERE='ABSOLU',
                      NOM_CMP='SIXY',
                      GROUP_NO='GRNO10',
                      PRECISION=0.10000000000000001,
                      CHAM_GD=SIGZZ2,
                      VALE_CALC=0.036554103,
                      VALE_REFE=SIXY(1.0,0.0,),
                      REFERENCE='ANALYTIQUE',),
                   ),
          )

IMPR_RESU(MODELE=MO,
          RESU=(_F(RESULTAT=RESU,
                   NOM_CHAM='SIZ1_NOEU',
                   NUME_ORDRE=1,
                   VALE_MAX='OUI',
                   VALE_MIN='OUI',
                   SOUS_TITRE='CONTRAINTES AUX NOEUDS ZZ1',),
                _F(RESULTAT=RESU,
                   NOM_CHAM='SIZ2_NOEU',
                   NUME_ORDRE=1,
                   VALE_MAX='OUI',
                   VALE_MIN='OUI',
                   SOUS_TITRE='CONTRAINTES AUX NOEUDS ZZ2',),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERZ1_ELEM',
                   NUME_ORDRE=1,
                   VALE_MAX='OUI',
                   VALE_MIN='OUI',
                   SOUS_TITRE='ESTIMATEUR DERREUR ZZ1',),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERZ1_ELEM',
                   NUME_ORDRE=1,
                   NOM_CMP='NUEST',
                   BORNE_INF=10.0,
                   SOUS_TITRE=('ESTIMATEUR DERREUR ZZ1:LISTE DES MAILLES OU LERREUR RELATIVE ','EST SUPERIEURE A 10 POUR CENT',),),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERZ2_ELEM',
                   NUME_ORDRE=1,
                   VALE_MAX='OUI',
                   VALE_MIN='OUI',
                   SOUS_TITRE='ESTIMATEUR DERREUR ZZ2',),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERZ2_ELEM',
                   NUME_ORDRE=1,
                   NOM_CMP='NUEST',
                   BORNE_INF=10.0,
                   SOUS_TITRE=('ESTIMATEUR DERREUR ZZ2:LISTE DES MAILLES OU LERREUR RELATIVE ','EST SUPERIEURE A 10 POUR CENT',),),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERME_ELEM',
                   NUME_ORDRE=1,
                   VALE_MAX='OUI',
                   VALE_MIN='OUI',
                   SOUS_TITRE='ESTIMATEUR DERREUR EN RESIDU',),
                _F(RESULTAT=RESU,
                   NOM_CHAM='ERME_ELEM',
                   NUME_ORDRE=1,
                   NOM_CMP='NUEST',
                   BORNE_INF=10.0,
                   SOUS_TITRE=
                   ('ESTIMATEUR DERREUR EN RESIDU :LISTE DES MAILLES OU LERREUR  ',
                                'RELATIVE EST SUPERIEURE A 10 POUR CENT',),),),);

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERZ1_ELEM',
                   NOM_CMP='NUEST',
                   VALE_CALC=5.5623935928036,
                   VALE_REFE=0.0,
                   PRECISION=5.6,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERZ2_ELEM',
                   NOM_CMP='NUEST',
                   VALE_CALC=3.1980631225982,
                   VALE_REFE=0.0,
                   PRECISION=3.2,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERME_ELEM',
                   NOM_CMP='ERREST',
                   VALE_CALC= 1.72248100E-04,
                   VALE_REFE=0.0,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   PRECISION=6.0E-3,
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERME_ELEM',
                   NOM_CMP='NUEST',
                   VALE_CALC=0.283465558,
                   VALE_REFE=0.0,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   PRECISION=10.0,
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERME_ELNO',
                   NOM_CMP='ERREST',
                   VALE_CALC= 1.72248100E-04,
                   VALE_REFE=0.0,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   PRECISION=6.0E-3,
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   POINT=1,
                   RESULTAT=RESU,
                   NOM_CHAM='ERME_ELNO',
                   NOM_CMP='NUEST',
                   VALE_CALC=0.283465558,
                   VALE_REFE=0.0,
                   REFERENCE='ANALYTIQUE',
                   CRITERE='ABSOLU',
                   PRECISION=10.0,
                   MAILLE='M1',),
                ),
          )

# POUR TESTER LE MOT CLE DEFORME DE LA COMMANDE MODI_MAILLAGE :
# ------------------------------------------------------------

DEPL1=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                 OPERATION='EXTR',
                 RESULTAT=RESU,
                 NOM_CHAM='DEPL',
                 NUME_ORDRE=1,);

M=MODI_MAILLAGE(reuse =M,
                MAILLAGE=M,
                DEFORME=_F(OPTION='TRAN',
                           DEPL=DEPL1,),);

MO2=AFFE_MODELE(MAILLAGE=M,
                AFFE=_F(TOUT='OUI',
                        PHENOMENE='MECANIQUE',
                        MODELISATION='C_PLAN',),);

CH21=AFFE_CHAR_MECA(MODELE=MO2,
                    FACE_IMPO=(_F(GROUP_MA='GRMA1',
                                  DY=0.,),
                               _F(GROUP_MA='GRMA2',
                                  DX=0.,),),);

CH22=AFFE_CHAR_MECA_F(MODELE=MO2,
                      FORCE_CONTOUR=(_F(GROUP_MA='GRMA3',
                                        FX=F1,
                                        FY=F2,),
                                     _F(GROUP_MA='GRMA4',
                                        FX=F3,
                                        FY=F4,),),);

RESU2=MECA_STATIQUE(MODELE=MO2,
                    CHAM_MATER=CM,
                    EXCIT=(_F(CHARGE=CH21,),
                           _F(CHARGE=CH22,),),);

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   RESULTAT=RESU,
                   NOM_CHAM='DEPL',
                   NOEUD='N184',
                   NOM_CMP='DX',
                   VALE_CALC=2.594556E-3,
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=RESU2,
                   NOM_CHAM='DEPL',
                   NOEUD='N184',
                   NOM_CMP='DX',
                   VALE_CALC=2.5956350000000002E-3,
                   ),
                ),
          )

FIN();

#
