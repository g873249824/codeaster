# MODIF  DATE 18/01/2011   AUTEUR PROIX J-M.PROIX 
# RESPONSABLE PROIX J-M.PROIX
# TITRE : VARIATION TEMPERATURE DANS LE COMPORTEMENT 'ELAS' ORTHOTROPE sous COMP_INCR
# comp008b.para = tps_job 300 mem_job 512Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
#         MATERIAU ORTHOTROPE (avec valeur isotrope)
# CAS-TEST DE REFERENCE : SSLS101E
#===================================================================== 

DEBUT(CODE=_F(NOM='COMP008B',NIV_PUB_WEB='INTERNET'),PAR_LOT='NON')

import numpy as N


MATER  = [None]*20
RESU   = [None]*20

epsi = 1.E-10

TINF1=45
TSUP1=65.
T1=50
TR1=T1 + ( ( TSUP1 + TINF1 - ( 2. * T1 ) ) / 6. )

TINF2=70.
TSUP2=90.
T2=75.
TR2=T2 + ( ( TSUP2 + TINF2 - ( 2. * T2 ) ) / 6. )

TINF3=95.
TSUP3=115
T3=100.
TR3=T3 + ( ( TSUP3 + TINF3 - ( 2. * T3 ) ) / 6. )

TREF = TR1
T0   = TR1
Tmax = TR3

ZERO =DEFI_CONSTANTE(VALE=0.0);

UN   =DEFI_CONSTANTE(VALE=1.0);

#=========================================================== 
#                  RELATION = 'ELAS'
#===========================================================
# 
# INITIALISATIONS

tmax = 1.

NCAL = 20

compor='ELAS'


E1=1.
E2=1.1
E3=1.2

# Module de cisaillement isotrope: G = E/2/(1+NU)
G1=E1/2
G2=E2/2
G3=E3/2
 
YOUN_L=DEFI_FONCTION(  NOM_PARA='TEMP',
                       VALE=( TR1, E1,  TR2, E2,  TR3, E3, )  )
YOUN_T=DEFI_FONCTION(  NOM_PARA='TEMP',
                       VALE=( TR1, E1,  TR2, E2,  TR3, E3, )  )

 
ALPHA1=DEFI_FONCTION(NOM_PARA='TEMP',
                     VALE=(TR1, 1.0E-5,
                           TR2, 1.5E-5,
                           TR3, 2.0E-5
                           ),);

ALPHA2=DEFI_FONCTION(NOM_PARA='TEMP',
                     VALE=(TR1, 1.0E-5,
                           TR2, 1.5E-5,
                           TR3, 2.0E-5
                           ),);

MCISA_1=DEFI_FONCTION(  NOM_PARA='TEMP',
                   VALE=( TR1, G1,  TR2, G2,  TR3, G3, )  )

MCISA_2=DEFI_FONCTION(  NOM_PARA='TEMP',
                   VALE=( TR1, G1,  TR2, G2,  TR3, G3, )  )

MATERI=DEFI_MATERIAU(  ELAS_ORTH_FO=_F(E_L   = YOUN_L,
                                       E_T   = YOUN_T, 
                                       E_N   = YOUN_L,
                                       NU_LN = ZERO, 
                                       NU_LT = ZERO, 
                                       NU_TN = ZERO,
                                       G_LT  = MCISA_1,  
                                       G_LN  = MCISA_2, 
                                       G_TN  = MCISA_1,
                                       TEMP_DEF_ALPHA = TREF,
                                       ALPHA_L = ALPHA1,
                                       ALPHA_T = ALPHA2,
                                       ALPHA_N = ALPHA2,), 
                    );

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=(_F(JUSQU_A=1,
                                     NOMBRE=NCAL,),
                                    ),);

TIMP=DEFI_FONCTION(
                      NOM_PARA='INST',  NOM_RESU='TEMP',
                       VALE=(  0. , TREF, 1. , Tmax)
                   )

U=SIMU_POINT_MAT(COMP_INCR=_F(RELATION=compor,),
                 MATER=MATERI,
                 SUPPORT='ELEMENT',
                   AFFE_VARC=(
                   _F(  NOM_VARC='TEMP',
                        VALE_FONC=TIMP,
                        VALE_REF=TREF),
                        ),
                 INCREMENT=_F(LIST_INST=L_INST,),
                 NEWTON=_F(PREDICTION='ELASTIQUE',
                           MATRICE='TANGENTE',
                           REAC_ITER=1,),
                 EPSI_IMPOSE=_F(EPXX=ZERO,),
                 INFO=1,);

IMPR_TABLE(TABLE=U,);


SXM = 0.
EXM=0.

time = 0.


for i in range(NCAL):
          
          timem = time 
          
          time = timem + tmax/NCAL
            
          Ti = T0 + time/tmax * (Tmax - T0)
          
          Tm = T0 + timem/tmax * (Tmax - T0)
          
          # deformation mecanique imposee correspondant a la deformation thermique du premier calcul
          
          epsimp =DEFI_CONSTANTE(VALE=-ALPHA1(Ti)*(Ti - TREF));

          print 'i=',i, ' instant=', time, ' Temperature=',Ti
          
          # variation des coef du comportement avec la temperature
          # correction eventuelle des valeurs initiales du temps ti 
          
          if i > 0 :
             SXM = SXM *(YOUN_L(Ti)/YOUN_L(Tm))
             
          MATER[i]=DEFI_MATERIAU(  ELAS_ORTH=_F( E_L     = YOUN_L(Ti), 
                                                 E_T     = YOUN_T(Ti),
                                                 E_N     = YOUN_L(Ti),
                                                 NU_LN   = 0., 
                                                 NU_LT   = 0., 
                                                 NU_TN   = 0.,
                                                 G_LT  = MCISA_1(Ti),  
                                                 G_LN  = MCISA_2(Ti), 
                                                 G_TN  = MCISA_1(Ti),
                                                 ALPHA_L = 0.,
                                                 ALPHA_T = 0.,
                                                 ALPHA_N = 0.,),
                                  );

          list = DEFI_LIST_REEL(DEBUT=timem,
                      INTERVALLE=(_F(JUSQU_A=time,NOMBRE=1,),),);
                                     
          RESU[i]=SIMU_POINT_MAT(COMP_INCR=_F(RELATION=compor,),
                                 MATER=MATER[i],
                                 SUPPORT='ELEMENT',
                                 INCREMENT=_F(LIST_INST = list, ),
                                 NEWTON=_F( PREDICTION='ELASTIQUE',
                                             MATRICE='TANGENTE',
                                             REAC_ITER=1,),
                                 EPSI_IMPOSE=_F(EPXX=epsimp),
                                 SIGM_INIT=_F(SIXX=SXM),
                                 EPSI_INIT=_F(EPXX=EXM, EPYY=0.,EPZZ=0.,EPXY=0.,EPXZ=0.,EPYZ=0.),
                                 INFO=1,);
                                 
           # recuperation des valeurs initiales du futur pas de temps dans la table resultat
          
          EXM = RESU[i]['EPXX',1]
             
          SXM = RESU[i]['SIXX',1]
          
          #IMPR_TABLE(TABLE=RESU[i]);
          
          DETRUIRE ( CONCEPT =  _F (NOM =epsimp),);
          DETRUIRE ( CONCEPT =  _F (NOM =list),);
          
          TEST_TABLE(TABLE=RESU[i],
                     NOM_PARA='VMIS',VALE=U['VMIS',i+1],
                     FILTRE=_F(NOM_PARA='INST',VALE=time),
                     REFERENCE='AUTRE_ASTER',);

          TEST_TABLE(TABLE=RESU[i],
                     NOM_PARA='TRACE',VALE=U['TRACE',i+1],
                     FILTRE=_F(NOM_PARA='INST',VALE=time),
                     REFERENCE='AUTRE_ASTER',);
FIN();
