# TITRE CONTACT DE DEUX POUTRES EN GRANDS DEPLACEMENTS
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

# CAS TEST  SSNV505J
# MODELE MIXTE 3D POU_D_TGM
# MAILLAGE : ELEMENT 3D HEXA A 8 NOEUDS + SEG2
# UNITES   : NEWTON , MILLIMETRE , SECONDE (N,MM,S)

DEBUT(CODE=_F(NOM='SSNV505J',
              NIV_PUB_WEB='INTERNET',
              VISU_EFICAS='OUI',),);


# Maillage 3D et poutre

MA=LIRE_MAILLAGE(FORMAT='MED',);

MA=MODI_MAILLAGE(reuse =MA,
                 MAILLAGE=MA,
                 ORIE_PEAU_3D=_F(GROUP_MA='SMAI',),);

MA=DEFI_GROUP(reuse =MA,
              MAILLAGE=MA,
              CREA_GROUP_MA=_F(NOM='STRUCT',
                               TOUT='OUI',),
              CREA_GROUP_NO=(_F(GROUP_MA='STRUCT',),
                             _F(GROUP_MA='SA',),),);

# Maillage de la section de poutre (multi-fibres)

MASECT=LIRE_MAILLAGE(UNITE=21,
                     FORMAT='MED',);

GF=DEFI_GEOM_FIBRE(SECTION=_F(GROUP_FIBRE='GFIB1',
                              TOUT_SECT='OUI',
                              MAILLAGE_SECT=MASECT,
                              COOR_AXE_POUTRE=(0,0,),),);

# Modele 3D et poutre

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=(_F(GROUP_MA='POUBAS',
                        PHENOMENE='MECANIQUE',
                        MODELISATION='3D',),
                     _F(GROUP_MA='POUHAU',
                        PHENOMENE='MECANIQUE',
                        MODELISATION='POU_D_TGM',),),);

# Materiau

MATER=DEFI_MATERIAU(ELAS=_F(E=6894.8,
                            NU=0.3333,),);

COMPF=DEFI_COMPOR(GEOM_FIBRE=GF,
                  MATER_SECT=MATER,
                  MULTIFIBRE=_F(GROUP_FIBRE='GFIB1',
                                MATER=MATER, RELATION='ELAS',),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=_F(TOUT='OUI',
                            MATER=MATER,),
                    AFFE_COMPOR=_F(GROUP_MA='POUHAU',
                                   COMPOR=COMPF,),);

# Caracteristiques de poutres multi-fibres

CELEM=AFFE_CARA_ELEM(MODELE=MO,
                     POUTRE=_F(GROUP_MA='POUHAU',
                               SECTION='GENERALE',
                               CARA=('A','IY','IZ','AY','AZ','JX','JG','IYR2','IZR2',),
                               VALE=(645.16,5549.7523413333333333,216787.2008333333333333,1.2,1.2,5.08,0,0,0,),),
                     GEOM_FIBRE=GF,
                     MULTIFIBRE=_F(GROUP_MA='POUHAU',
                                   GROUP_FIBRE='GFIB1',),);

# Chargement

CL=AFFE_CHAR_MECA(MODELE=MO,
                  DDL_IMPO=(_F(GROUP_MA='SA',
                               LIAISON='ENCASTRE',),
                            _F(GROUP_NO='B',
                               LIAISON='ENCASTRE',),
                            _F(GROUP_NO='STRUCT',
                               DZ=0,),
                            _F(GROUP_MA='POUHAU',
                               DRX=0,
                               DRY=0,),),);

CHARGE=AFFE_CHAR_MECA(MODELE=MO,
                      DDL_IMPO=_F(GROUP_NO='C',
                                  DY=-790,),);

RAMPE=DEFI_FONCTION(NOM_PARA='INST',VALE=(0,0,
                          1,1,
                          ),);

# Contact discret et continu

DIST_E=DEFI_CONSTANTE(VALE=31.75,);

CONTD=DEFI_CONTACT(MODELE=MO,
                   FORMULATION='DISCRETE',
                   FROTTEMENT='SANS',
                   ZONE=_F(GROUP_MA_MAIT='SMAI',
                           GROUP_MA_ESCL='SESC',
                           DIST_ESCL=DIST_E,
                           ),);

CONTC=DEFI_CONTACT(MODELE=MO,
                   FORMULATION='CONTINUE',
                   ALGO_RESO_CONT = 'POINT_FIXE',
                   ALGO_RESO_GEOM = 'POINT_FIXE',
                   FROTTEMENT='SANS',
                   ZONE=_F(GROUP_MA_MAIT='SMAI',
                           GROUP_MA_ESCL='SESC',
                           DIST_ESCL=DIST_E,
                           ),);


# Pas de calcul/archivage

L_TEMPS=DEFI_LIST_REEL(DEBUT=0,
                       INTERVALLE=_F(JUSQU_A=1,
                                     NOMBRE=50,),);

L_ARCH=DEFI_LIST_REEL(DEBUT=0,
                      INTERVALLE=_F(JUSQU_A=1,
                                    NOMBRE=25,),);

# --------------------------------------------
# 1er calcul : formulation discrete de contact
# --------------------------------------------

RESUD=STAT_NON_LINE(MODELE=MO,
                    CHAM_MATER=CHMAT,
                    CARA_ELEM=CELEM,
                    EXCIT=(_F(CHARGE=CL,),
                           _F(CHARGE=CHARGE,
                              FONC_MULT=RAMPE,),),
                    CONTACT=CONTD,
                    COMP_INCR=(_F(RELATION='ELAS',
                                  DEFORMATION='GROT_GDEP',
                                  GROUP_MA='POUBAS',),
                               _F(RELATION='MULTIFIBRE',DEFORMATION='GROT_GDEP',
                                  GROUP_MA='POUHAU',),),
                    INCREMENT=_F(LIST_INST=L_TEMPS,),
                    NEWTON=_F(REAC_ITER=1,),
                    SOLVEUR=_F(SYME='OUI',),
                    CONVERGENCE=_F(ITER_GLOB_MAXI=41,),
                    ARCHIVAGE=_F(LIST_INST=L_ARCH,),);

RESUD=CALC_CHAMP(reuse =RESUD,
              RESULTAT=RESUD,
              FORCE='FORC_NODA',);

T_REACD=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                INTITULE='Reaction nodale de contact',
                                RESULTAT=RESUD,
                                NOM_CHAM='FORC_NODA',
                                GROUP_NO=('B','SA',),
                                RESULTANTE='DY',),);

TEST_TABLE(
           VALE_CALC=311.88546737562,
           NOM_PARA='DY',
           TABLE=T_REACD,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.2,),
           )

TEST_TABLE(
           VALE_CALC=1498.475070966,
           NOM_PARA='DY',
           TABLE=T_REACD,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.4,),
           )

TEST_TABLE(
           VALE_CALC=3042.1730998956,
           NOM_PARA='DY',
           TABLE=T_REACD,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.6,),
           )

TEST_TABLE(
           VALE_CALC=2171.9960528871,
           NOM_PARA='DY',
           TABLE=T_REACD,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.8,),
           )

TEST_TABLE(
           VALE_CALC=2159.7275211475,
           NOM_PARA='DY',
           TABLE=T_REACD,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=1.0,),
           )

IMPR_RESU(FORMAT='MED',
          RESU=_F(RESULTAT=RESUD,
                  NOM_CHAM=('DEPL','FORC_NODA','SIEF_ELGA',),),);

# ---------------------------------------------
# 2eme calcul : formulation continue de contact
# ---------------------------------------------

RESUC=STAT_NON_LINE(MODELE=MO,
                    CHAM_MATER=CHMAT,
                    CARA_ELEM=CELEM,
                    EXCIT=(_F(CHARGE=CL,),
                           _F(CHARGE=CHARGE,
                              FONC_MULT=RAMPE,),),
                    CONTACT=CONTC,
                    COMP_INCR=(_F(RELATION='ELAS',
                                  DEFORMATION='GROT_GDEP',
                                  GROUP_MA='POUBAS',),
                               _F(RELATION='MULTIFIBRE',DEFORMATION='GROT_GDEP',
                                  GROUP_MA='POUHAU',),),
                    INCREMENT=_F(LIST_INST=L_TEMPS,),
                    NEWTON=_F(REAC_ITER=1,),
                    CONVERGENCE=_F(ITER_GLOB_MAXI=21,),
                    ARCHIVAGE=_F(LIST_INST=L_ARCH,),);

RESUC=CALC_CHAMP(reuse =RESUC,
              RESULTAT=RESUC,
              FORCE='FORC_NODA',);

T_REACC=POST_RELEVE_T(ACTION=_F(OPERATION='EXTRACTION',
                                INTITULE='Reaction nodale de contact',
                                RESULTAT=RESUC,
                                NOM_CHAM='FORC_NODA',
                                GROUP_NO=('B','SA',),
                                RESULTANTE='DY',),);

# Comparaison formulation discrete

TEST_TABLE(REFERENCE='AUTRE_ASTER',
           VALE_CALC=311.88548226637,
           VALE_REFE=311.88,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.2,),
           )

TEST_TABLE(REFERENCE='AUTRE_ASTER',
           VALE_CALC=1498.4933260863,
           VALE_REFE=1498.48,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.4,),
           )

TEST_TABLE(REFERENCE='AUTRE_ASTER',
           VALE_CALC=3042.2713193538,
           VALE_REFE=3042.17,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.6,),
           )

TEST_TABLE(REFERENCE='AUTRE_ASTER',
           PRECISION=1.E-2,
           VALE_CALC=2191.4664891165,
           VALE_REFE=2172,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.8,),
           )

TEST_TABLE(REFERENCE='AUTRE_ASTER',
           PRECISION=0.02,
           VALE_CALC=2183.2387917316,
           VALE_REFE=2159.73,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=1.0,),
           )

# Non-regression

TEST_TABLE(
           VALE_CALC=311.88548226637,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.2,),
           )

TEST_TABLE(
           VALE_CALC=1498.4933260863,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.4,),
           )

TEST_TABLE(
           VALE_CALC=3042.2713193538,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.6,),
           )

TEST_TABLE(
           VALE_CALC=2191.4664891165,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=0.8,),
           )

TEST_TABLE(
           VALE_CALC=2183.2387917316,
           NOM_PARA='DY',
           TABLE=T_REACC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=1.0,),
           )

IMPR_RESU(FORMAT='MED',
          RESU=_F(RESULTAT=RESUC,
                  NOM_CHAM=('DEPL','FORC_NODA','SIEF_ELGA',),),);

FIN();
