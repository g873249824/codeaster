#
# TITRE    ESSAI TRIAXIAL NON DRAINE AVEC LA LOI DE HUJEUX
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#                         SUR SABLE D'HOSTUN
#          ===============================================


DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='NON'),);

# proprietes hydrauliques
poro = 0.425   ;   # porosite
rhol = 1000.   ;   # masse volumique du fluide
kin  = 1.E-8   ;   # permeabilite intrinsinque
k_w  = 1.E+12  ;  # module de compressibilite de l'eau
UNSURK = 1/k_w ;
visco  = .001  ;
dvisco = .0    ;
k_int   = DEFI_CONSTANTE(VALE=kin);
viscoliq= DEFI_CONSTANTE(VALE=visco);
dviscoli= DEFI_CONSTANTE(VALE=dvisco);
b       = 1.
coef    = b*k_w/3.

# modules mecaniques [Pa]
K = 516.2E+6 ;
G = 238.2E+6 ;
# =>
YOUNG   = 9.*K*G /(3.*K+G)        ;
POISSON = (3.*K-2.*G) /(6.*K+2.*G);

print '>> Young=',YOUNG,' /// nu=',POISSON

# pression de preconsolidation [en Pa]
PCO =  5.E+4 ;


#*******************************************************************
#
#    MAILLAGE + MODELE
#
#*******************************************************************
MAILLAGE=LIRE_MAILLAGE(FORMAT='MED',);

MODELE=AFFE_MODELE(MAILLAGE=MAILLAGE,
                   AFFE=_F(TOUT         = 'OUI',
                           PHENOMENE    = 'MECANIQUE',
                           MODELISATION = '3D_HM_SI'),
                           INFO         = 1);

MAILLAGE=MODI_MAILLAGE(reuse    = MAILLAGE,
                       MAILLAGE = MAILLAGE,
                       ORIE_PEAU_3D=_F(GROUP_MA=('DEVANT','DROIT','ARRIERE',
                                    'GAUCHE','BAS','HAUT','APPUI',
                                    'COTE',),),
                       INFO=1);


#*******************************************************************
#
#                         LISTES D'INSTANTS
#
#*******************************************************************
end =1.2

TEMPS0=DEFI_LIST_REEL(DEBUT=-1.,
                      INTERVALLE=_F(JUSQU_A =  0., NOMBRE = 1),);
                      
TEMPS1=DEFI_LIST_REEL(DEBUT=0.,
                      INTERVALLE=(_F(JUSQU_A = 20., NOMBRE = 200,),),);

TEMPS2=DEFI_LIST_REEL(DEBUT=0.,
                      INTERVALLE=(_F(JUSQU_A = 9.6, NOMBRE = 24,),
                                  _F(JUSQU_A = 20., NOMBRE = 416,),),);

DEFLIST1=DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST=TEMPS1,
                                    METHODE='AUTO',
                                    PAS_MINI=0.000001,),
                        ECHEC=_F(EVENEMENT     = 'ERREUR',
                                 ACTION        = 'DECOUPE',
                                 SUBD_METHODE  = 'MANUEL',
                                 SUBD_PAS=10),);

DEFLIST2=DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST=TEMPS1,),
                       ECHEC=_F(EVENEMENT     = 'ERREUR',
                                 ACTION       = 'DECOUPE',
                                 SUBD_METHODE = 'MANUEL',
                                 SUBD_PAS     = 4,
                                 SUBD_NIVEAU  = 10,),);
                                 
#*******************************************************************
#
#               DEFI_MATERIAU : SOL MOHR-COULOMB + EAU
#
#*******************************************************************
SOL=DEFI_MATERIAU(ELAS=_F(E=YOUNG, NU=POISSON, RHO=rhol, ALPHA=0.),
                  MOHR_COULOMB=_F(PHI     = 33.,
                                  ANGDIL  = 27.,
                                  COHESION= 1.0E+3,),
                   COMP_THM='LIQU_SATU',
                   THM_INIT=_F(PRE1 = 0.,
                               PORO = poro),
                   THM_DIFFU=_F(RHO       = rhol,
                                BIOT_COEF = 1.,
                                PESA_X    = 0.,
                                PESA_Y    = 0.,
                                PESA_Z    = 0.,
                                PERM_IN   = k_int),
                   THM_LIQU=_F(RHO         = rhol,
                               UN_SUR_K    = UNSURK,
                               VISC        = viscoliq,
                               D_VISC_TEMP = dviscoli,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=_F(TOUT='OUI', MATER=SOL,),);


#****************************************************************
#
#    CHARGEMENT MECANIQUE : FORCE DE COMPRESSION + DDL IMPOSES
#
#****************************************************************
CHAR_U2=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='APPUI', PRES = 1.),);

CHAR_U3=AFFE_CHAR_MECA(MODELE=MODELE,
                       FACE_IMPO=_F(GROUP_MA='APPUI', DZ = 1.),);

CHAR_UD=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='DROIT', PRES = 1.),);

CHAR_UA=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='ARRIERE', PRES = 1.),);
                       
DEPL_1=AFFE_CHAR_MECA(MODELE=MODELE,
                      FACE_IMPO=(_F(GROUP_MA='BAS',   DZ = 0.),
                                 _F(GROUP_MA='GAUCHE',DX = 0.),
                                 _F(GROUP_MA='DEVANT',DY = 0.),),);


#*****************************************************************
#
#             PHASE DE CONSOLIDATION ISOTROPE DRAINEE
#
#*****************************************************************
PRE0=AFFE_CHAR_CINE(MODELE=MODELE,
                    MECA_IMPO=_F(GROUP_MA='ECHAN',PRE1 = 0.),);

epsilon = 1.e-6

COEF0=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_DROITE='CONSTANT',
                    VALE=(-1., 0.0,
                           0., PCO,));

COEF00=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_DROITE='CONSTANT',
                    VALE=(-1., 0.0,
                           0., PCO*(1.+epsilon),));
                           
# ---- premier chargement isotrope en elastique jusqu'a 50kPa
U0M=STAT_NON_LINE(MODELE    = MODELE,
                 CHAM_MATER = CHMAT,
                 EXCIT=(_F(CHARGE    = CHAR_UD, FONC_MULT = COEF0),
                        _F(CHARGE    = CHAR_UA, FONC_MULT = COEF00),
                        _F(CHARGE    = CHAR_U2, FONC_MULT = COEF0),
                        _F(CHARGE    = DEPL_1),
                        _F(CHARGE    = PRE0)),
                 COMPORTEMENT=_F(RELATION     = 'KIT_HM',
                              RELATION_KIT = ('ELAS','LIQU_SATU','HYDR_UTIL')),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-8,
                                ITER_GLOB_MAXI = 5),
                 INCREMENT=_F(LIST_INST = TEMPS0,
                              INST_FIN  = 0.));

SIG0=CREA_CHAMP(INFO=2,
                TYPE_CHAM='ELGA_SIEF_R',
                OPERATION='EXTR',
                RESULTAT=U0M,
                NOM_CHAM='SIEF_ELGA',
                INST=0.0,);
                           
#***********************************************************************
#
#                     SIMU_POINT_MAT (REFERENCE)
#
#***********************************************************************                       10.*end, 0.0001*end,));
COEF2=DEFI_FONCTION(NOM_PARA    = 'INST',
                    PROL_DROITE = 'CONSTANT',
                    VALE=( 0.0, -PCO,
                           10.*end, -PCO,),);

COEF3=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_DROITE='CONSTANT',
                    VALE=( 0.0, 0.0,
                           10.*end,-0.0001*end,),);
                           
SPM=SIMU_POINT_MAT(INFO=2,
                  COMPORTEMENT=_F(RELATION='MOHR_COULOMB',),
                  MATER=SOL,
                  INCREMENT=_F(LIST_INST=DEFLIST1,
                               INST_INIT=0.,
                               INST_FIN =10.*end,),
                  NEWTON=_F(MATRICE='TANGENTE',
                            REAC_ITER=1,
                            PREDICTION='ELASTIQUE'),
                  CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-4,
                                 ITER_GLOB_MAXI = 10,
                                 ARRET='OUI',),
                  ARCHIVAGE=_F(LIST_INST=TEMPS1,),
                  MATR_C1=(
                     _F(NUME_LIGNE=1,NUME_COLONNE=1,VALE=1.),
                     _F(NUME_LIGNE=2,NUME_COLONNE=2,VALE=1.),
                     _F(NUME_LIGNE=3,NUME_COLONNE=3,VALE=0.),
                           ),
                  VECT_IMPO=(
                     _F(NUME_LIGNE=1,VALE=COEF2),
                     _F(NUME_LIGNE=2,VALE=COEF2),
                     _F(NUME_LIGNE=3,VALE=COEF3),
                            ),
                  MATR_C2=(
                     _F(NUME_LIGNE=1,NUME_COLONNE=1,VALE=coef),
                     _F(NUME_LIGNE=1,NUME_COLONNE=2,VALE=coef),
                     _F(NUME_LIGNE=1,NUME_COLONNE=3,VALE=coef),
                     _F(NUME_LIGNE=2,NUME_COLONNE=1,VALE=coef),
                     _F(NUME_LIGNE=2,NUME_COLONNE=2,VALE=coef),
                     _F(NUME_LIGNE=2,NUME_COLONNE=3,VALE=coef),
                     _F(NUME_LIGNE=3,NUME_COLONNE=3,VALE=1.),
                           ),
                  SIGM_INIT=_F(SIXX=-PCO,
                               SIYY=-PCO,
                               SIZZ=-PCO,),
                  EPSI_INIT=_F(EPXX=0.,
                               EPYY=0.,
                               EPZZ=0.,
                               EPXY=0.,
                               EPXZ=0.,
                               EPYZ=0.,),);

pressure = FORMULE(VALE='coef*(EPXX+EPYY+EPZZ)',
                   NOM_PARA=('EPXX','EPYY','EPZZ',),);

SPM=CALC_TABLE(reuse=SPM,
               TABLE=SPM,
               ACTION=_F(OPERATION='OPER',
                         FORMULE=pressure,
                         NOM_PARA='SIP_0D',),);
                         
SPM_SIG=CALC_TABLE(TABLE=SPM,
               ACTION=(_F(OPERATION='EXTR',
                         NOM_PARA=('EPZZ','SIXX','SIYY','SIZZ','SIP_0D',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('SIXX','SIXX_0D',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('SIYY','SIYY_0D',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('SIZZ','SIZZ_0D',),),),);
                                
SPM_VARI=CALC_TABLE(TABLE=SPM,
               ACTION=(_F(OPERATION='EXTR',
                         NOM_PARA=('EPZZ','V1','V2','V3',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('V1','V1_0D',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('V2','V2_0D',),),
                       _F(OPERATION='RENOMME',
                         NOM_PARA=('V3','V3_0D',),),),);
                         
IMPR_TABLE(TABLE=SPM_SIG,);
IMPR_TABLE(TABLE=SPM_VARI,);

#***********************************************************************
#
#                             STAT_NON_LINE
#
#***********************************************************************
COEF1=DEFI_FONCTION(NOM_PARA    = 'INST',
                    PROL_DROITE = 'CONSTANT',
                    VALE=( 0., PCO,
                          10.*end, PCO,));
                          
COEF11=DEFI_FONCTION(NOM_PARA    = 'INST',
                    PROL_DROITE = 'CONSTANT',
                    VALE=( 0., PCO*(1.+epsilon),
                          10.*end, PCO*(1.+epsilon),));
                          
SNL=STAT_NON_LINE(MODELE=MODELE,
                 INFO=1,
                 CHAM_MATER=CHMAT,
                 EXCIT=(_F(CHARGE    = CHAR_UD, FONC_MULT = COEF1,),
                        _F(CHARGE    = CHAR_UA, FONC_MULT = COEF11,),
                        _F(CHARGE     = CHAR_U3,
                           TYPE_CHARGE='DIDI',
                           FONC_MULT  = COEF3,),
                        _F(CHARGE     = DEPL_1,),),
                 ETAT_INIT=_F(SIGM = SIG0,),
                 COMPORTEMENT=_F(RELATION    = 'KIT_HM',
                              RELATION_KIT   = ('MOHR_COULOMB',
                                                'LIQU_SATU','HYDR_UTIL'),
                              ITER_INTE_PAS  = +40,),
                 NEWTON=_F(MATRICE   = 'TANGENTE',
                           REAC_ITER = 1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-4,
                                ITER_GLOB_MAXI = 4,),
                 SOLVEUR=_F(METHODE='MUMPS',),
                 ARCHIVAGE=_F(LIST_INST = TEMPS2,),
                 INCREMENT=_F(LIST_INST = DEFLIST2,
                              INST_INIT = 0.0,
                              INST_FIN  = 10.*end,));


#-------------------------
#    TEST_RESU AU POINT C
#-------------------------

SNL=CALC_CHAMP(reuse       =SNL,
              CONTRAINTE  =('SIGM_ELNO','SIEF_ELNO',),
              VARI_INTERNE=('VARI_ELNO'),
              DEFORMATION =('EPSI_ELNO'),
              RESULTAT    =SNL)


SNL=CALC_CHAMP(reuse    =SNL,
           CONTRAINTE  =('SIGM_NOEU','SIEF_NOEU',),
           VARI_INTERNE='VARI_NOEU',
           DEFORMATION ='EPSI_NOEU',
           RESULTAT    =SNL);

SNL_SIG=POST_RELEVE_T(ACTION=_F(INTITULE = 'SIEF_NOEU',
                                GROUP_NO = 'C',
                                RESULTAT = SNL,
                                NOM_CHAM = 'SIEF_NOEU',
                                NOM_CMP  = ('SIXX','SIZZ','SIPXX'),
                                OPERATION= 'EXTRACTION'));

SNL_VARI=POST_RELEVE_T(ACTION=_F(INTITULE= 'VARI_NOEU',
                                GROUP_NO = 'C',
                                RESULTAT = SNL,
                                NOM_CHAM = 'VARI_NOEU',
                                NOM_CMP  = ('V1','V2','V3'),
                                OPERATION= 'EXTRACTION'));


SNL_EPZZ=POST_RELEVE_T(ACTION=_F(INTITULE = 'EPSI_NOEU',
                                GROUP_NO = 'C',
                                RESULTAT = SNL,
                                NOM_CHAM = 'EPSI_NOEU',
                                NOM_CMP  = ('EPZZ',),
                                OPERATION= 'EXTRACTION'));

SNL_SIG=CALC_TABLE(reuse=SNL_SIG,
                   TABLE=SNL_SIG,
                   ACTION=_F(OPERATION='COMB',
                             TABLE=SNL_EPZZ,
                             NOM_PARA='INST'));

SNL_VARI=CALC_TABLE(reuse=SNL_VARI,
                    TABLE=SNL_VARI,
                    ACTION=_F(OPERATION='COMB',
                              TABLE=SNL_EPZZ,
                              NOM_PARA='INST'));



IMPR_TABLE(TABLE=SNL_SIG);
IMPR_TABLE(TABLE=SNL_VARI);

fmt = 'E12.5'

TAB_SIG=CALC_TABLE(TABLE=SNL_SIG,
                   ACTION=_F(OPERATION='COMB',
                             TABLE=SPM_SIG,
                             RESTREINT='OUI',
                             FORMAT_R=fmt,
                             NOM_PARA=('EPZZ','EPZZ'),),);

TAB_VARI=CALC_TABLE(TABLE=SNL_VARI,
                   ACTION=_F(OPERATION='COMB',
                             TABLE=SPM_VARI,
                             RESTREINT='OUI',
                             FORMAT_R=fmt,
                             NOM_PARA=('EPZZ','EPZZ'),),);

err_sigm = FORMULE(VALE='abs(SIXX-SIXX_0D)/PCO',
                   NOM_PARA=('SIXX','SIXX_0D',),);

err_pres= FORMULE(VALE='abs(SIPXX-SIP_0D)/PCO',
                   NOM_PARA=('SIPXX','SIP_0D',),);

err_v1= FORMULE(VALE='abs(V1-V1_0D)',
                   NOM_PARA=('V1','V1_0D',),);

err_v2= FORMULE(VALE='abs(V2-V2_0D)',
                   NOM_PARA=('V2','V2_0D',),);
                   
TAB_SIG=CALC_TABLE(reuse=TAB_SIG,
               TABLE=TAB_SIG,
               ACTION=(_F(OPERATION='OPER',
                         FORMULE=err_sigm,
                         NOM_PARA='ERR_SIGMA',),
                       _F(OPERATION='OPER',
                         FORMULE=err_pres,
                         NOM_PARA='ERR_PRESS',),),);

TAB_VARI=CALC_TABLE(reuse=TAB_VARI,
               TABLE=TAB_VARI,
               ACTION=(_F(OPERATION='OPER',
                         FORMULE=err_v1,
                         NOM_PARA='ERR_V1',),
                       _F(OPERATION='OPER',
                         FORMULE=err_v2,
                         NOM_PARA='ERR_V2',),),);
                         
IMPR_TABLE(TABLE=TAB_SIG);
IMPR_TABLE(TABLE=TAB_VARI);


# Erreur sur SIGMA_XX effective
TEST_TABLE(CRITERE  ='ABSOLU',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.3E-4,
           VALE_CALC=9.63119739858E-05,
           VALE_REFE=0.,
           NOM_PARA ='ERR_SIGMA',
           TABLE    =TAB_SIG,
           FILTRE=_F(CRITERE  ='ABSOLU',
                     PRECISION=1.E-06,
                     NOM_PARA ='EPZZ',
                     VALE     =-1.20000E-04,),);

# Erreur sur pression hydraulique               
TEST_TABLE(CRITERE  ='ABSOLU',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-3,
           VALE_CALC=1.33896244081E-05,
           VALE_REFE=0.,
           NOM_PARA ='ERR_PRESS',
           TABLE    =TAB_SIG,
           FILTRE=_F(CRITERE  ='ABSOLU',
                     PRECISION=1.E-06,
                     NOM_PARA ='EPZZ',
                     VALE     =-1.20000E-04,),);

# Erreur sur deformation volumique                 
TEST_TABLE(CRITERE  ='ABSOLU',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-6,
           VALE_CALC=3.39359061833E-08,
           VALE_REFE=0.,
           NOM_PARA ='ERR_V1',
           TABLE    =TAB_VARI,
           FILTRE=_F(CRITERE  ='ABSOLU',
                     PRECISION=1.E-06,
                     NOM_PARA ='EPZZ',
                     VALE     =-1.20000E-04,),);

# Erreur sur deviateur deformation plastique
TEST_TABLE(CRITERE  ='ABSOLU',
           REFERENCE='SOURCE_EXTERNE',
           PRECISION=1.E-6,
           VALE_CALC=6.69224329908E-08,
           VALE_REFE=0.,
           NOM_PARA ='ERR_V2',
           TABLE    =TAB_VARI,
           FILTRE=_F(CRITERE  ='ABSOLU',
                     PRECISION=1.E-06,
                     NOM_PARA ='EPZZ',
                     VALE     =-1.20000E-04,),);

FIN();
