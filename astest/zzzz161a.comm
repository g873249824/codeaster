# MODIF  DATE 13/02/2007   AUTEUR PELLET J.PELLET 
# RESPONSABLE GNICOLAS G.NICOLAS
# TITRE ESSAI MED POUR DIFFERENTS TYPES D ELEMENTS
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2002  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
DEBUT(CODE=_F( NOM = 'ZZZZ161A',NIV_PUB_WEB='INTERNET'))
#
# 1. Definition des materiaux
#
MATER1=DEFI_MATERIAU(
           ELAS=_F(  E = 180000., NU = 0.30, ALPHA = 1.5E-7, RHO = 7700.) )
#
MATER2=DEFI_MATERIAU(
           ELAS=_F(  E = 220000., NU = 0.33, ALPHA = 1.6E-7, RHO = 8300.) )
#
# 2. Lecture du maillage
#
PRE_IDEAS()
MAILTRQU=LIRE_MAILLAGE( );
#
# 3. Calcul
# 3.1. Modele mecanique
#
MODETRQU=AFFE_MODELE(  MAILLAGE=MAILTRQU,
                       AFFE=_F(  TOUT         = 'OUI',
                                 PHENOMENE    = 'MECANIQUE',
                                 MODELISATION = 'D_PLAN') );

#
# 3.2. Orientation des mailles de bord
#
MAILTRQU=MODI_MAILLAGE( reuse=MAILTRQU,   MAILLAGE=MAILTRQU,
                     ORIE_PEAU_2D=_F(  GROUP_MA = ('BORD_GAU','BORD_INF','BORD_DRO','BORD_SUP',),),);
#
# 3.3. Mise en place des materiaux
#
MATETEST=AFFE_MATERIAU( MAILLAGE=MAILTRQU,
                        AFFE=(_F(  GROUP_MA = 'TRIA',
                                   MATER    = MATER1,
                                   TEMP_REF = 20.    ),
                              _F(  GROUP_MA = 'QUAD',
                                   MATER    = MATER2,
                                   TEMP_REF = 20.))
                      );

#
# 3.4. Chargements
#
CHARTRQU=AFFE_CHAR_MECA(    MODELE=MODETRQU,
                  DDL_IMPO =_F(  GROUP_NO = 'ORIGINE',     DY = 0.,),
                  PRES_REP =_F(  GROUP_MA = 'BORD_SUP',    PRES = 1000.,),
                  FACE_IMPO=_F(  GROUP_MA = 'BORD_GAU',    DNOR = 0.,)
                          );
#
# 3.4. Resolution
#
RESUTRQU=MECA_STATIQUE( MODELE=MODETRQU,
                        CHAM_MATER=MATETEST,
                        EXCIT  =_F( CHARGE = CHARTRQU),
                        SOLVEUR=_F( METHODE='LDLT', ),
                       )

#
# 3.5. Ecriture relecture du resultat complet au format MED
#

DEFI_FICHIER( FICHIER = 'MED_70', TYPE = 'LIBRE',UNITE = 70)

IMPR_RESU(FORMAT='MED',UNITE = 70,RESU=_F(RESULTAT=RESUTRQU,),);


RESUTRQ2=LIRE_RESU(
              EXCIT  =_F( CHARGE = CHARTRQU),
              MODELE=MODETRQU,
              CHAM_MATER=MATETEST,
              TYPE_RESU='EVOL_ELAS',
              FORMAT='MED',
              FORMAT_MED=_F( NOM_CHAM_MED='RESUTRQUDEPL____________________',
                             NOM_CHAM  ='DEPL' ),
              UNITE=70,
              TOUT_ORDRE ='OUI',);

#
# 3.6. Calculs d autres champs
#
RESUTRQ2=CALC_ELEM( reuse=RESUTRQ2,   RESULTAT=RESUTRQ2,
                    OPTION=( 'SIGM_ELNO_DEPL',
                             'EPSI_ELNO_DEPL',
                             'ERRE_ELEM_SIGM', )
                     )

#
# 3.7. On cree un champ aux noeuds avec le deplacement
#
REQT_GD=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                   OPERATION='EXTR',
                   RESULTAT=RESUTRQ2,
                   NOM_CHAM = 'DEPL',);
#
# 4. Impressions
#
IMPR_RESU ( RESU=_F( MAILLAGE=MAILTRQU, IMPR_COOR = 'OUI', ) ) ;
IMPR_RESU ( RESU=_F( RESULTAT=RESUTRQ2, ) ) ;
IMPR_RESU ( RESU=_F( CHAM_GD =REQT_GD, ) ) ;
IMPR_RESU ( RESU=_F( RESULTAT=RESUTRQ2,
                     NOM_CHAM = ('ERRE_ELEM_SIGM',),
                     GROUP_MA = 'MILIEU' ),
            INFO=2 ) ;
#
IMPR_RESU ( FORMAT='MED', RESU=_F( RESULTAT=RESUTRQ2,
                                   NOM_CHAM = ('DEPL',) ),
            INFO=2 ) ;
IMPR_RESU ( FORMAT='MED', RESU=_F( CHAM_GD=REQT_GD,),
            INFO=2 ) ;
IMPR_RESU ( FORMAT='MED', RESU=_F( RESULTAT=RESUTRQ2,
                                   NOM_CHAM = ('SIGM_ELNO_DEPL',),),
            INFO=2 ) ;
IMPR_RESU ( FORMAT='MED', RESU=_F( RESULTAT=RESUTRQ2,
                                   NOM_CHAM = 'ERRE_ELEM_SIGM',),
            INFO=2 ) ;
#
# 5. Relecture
#
################## CHAM_NO ##################
#
DEPLRELU=LIRE_CHAMP(MAILLAGE=MAILTRQU,
                FORMAT='MED',
                UNITE=80,
                NOM_MED='RESUTRQ2DEPL____________________',
                NUME_ORDRE=1,NUME_PT=1,
                TYPE_CHAM='NOEU_DEPL_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=DEPLRELU, ) ) ;
#
################## CHAM_ELEM ELNO ##################
#
SIGMRELU=LIRE_CHAMP(MAILLAGE=MAILTRQU,
                MODELE=MODETRQU,
                FORMAT='MED',
                UNITE=80,
                NOM_MED='RESUTRQ2SIGM_ELNO_DEPL__________',
                NUME_ORDRE=1,NUME_PT=1,
                TYPE_CHAM='ELNO_SIEF_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=SIGMRELU, ) ) ;
#
################## CHAM_ELEM ELEM ##################
#
ERRERELU=LIRE_CHAMP(MAILLAGE=MAILTRQU,
                MODELE=MODETRQU,
                FORMAT='MED',
                UNITE=80,
                NOM_MED='RESUTRQ2ERRE_ELEM_SIGM__________',
                NUME_ORDRE=1,NUME_PT=1,
                TYPE_CHAM='ELEM_ERREUR',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=ERRERELU, ) ) ;
#
# 6. Validation des mots cles GROUP_NO,GROUP_MA,NOEUD,MAILLE de 
# l'operateur IMPR_RESU au FORMAT 'MED'


DEFI_FICHIER(UNITE=81)

IMPR_RESU(UNITE=81,FORMAT='MED',
          RESU=(_F( RESULTAT=RESUTRQ2,NOM_CHAM ='DEPL',GROUP_NO='OPPOSE',),
                _F( RESULTAT=RESUTRQ2,NOM_CHAM ='EPSI_ELNO_DEPL',GROUP_MA='TRIA',MAILLE='M43'),),)


UUU=LIRE_RESU(TYPE_RESU='EVOL_ELAS',
               FORMAT='MED',
               MODELE=MODETRQU,
               FORMAT_MED=(
                          _F( NOM_CHAM_MED='RESUTRQ2DEPL____________________',
                              NOM_CHAM    ='DEPL' ),
                          _F( NOM_CHAM_MED='RESUTRQ2EPSI_ELNO_DEPL__________',
                              NOM_CHAM    ='EPSI_ELNO_DEPL'),
                         ) ,
               UNITE=81,TOUT_ORDRE='OUI');

DEFI_FICHIER(UNITE=82, FICHIER='./fort.82')


IMPR_RESU(UNITE=82, FORMAT='GMSH',
         RESU=(_F(RESULTAT=UUU,NOM_CHAM='DEPL',NOM_CMP=('DX','DY'),),
               _F(RESULTAT=UUU,NOM_CHAM='EPSI_ELNO_DEPL',NOM_CMP=('EPXX','EPYY','EPXY'),),),)


DEFI_FICHIER(UNITE=82, ACTION='LIBERER')


TEST_FICHIER(FICHIER='./fort.82',
             VALE_K='19c219e564d15b127c0493056190d54b',
             REFERENCE='NON_REGRESSION',
             NB_CHIFFRE=4,
             EPSILON=1.E-6,
             VERSION='8.1.13')

#
# 7. Test de non-regression
#
TEST_RESU(CHAM_NO=(
                 _F( CHAM_GD=DEPLRELU,
                     CRITERE = 'RELATIF',
                     PRECISION = 1.E-6,
                     GROUP_NO='OPPOSE',
                     NOM_CMP = 'DX',
                     VALE =  4.183044E-01,
                     REFERENCE = 'NON_REGRESSION' ),
                 _F( CHAM_GD=DEPLRELU,
                     CRITERE = 'RELATIF',
                     PRECISION = 1.E-6,
                     GROUP_NO='OPPOSE',
                     NOM_CMP = 'DY',
                     VALE = -1.639849E+00,
                     REFERENCE = 'NON_REGRESSION' ),
                   ),
          )

#
TEST_RESU(CHAM_ELEM=(
                 _F( CHAM_GD=SIGMRELU,
                     CRITERE = 'RELATIF',
                     PRECISION = 1.E-4,
                     MAILLE='M43',
                     GROUP_NO='OPPOSE',
                     NOM_CMP = 'SIYY',
                     VALE =  -3.25565E+02,
                     REFERENCE = 'NON_REGRESSION' ),
                 _F( CHAM_GD=SIGMRELU,
                     CRITERE = 'RELATIF',
                     PRECISION = 1.E-4,
                     MAILLE='M43',
                     GROUP_NO='OPPOSE',
                     NOM_CMP = 'SIXY',
                     VALE = -1.20895E+02,
                     REFERENCE = 'NON_REGRESSION' ),
                   ),
          )

#
FIN( )
