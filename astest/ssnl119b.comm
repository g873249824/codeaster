# MODIF  DATE 09/10/2012   AUTEUR HAMON F.HAMON 
# TITRE POUTRE EULER_BERNOULLI MULTIFIBRES (STATIQUE NON-LINEAIRE)
# ssnl119b.para = tps_job 60 mem_job 256Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# tps_job 480 mem_job 32Mo ncpus 1 liste_test S

DEBUT(CODE=_F( NOM = 'SSNL119B',NIV_PUB_WEB='INTERNET'))

# lecture maillage lineique
MAPOU=LIRE_MAILLAGE(UNITE=17,FORMAT='MED',);
# lecture maillage section1
MASEC=LIRE_MAILLAGE(UNITE=18,FORMAT='MED',);

GF=DEFI_GEOM_FIBRE(
   INFO=2,
   FIBRE = (
      _F(GROUP_FIBRE='SACI', CARA = 'DIAMETRE', COOR_AXE_POUTRE = (0.,0.,),
         VALE =(   0.066, -0.218, 32.0E-03,
                  -0.066, -0.218, 32.0E-03,
                   0.066,  0.218,  8.0E-03,
                  -0.066,  0.218,  8.0E-03,), ),
   ),
   SECTION=_F(GROUP_FIBRE='SBET', COOR_AXE_POUTRE = (0., 0.,),
              MAILLAGE_SECT = MASEC, TOUT_SECT = 'OUI', ),
)


MOPOU=AFFE_MODELE(
   MAILLAGE=MAPOU,
   AFFE=_F(TOUT='OUI', PHENOMENE='MECANIQUE', MODELISATION='POU_D_EM',), )

# Beton
EB = 37272.0E+06
BETON = DEFI_MATER_GC(
   MAZARS=_F(
      UNITE_LONGUEUR = 'M',
      FCJ=40.963E+06, EIJ=EB,
      EPSI_C=1.75754E-03, AT=1.0,NU=0.2,
   ),
   RHO=2400.0, INFO=2,
)

ACIER=DEFI_MATER_GC(
   ACIER=_F(
      E = 2.0E+11,
      D_SIGM_EPSI=3.28E+9, SY=4.E+8,
   ),
   RHO=7800.,
)


MATOR=DEFI_MATERIAU(ELAS=_F(E=2.E11,  NU=0.0, RHO=7800.0,), )

PMFMAZAR=DEFI_COMPOR(
   GEOM_FIBRE=GF,
   MATER_SECT=MATOR,
   MULTIFIBRE=(
      _F(GROUP_FIBRE='SACI', MATER=ACIER, RELATION='ECRO_CINE_1D'),
      _F(GROUP_FIBRE='SBET', MATER=BETON, RELATION='MAZARS_1D'),),
)

MATMAZAR=AFFE_MATERIAU(
   MAILLAGE=MAPOU,
   AFFE=_F(GROUP_MA='POUTRE', MATER=(ACIER,BETON,MATOR),),
   AFFE_COMPOR=_F(GROUP_MA='POUTRE',COMPOR=PMFMAZAR),
)

POUCA=AFFE_CARA_ELEM(
   MODELE=MOPOU, INFO=1,
   POUTRE=_F(GROUP_MA=('POUTRE'), SECTION='RECTANGLE',
             CARA=('HY','HZ'), VALE=(0.2,0.5), PREC_AIRE=5., PREC_INERTIE=10.,),
   ORIENTATION=_F(GROUP_MA=('POUTRE'), CARA='ANGL_VRIL', VALE=-90.0,),
   GEOM_FIBRE=GF,
   MULTIFIBRE=_F(GROUP_MA=('POUTRE'), GROUP_FIBRE=('SBET','SACI')),
)

BLOCAGE=AFFE_CHAR_MECA(
   MODELE=MOPOU,
   DDL_IMPO=(
      _F(GROUP_NO='A', DX=0.0, DY=0.0, DZ=0.0, DRX=0.0, DRY=0.0,),
      _F(GROUP_NO='B', DY=0.0,), ),
)

DEPIMP=AFFE_CHAR_MECA(
   MODELE=MOPOU,
   DDL_IMPO=_F(GROUP_NO='C', DY=-1.E-2,),
)


FOFO=DEFI_FONCTION(
   NOM_PARA='INST',
   VALE=(0.0,0.0,3.5,3.5),
   PROL_DROITE='EXCLU',
   PROL_GAUCHE='EXCLU',
)


LINSTD=DEFI_LIST_REEL(
   DEBUT=0.0,
   INTERVALLE=(
      _F( JUSQU_A= 0.10,  NOMBRE =  2 ),
      _F( JUSQU_A= 1.40,  NOMBRE = 10 ),
      _F( JUSQU_A= 3.00,  NOMBRE = 10 ), ),
)

LINST = DEFI_LIST_INST(
   DEFI_LIST=_F(
      METHODE   = 'MANUEL',
      LIST_INST =  LINSTD, ),
   ECHEC=_F(
      EVENEMENT       = 'ERREUR',
      ACTION          = 'DECOUPE',
      SUBD_METHODE    = 'MANUEL',
      SUBD_PAS        = 4,
      SUBD_PAS_MINI   = 1.0E-10,
      SUBD_NIVEAU     = 5,
   ),
)

U1MAZAR=STAT_NON_LINE(
   MODELE=MOPOU,
   CHAM_MATER=MATMAZAR,
   CARA_ELEM=POUCA,
   EXCIT=(
      _F(CHARGE=BLOCAGE,),
      _F(CHARGE=DEPIMP, FONC_MULT=FOFO,),
   ),
   COMP_INCR=_F(RELATION='MULTIFIBRE'),
   INCREMENT=_F(LIST_INST=LINST, ),
   NEWTON=_F(MATRICE='TANGENTE',REAC_ITER=1),
   CONVERGENCE=_F(RESI_GLOB_RELA=1.E-5, ITER_GLOB_MAXI=10,),
)

U1MAZAR=CALC_CHAMP(FORCE='REAC_NODA', reuse =U1MAZAR, RESULTAT=U1MAZAR, );

# Instants
Temps = [  0.100       ,   1.400       ,   2.680       ]
# reactions
React = [  1.75623E+04 ,   1.10527E+05 ,   1.21222E+05 ]
# contraintes acier tendu
Aciet = [  1.99326E+07 ,   4.00499E+08 ,   4.35444E+08 ]
# contraintes acier comprime
Aciec = [ -2.21394E+07 ,  -1.77301E+08 ,  -4.01893E+08 ]
# Deformations acier tendu
Eacit = [  9.93916E-05 ,   2.09912E-03 ,   1.07467E-02 ]
# contraintes beton comprime
Betoc = [ -4.47657E+06 ,  -3.53105E+07 ,  -3.06413E+07 ]
# contraintes beton tendu
Betot = [  2.92412E+06 ,   8.52817E+02 ,   5.02952E+03 ]

U1MAZAR=CALC_CHAMP(reuse=U1MAZAR, RESULTAT=U1MAZAR, DEFORMATION=('EPSI_ELGA'), )

TEST_RESU(RESU=(
   # Reactions
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='REAC_NODA',         GROUP_NO = 'A', NOM_CMP='DY', VALE=React[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='REAC_NODA',         GROUP_NO = 'A', NOM_CMP='DY', VALE=React[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='REAC_NODA',         GROUP_NO = 'A', NOM_CMP='DY', VALE=React[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   # Contraintes acier tendu
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='SIXX', VALE=Aciet[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='SIXX', VALE=Aciet[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='SIXX', VALE=Aciet[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   # Contraintes acier comprime
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=44, NOM_CMP='SIXX', VALE=Aciec[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=44, NOM_CMP='SIXX', VALE=Aciec[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=44, NOM_CMP='SIXX', VALE=Aciec[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   # Deformations acier tendu
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='EPSI_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='EPXX', VALE=Eacit[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='EPSI_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='EPXX', VALE=Eacit[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='EPSI_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=41, NOM_CMP='EPXX', VALE=Eacit[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   # Contraintes beton comprime
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=1,  NOM_CMP='SIXX', VALE=Betoc[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=1,  NOM_CMP='SIXX', VALE=Betoc[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=1,  NOM_CMP='SIXX', VALE=Betoc[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   # Contraintes beton tendu
   _F(RESULTAT=U1MAZAR, INST=Temps[0], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=40, NOM_CMP='SIXX', VALE=Betot[0],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[1], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=40, NOM_CMP='SIXX', VALE=Betot[1],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   _F(RESULTAT=U1MAZAR, INST=Temps[2], NOM_CHAM='SIEF_ELGA',         MAILLE='M9', POINT=1, SOUS_POINT=40, NOM_CMP='SIXX', VALE=Betot[2],
      REFERENCE='NON_REGRESSION', CRITERE=('RELATIF','ABSOLU'), PRECISION=(3.0E-04,3.0E-04), ),
   )
)

"""
# ===========================================================================
# COURBES DES FIGURES DE LA DOCUMENTATION : EN COMMENTAIRE CI-DESSOUS
# ===========================================================================
# Table contenant les resultats en contrainte aux sous-points
S1MAZAR = CREA_TABLE( RESU=_F(RESULTAT=U1MAZAR, NOM_CHAM='SIEF_ELGA',TOUT='OUI',TOUT_CMP='OUI'), )

# Table contenant les resultats en variables aux sous-points
V1MAZAR = CREA_TABLE( RESU=_F(RESULTAT=U1MAZAR, NOM_CHAM='VARI_ELGA',TOUT='OUI',TOUT_CMP='OUI'), )

fic = './REPE_OUT/contraintes_sous_points.table'
unit = DEFI_FICHIER(FICHIER = fic, ACTION='ASSOCIER', TYPE='ASCII',ACCES='NEW')
IMPR_TABLE(UNITE=unit,TABLE=S1MAZAR,FORMAT='ASTER')
IMPR_TABLE(UNITE=unit,TABLE=V1MAZAR,FORMAT='ASTER')
DEFI_FICHIER(UNITE = unit, ACTION='LIBERER',)
DETRUIRE(INFO=1,ALARME='NON',CONCEPT=(_F(NOM=unit,),),)


fic = './REPE_OUT/courbes.post'
unit = DEFI_FICHIER(FICHIER = fic, ACTION='ASSOCIER', TYPE='ASCII',ACCES='NEW')

# Deplacement milieu de poutre suivant Y
DEPCY = RECU_FONCTION(  RESULTAT=U1MAZAR, NOM_CHAM='DEPL',      NOM_CMP='DY',   GROUP_NO='C',)
# Deplacement noeud B suivant X
DEPBX = RECU_FONCTION(  RESULTAT=U1MAZAR, NOM_CHAM='DEPL',      NOM_CMP='DX',   GROUP_NO='B', )
# Reaction d'appui en A
REACA = RECU_FONCTION(  RESULTAT=U1MAZAR, NOM_CHAM='REAC_NODA', NOM_CMP='DY',   GROUP_NO='A',)
# Acier tendu : Deformation, Contrainte
DEFAT = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V3',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 41),
                        ),
)
CONAT = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V4',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 41),
                        ),
)
# Acier comprime : Deformation, Contrainte
DEFAC = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V3',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 44),
                        ),
)
CONAC = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V4',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 44),
                        ),
)
# Beton tendu : Deformation, Contrainte
DEFBT = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V3',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 40),
                        ),
)
CONBT = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V5',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I= 40),
                        ),
)
# Beton comprime : Deformation, Contrainte
DEFBC = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V3',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I=  1),
                        ),
)
CONBC = RECU_FONCTION(  TABLE  =V1MAZAR, PARA_X='INST', PARA_Y='V5',
                        FILTRE =(
                           _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K='M9'),
                           _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  1),
                           _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I=  1),
                        ),
)
IMPR_FONCTION(UNITE=unit,FORMAT='TABLEAU',
   COURBE=(
      _F(FONCTION=DEPCY), _F(FONCTION=DEPBX),
      _F(FONCTION=REACA),
      _F(FONCTION=DEFAT), _F(FONCTION=DEFAC), _F(FONCTION=DEFBT), _F(FONCTION=DEFBC),
      _F(FONCTION=CONAT), _F(FONCTION=CONAC), _F(FONCTION=CONBT), _F(FONCTION=CONBC),
   )
)
DEFI_FICHIER(UNITE = unit, ACTION='LIBERER',)
DETRUIRE(INFO=1,ALARME='NON',CONCEPT=(_F(NOM=unit,),),)
"""
FIN()

