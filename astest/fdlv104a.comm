# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# CAS_TEST__: FDLV104
#             VALIDATION MASSE AJOUTEE EN SOUS-STRUCTURATION CLASSIQUE
#             POUR LE CAS 3D
#

#   CAS  : SOUS-STRUCTURATION CLASSIQUE

#           RANGEE DE DEUX SPHERES IMMERGEES DANS UN FLUIDE

#           INCOMPRESSIBLE (EAU) ET RELIES PAR DES ELEMENTS

#           RESSORT AVEC INTERFACE DE TYPE CRAIG-BAMPTON
# FICHIER DE COMMANDE ASTER
#
#
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),
IGNORE_ALARM=('MODELE1_63','MODELE1_64'),DEBUG=_F(SDVERI='OUI'))

# <MODELE1_63> : DANS UN MODELE, IL EXISTE DES ELEMENTS DE TYPE "BORD" QUI N'ONT PAS DE VOISIN AVEC RIGIDITE
# <MODELE1_64> : DANS UN MODELE, IL N'Y A AUCUN ELEMENT AVEC AVEC RIGIDITE
#  LE MODELE PROVOQUANT CES ALARMES EST UN MODELE D'INTERFACE
#
#PRE_IDEAS()

#

MAILLA=LIRE_MAILLAGE(FORMAT='MED',UNITE=20, )

#
# AFFECTATION DES MODELES FLUIDES, INTERFACE, STRUCTURE
#

FLUIDE=AFFE_MODELE(  MAILLAGE=MAILLA,AFFE=(
                           _F(  GROUP_MA = 'FLUIDE',
                                  PHENOMENE = 'THERMIQUE',
                                  MODELISATION = '3D'),
                           _F(  GROUP_MA = 'INTERF',
                                  PHENOMENE = 'THERMIQUE',
                                  MODELISATION = '3D')))

INTERFAC=AFFE_MODELE(  MAILLAGE=MAILLA,
                           AFFE=_F(  GROUP_MA = 'INTERF',
                                  PHENOMENE = 'THERMIQUE',
                                  MODELISATION = '3D'))

STRUCT=AFFE_MODELE(  MAILLAGE=MAILLA,AFFE=(
                           _F(  GROUP_MA = 'COQU1',
                                  PHENOMENE = 'MECANIQUE',
                                  MODELISATION = 'DKT'),
                           _F(  GROUP_MA = ('RESSORT1','RESSORT2',
                                  'RESSORT3',),
                                  PHENOMENE = 'MECANIQUE',
                                  MODELISATION = 'DIS_TR')) )

INCLUDE(UNITE=21 )

#
ACIER=DEFI_MATERIAU(  ELAS=_F( E = 2.1E15,  NU = 0.30,  RHO = 7800.0))

#
EAU=DEFI_MATERIAU(  THER=_F( LAMBDA = 1.,  RHO_CP = 1000.0))

#
CHAMMAT1=AFFE_MATERIAU(  MAILLAGE=MAILLA,
                              AFFE=_F( GROUP_MA = 'COQU1',
                                    MATER = ACIER)
                          )

CHAMMAT2=AFFE_MATERIAU(  MAILLAGE=MAILLA,AFFE=(
                              _F( GROUP_MA = 'FLUIDE',
                                    MATER = EAU),
                             _F( GROUP_MA = 'INTERF',
                                    MATER = EAU)))

#
########################################################################
#
#        DEUX SPHERES RELIEES PAR DES RESSORTS
#   SOUS-STRUCTURATION CLASSIQUE - INTERFACES TYPE CRAIG-BAMPTON
#
########################################################################


CHARGE_F=AFFE_CHAR_THER( MODELE=FLUIDE,
                TEMP_IMPO=_F( GROUP_NO = 'TEMPIMPO', TEMP = 10000.)
                          )

#
# SOUS-STRUCTURE ENCASTREE - INTERFACE TYPE CRAIG-BAMPTON
#
CHARGE_E=AFFE_CHAR_MECA(  MODELE=STRUCT,

               DDL_IMPO=_F( GROUP_NO = 'ENCAST2', DX = 0.0, DY = 0.0, DZ = 0.0,
                        DRX = 0.0, DRY = 0.0, DRZ = 0.0)

          )

#
MERIME_E=CALC_MATR_ELEM(      MODELE=STRUCT,
                                CHARGE=CHARGE_E,
                            CHAM_MATER=CHAMMAT1,
                             CARA_ELEM=CHAMPCAR,
                               OPTION='RIGI_MECA')

#
MEMAME_E=CALC_MATR_ELEM(      MODELE=STRUCT,
                                CHARGE=CHARGE_E,
                            CHAM_MATER=CHAMMAT1,
                             CARA_ELEM=CHAMPCAR,
                               OPTION='MASS_MECA')

#
NUMDDL_E=NUME_DDL(  MATR_RIGI=MERIME_E)

#
RAID_E=ASSE_MATRICE(  MATR_ELEM=MERIME_E,
                           NUME_DDL=NUMDDL_E)

#
MASS_E=ASSE_MATRICE(  MATR_ELEM=MEMAME_E,
                           NUME_DDL=NUMDDL_E)

#
MODES_E=CALC_MODES(CALC_FREQ=_F(FREQ=(1.,80.,),
                                ),
                   VERI_MODE=_F(SEUIL=2.E-5,
                                ),
                   OPTION='BANDE',
                   MATR_RIGI=RAID_E,
                   MATR_MASS=MASS_E,
                   )


#
#  DEFINITION DES INTERFACES
#
#
LINT0=DEFI_INTERF_DYNA(   NUME_DDL=NUMDDL_E,
                             INTERFACE=_F( NOM = 'ITF0',
                                        TYPE = 'CRAIGB',
                                        GROUP_NO = 'POINT2',
                                         MASQUE = (
                                         'DRX','DRY','DRZ',))
                           )

#
LINT1=DEFI_INTERF_DYNA(   NUME_DDL=NUMDDL_E,
                             INTERFACE=_F( NOM = 'ITF1',
                                        TYPE = 'CRAIGB',
                                        GROUP_NO = 'POINT1',
                                         MASQUE = (
                                  'DRX','DRY','DRZ', ))
                          )

#
#  CALCUL DE LA BASE MODALE DES SOUS-STRUCTURES
#
#
BAMO1=DEFI_BASE_MODALE( CLASSIQUE=_F( INTERF_DYNA = LINT1,
                                        MODE_MECA = MODES_E,
                                        NMAX_MODE = 3))

#
BAMO0=DEFI_BASE_MODALE( CLASSIQUE=_F( INTERF_DYNA = LINT0,
                                        MODE_MECA = MODES_E,
                                        NMAX_MODE = 3))

#
#  CALCUL DES MACRO-ELEMENTS
#
#
MACEL0=MACR_ELEM_DYNA(  BASE_MODALE=BAMO0)

#
MACEL1=MACR_ELEM_DYNA(  BASE_MODALE=BAMO1)

#
#   CALCUL SUR MODELE GENERALISE
#


MODEGE1=DEFI_MODELE_GENE(SOUS_STRUC=( _F( NOM = 'SPHER0',
                                         MACR_ELEM_DYNA = MACEL0,
                                         ANGL_NAUT = (0., 0., 0.,),
                                         TRANS=(0.,0.,0.)),
                             _F( NOM = 'SPHER1',
                                         MACR_ELEM_DYNA = MACEL1,
                                         ANGL_NAUT = (90., 0., 90.,),
                                         TRANS=(2.,0.,0.))),
                             LIAISON=_F( SOUS_STRUC_1 = 'SPHER0',
                                      SOUS_STRUC_2 = 'SPHER1',
                                      INTERFACE_1 = 'ITF0',
                                      INTERFACE_2 = 'ITF1')

                            )

#
#  NUMEROTATION DU PROBLEME GENERALISE
#
NUMEGE1=NUME_DDL_GENE(  MODELE_GENE=MODEGE1,
                           STOCKAGE='PLEIN'
                            )

#
#  ASSEMBLAGE DES MATRICES RAIDEUR ET MASSE
#
MASGEN=ASSE_MATR_GENE(  NUME_DDL_GENE=NUMEGE1,
                                  OPTION='MASS_GENE')

#
RIGGEN=ASSE_MATR_GENE(  NUME_DDL_GENE=NUMEGE1,
                                  OPTION='RIGI_GENE')

MATRAJ=CALC_MATR_AJOU(  MODELE_FLUIDE=FLUIDE,
                 MODELE_INTERFACE=INTERFAC,
                 OPTION='MASS_AJOU',
                  CHARGE=CHARGE_F,
                  CHAM_MATER=CHAMMAT2,
                  MODELE_GENE=MODEGE1,
                  NUME_DDL_GENE=NUMEGE1,
                  DIST_REFE=4.5158)

#
# SOMME DE LA MATRICE DE MASSE AJOUTEE A LA MATRICE DE MASSE
#
#
MASTOT=COMB_MATR_ASSE( COMB_R=(  _F( MATR_ASSE = MASGEN,
                                     COEF_R = 1.),
                                     _F( MATR_ASSE = MATRAJ,
                                     COEF_R = 1.)))

#
#   CALCUL DES MODES PROPRES DE LA STRUCTURE GLOBALE EN EAU
#


RGENHUMI=CALC_MODES(CALC_FREQ=_F(FREQ=(1.,50.,),
                                 ),
                    VERI_MODE=_F(SEUIL=2.E-5,
                                 ),
                    OPTION='BANDE',
                    MATR_RIGI=RIGGEN,
                    MATR_MASS=MASTOT,
                    )


#
#   CREATION DU MAILLAGE SQUELETTE DE LA STRUCTURE GLOBALE
#
SQUEL=DEFI_SQUELETTE(  MODELE_GENE=MODEGE1,SOUS_STRUC=(
                            _F( NOM = 'SPHER0',
                                        GROUP_MA = ('COQU1',
                                        'RESSORT1','RESSORT2','RESSORT3', )),
                            _F( NOM = 'SPHER1',
                                        GROUP_MA = ('COQU1',
                                        'RESSORT1','RESSORT2','RESSORT3', )))
                           )

#
#   RESTITUTION SUR MAILLAGE SQUELETTE
#
MODGLO=REST_SOUS_STRUC(   RESU_GENE=RGENHUMI,
                             SQUELETTE=SQUEL,
                           TOUT_ORDRE='OUI')

TEST_RESU(RESU=(_F(PARA='FREQ',
                   NUME_MODE=1,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=3.11916136991,
                   VALE_REFE=3.1172,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(PARA='FREQ',
                   NUME_MODE=2,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=3.13237426135,
                   VALE_REFE=3.1183000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(PARA='FREQ',
                   NUME_MODE=3,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=9.31442277441,
                   VALE_REFE=9.2727000000000004,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(PARA='FREQ',
                   NUME_MODE=4,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=9.85338573577,
                   VALE_REFE=9.8267000000000007,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(PARA='FREQ',
                   NUME_MODE=5,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=23.1290582233,
                   VALE_REFE=22.440000000000001,
                   CRITERE='RELATIF',
                   PRECISION=0.031,),
                _F(PARA='FREQ',
                   NUME_MODE=6,
                   REFERENCE='AUTRE_ASTER',
                   RESULTAT=MODGLO,
                   VALE_CALC=31.177904824,
                   VALE_REFE=30.329499999999999,
                   CRITERE='RELATIF',
                   PRECISION=0.029999999999999999,),
                ),
          )

FIN()
#
