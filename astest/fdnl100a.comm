# MODIF  DATE 04/04/2007   AUTEUR ABBAS M.ABBAS 
# TITRE CALCUL DES FORCE_FLUIDE LORS D'UNE CHUTTE DE GRAPPE
# RESPONSABLE LONGATTE E.LONGATTE
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2003  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT( CODE=_F(  NOM = 'FDNL100A',NIV_PUB_WEB='INTRANET'), )

MAILLA=LIRE_MAILLAGE();

MAILLA=DEFI_GROUP(reuse =MAILLA,
                  MAILLAGE=MAILLA,
                  CREA_GROUP_NO=(_F(GROUP_MA=('GRAPPE'),),),)

MODELE=AFFE_MODELE(MAILLAGE=MAILLA,
                   AFFE=(_F(GROUP_MA=('GRAPPE',),
                            PHENOMENE='MECANIQUE',
                            MODELISATION='POU_D_E',),),)

E  = 1.9633E+14
NU = 0.34

# ACIER DE BASE  TIGE DE COMMANDE ET CRAYON
MATER1=DEFI_MATERIAU(ELAS=_F(E=E,
                             NU=NU,
                             RHO=7700.0,),);

# MATERIAU EQUIVALENT PARTIE TIGE CANELEE
MATER2=DEFI_MATERIAU(ELAS=_F(E=E,
                             NU=NU,
                             RHO=7200.0,),);

# MATERIAU EQUIVALENT BASE ARAIGNEE
MATER3=DEFI_MATERIAU(ELAS=_F(E=E,
                             NU=NU,
                             RHO=18000.0,),);

# MATERIAU EQUIVALENT CRAYON + RESSORT
MATER4=DEFI_MATERIAU(ELAS=_F(E=E,
                             NU=NU,
                             RHO=15000.0,),);

# MATERIAU EQUIVALENT CRAYON + AIC
MATER5=DEFI_MATERIAU(ELAS=_F(E=E,
                             NU=NU,
                             RHO=57900.0,),);

CHAMPMAT=AFFE_MATERIAU(MAILLAGE=MAILLA,
                       MODELE=MODELE,
                       AFFE=(_F(GROUP_MA='TRAV1',
                                MATER=MATER1,),
                             _F(GROUP_MA='TRAV2',
                                MATER=MATER2,),
                             _F(GROUP_MA='TRAV3',
                                MATER=MATER1,),
                             _F(GROUP_MA='TRAV4',
                                MATER=MATER2,),
                             _F(GROUP_MA='TRAV5',
                                MATER=MATER1,),
                             _F(GROUP_MA='TRAV6',
                                MATER=MATER3,),
                             _F(GROUP_MA='TRAV7',
                                MATER=MATER3,),
                             _F(GROUP_MA='TRAV8',
                                MATER=MATER1,),
                             _F(GROUP_MA='TRAV9',
                                MATER=MATER4,),
                             _F(GROUP_MA='TRAV10',
                                MATER=MATER5,),
                             _F(GROUP_MA='TRAV11',
                                MATER=MATER1,),),);

CHAMPCAR=AFFE_CARA_ELEM(MODELE=MODELE,
                        ORIENTATION=(_F(GROUP_MA='GRAPPE',
                                        VALE=(0.,0.,1.),
                                        CARA='VECT_Y',),),
                        POUTRE=(_F(GROUP_MA='TRAV1',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.00119224,1.82e-07,1.82e-07,1.57,1.57,3.64e-07,),),
                                _F(GROUP_MA='TRAV2',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.00100267,1.3794e-07,1.3794e-07,1.60,1.60,2.7588e-07,),),
                                _F(GROUP_MA='TRAV3',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.00119224,1.82e-07,1.82e-07,1.57,1.57,3.64e-07,),),
                                _F(GROUP_MA='TRAV4',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.00076309,1.1953e-07,1.1953e-07,1.76,1.76,2.3906e-07,),),
                                _F(GROUP_MA='TRAV5',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.00136572,1.4843e-07,1.4843e-07,2.0,2.0,2.9686e-07,),),
                                _F(GROUP_MA='TRAV6',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0010516,1.4057e-07,1.4057e-07,1.56,1.56,2.8115e-07,),),
                                _F(GROUP_MA='TRAV7',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0010516,1.4057e-07,1.4057e-07,1.56,1.56,2.8115e-07,),),
                                _F(GROUP_MA='TRAV8',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0008822,1.9000e-09,1.9000e-09,2.0,2.0,3.8000e-09,),),
                                _F(GROUP_MA='TRAV9',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0002997,3.2092e-09,3.2092e-09,1.95,1.95,6.4184e-09,),),
                                _F(GROUP_MA='TRAV10',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0002997,4.33254e-09,4.3325e-09,1.95,1.95,8.6649e-09,),),
                                _F(GROUP_MA='TRAV11',
                                   SECTION='GENERALE',
                                   CARA=('A','IY','IZ','AY','AZ','JX',),
                                   VALE=(0.0017644,1.0323e-08,1.0323e-08,2.0,2.0,2.0646e-08,),),),)

# ======================================================================

MASSESTR=POST_ELEM(  MODELE=MODELE,
                         CHAM_MATER=CHAMPMAT,   CARA_ELEM=CHAMPCAR,
                        MASS_INER=_F(  GROUP_MA = ('GRAPPE','TIGE','ARAIGN','CRAYON' ) ) )

IMPR_TABLE( TABLE=MASSESTR, 
            FORMAT_R='E20.13' )

# 
# --- GRANDEURS CALCULEES PAR POST_ELEM
# 
# masse GRAPPE 
M_GRAPP = 126.41755870000
# masse TIGE 
M_TIGE  =  59.07367720000
# masse ARAIGNEE
M_ARAIG =   3.02860800000
# masse CRAYON
M_CRAYO =  64.31527350000
# 
# --- TIGE: CALCUL DE ROTIGE
# 
DTIGE  = 0.0445
LTIGE  = 7.500
ROTIGE = M_TIGE / ( LTIGE * pi * DTIGE**2 / 4 )
# 
# --- ARAIGNEE: CALCUL DE RORAI
# 
VARAI = 4.900E-4
RORAI = M_ARAIG / VARAI
# 
# --- CRAYON: CALCUL DE ROCRAY
# 
DCRAY  = 0.009675
LCRAY  = 3.860
ROCRAY = M_CRAYO / ( 24 * LCRAY * pi * DCRAY**2 / 4 )

TEST_TABLE( TABLE = MASSESTR,
            FILTRE=_F( NOM_PARA='LIEU', VALE_K='GRAPPE'),
            NOM_PARA='MASSE',
            VALE=M_GRAPP,
            REFERENCE='NON_REGRESSION', )
TEST_TABLE( TABLE = MASSESTR,
            FILTRE=_F( NOM_PARA='LIEU', VALE_K='TIGE'),
            NOM_PARA='MASSE',
            VALE=M_TIGE,
            REFERENCE='NON_REGRESSION', )
TEST_TABLE( TABLE = MASSESTR,
            FILTRE=_F( NOM_PARA='LIEU', VALE_K='ARAIGN'),
            NOM_PARA='MASSE',
            VALE=M_ARAIG,
            REFERENCE='NON_REGRESSION', )
TEST_TABLE( TABLE = MASSESTR,
            FILTRE=_F( NOM_PARA='LIEU', VALE_K='CRAYON'),
            NOM_PARA='MASSE',
            VALE=M_CRAYO,
            REFERENCE='NON_REGRESSION', )

# ======================================================================
# 
# --- deplacement suivant Y
# 
CHARG0 = AFFE_CHAR_MECA( MODELE=MODELE,
                         DDL_IMPO = _F( GROUP_NO='GRAPPE',
                                         DX=0.0,           DZ=0.0, 
                                        DRX=0.0, DRY=0.0, DRZ=0.0,),  ) ;

# 
# --- charge due au frottement 
# 
FM = 100. / ( LTIGE + LCRAY )

CHARG1 = AFFE_CHAR_MECA( MODELE=MODELE,
                         FORCE_POUTRE = _F( GROUP_MA='GRAPPE',
                                            FY= FM  ), ) ;
# 
# --- poids propre 
# 

CHARG2 = AFFE_CHAR_MECA( MODELE=MODELE,
                         PESANTEUR = ( 9.81,  0., -1., 0.  ), ) ;

# ======================================================================
# 
# --- LECTURE DES DONNESS GRAPPE_900 ---
# 
INCLUDE(   UNITE= 33,   INFO=1  )

F_FLUIDE=AFFE_CHAR_MECA(MODELE=MODELE,
                     GRAPPE_FLUIDE=(_F( GROUP_MA='GRAPPE',
                                        GROUP_NO_ORIG = 'PHTDC',
                                        GROUP_NO_EXTR = 'PBCRA',
                                        Z0 = 0.22 ,
                                        CARA_HYDR = C_HYDR ,
                                        VALE_HYDR = V_HYDR ,
                                        CARA_GRAPPE = C_GRAP ,
                                        VALE_GRAPPE = V_GRAP ,
                                        CARA_COMMANDE = C_COMM ,
                                        VALE_COMMANDE = V_COMM ,
                                        CARA_MANCHETTE = C_MANC ,
                                        VALE_MANCHETTE = V_MANC ,
                                        CARA_GUIDE = C_GUID ,
                                        VALE_GUIDE = V_GUID ,
                                        CARA_ASSEMBLAGE = C_ASSE ,
                                        VALE_ASSEMBLAGE = V_ASSE ,
                                        CARA_PDC = C_PDC ,
                                        VALE_PDC = V_PDC ,
                                      ),
                                    _F( APPL_FORC_FMEC  = 'REPARTIE',
                                        APPL_FORC_FPLAQ = 'REPARTIE',
                                        APPL_FORC_FTG   = 'REPARTIE',
                                        APPL_FORC_ARCHI = 'REPARTIE',
#                                        APPL_FORC_ARCHI = 'CDG',
#                                        MASS_INER = MASSESTR,
                                        CARA_GRAPPE = ('M'    ,'ROTIGE','ROCRAY','RORAI'),
                                        VALE_GRAPPE = (M_GRAPP, ROTIGE , ROCRAY , RORAI ),
                                        UNITE_IMPR_FORCE = 38 ,
                                        UNITE_IMPR_NOEUD = 37 ,
                                      ),
                                   ),
                        ) ;


# ======================================================================

TFIN = 1.790     # Temps fin pour le calcul

PAS = 0.001      # pas de temps du calcul

L_INST=DEFI_LIST_REEL( DEBUT=0.0,
                       INTERVALLE=_F( JUSQU_A=TFIN, PAS=PAS,),
                     ) ;

#
DEFI_FICHIER( UNITE=37 );
DEFI_FICHIER( UNITE=38 );

RESU=DYNA_NON_LINE( MODELE=MODELE,
                CHAM_MATER=CHAMPMAT,
                CARA_ELEM=CHAMPCAR,
                EXCIT=(_F(CHARGE=CHARG0 ),
                       _F(CHARGE=CHARG1 ),
                       _F(CHARGE=CHARG2 ),
                       _F(CHARGE=F_FLUIDE,),),
                COMP_INCR=_F(RELATION='ELAS',
                             TOUT='OUI',),
                INCREMENT=_F(LIST_INST=L_INST,
#                            INST_FIN = TFIN,
                             NUME_INST_FIN   = 3 ,
                            ),
                SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                FORMULATION='DEPLACEMENT',),
                 ARCHIVAGE=_F( INST=( 0.700, 1.400, 1.787 ), ),
            );


RESU=DYNA_NON_LINE( reuse=RESU, MODELE=MODELE,
                CHAM_MATER=CHAMPMAT,
                CARA_ELEM=CHAMPCAR,
                EXCIT=(_F(CHARGE=CHARG0 ),
                       _F(CHARGE=CHARG1 ),
                       _F(CHARGE=CHARG2 ),
                       _F(CHARGE=F_FLUIDE,),),
                ETAT_INIT=_F( EVOL_NOLI = RESU ),
                COMP_INCR=_F(RELATION='ELAS',
                             TOUT='OUI',),
                INCREMENT=_F(LIST_INST=L_INST,
#                            NUME_INST_FIN   = 6 ,
                             INST_FIN = 1.78500000,
                            ),
                SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                FORMULATION='DEPLACEMENT',),
                 ARCHIVAGE=_F( INST=( 0.700, 1.400, 1.785 ), ),
            );

#######################################################################
#                      reference PEGASE 
#######################################################################
#
#  Les valeurs sont issus du code PEGASE
#  modelisation POI1, algo :
#    ACCE(IT) = FORCE_FLUIDE(DEPL(IT-1),VITE(IT-1),ACCE(IT-1))
#    VITE(IT) = VITE(IT-1) + DT*ACCE(IT)
#    DEPL(IT) = DEPL(IT-1) + (VITE(IT)+VITE(IT-1))/2*DT
#    avec DEPL(0)=VITE(0)=ACCE(0)
#
#  instant 0.7
DEPL_1 = -1.15640E+00
VITE_1 = -2.62173E+00
ACCE_1 = -1.19459E+00

#  instant 1.4
DEPL_2 = -3.16070E+00
VITE_2 = -2.62081E+00
ACCE_2 =  1.61194E+01

#  instant 1.785
DEPL_3 = -3.60930E+00
VITE_3 = -7.27578E-01
ACCE_3 =  2.94495E-01

TEST_RESU(RESU=(
          # DEPLACEMENT DU NOEUD SUPERIEUR DE LA TIGE
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,   NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = 0.0050, 
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = DEPL_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = 0.0050,
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = DEPL_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,   NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = 0.0050,
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = DEPL_3 ),

          # VITESSE DU NOEUD SUPERIEUR DE LA TIGE
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,    NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0050, 0.001 ),
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = VITE_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0150, 0.001 ),
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = VITE_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,   NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0050, 0.001 ),
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = VITE_3 ),

          # ACCELERATION DU NOEUD SUPERIEUR DE LA TIGE
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,    NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = 0.300, 
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = ACCE_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.060, 0.001 ), 
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = ACCE_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,   NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 25.000, 0.001 ), 
        GROUP_NO = 'PHTDC',  NOM_CMP = 'DY',       VALE = ACCE_3 ),

        )       )

TEST_RESU(RESU=(
          # DEPLACEMENT DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,   NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0100, 0.001 ),
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = DEPL_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0100, 0.001 ),
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = DEPL_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,    NOM_CHAM = 'DEPL',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0100, 0.001 ),
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = DEPL_3 ),

          # VITESSE DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,    NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0050, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = VITE_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0150, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = VITE_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,   NOM_CHAM = 'VITE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.0050, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = VITE_3 ),

          # ACCELERATION DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 7.00000E-01,    NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 0.350, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = ACCE_1 ),
   _F(  RESULTAT = RESU,     INST = 1.40000E+00,   NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',   PRECISION = ( 0.060, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = ACCE_2 ),
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,   NOM_CHAM = 'ACCE',
        REFERENCE = 'SOURCE_EXTERNE',  PRECISION = ( 1.700, 0.001 ), 
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',       VALE = ACCE_3 ),

        )       )

#######################################################################
#                      TEST de NON REGRESSION
#######################################################################
# -3.6104090071085E+00 sur clpaster
# -3.6104090071087E+00 sur clp50a8
# -3.6104090440009D+00 sur clayastr
#
TEST_RESU(RESU=(
          # DEPLACEMENT DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,    NOM_CHAM = 'DEPL',
        REFERENCE = 'NON_REGRESSION',  PRECISION = 1.E-8,
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',  VALE = -3.6104090194060 ),
        )       )

# -7.2647453926285E-01 sur clpaster
# -7.2647453926300E-01 sur clp50a8
# -7.2647453633216D-01 sur clayastr
#
TEST_RESU(RESU=(
          # DEPLACEMENT DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,    NOM_CHAM = 'VITE',
        REFERENCE = 'NON_REGRESSION',  PRECISION = 1.E-8,
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',  VALE = -7.2647453828600E-01 ),
        )       )

# -2.0604017675623E-01 sur clpaster
# -2.0604011707321E-01 sur clp50a8
# -2.0604134831092D-01 sur clayastr
#
TEST_RESU(RESU=(
          # DEPLACEMENT DU NOEUD INFERIEUR DU CRAYON
        
   _F(  RESULTAT = RESU,     INST = 1.78500E+00,    NOM_CHAM = 'ACCE',
        REFERENCE = 'NON_REGRESSION',  PRECISION = 1.E-5,
        GROUP_NO = 'PBCRA',  NOM_CMP = 'DY',  VALE =  -2.0604054738012E-01 ),
        )       )

FIN();
