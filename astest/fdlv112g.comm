# TITRE REPONSE SISMIQUE D UN BARRAGE AVEC LAPLACE TEMPS
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',),DEBUG=_F(SDVERI='OUI'), 
     );

mail = LIRE_MAILLAGE(VERI_MAIL=_F(VERIF='OUI'));

mail=DEFI_GROUP(reuse = mail,
                    MAILLAGE=mail,
                    CREA_GROUP_NO=(
                        _F(GROUP_MA=('PBASE',)),
                  ),
           );

mat1= DEFI_MATERIAU( ELAS=_F( E= 3.6E+10,
                              RHO= 2400.,
                              NU= 0.2,
                            ),
                       ) ;

Npf = 205*2

kxp=3.55E13/Npf
kyp=3.33E13/Npf
kzp=3.41E14/Npf

PRE_SEISME_NONL(
                 RESULTAT = _F(
                                MODELE = CO('modele'),
                                MAILLAGE = CO('mail2'),
                                CARA_ELEM = CO('cara_el2'),
                                CHARGE = (_F( NOM = CO('cond_lim'),
                                               OPTION = 'COND_LIM'),
                                           ),
                                CHAM_MATER = CO('champmat'),
                                BASE_MODALE = CO('BAMO'),
                                MACR_ELEM_DYNA = CO('MAEL0'),
                               ),

                 PARAMETRE = _F(  
                                  PRE_CALC_MISS= _F(
                                                     REDUC_DYNA_ISS = 'NON',
                                                     REDUC_DYNA_IFS = 'OUI',
                                                     NMAX_MODE_ISS = 6,
                                                     NMAX_MODE_IFS = 54,
                                                     GROUP_NO_INTERF = 'NISFS',
                                                     GROUP_NO_CENT = 'PBASE',
                                                     CALC_MISS_OPTION = 'ISFS',
                                                    ),
                                ),

                 AFFE_MODELE = _F( 
                                   MAILLAGE=mail,
                                   AFFE=( 
                                          _F(GROUP_MA=( 'STRVOU2' ),
                                             PHENOMENE= 'MECANIQUE',
                                             MODELISATION= '3D'),
                                          _F(GROUP_MA = 'PBASE',
                                             PHENOMENE = 'MECANIQUE',
                                             MODELISATION = 'DIS_TR'),
                                          _F(GROUP_MA = 'PFONDAT',
                                             PHENOMENE = 'MECANIQUE',
                                             MODELISATION = 'DIS_TR'),
                                         ),
                               ),

                # Condition aux limites pour le calcul des modes de corps rigide d'ISS
                AFFE_CHAR_MECA = _F( 
                                     #MODELE= MODEL1,
                                     DDL_IMPO=_F(
                                                 GROUP_NO = 'PBASE',
                                                 DX= 0.,
                                                 DY= 0.,
                                                 DZ= 0.,
                                                 DRX= 0.,
                                                 DRY= 0.,
                                                 DRZ= 0.,
                                                ),
                                     LIAISON_SOLIDE=_F(GROUP_NO=('ISOLSTR',),)
                                   ),

                # Tapis de ressorts pour le calcul des modes dynamiques d'ISFS
                AFFE_CARA_ELEM = _F(
                                     #MODELE= MODEL1,
                                     DISCRET=(
                                               _F(GROUP_MA=('PBASE'), 
                                                  CARA='K_TR_D_N',
                                                  VALE=(0.0,0.0,0.0,0.0,0.0,0.0,),
                                                  ),
                                               _F(GROUP_MA=('PFONDAT'), 
                                                  CARA='K_TR_D_N',
                                                  VALE=(kxp, kyp,kzp,1E18,1E18,1E18),
                                                  ),
                                               ),
                                   ),

                AFFE_MATERIAU = _F(
                                   MAILLAGE=mail,
                                   AFFE=_F( 
                                           GROUP_MA= ('STRVOU2'),
                                           MATER= mat1 )
                                    ),

);

#FIN();
#IMPR_CO(CHAINE='MAEL0   .LINO', UNITE = 6);  

TABSOL = DEFI_SOL_MISS(
   TITRE="SOL HOMOGENE",
   MATERIAU=(
      _F(E=3.0e11,   NU=0.16, RHO=2000., AMOR_HYST=0.10),
      _F(E=3.0e11,   NU=0.16, RHO=2000., AMOR_HYST=0.10),
   ),
   COUCHE=(
      _F(EPAIS=2.5, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=2.5, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=4.0, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=4.0, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=4.0, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=4.0, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=5.0, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=5.0, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=5.0, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=5.0, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=5.5, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=5.5, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=6.0, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=6.0, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=6.5, NUME_MATE=1, RECEPTEUR="OUI"),
      _F(EPAIS=6.5, NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(EPAIS=10., NUME_MATE=1, RECEPTEUR="OUI", SOURCE="OUI"),
      _F(SUBSTRATUM="OUI", NUME_MATE=2,),
   ),
   INFO=2,
);
                     
CALC_MISS(TYPE_RESU='FICHIER_TEMPS',
          PROJET='FDLV112E2',
          VERSION='V6.6',
          TABLE_SOL=TABSOL,
          MATER_FLUIDE=_F(RHO=1000.,
                          CELE=1500.,
                          AMOR_BETA=0.),
          MACR_ELEM_DYNA=MAEL0,
          GROUP_MA_INTERF='SURFBAS2',
          GROUP_MA_FLU_STR='IFLUSTR2',
          GROUP_MA_FLU_SOL='IFLUSOL2',
          GROUP_MA_SOL_SOL='SLIBREM2',
          UNITE_IMPR_ASTER=26,
          INST_FIN = 2.0,
          #INST_FIN = 0.1,
          #PCENT_FREQ_CALCUL=40,
          #FACTEUR_INTERPOL=10,
          PRECISION = 1E-10,
          PAS_INST = 0.05,
          UNITE_RESU_RIGI=35,
          PARAMETRE=_F(FREQ_IMAG=0.1,
                       Z0=5.0,
                       SURF='NON',
                       ISSF='OUI',
                       ALGO='REGU',
                       OFFSET_MAX=1000,
                       OFFSET_NB=5000,),);                       

NDDLGEN = NUME_DDL_GENE( BASE= BAMO, STOCKAGE= 'PLEIN',);

MATK = LIRE_IMPE_MISS(UNITE_RESU_IMPE=35, INST_EXTR=0.0,
                      SYME='OUI',
                      BASE=BAMO, NUME_DDL_GENE=NDDLGEN);

MAEL=MACR_ELEM_DYNA(  BASE_MODALE=BAMO,
                       MATR_IMPE_RIGI = MATK,
                       SANS_GROUP_NO='NISFS',
                       );
                       
IMPR_CO(CHAINE='MAEL    .LINO', UNITE = 6);

PRE_SEISME_NONL( 
                 RESULTAT = _F(
                                MODELE = CO('MODELB'),
                                MAILLAGE = CO('MAILB'),
                                CARA_ELEM = CO('ELEMB'),
                                CHARGE = (
                                            _F( NOM = CO('COND_LIB'),
                                                OPTION = 'COND_LIM'),
                                            _F( NOM = CO('CHSOL'),
                                                OPTION = 'LAPL_TEMPS'),
                                          ),
                                CHAM_MATER = CO('CHMATB')
                               ),

                 PARAMETRE = _F(
                                POST_CALC_MISS = _F(
                                                   MACR_ELEM_DYNA = MAEL,
                                                   UNITE_RESU_RIGI = 35,),
                                ),

                 AFFE_MODELE = _F(
                                  MAILLAGE=mail,
                                  AFFE=(
                                          _F(GROUP_MA=( 'STRVOU2' ),
                                             PHENOMENE= 'MECANIQUE',
                                             MODELISATION= '3D'),
                                          _F(GROUP_MA = 'PFONDAT',
                                             PHENOMENE = 'MECANIQUE',
                                             MODELISATION = 'DIS_TR'),
                                        ),
                                ),
    
                 AFFE_CARA_ELEM = _F(
                                      MODELE=modele,
                                      DISCRET=(
                                                _F(GROUP_MA=('PFONDAT'), 
                                                   CARA='K_TR_D_N',
                                                   VALE=(0.0, 0.0,0.0,0.0,0.0,0.0),
                                                   ),
                                               ),
                                     ),

                 AFFE_MATERIAU = _F(
                                      MAILLAGE=mail,
                                      AFFE=_F( 
                                              GROUP_MA= ('STRVOU2'),
                                              MATER= mat1 
                                              )
                                    ),

           );
 

PESAX=AFFE_CHAR_MECA(MODELE=MODELB,
                    PESANTEUR=_F(GRAVITE=1.0,
                                 DIRECTION=(-1.0,0.0,0.0,),),);

INCLUDE(UNITE=31,);

dt=0.05
TFIN=4                          
N=27

L_INST=DEFI_LIST_REEL(DEBUT=0.,
                     INTERVALLE=_F(
                                   JUSQU_A=(N-1)*dt,
                                   PAS=dt,),
                     );

ACCEX= CALC_FONCTION( COMB=_F( FONCTION = acc_x, COEF = 1.),
                        INTERPOL='LIN',
                        PROL_DROITE='LINEAIRE',
                        PROL_GAUCHE='LINEAIRE',
                      LIST_PARA=L_INST);
                        
DYNA=DYNA_NON_LINE(MODELE=MODELB,
                 CHAM_MATER=CHMATB,
                 CARA_ELEM=ELEMB,
                 EXCIT=(
                        #_F(CHARGE=FSEISX0,),
                        _F(CHARGE=PESAX,FONC_MULT=ACCEX,),
                        _F(CHARGE=CHSOL),
                        _F(CHARGE=COND_LIB),
                        ),
                 COMPORTEMENT=(_F(RELATION='ELAS',
                                    TOUT='OUI',),
                                ),
                 NEWTON=_F(#PREDICTION='ELASTIQUE',
                           MATRICE='ELASTIQUE',
                           #MATRICE='TANGENTE',
                           REAC_INCR=0,REAC_ITER=0,
                           ),
                 SCHEMA_TEMPS = _F(SCHEMA='HHT', 
                                   #ALPHA=-0.0,
                                   #ALPHA=-0.1,
                                   ALPHA=-0.02,
                                   MODI_EQUI='OUI',
                                   FORMULATION='DEPLACEMENT',),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-8,
                                ITER_GLOB_MAXI = 20,
                                ARRET='OUI',),
                 INCREMENT=_F(LIST_INST=L_INST,),
                 #ARCHIVAGE=_F(PAS_ARCH=1,),             
                          );
                          
ax253i = RECU_FONCTION ( RESULTAT = DYNA, NOM_CHAM = 'ACCE',
                        INTERPOL='LIN',
                        PROL_DROITE='LINEAIRE',
                        PROL_GAUCHE='LINEAIRE',
                        NOEUD = 'N253', NOM_CMP = 'DX', );
                        
ax316i = RECU_FONCTION ( RESULTAT = DYNA, NOM_CHAM = 'ACCE',
                        INTERPOL='LIN',
                        PROL_DROITE='LINEAIRE',
                        PROL_GAUCHE='LINEAIRE',
                        NOEUD = 'N316', NOM_CMP = 'DX', );
                        
ax11i = RECU_FONCTION ( RESULTAT = DYNA, NOM_CHAM = 'ACCE',
                        INTERPOL='LIN',
                        PROL_DROITE='LINEAIRE',
                        PROL_GAUCHE='LINEAIRE',
                        NOEUD = 'N11', NOM_CMP = 'DX', );
                        
ax253ia=CALC_FONCTION(LIST_PARA=L_INST,
                    COMB=(_F(FONCTION=ax253i,
                             COEF=1.,),
                          _F(FONCTION=ACCEX,
                             COEF=1.,),
                          ),
                       );
                       
ax316ia=CALC_FONCTION(LIST_PARA=L_INST,
                    COMB=(_F(FONCTION=ax316i,
                             COEF=1.,),
                          _F(FONCTION=ACCEX,
                             COEF=1.,),
                          ),
                       );        
                       
ax11ia=CALC_FONCTION(LIST_PARA=L_INST,
                    COMB=(_F(FONCTION=ax11i,
                             COEF=1.,),
                          _F(FONCTION=ACCEX,
                             COEF=1.,),
                          ),
                       );                        
                                

TEST_FONCTION(VALEUR=(
                      _F(VALE_CALC=-6.0407335E-01,
                         #VALE_REFE=4.885,
                         #PRECISION=0.015,
                         #REFERENCE = 'AUTRE_ASTER',
                         VALE_PARA=1.25,
                         FONCTION=ax253ia,
                         ),
##                       _F(VALE_CALC=4.884638426062,
##                          VALE_REFE=4.885,
##                          PRECISION=0.13,
##                          REFERENCE = 'AUTRE_ASTER',
##                          VALE_PARA=1.00,
##                          FONCTION=ax253i,
##                          ),
##                       _F(VALE_CALC=17.39874712248,
##                          VALE_REFE=17.40,
##                          PRECISION=0.015,
##                          REFERENCE = 'AUTRE_ASTER',
##                          VALE_PARA=(10.7, 0.05),
##                          NOM_PARA=('FREQ', 'AMOR'),
##                          FONCTION=sro_axi,
##                          ),
                      ),
              );


FIN( );
