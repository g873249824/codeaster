# TITRE CONTACT AVEC MACRO-ELEMENTS STATIQUE
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================


DEBUT(CODE=_F(NOM='SSNV193A',
              NIV_PUB_WEB='INTERNET',),
#              IGNORE_ALARM=('MECANONLINE5_4',),
DEBUG=_F(SDVERI='OUI'))


MA=LIRE_MAILLAGE(FORMAT='MED');

MA=MODI_MAILLAGE(reuse =MA,
                   MAILLAGE=MA,
                   ORIE_PEAU_3D=(_F(GROUP_MA='Esclave',),
                                 _F(GROUP_MA='Maitre',),),);
MA=DEFI_GROUP(reuse =MA,
              MAILLAGE=MA,
              CREA_GROUP_NO=(_F(GROUP_MA='Esclave',
                                NOM='Esclave',),
                             _F(GROUP_MA='Interf',
                                NOM='Interf',),
                             _F(GROUP_MA='Haut',
                                NOM='Haut',),

                              ),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=210.E9,
                            NU=0.3,
                            RHO=7800.0,),);

RIGID=DEFI_MATERIAU(ELAS=_F(E=210.E15,
                            NU=0.3,
                            RHO=7800.0,),);


LISTIN1=DEFI_LIST_REEL(DEBUT=0.0,
                       INTERVALLE=_F(JUSQU_A=1.0,
                                     NOMBRE=2,),);


RAMPE=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_GAUCHE='LINEAIRE',
                    PROL_DROITE='LINEAIRE',
                    VALE=(0.0,0.0,1.0,1.0,)
                    )

# CALCUL DE REFERENCE SANS MACRO_ELEMENTS

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=(_F(TOUT='OUI',
                            MATER=ACIER,),
                          _F(GROUP_MA='Cube1',
                            MATER=RIGID,)
                            )
                            ,);

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='3D',),);

ENCAST=AFFE_CHAR_CINE(MODELE=MO,
                      MECA_IMPO=_F(GROUP_MA='Maitre',
                                  DX=0.0,
                                  DY=0.0,
                                  DZ=0.0,),);


CONTC =DEFI_CONTACT(MODELE    = MO,
                  FORMULATION  = 'CONTINUE',
                  ALGO_RESO_CONT = 'NEWTON',
                  ALGO_RESO_GEOM = 'NEWTON',
                  ZONE=(
                        _F(
                          GROUP_MA_MAIT='Maitre',
                          GROUP_MA_ESCL='Esclave',
                          CONTACT_INIT='OUI',
                         ),
                       ),
                  )

DEPL=AFFE_CHAR_MECA(MODELE=MO,
                     DDL_IMPO=_F(GROUP_MA='Haut',
                                 DX=0.0,
                                 DY=0.0,
                                 DZ=-0.1,),)

UCTCC=STAT_NON_LINE(MODELE=MO,
                CHAM_MATER=CHMAT,
                EXCIT=(
                        _F(CHARGE=ENCAST,),
                        _F(CHARGE=DEPL,FONC_MULT=RAMPE),
                      ),
                CONTACT = CONTC,
                COMP_INCR=(_F(RELATION='ELAS',
                              TOUT='OUI',),
                          ),
                INCREMENT=_F(LIST_INST=LISTIN1,),
                NEWTON=_F(MATRICE='ELASTIQUE',
                          REAC_ITER=1,),
                SOLVEUR=_F(SYME='OUI',),
                INFO=1,);

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  RESULTAT=UCTCC,
                  NOM_CHAM='VALE_CONT',
                  NOM_CMP='RZ',
                  VALE_CALC=-1.3801560770878E9,
                  CRITERE='RELATIF',
                  ),
          )

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=UCTCC,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DZ',
                  VALE_CALC= 3.851859888774E-33,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  PRECISION=9.9999999999999998E-13,
                  ),
          )

#CREATION DU MACRO-ELEMENT STATIQUE
MODSS=AFFE_MODELE(MAILLAGE=MA,
                  AFFE=_F(
                  GROUP_MA=('Cube2','Esclave','Haut',),
                          PHENOMENE='MECANIQUE',
                          MODELISATION='3D',),);

CHF31=AFFE_CHAR_MECA(MODELE=MODSS,
                     DDL_IMPO=_F(GROUP_MA='Haut',
                                 DX=0.0,
                                 DY=0.0,
                                 DZ=-0.1,),);

MACSS=MACR_ELEM_STAT(DEFINITION=_F(MODELE=MODSS,
                                   CHAM_MATER=CHMAT,
                                   CHAR_MACR_ELEM=CHF31,),
                     EXTERIEUR=_F(GROUP_NO=('Esclave')),
                     RIGI_MECA=_F(),
                     CAS_CHARGE=_F(NOM_CAS='K1',
                                   SUIV='OUI',
                                   CHARGE=CHF31,),);

MAYSS=DEFI_MAILLAGE(DEFI_SUPER_MAILLE=_F(MACR_ELEM=MACSS,
                                        SUPER_MAILLE='MAILLE1',),
                    DEFI_NOEUD=_F(TOUT='OUI',
                    INDEX=(1,0,1,8,),),
                                  );
#FIN DU MACRO-ELEMENT STATIQUE
MAG=ASSE_MAILLAGE(MAILLAGE_1=MA,
                  MAILLAGE_2=MAYSS,
                  OPERATION='SOUS_STR',);

CHMAT2=AFFE_MATERIAU(MAILLAGE=MAG,
                    AFFE=(_F(TOUT='OUI',
                            MATER=ACIER,),
                          _F(GROUP_MA='Cube1',
                            MATER=RIGID,)
                            ),);

MOMACR=AFFE_MODELE(MAILLAGE=MAG,
               AFFE_SOUS_STRUC=_F(SUPER_MAILLE='MAILLE1',
                                  PHENOMENE='MECANIQUE',),
               AFFE=_F(GROUP_MA=('Cube1','Maitre','Base',),
                       PHENOMENE='MECANIQUE',
                       MODELISATION='3D',),);

CONTC2 =DEFI_CONTACT(MODELE    = MOMACR,
                  FORMULATION  = 'CONTINUE',
                  ALGO_RESO_CONT = 'NEWTON',
                  ALGO_RESO_GEOM = 'NEWTON',
                  ZONE=(
                        _F(
                          GROUP_MA_MAIT='Maitre',
                          GROUP_MA_ESCL='Esclave',
                          CONTACT_INIT='OUI',
                         ),
                       ),);
CONTD2 =DEFI_CONTACT(MODELE    = MOMACR,
                  FORMULATION  = 'DISCRETE',
                  ZONE=(
                        _F(
                          GROUP_MA_MAIT='Maitre',
                          GROUP_MA_ESCL='Esclave',
                         ),
                       ),);

ENCAST2=AFFE_CHAR_CINE(MODELE=MOMACR,
                      MECA_IMPO=_F(GROUP_MA='Maitre',
                                  DX=0.0,
                                  DY=0.0,
                                  DZ=0.0,),);

UMCTCC=STAT_NON_LINE(MODELE=MOMACR,
                CHAM_MATER=CHMAT2,
                SOLVEUR=_F(SYME='OUI',),
                EXCIT=(
                        _F(CHARGE=ENCAST2,),
                      ),
                CONTACT = CONTC2,
                SOUS_STRUC=_F(CAS_CHARGE='K1',
                              FONC_MULT=RAMPE,
                           SUPER_MAILLE='MAILLE1',),
                COMP_INCR=(_F(RELATION='ELAS',
                              TOUT='OUI',),
                          ),
                INCREMENT=_F(LIST_INST=LISTIN1,),
                NEWTON=_F(MATRICE='ELASTIQUE',
                          REAC_ITER=1,),
                INFO=1,);

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  REFERENCE='AUTRE_ASTER',
                  RESULTAT=UMCTCC,
                  NOM_CHAM='VALE_CONT',
                  NOM_CMP='RZ',
                  VALE_CALC=-1.38015608E+09,
                  VALE_REFE=-1.3801560770878E9,
                  CRITERE='RELATIF',
                  PRECISION=9.9999999999999995E-07,
                  ),
          )

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=UMCTCC,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DZ',
                  VALE_CALC= 0.0E+00,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  PRECISION=9.9999999999999998E-13,
                  ),
          )

UMCTCD=STAT_NON_LINE(MODELE=MOMACR,
                   CHAM_MATER=CHMAT2,
                   SOLVEUR=_F(SYME='OUI',),
                EXCIT=(
                        _F(CHARGE=ENCAST2,),
                      ),
                CONTACT = CONTD2,
                SOUS_STRUC=_F(CAS_CHARGE='K1',
                              FONC_MULT=RAMPE,
                           SUPER_MAILLE='MAILLE1',),
                COMP_INCR=(_F(RELATION='ELAS',
                              TOUT='OUI',),
                          ),
                INCREMENT=_F(LIST_INST=LISTIN1,),
                NEWTON=_F(MATRICE='ELASTIQUE',
                          REAC_ITER=1,),
                INFO=1,);

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  REFERENCE='AUTRE_ASTER',
                  RESULTAT=UMCTCD,
                  NOM_CHAM='VALE_CONT',
                  NOM_CMP='RZ',
                  VALE_CALC=-1.38015608E+09,
                  VALE_REFE=-1.3801560770878E9,
                  CRITERE='RELATIF',
                  PRECISION=9.9999999999999995E-07,
                  ),
          )

TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  GROUP_NO='A',
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=UMCTCD,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DZ',
                  VALE_CALC=-3.035766082959E-18,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  PRECISION=9.9999999999999998E-13,
                  ),
          )

FIN();
