# person_in_charge: ayaovi-dzifa.kudawoo at edf.fr
# TITRE VERIFICATION EXCENTREMENT PLAQUE TROUEE EN TRACTION EN PLASTICITE 
# ======================================================================
# COPYRIGHT (C) 1991 - 2015  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(
              NIV_PUB_WEB='INTERNET',
VISU_EFICAS='OUI',),DEBUG=_F(SDVERI='OUI'))


# LECTURE DU MAILLAGE
MAIL0=LIRE_MAILLAGE(FORMAT='MED',);


# creation de plaq2 : meme noeuds que plaq1 mais mailles distinctes
MAIL=CREA_MAILLAGE(MAILLAGE=MAIL0,
                  CREA_MAILLE=_F(NOM = 'ALL_FAC1',
                                   PREF_MAILLE = 'C',
                                   GROUP_MA = 'ALL_FAC',)
                 )

MAIL=DEFI_GROUP(reuse =MAIL,
               MAILLAGE=MAIL,
               CREA_GROUP_NO=(_F(GROUP_MA='ALL_FAC',
                                 NOM='ALL_FAC',),
                              _F(GROUP_MA='ALL_FAC1',
                                 NOM='ALL_FAC1',),),);


MAIL=MODI_MAILLAGE(reuse =MAIL,
                   MAILLAGE=MAIL,
                   ORIE_PEAU_2D=_F(GROUP_MA='haut',),);



# AFFECTATION DU MODELE (CONTRAINTES PLANES)
MODE=AFFE_MODELE(MAILLAGE=MAIL0,
                 AFFE=_F(TOUT='OUI',
                         PHENOMENE='MECANIQUE',
                         MODELISATION='DKT',),);

MODE1=AFFE_MODELE(MAILLAGE=MAIL,
                 AFFE=_F(TOUT='OUI',
                         PHENOMENE='MECANIQUE',
                         MODELISATION='DKT',),);
ep=1.0
EP=AFFE_CARA_ELEM(MODELE=MODE,
                   COQUE= (
                           _F(GROUP_MA=('ALL_FAC','haut','bas','gauche','droite',),
                             EPAIS=ep,EXCENTREMENT=0., INER_ROTA='OUI',COQUE_NCOU=5,),
                           ),  
                             )

EP1=AFFE_CARA_ELEM(MODELE=MODE1,
                   COQUE= (
                           _F(GROUP_MA=('ALL_FAC','haut','bas','gauche','droite',),
                             EPAIS=ep/2,EXCENTREMENT=ep/4, INER_ROTA='OUI',COQUE_NCOU=5,),
                           _F(GROUP_MA=('ALL_FAC1',),
                             EPAIS=ep/2,EXCENTREMENT=-ep/4, INER_ROTA='OUI',COQUE_NCOU=5,)
                           ),  
                             )


# DEFINITION DU MATERIAU
# COURBE DE TRACTION
CTRAC = LIRE_FONCTION(UNITE=21,
                      NOM_PARA='EPSI',
                      PROL_DROITE='CONSTANT',)

#IMPR_FONCTION(FORMAT='XMGRACE',
              #UNITE=29,
              #COURBE=_F(FONCTION=CTRAC,),
              #TITRE='Courbe de traction',
              #LEGENDE_X='Deformation',
              #LEGENDE_Y='Contrainte (MPa)',);

ACIER=DEFI_MATERIAU(ELAS=_F(E=200000.0,
                    NU=0.3,),
                 TRACTION=_F(SIGM=CTRAC,),);

CHMATE=AFFE_MATERIAU(MAILLAGE=MAIL0,
                     AFFE=_F(TOUT='OUI',
                           MATER=ACIER,),);
                           
CHMATE1=AFFE_MATERIAU(MAILLAGE=MAIL,
                     AFFE=_F(TOUT='OUI',
                           MATER=ACIER,),);
# CONDITIONS DE SYMETRIE
CHSYME=AFFE_CHAR_MECA(MODELE=MODE,
                      DDL_IMPO=(_F(GROUP_MA='bas',
                                 DY=0.0,DZ=0.0,DRY=0.0,),
                                 _F(GROUP_MA='gauche',
                                 DX=0.0,DZ=0.0,DRX=0.0),
                                # _F(GROUP_NO='F',
                                # DRX=0.0,DRY=0.0,DRZ=0.0,),
                                 ),
                                );

CHSYME1=AFFE_CHAR_MECA(MODELE=MODE1,
                      DDL_IMPO=(_F(GROUP_MA='bas',
                                 DY=0.0,DZ=0.0,DRY=0.0,),
                                 _F(GROUP_MA='gauche',
                                 DX=0.0,DZ=0.0,DRX=0.0),
                                # _F(GROUP_NO='F',
                                # DRX=0.0,DRY=0.0,DRZ=0.0,),
                                 ),
                                );

# CHARGEMENT EN FORCE
CHFORC=AFFE_CHAR_MECA(MODELE=MODE,
                      FORCE_ARETE=_F(GROUP_MA='haut', FY=1.0,),);
                      
CHFORC1=AFFE_CHAR_MECA(MODELE=MODE1,
                      FORCE_ARETE=_F(GROUP_MA='haut', FY=1.0,),);
                      
# RAMPE APPLICATION CHARGEMENT
RAMPE=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,0.0,
                           1000.,1000.,
                           ),);

# DISCRETISATION EN TEMPS
TFIN  = 110.0;
TELAS = 10.0;

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=(_F(JUSQU_A=TELAS,
                                     NOMBRE=1,),
                                  _F(JUSQU_A=TFIN,
                                     NOMBRE=50,),
                                  ),);

DEFLIST =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST = L_INST,),
                        ECHEC=_F(EVENEMENT='ERREUR',
                                 SUBD_NIVEAU=5,
                                 ACTION='DECOUPE',),)


########################################################################
#
# PREMIER CALCUL : ON RESTE ELASTIQUE
#
########################################################################

RESU=STAT_NON_LINE(MODELE=MODE,
                     CHAM_MATER=CHMATE,
                   CARA_ELEM=EP,
                     EXCIT=(_F(CHARGE=CHSYME,),
                            _F(CHARGE=CHFORC,
                               FONC_MULT=RAMPE,
                               ),),
                     COMPORTEMENT=_F(RELATION='VMIS_ISOT_TRAC',),
                     CONVERGENCE=_F(RESI_GLOB_MAXI=1.E-6,ITER_GLOB_MAXI=15,),
                     INCREMENT=_F(LIST_INST=DEFLIST,
                                  INST_FIN=TELAS,),);
RESU1=STAT_NON_LINE(MODELE=MODE1,
                     CHAM_MATER=CHMATE1,
                   CARA_ELEM=EP1,
                     EXCIT=(_F(CHARGE=CHSYME1,),
                            _F(CHARGE=CHFORC1,
                               FONC_MULT=RAMPE,
                               ),),
                     COMPORTEMENT=_F(RELATION='VMIS_ISOT_TRAC',),
                     CONVERGENCE=_F(RESI_GLOB_MAXI=1.E-6,ITER_GLOB_MAXI=15,),
                     INCREMENT=_F(LIST_INST=DEFLIST,
                                  INST_FIN=TELAS,),);

########################################################################
#
# PREMIER CALCUL : PLASTIFICATION
#
########################################################################

RESU=STAT_NON_LINE(reuse =RESU,
                     MODELE=MODE,
                     CHAM_MATER=CHMATE,
                   CARA_ELEM=EP,
                     EXCIT=(_F(CHARGE=CHSYME,),
                            _F(CHARGE=CHFORC,
                               FONC_MULT=RAMPE,),),
                     COMPORTEMENT=_F(RELATION='VMIS_ISOT_TRAC',),
                     ETAT_INIT=_F(EVOL_NOLI=RESU,),
                     INCREMENT=_F(LIST_INST=DEFLIST,
                                  INST_FIN=TFIN,
                                  ),
                     NEWTON=_F(REAC_ITER=1,PREDICTION='ELASTIQUE',),
                     CONVERGENCE=_F(RESI_GLOB_MAXI=1.E-6,ITER_GLOB_MAXI=200,),
                     );


RESU1=STAT_NON_LINE(reuse =RESU1,
                     MODELE=MODE1,
                     CHAM_MATER=CHMATE1,
                   CARA_ELEM=EP1,
                     EXCIT=(_F(CHARGE=CHSYME1,),
                            _F(CHARGE=CHFORC1,
                               FONC_MULT=RAMPE,),),
                     COMPORTEMENT=_F(RELATION='VMIS_ISOT_TRAC',),
                     ETAT_INIT=_F(EVOL_NOLI=RESU1,),
                     INCREMENT=_F(LIST_INST=DEFLIST,
                                  INST_FIN=TFIN,
                                  ),
                     NEWTON=_F(REAC_ITER=1,PREDICTION='ELASTIQUE',),
                     CONVERGENCE=_F(RESI_GLOB_MAXI=1.E-6,ITER_GLOB_MAXI=200,),
                     );


########################################################################
#
# POST_TRAITEMENT
#
########################################################################
########RESU
# INTERPOLATION DES CONTRAINTES AUX NOEUDS
RESU=CALC_CHAMP(reuse=RESU,RESULTAT=RESU,DEFORMATION=('EPSI_ELNO'),CONTRAINTE=('SIGM_ELNO'))
RESUPOS=POST_CHAMP(RESULTAT=RESU,
                   EXTR_COQUE=_F(NOM_CHAM='SIGM_ELNO',
                                 NUME_COUCHE=1,
                                 NIVE_COUCHE='MOY',),);
RESUPOS=CALC_CHAMP(reuse =RESUPOS,
                RESULTAT=RESUPOS,
                CONTRAINTE='SIGM_NOEU',);                

DEFOPOS=POST_CHAMP(RESULTAT=RESU,
                   EXTR_COQUE=_F(NOM_CHAM='EPSI_ELNO',
                                 NUME_COUCHE=1,
                                 NIVE_COUCHE='MOY',),);
DEFOPOS=CALC_CHAMP(reuse =DEFOPOS,
                RESULTAT=DEFOPOS,
                DEFORMATION='EPSI_NOEU',);                


# INTERPOLATION DES CONTRAINTES EQUIVALENTES AUX NOEUDS
RESU=CALC_CHAMP(reuse=RESU,RESULTAT=RESU,CRITERES=('SIEQ_ELNO'))
# IMPRESSION DES RESULTATS
#IMPR_RESU(FORMAT='MED',
          #RESU=_F(RESULTAT=RESU,),);


########RESU1
RESU1=CALC_CHAMP(reuse=RESU1,RESULTAT=RESU1,DEFORMATION=('EPSI_ELNO'),CONTRAINTE=('SIGM_ELNO'))
RESUPOS1=POST_CHAMP(RESULTAT=RESU1,
                   EXTR_COQUE=_F(NOM_CHAM='SIGM_ELNO',
                                 NUME_COUCHE=1,
                                 NIVE_COUCHE='MOY',),);
RESUPOS1=CALC_CHAMP(reuse =RESUPOS1,
                RESULTAT=RESUPOS1,
                CONTRAINTE='SIGM_NOEU',);

DEFOPOS1=POST_CHAMP(RESULTAT=RESU1,
                   EXTR_COQUE=_F(NOM_CHAM='EPSI_ELNO',
                                 NUME_COUCHE=1,
                                 NIVE_COUCHE='MOY',),);
DEFOPOS1=CALC_CHAMP(reuse =DEFOPOS1,
                RESULTAT=DEFOPOS1,
                DEFORMATION='EPSI_NOEU',);                


# INTERPOLATION DES CONTRAINTES EQUIVALENTES AUX NOEUDS
RESU1=CALC_CHAMP(reuse=RESU1,RESULTAT=RESU1,CRITERES=('SIEQ_ELNO'))


# IMPRESSION DES RESULTATS
#IMPR_RESU(FORMAT='MED',
          #RESU=_F(RESULTAT=RESU1,),);
          
          
TEST_RESU(RESU=_F(NUME_ORDRE=1,
                  GROUP_NO='B',
                  RESULTAT=RESUPOS,
                  NOM_CHAM='SIGM_NOEU',
                  NOM_CMP='SIYY',
                  VALE_CALC=28.3820363291,
                  CRITERE='RELATIF',),
          )

          
TEST_RESU(RESU=_F(
                  REFERENCE='AUTRE_ASTER',
                  NUME_ORDRE=1,
                  GROUP_NO='B',
                  RESULTAT=RESUPOS1,
                  NOM_CHAM='SIGM_NOEU',
                  NOM_CMP='SIYY',
                  VALE_CALC=28.3820363291,
                  VALE_REFE=28.3820363291,
                  CRITERE='RELATIF',),
          )



#EPYY=RECU_FONCTION (   RESULTAT = DEFOPOS,
                          #NOM_CMP = 'EPYY',
                          #NOM_CHAM = 'EPSI_NOEU',
                          #GROUP_NO = 'B',
                          #TOUT_ORDRE = 'OUI')

#SIGYY=RECU_FONCTION (   RESULTAT = RESUPOS,
                          #NOM_CMP = 'SIYY',
                          #NOM_CHAM = 'SIGM_NOEU',
                          #GROUP_NO = 'B',
                          #TOUT_ORDRE = 'OUI')

#EPYY1=RECU_FONCTION (   RESULTAT = DEFOPOS1,
                          #NOM_CMP = 'EPYY',
                          #NOM_CHAM = 'EPSI_NOEU',
                          #GROUP_NO = 'B',
                          #TOUT_ORDRE = 'OUI')

#SIGYY1=RECU_FONCTION (   RESULTAT = RESUPOS1,
                          #NOM_CMP = 'SIYY',
                          #NOM_CHAM = 'SIGM_NOEU',
                          #GROUP_NO = 'B',
                          #TOUT_ORDRE = 'OUI')

#IMPR_FONCTION( UNITE=25, FORMAT='XMGRACE',
               #COURBE=(_F(FONC_X = EPYY,FONC_Y=SIGYY),
                      #_F(FONC_X = EPYY1,FONC_Y=SIGYY1),_F(FONCTION=CTRAC,),),
                #TITRE='SIYY en fonction de EPYY'
              #)



FIN();
