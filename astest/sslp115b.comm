# TITRE DISQUE FISSURE EN PRESENCE DE CONTRAINTES INITIALES AVEC X-FEM
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

#################################################################
###########                  CALCUL THERMIQUE
#################################################################
MAILMECA=LIRE_MAILLAGE(UNITE=20,
                       FORMAT='MED',
                        );

TEMPVARX=DEFI_FONCTION(NOM_PARA='X',VALE=(-100,260,
                                           0,130,
                                           22,100,
                                           100,200),);
CHP_TEMP=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_F',
                     MAILLAGE=MAILMECA,
                     AFFE=_F(TOUT = 'OUI',
                     NOM_CMP = 'TEMP',
                     VALE_F = TEMPVARX))

CTE250=DEFI_FONCTION(NOM_PARA='X',
                     VALE=(-100,250,
                            100,250),);

CHTEMP0=CREA_CHAMP( OPERATION='AFFE',
                    TYPE_CHAM='NOEU_TEMP_F',
                    MAILLAGE=MAILMECA,
                    AFFE=_F(TOUT = 'OUI',
                            NOM_CMP = 'TEMP',
                            VALE_F = CTE250))

#Calcul thermique
LIST1=DEFI_LIST_REEL(DEBUT=0,
                     INTERVALLE=_F(JUSQU_A=2,NOMBRE=2,),);

RESUTHER=CREA_RESU(OPERATION='AFFE',
                   TYPE_RESU='EVOL_THER',
                   NOM_CHAM='TEMP',
                   AFFE=(_F(INST = -1,
                            CHAM_GD = CHTEMP0),
                         _F(LIST_INST = LIST1,
                            CHAM_GD = CHP_TEMP),)
                   )

##CALCUL MECANIQUE AVEC TEMPERATURE, FISSURE FERMEE => RESUMECA, pour champs
#de contrainte initiale 

MO=AFFE_MODELE(MAILLAGE=MAILMECA,
               AFFE=_F(GROUP_MA='Tout',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='D_PLAN',),);

a0=23
LN = FORMULE(NOM_PARA=('Y'),VALE='Y')
LT = FORMULE(NOM_PARA=('X'),VALE='abs(X-a0/2)-a0/2')

FISS=DEFI_FISS_XFEM(MODELE=MO,
                      DEFI_FISS=_F(FONC_LT=LT,
                                   FONC_LN=LN,),),

##Materiau dependant de la temperature
MAMEC=DEFI_MATERIAU(ELAS=_F(E=210000,
                            NU=0.3,
                            ALPHA=10e-6,),);

MAMECA=AFFE_MATERIAU(MAILLAGE=MAILMECA,
                     AFFE=_F(TOUT='OUI',
                             MATER=MAMEC,),
                     AFFE_VARC=_F(TOUT='OUI',
                                  NOM_VARC='TEMP',
                                  EVOL = RESUTHER,
                                  VALE_REF=250,),);


INSTMECA=DEFI_LIST_REEL(DEBUT=-1,
                        INTERVALLE=(_F(JUSQU_A=0,PAS=1,),
                                    _F(JUSQU_A=1,PAS=1,),),);

ModX=MODI_MODELE_XFEM(MODELE_IN=MO,
                         FISSURE=FISS);

##Chargement : encastrement
ENCASTRE=AFFE_CHAR_MECA(MODELE=ModX,
                        DDL_IMPO=_F(GROUP_NO='Contour',
                                    DX=0,
                                    DY=0,),);
                         
# Desactiver les ddl enrichis pour considere une fissure fermed
DESXFEM=AFFE_CHAR_MECA(MODELE=ModX,
                       DDL_IMPO=_F(TOUT ='OUI',
                                   H1X = 0,
                                   H1Y = 0,
                                   E1X = 0,
                                   E1Y = 0,
                                   E2X = 0,
                                   E2Y = 0,
                                   E3X = 0,
                                   E3Y = 0,
                                   E4X = 0,
                                   E4Y = 0,
                                    )  ,);

##Calcul thermomecanique avec fissure fermee pour extraction des contraintes
RESUMECA=STAT_NON_LINE(MODELE=ModX,
                       CHAM_MATER=MAMECA,
                       EXCIT=(_F(CHARGE=ENCASTRE,),
                              _F(CHARGE=DESXFEM,),
                               ),
                       COMPORTEMENT=_F(RELATION='ELAS',),
                       INCREMENT=_F(LIST_INST=INSTMECA,),);

RESUMECA=CALC_CHAMP(reuse=RESUMECA,
                    RESULTAT=RESUMECA,
                    CONTRAINTE=('SIEF_ELNO','SIEF_NOEU',),
                    DEFORMATION=('EPSI_ELGA','EPSP_ELNO',),
                    VARI_INTERNE=('VARI_ELNO',),);

##Extraction des contraintes au noeuds et points de Gauss
SIEFELGA=CREA_CHAMP(TYPE_CHAM='ELGA_SIEF_R',
                    OPERATION='EXTR',
                    RESULTAT=RESUMECA,
                    NOM_CHAM='SIEF_ELGA',
                    INST=1,
                    INFO=1,);

##Calcul thermomecanique sans etat init ouverture de la fissure
RESOUVFI=STAT_NON_LINE(MODELE=ModX,
                       CHAM_MATER=MAMECA,
                       EXCIT=(_F(CHARGE=ENCASTRE,),),
                       COMPORTEMENT=_F(RELATION='ELAS',),
                       INCREMENT=_F(LIST_INST=INSTMECA,), );

RESOUVFI=CALC_CHAMP(reuse=RESOUVFI,
                    RESULTAT=RESOUVFI,
                    CONTRAINTE=('SIEF_ELNO',),
                    DEFORMATION=('EPSI_ELGA','EPSP_ELNO',),
                    VARI_INTERNE=('VARI_ELNO',),);

##Definition du fond de fissure et des couronnes pour reutilisation dans resuini
# DÃ©finit par CALC_G avec ce maillahe
Rinf=1.2
Rsup=2.4

THETA1=CALC_G(RESULTAT=RESOUVFI,
             OPTION='CALC_G',
             THETA=_F( FISSURE=FISS,),);
IMPR_TABLE(TABLE = THETA1)
#################################################################
########## Calcul de G en presence du champ de contrainte residuelle genere par le calcul thermique)
##################################################################
## Definition de la liste d'instants
LIST3=DEFI_LIST_REEL(DEBUT=2,
                     INTERVALLE=_F(JUSQU_A=3,PAS=1,),);

## Affectation du materiau mecanique (sans chargement thermique)
MAMECA2=AFFE_MATERIAU(MAILLAGE=MAILMECA,
                      AFFE=_F(TOUT='OUI',MATER=MAMEC,),);
## Resolution ouverture de la fissure en presence d'un champ de contrainte residuelle

RESUINI=STAT_NON_LINE(MODELE=ModX,
                      CHAM_MATER=MAMECA2,
                      EXCIT=(_F(CHARGE=ENCASTRE,),),
                      COMPORTEMENT=_F(RELATION='ELAS',),
                      ETAT_INIT=_F(SIGM=SIEFELGA,),
                      CONVERGENCE=_F(RESI_GLOB_MAXI=1.E-10),
                      INCREMENT=_F(LIST_INST=LIST3),);

## Calcul postraitement
RESUINI=CALC_CHAMP(reuse=RESUINI,
                   RESULTAT=RESUINI,
                   DEFORMATION=('EPSI_ELGA','EPSP_ELNO',),
                   VARI_INTERNE=('VARI_ELNO',),);


## Calcul de G en utilisant les couronnes precedemment definies (dans le calcul thermique)
# et les differentes possibilites de l'etat initial.                             
GINGA=CALC_G(THETA=_F( FISSURE=FISS, 
                         NUME_FOND = 2,
                ),
             RESULTAT=RESUINI,
             INST=3,
             ETAT_INIT =_F(SIGM=SIEFELGA),
             OPTION='CALC_G')

GINGA2=CALC_G(THETA=_F( FISSURE=FISS,
                         NUME_FOND = 2,
                         R_INF = Rinf,
                         R_SUP = 2*Rsup,
                ),
             RESULTAT=RESUINI,
             INST=3,
             ETAT_INIT =_F(SIGM=SIEFELGA),
             OPTION='CALC_G')
             
GINGA3=CALC_G(THETA=_F( FISSURE=FISS,
                     NUME_FOND = 2,
                     R_INF = Rinf,
                     R_SUP = 4*Rsup,
                ),
             RESULTAT=RESUINI,
             INST=3,
             ETAT_INIT =_F(SIGM=SIEFELGA),
             OPTION='CALC_G')

GTHER=CALC_G(THETA=_F( FISSURE=FISS,
                         NUME_FOND = 2
                ),
             RESULTAT=RESOUVFI,
             INST=1,
             OPTION='CALC_G')

## Impression des resultats
TEST_TABLE(PRECISION=0.02,
           VALE_CALC=54.243555023161,
           VALE_REFE=55.102982584654,
           REFERENCE='SOURCE_EXTERNE',
           NOM_PARA='G',
           TABLE=GINGA,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=3,),
           )

TEST_TABLE(PRECISION=0.02,
           VALE_CALC=54.611545963686,
           VALE_REFE=55.102982584654,
           REFERENCE='SOURCE_EXTERNE',
           NOM_PARA='G',
           TABLE=GINGA2,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=3,),
           )

TEST_TABLE(PRECISION=0.02,
           VALE_CALC=54.124067771622,
           VALE_REFE=55.102982584654,
           REFERENCE='SOURCE_EXTERNE',
           NOM_PARA='G',
           TABLE=GINGA3,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=3,),
           )
           
TEST_TABLE(VALE_CALC=55.102982584654,
           NOM_PARA='G',
           TABLE=GTHER,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=1,),
           )
FIN();

