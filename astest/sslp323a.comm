# TITRE PROPAGATION DE FISSURE RADIALE DEBOUCHANTE DANS UN DISQUE EN ROTATION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='OUI'))


#***********************************
# MAILLAGE ET MODELE
#***********************************

MAILLAG1=LIRE_MAILLAGE(INFO=1,FORMAT='MED',);


MO=AFFE_MODELE(MAILLAGE=MAILLAG1,
                   AFFE=_F(GROUP_MA=('PLAQUE',),
                           PHENOMENE='MECANIQUE',
                           MODELISATION='C_PLAN',),);

#***********************************
# MATERIAU
#***********************************
NU=0.33
E=2.06E11
RHO=7800.

ACIER=DEFI_MATERIAU(ELAS=_F(E=E,
                            NU=NU,RHO=RHO,),);

MAT=AFFE_MATERIAU(MAILLAGE=MAILLAG1,
                      AFFE=_F(TOUT='OUI',
                              MATER=ACIER,),);

#***********************************
# DISCRETISATION TEMPORELLE
#***********************************

LINST=DEFI_LIST_REEL(DEBUT=0,
                        INTERVALLE=_F(JUSQU_A=1,
                                      NOMBRE=1,),);

#***********************************
# DEFINITION DES FISSURES
#***********************************

# LONGUEUR DE LA FISSURE INITIALE
a0 = 2
R = 5.

LN = FORMULE(VALE='X-R',
              NOM_PARA=('X'));
LT = FORMULE(VALE='Y-a0',
              NOM_PARA=('Y'));

# NOMBRE DE PROPAGATIONS
NPS = 3
NPS = NPS+2

Fiss = [None]*NPS

Fiss[1]=DEFI_FISS_XFEM(MODELE=MO,
                        DEFI_FISS=_F(FONC_LT=LT,
                                     FONC_LN=LN,),);

#****************************
# PROPAGATION DES FISSURES
#****************************

ModX = [None]*NPS
ChgX = [None]*NPS
BLOC = [None]*NPS
CHRX = [None]*NPS
ResX = [None]*NPS
SIF = [None]*NPS
PULSE = 10.

RI = 0.25
RS = 2*RI

# AVANCE DE LA FISSURE A CHAQUE ITERATION
da_fiss = 1.

for i in range(1,NPS-1) :

    ModX[i]=MODI_MODELE_XFEM(MODELE_IN=MO,
                         FISSURE=Fiss[i],);

    BLOC[i]=AFFE_CHAR_MECA(MODELE=ModX[i],
                           DDL_IMPO=(_F(GROUP_NO=('AXE',),
                                        DX=0,
                                        DY=0,),
                                        _F(GROUP_NO=('P_SUP',),
                                        DX=0,),),
                                        );

    CHRX[i]=AFFE_CHAR_MECA(MODELE=ModX[i],
                       ROTATION=_F(VITESSE = PULSE,
                                   AXE = (0.,0.,1.,),
                                   CENTRE=(R,R,0.,),),); 


    ResX[i]=MECA_STATIQUE(MODELE=ModX[i],
                         CHAM_MATER=MAT,
                         EXCIT=(_F(CHARGE=CHRX[i],),
                                _F(CHARGE=BLOC[i],),
                                ),
                         );

    SIF[i]=CALC_G(THETA=_F(FISSURE=Fiss[i],),
                   RESULTAT=ResX[i],
                   OPTION='CALC_K_G',);


    IMPR_TABLE(TABLE=SIF[i],);

    if ( i != NPS ) :
      Fiss[i+1]=CO('Fiss_%d'%(i+1))

      PROPA_FISS(MODELE=ModX[i],
                 FISSURE=_F(FISS_ACTUELLE=Fiss[i],
                             FISS_PROPAGEE=Fiss[i+1],
                             TABLE=SIF[i],),
                 DA_MAX=da_fiss,
#                 METHODE_PROPA='UPWIND',
                 METHODE_PROPA='SIMPLEXE',
                 ZONE_MAJ='TOUT',                    
                 LOI_PROPA=_F(LOI='PARIS',
                              C=1.,
                              M=1.,
                              MATER=ACIER),
                 COMP_LINE=_F(COEF_MULT_MINI=0.,
                              COEF_MULT_MAXI=1.,
                             ),
                 RAYON=RS,
                 INFO=0,);

#----------------------------------------------
#         POST TRAITEMENT
#----------------------------------------------
#       SOLUTIONS ANALYTIQUES DE K1 :
# STRESS ANALYSIS OF CRACKS HANDBOOK (TADA,PARIS,IRWIN) P.246
D=2*R
afiss=[a0 , a0+da_fiss, a0+2*da_fiss, a0+3*da_fiss]
alpha = 0.5 / (1. - NU)
F = [None]*5
G = [None]*5
K1REF = [None]*5

VAL_CAL=[
 3.2030644112693E+07,
 3.2030644112693E+07,
 5.2139827095131E+07,
 5.2139827095131E+07,
 7.8205484656505E+07,
 7.8205484656505E+07,
]

for i in range(1,4) :
   F[i]=(1.122+0.14*(afiss[i]/D)-0.545*(afiss[i]/D)**2+0.405*(afiss[i]/D)**3)/(1-afiss[i]/D)**1.5
   G[i]=(0.187*(6-9*(afiss[i]/D)+5*(afiss[i]/D)**2)-7.35*(afiss[i]/D)**2*(1-afiss[i]/D)**4*(1-0.5*afiss[i]/D))/(1-afiss[i]/D)**1.5
   K1REF[i]=((1+alpha)/16)*RHO*PULSE**2*D**2*sqrt(pi*afiss[i])*(F[i]-(3*alpha-1)*G[i]/(1+alpha))

   TEST_TABLE(TABLE=SIF[i],
              NOM_PARA='K1',
              TYPE_TEST='MAX',
              VALE_CALC=VAL_CAL[2*(i-1)+0],
              VALE_REFE=K1REF[i],
              CRITERE='RELATIF',
              PRECISION=0.05,
              REFERENCE='ANALYTIQUE',);

   TEST_TABLE(TABLE=SIF[i],
              NOM_PARA='K1',
              TYPE_TEST='MIN',
              VALE_CALC=VAL_CAL[2*(i-1)+1],
              VALE_REFE=K1REF[i],
              CRITERE='RELATIF',
              PRECISION=0.05,
              REFERENCE='ANALYTIQUE',);


FIN();
