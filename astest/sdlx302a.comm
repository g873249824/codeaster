# TITRE POUTRE ENCASTREE ET MASSE CONCENTREE SOUMISE A UNE FORCE
# ======================================================================
# COPYRIGHT (C) 1991 - 2015  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
#
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

#
MA=LIRE_MAILLAGE( )

#
MA=DEFI_GROUP( reuse=MA,        MAILLAGE=MA,
                           CREA_GROUP_NO=_F( GROUP_MA = ( 'POUTRE',
                                                       'MASS',
                                                     ))
                        )

#
# DEFINITION DES PARAMETRES GEOMETRIQUE POUR LES TUYAUX
#
# RAYON EXTERIEUR DU TUYAU
#
R1=0.2

#
# EPAISSEUR DU TUYAU
#
EP=0.006

#
# DEFINITION DU PARAMETRE POUR LA MASSE PONCTUELLE
#
M1=300.

JT=200.

#
# DEFINITIN DU MODELE
#
MO=AFFE_MODELE(    MAILLAGE=MA,AFFE=(
                                _F( PHENOMENE = 'MECANIQUE',
                                      GROUP_MA = 'POUTRE',
                                      MODELISATION = 'POU_D_T'),
                                     _F( PHENOMENE = 'MECANIQUE',
                                      GROUP_MA = 'MASS',
                                      MODELISATION = 'DIS_TR'))
                        )

#
# CARACTERISTIQUES DES POUTRES, ET AUTRES ELEMENTS
#
CARAELEM=AFFE_CARA_ELEM(       MODELE=MO,
                                   POUTRE=_F( GROUP_MA = 'POUTRE',
                                           SECTION = 'CERCLE',
                                           CARA = ( 'R', 'EP', ),
                                           VALE = (  R1,  EP,  )),
                              ORIENTATION=_F( GROUP_MA = 'POUTRE',
                                           CARA = 'VECT_Y',
                                           VALE = (1., 0., 0.,)),
#
# LA MASSE
#
                                 DISCRET=(_F( GROUP_MA = 'MASS',
                                          CARA = 'M_TR_N',
                                          REPERE = 'GLOBAL',
                                          VALE = ( M1,   0.,  M1,
                                                       0.,   0.,  M1,
                                                       0.,   0.,  0.,
                                                       JT,   0.,  0.,
                                                       0.,   0.,  JT,
                                                       0.,   0.,  0.,
                                                       0.,  0.,   JT,
                                                     )),
                                          _F( GROUP_MA = 'MASS',
                                          CARA = 'K_TR_N',
                                          REPERE = 'GLOBAL',
                                          VALE = (0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,
                                                  0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,
                                                  0.
                                                     ))
                           ))

#
# DEFINITION DU MATERIAU
#
MAT=DEFI_MATERIAU(    ELAS=_F( E = 2.1E11,
                                    NU = 0.,
                                    RHO = 7850.)
                          )

#
# AFFECTATION DU MATERIAU
#
#
CHMAT=AFFE_MATERIAU(    MAILLAGE=MA,
                                  AFFE=_F( TOUT = 'OUI',
                                        MATER = MAT)
                          )

#
# CONDITIONS AUX LIMITES
#
CH1A=AFFE_CHAR_MECA(      MODELE=MO,DDL_IMPO=(
                                _F(  GROUP_NO = ('P1',),
                                           DX = 0.,
                                           DY = 0.,
                                           DZ = 0.,
                                           DRX = 0.,
                                           DRY = 0.,
                                           DRZ = 0.),
                                _F(  TOUT = 'OUI',
                                           DY = 0.,
                                           DZ = 0.,
                                           DRX = 0.,
                                           DRY = 0.))
                            )

#
# CALCUL DES MATRICES ELEMENTAIRES DE RIGIDITES
#
RIGIELEM=CALC_MATR_ELEM(        MODELE=MO,
                                   OPTION='RIGI_MECA',
                                   CHARGE=CH1A,
                               CHAM_MATER=CHMAT,
                                CARA_ELEM=CARAELEM
                           )

#
# CALCUL DES MATRICES ELEMENTAIRES DE MASSES
#
MASSELEM=CALC_MATR_ELEM(        MODELE=MO,
                                   OPTION='MASS_MECA',
                                   CHARGE=CH1A,
                               CHAM_MATER=CHMAT,
                                CARA_ELEM=CARAELEM
                           )

#
# NUMEROTATIOM
#
NUMEDDL=NUME_DDL(    MATR_RIGI=RIGIELEM )

#
# MATRICE DE RIGIDITE
#
RIGIDITE=ASSE_MATRICE(    MATR_ELEM=RIGIELEM,
                             NUME_DDL=NUMEDDL
                        )

#
# MATRICE DE MASSE
#
MASSE=ASSE_MATRICE(    MATR_ELEM=MASSELEM,
                             NUME_DDL=NUMEDDL
                        )

#
# CALCUL MODAL
#
MODE1=CALC_MODES(MATR_RIGI=RIGIDITE,
                 OPTION='PLUS_PETITE',
                 CALC_FREQ=_F(NMAX_FREQ=10,
                              ),
                 MATR_MASS=MASSE,
                 )


MODE1=CALC_CHAMP(reuse=MODE1,RESULTAT=MODE1,CONTRAINTE=('EFGE_ELNO','SIPO_ELNO','SIEF_ELGA'))


MODE1=CALC_CHAMP(reuse=MODE1,     RESULTAT=MODE1,
                                   FORCE='FORC_NODA',

                      )

#
# TEST_RESU
#
#
# MODES PROPRES
#
TEST_RESU(RESU=_F(NUME_ORDRE=1,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=0.703968595,
                  VALE_REFE=0.70199999999999996,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=1.E-2,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=2,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=5.028968725,
                  VALE_REFE=5.0430000000000001,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=1.E-2,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=3,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=14.587489455,
                  VALE_REFE=14.066000000000001,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.037999999999999999,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=4,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=28.429257310,
                  VALE_REFE=28.657,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=1.E-2,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=5,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=45.377653666,
                  VALE_REFE=45.890000000000001,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.012,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=6,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=65.069267459,
                  VALE_REFE=66.269999999999996,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.019,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=7,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=89.174540997,
                  VALE_REFE=91.510000000000005,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.025999999999999999,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=8,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=118.677744747,
                  VALE_REFE=122.77,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.034000000000000002,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=9,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=153.247292978,
                  VALE_REFE=157.78999999999999,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.029999999999999999,),
          )

#
TEST_RESU(RESU=_F(NUME_ORDRE=10,
                  PARA='FREQ',
                  RESULTAT=MODE1,
                  VALE_CALC=192.413031345,
                  VALE_REFE=204.69,
                  REFERENCE='NON_DEFINI',
                  CRITERE='RELATIF',
                  PRECISION=0.060999999999999999,),
          )

#
EFF1=AFFE_CHAR_MECA(          MODELE=MO,
                              FORCE_NODALE=_F( NOEUD = 'N1',
                                            FX = 1000.)
                          )

#
VECT1=CALC_VECT_ELEM(     OPTION='CHAR_MECA',
                               CHARGE=EFF1
                          )

#
VECTASS1=ASSE_VECTEUR(    VECT_ELEM=VECT1,
                              NUME_DDL=NUMEDDL
                         )

#
#
# DEFINITION DE L ACCELERATION
#
#
# DEFINITION DES BORNES FREQUENTIELLES
#
F0=0.

F1=0.9999

F2=1.000

F3=101.

F4=101.0001

#
# DEFINITION DES DSP
#
G0=0.

G1=1.

#
# INTERSPECTRE D EXCITATION
#
FINTER=DEFI_FONCTION(       NOM_PARA='FREQ',
                                NOM_RESU='DSP',
                                INTERPOL='LIN',
                              PROL_DROITE='CONSTANT',
                             PROL_GAUCHE='CONSTANT',
                                  VALE_C=( F0, G0, 0.,
                                           F1, G0, 0.,
                                           F2, G1, 0.,
                                           F3, G1, 0.,
                                           F4, G0, 0.,
                                         )
                         )

#
INTERSPE=DEFI_INTE_SPEC(       DIMENSION=1,
                              PAR_FONCTION=_F(  NUME_ORDRE_I = 1,
                                             NUME_ORDRE_J = 1,
                                             FONCTION = FINTER)
                          )

#
#
DYNALEA1=DYNA_ALEA_MODAL(    BASE_MODALE=_F( MODE_MECA = MODE1,
                                            BANDE = (1., 101.,
                                                          ),
                                            AMOR_UNIF = 0.01),
                                    EXCIT=_F( DERIVATION = 0,
                                           INTE_SPEC = INTERSPE,
                                           NUME_ORDRE_I = 1,
                                           NUME_ORDRE_J = 1,
                                           CHAM_NO = VECTASS1),
                                  REPONSE=_F( DERIVATION = 0,
                                           FREQ_MIN = 1.,
                                           FREQ_MAX = 101.,
                                           PAS = 1.)
                         )

#

INTEREP1=REST_SPEC_PHYS(         MODE_MECA=MODE1,
                                         BANDE=( 1., 101., ),
                                INTE_SPEC_GENE=DYNALEA1,
                                      NOM_CHAM='DEPL',
                                          NOEUD='N1',
                                       NOM_CMP='DX',
                                        OPTION='TOUT_TOUT'  )

#
POSALEA1=POST_DYNA_ALEA(INTERSPECTRE=_F(
                              INTE_SPEC=INTEREP1,
                                NOEUD_I='N1',
                              NOM_CMP_I='DX',
                                NOEUD_J='N1',
                              NOM_CMP_J='DX',
                          ))

#
TEST_TABLE(PRECISION=0.11,
           VALE_CALC=0.034424456,
           VALE_REFE=0.037999999999999999,
           REFERENCE='NON_DEFINI',
           NOM_PARA='ECART',
           TABLE=POSALEA1,
           FILTRE=(_F(NOM_PARA='NOEUD_I',
                      VALE_K='N1',),
                   _F(NOM_PARA='NOEUD_J',
                      VALE_K='N1',),
                   ),
           )

FIN( )
