# MODIF  DATE 25/08/2008   AUTEUR KHAM M.KHAM 
#
# TITRE    ESSAI TRIAXIAL NON DRAINE CYCLIQUE AVEC LA LOI  
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
#                    DE HUJEUX SUR SABLE D'HOSTUN
#          ===============================================

from Numeric import *

DEBUT(CODE=_F(NOM='WTNV134A',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'));


# proprietes hydrauliques
poro = 0.425 ;  # porosite
rhol = 1000. ;  # masse volumique du fluide
kin  = 1.E-8 ;  # permeabilite intrinsinque
k_w  = 1.E10 ;  # module de compressibilite de l'eau
#UNSURK = 1/k_w ;
UNSURK = 1.E-12 ;
visco  = 0.001   ;
dvisco = 0.0     ;
k_int    = DEFI_CONSTANTE(VALE=kin)   ;
viscoliq = DEFI_CONSTANTE(VALE=visco) ;
dviscoli = DEFI_CONSTANTE(VALE=dvisco);


# modules mecaniques [Pa]
K = 516.2E6 ;
G = 238.2E6 ;
# =>
YOUNG   = 9.*K*G /(3.*K+G)        ;
POISSON = (3.*K-2.*G) /(6.*K+2.*G);

degr  = pi /180.
M     = sin(degr*31.)
pcr   = 361.E5*exp(1.) /2.
lambd = 0.1 /(1.-poro)
kapa  = lambd /2.

print 'young=',YOUNG,' /// nu=',POISSON

# pression de preconsolidation [en Pa]
PCR = -1.E6 ;
PCO =  3.E4 ;

# cohesion
r_ela =0.005
b     =0.2
ptrac =1000
p0    =-3.e4
pc    =-1.e6
c = M*r_ela*b*ptrac*(1+log(p0/pc)-1/b-ptrac/p0)
print 'cohesion =',c

#*******************************************************************
#    MAILLAGE + MODELE
#*******************************************************************
MAILLAGE=LIRE_MAILLAGE( );

MODELE=AFFE_MODELE(MAILLAGE=MAILLAGE,
                   AFFE=_F(TOUT         = 'OUI',
                           PHENOMENE    = 'MECANIQUE',
                           MODELISATION = '3D_HM'),
                           INFO         = 1);

MAILLAGE=MODI_MAILLAGE(reuse    = MAILLAGE,
                       MAILLAGE = MAILLAGE,
                       ORIE_PEAU_3D=
                            _F(GROUP_MA=('DEVANT','DROIT','ARRIERE',
                                         'GAUCHE','BAS','HAUT','APPUI',
                                         'COTE')),
                       INFO=1);


#*******************************************************************
#    INCREMENTS DE TEMPS
#*******************************************************************
TEMPS0=DEFI_LIST_REEL(DEBUT=-1.,
                      INTERVALLE=(_F(JUSQU_A =  0., NOMBRE = 1),));
                         
TEMPS1=DEFI_LIST_REEL(DEBUT=0.,
                      INTERVALLE=(_F(JUSQU_A = 10., NOMBRE = 10),
                                  _F(JUSQU_A = 20., NOMBRE = 10),
                                  _F(JUSQU_A = 30., NOMBRE = 10),
                                  _F(JUSQU_A = 40., NOMBRE = 10),
                                  _F(JUSQU_A = 50., NOMBRE = 10),
                                  _F(JUSQU_A = 55., NOMBRE = 5),
                                  _F(JUSQU_A = 60., NOMBRE = 50),
                                  _F(JUSQU_A = 65., NOMBRE = 50),
                                  _F(JUSQU_A = 70., NOMBRE = 50),
                                  _F(JUSQU_A = 74., NOMBRE = 40),
                                  _F(JUSQU_A = 76., NOMBRE = 40),
                                  _F(JUSQU_A = 80., NOMBRE = 40),
                                  _F(JUSQU_A = 90., NOMBRE = 100),
                                  _F(JUSQU_A = 100.,NOMBRE = 100),
                                  _F(JUSQU_A = 110.,NOMBRE = 50),
                                  _F(JUSQU_A = 120.,NOMBRE = 50),
                                  _F(JUSQU_A = 130.,NOMBRE = 50),
                                  _F(JUSQU_A = 140.,NOMBRE = 50),
                                  _F(JUSQU_A = 150.,NOMBRE = 50),
                                  _F(JUSQU_A = 160.,NOMBRE = 50),));
                                  
#*******************************************************************
#    MATERIAU : SOL
#*******************************************************************
SOL0=DEFI_MATERIAU(ELAS=_F(E=YOUNG, NU=POISSON, RHO=2500., ALPHA=0.),
                   COMP_THM='LIQU_SATU',
                   THM_INIT=_F(PRE1 = 0.,
                               PORO = poro),
                   THM_DIFFU=_F(RHO       = rhol,
                                BIOT_COEF = 1.,
                                PESA_X    = 0.,
                                PESA_Y    = 0.,
                                PESA_Z    = 0.,
                                PERM_IN   = k_int),
                   THM_LIQU=_F(RHO         = rhol,
                               UN_SUR_K    = UNSURK,
                               VISC        = viscoliq,
                               D_VISC_TEMP = dviscoli));

CHMAT0=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=_F(TOUT='OUI', MATER=SOL0));

#****************************************************************
#    CHARGEMENT MECANIQUE : FORCE DE COMPRESSION + DDL IMPOSES   
#****************************************************************
CHAR_U1=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='COTE',
                                   PRES = 1.));

CHAR_U2=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='APPUI',
                                   PRES = 1.));

CHAR_U3=AFFE_CHAR_MECA(MODELE=MODELE,
                       PRES_REP=_F(GROUP_MA='APPUI',PRES = 1.));
                                             
DEPL_1=AFFE_CHAR_MECA(MODELE=MODELE,
                      FACE_IMPO=(_F(GROUP_MA='BAS',   DZ = 0.),
                                 _F(GROUP_MA='GAUCHE',DX = 0.),
                                 _F(GROUP_MA='DEVANT',DY = 0.)));


#*****************************************************************
#    CHARGEMENT HYDRAULIQUE :          
#    TRIAXIAL NON DRAINE => FLUX NUL SUR TOUTES LES FACES
#                           (realise par defaut) 
#*****************************************************************
PRE0=AFFE_CHAR_MECA(MODELE=MODELE,
                    DDL_IMPO=_F(GROUP_MA='ECHAN',PRE1 = 0.));


COEF0=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_DROITE='CONSTANT',
                    VALE=(-1.0, 0.0,
                           0.0, PCO, ));
                        
# ---- premier chargement isotrope en elastique jusqu'a 50kPa
U0M=STAT_NON_LINE(MODELE    = MODELE,
                 CHAM_MATER = CHMAT0,
                 EXCIT=(_F(CHARGE    = CHAR_U1,
                           FONC_MULT = COEF0),
                        _F(CHARGE    = CHAR_U2,
                           FONC_MULT = COEF0),
                        _F(CHARGE    = DEPL_1),
                        _F(CHARGE    = PRE0)),
                 COMP_INCR=_F(RELATION     = 'KIT_HM',
                              RELATION_KIT = ('ELAS','LIQU_SATU','HYDR_UTIL')),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-6,
                                ITER_GLOB_MAXI = 50),
                 INCREMENT=_F(LIST_INST = TEMPS0,
                              INST_FIN  = 0.));
                                 
SIG0=CREA_CHAMP(INFO=1,
                TYPE_CHAM='ELGA_SIEF_R',
                OPERATION='EXTR',
                RESULTAT=U0M,
                NOM_CHAM='SIEF_ELGA',
                INST=0.0,);

                        
#***********************************************************************
#    ESSAI TRIAXIAL NON DRAINE CYCLIQUE
#***********************************************************************
SOL=DEFI_MATERIAU(ELAS=_F(E=YOUNG, NU=POISSON, RHO=2500., ALPHA=0.),
                  HUJEUX=_F(N        = 0.4,
                            BETA     = 24.,
                            D        = 2.5,
                            B        = 0.2,
                            PHI      = 33.,
                            ANGDIL   = 33.,
                            PCO      = -1.E6,
                            PREF     = -1.E6,
                            AMON     = 0.008,
                            ACYC     = 0.0001,
                            CMON     = 0.2,
                            CCYC     = 0.1,
                            RD_ELA   = 0.005,
                            RI_ELA   = 0.001,
                            RHYS     = 0.05,
                            RMOB     = 0.9,
                            XM       = 1.,
                            RD_CYC   = 0.005,
                            RI_CYC   = 0.001,
                            DILA     = 1.0, ),
                   COMP_THM='LIQU_SATU',
                   THM_INIT=_F(PRE1 = 0.,
                               PORO = poro),
                   THM_DIFFU=_F(RHO       = rhol,
                                BIOT_COEF = 1.,
                                PESA_X    = 0.,
                                PESA_Y    = 0.,
                                PESA_Z    = 0.,
                                PERM_IN   = k_int),
                   THM_LIQU=_F(RHO         = rhol,
                               UN_SUR_K    = UNSURK,
                               VISC        = viscoliq,
                               D_VISC_TEMP = dviscoli));
                    
CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=_F(TOUT='OUI', MATER=SOL));
                    
COEF1=DEFI_FONCTION(NOM_PARA    = 'INST',
                    PROL_DROITE = 'CONSTANT',
                    VALE=( 0.0, PCO,
                          10.0, PCO,));

COEF3=DEFI_FONCTION(NOM_PARA='INST',
                    PROL_DROITE='CONSTANT',
                    VALE=( 0.0, 0.00,
                          10.0, -15000.,
                          20.0, 15000.,
                          30.0, -15000.,
                          40.0, 15000.,
                          50.0, -15000.,
                          60.0, 15000,
                          70.0, -15000,
                          80.0, 15000,
                          90.0, -15000.,
                          100.0, 15000.,
                          110.0, -15000.,
                          120.0, 15000.,
                          130.0, -15000.,
                          140.0, 15000,
                          150.0, -15000,
                          160.0, 15000,));
                          
U1=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHMAT,
                 EXCIT=(_F(CHARGE = CHAR_U1, FONC_MULT = COEF1),
                        _F(CHARGE = CHAR_U2, FONC_MULT = COEF1),
                        _F(CHARGE = CHAR_U3, FONC_MULT = COEF3),
                        _F(CHARGE = DEPL_1)),
                 ETAT_INIT=_F(SIGM = SIG0,),
                 COMP_INCR=_F(RELATION       = 'KIT_HM',
                              RELATION_KIT   = ('HUJEUX',
                                                'LIQU_SATU','HYDR_UTIL'),
                              RESI_INTE_RELA = 1.E-6,
                              ITER_INTE_PAS  = -10),
                 NEWTON=_F(MATRICE   = 'TANGENTE',
                           REAC_ITER = 1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-6,
                                ITER_GLOB_MAXI = 10),
                 ARCHIVAGE=_F(LIST_INST    = TEMPS1,),
                 INCREMENT=_F(LIST_INST    = TEMPS1,
                              SUBD_METHODE = 'UNIFORME',
                              SUBD_PAS     = 10,
                              SUBD_NIVEAU  = 10,
                              INST_INIT    = 0.0,
                              INST_FIN     = 55.00),
                 RECH_LINEAIRE=_F(ITER_LINE_MAXI = 3),);


#-------------------------
#    TEST_RESU AU POINT C
#-------------------------
U1=CALC_ELEM(reuse      = U1, 
             MODELE     = MODELE,
             CHAM_MATER = CHMAT,
             OPTION     = ('SIEF_ELNO_ELGA','EPSI_ELNO_DEPL','VARI_ELNO_ELGA'),
             RESULTAT   = U1);

U1=CALC_NO(reuse      = U1,
           CHAM_MATER = CHMAT,
           OPTION     = ('SIEF_NOEU_ELGA','EPSI_NOEU_DEPL','VARI_NOEU_ELGA'),
           RESULTAT   = U1);
              

TAB_SIG=POST_RELEVE_T(ACTION=_F(INTITULE = 'SIEF_NOEU_ELGA',
                                GROUP_NO = 'C',
                                RESULTAT = U1,
                                NOM_CHAM = 'SIEF_NOEU_ELGA',
                                INVARIANT = 'OUI',
                                OPERATION= 'EXTRACTION'));

TAB_VAR=POST_RELEVE_T(ACTION=_F(INTITULE = 'VARI_NOEU_ELGA',
                                GROUP_NO = 'C',
                                RESULTAT = U1,
                                NOM_CHAM = 'VARI_NOEU_ELGA',
                                NOM_CMP  = ('V1','V2','V3','V4','V5','V6',
                                            'V7','V8','V23'),
                                OPERATION= 'EXTRACTION'));

#IMPR_TABLE(TABLE=TAB_SIG);
#IMPR_TABLE(TABLE=TAB_VAR);

# TEST SUR LA PRESSION ISOTROPE EFFECTIVE PAR RAPPORT AUX REFERENCES LAWYER
TEST_TABLE(TABLE=TAB_SIG,
           NOM_PARA='TRACE',
           VALE=-80193.7,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=10.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_SIG,
           NOM_PARA='TRACE',
           VALE=-74078.1,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=20.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_SIG,
           NOM_PARA='TRACE',
           VALE=-66250.1,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=30.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_SIG,
           NOM_PARA='TRACE',
           VALE=-52999,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=40.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_SIG,
           NOM_PARA='TRACE',
           VALE=-45671.9,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=50.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

# TEST DU COEF D ECROUISSAGE ISOROPE CYCLIQUE PAR RAPPORT AUX REFERENCES LAWYER
TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V8',
           VALE=.00138,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=15.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V8',
           VALE=.00217,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=25.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V8',
           VALE=.00337,
           PRECISION=0.03,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=35.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V8',
           VALE=.00510,
           PRECISION=0.04,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=45.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V8',
           VALE=.00189,
           PRECISION=0.07,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=55.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));


# TEST DU COEF D ECROUISSAGE DEVIATOIRE CYCLIQUE PAR RAPPORT AUX REFERENCES LAWYER
TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V1',
           VALE=.326,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=20.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V1',
           VALE=.394,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=30.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V1',
           VALE=.394,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=40.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V1',
           VALE=.578,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=50.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));


# TEST SUR LA DEFORMATION VOLUMIQUE PLASTIQUE PAR RAPPORT AUX REFERENCES LAWYER

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-2.63E-5,
           PRECISION=0.01,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=10.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-2.78E-5,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=15.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-4.43E-5,
           PRECISION=0.02,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=25.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-7.05E-5,
           PRECISION=0.03,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=35.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-1.11E-4,
           PRECISION=0.04,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=45.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));

TEST_TABLE(TABLE=TAB_VAR,
           NOM_PARA='V23',
           VALE=-1.85E-4,
           PRECISION=0.04,
           CRITERE='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA='INST',
                     VALE=55.00,
                     PRECISION=.00009,
                     CRITERE='ABSOLU'));


#************************************************************************
# ON POURSUIT AU-DELA DE LA LIQUEFACTION AVEC UNE COHESION PTRAC = 1000Pa
#************************************************************************
SOL1=DEFI_MATERIAU(ELAS=_F(E=YOUNG, NU=POISSON, RHO=2500., ALPHA=0.),
                  HUJEUX=_F(N        = 0.4,
                            BETA     = 24.,
                            D        = 2.5,
                            B        = 0.2,
                            PHI      = 33.,
                            ANGDIL   = 33.,
                            PCO      = -1.E6,
                            PREF     = -1.E6,
                            AMON     = 0.008,
                            ACYC     = 0.0001,
                            CMON     = 0.2,
                            CCYC     = 0.1,
                            RD_ELA   = 0.005,
                            RI_ELA   = 0.001,
                            RHYS     = 0.05,
                            RMOB     = 0.9,
                            XM       = 1.,
                            RD_CYC   = 0.005,
                            RI_CYC   = 0.001,
                            DILA     = 1.0,
                            PTRAC    = 1000.),
                   COMP_THM='LIQU_SATU',
                   THM_INIT=_F(PRE1 = 0.,
                               PORO = poro),
                   THM_DIFFU=_F(RHO       = rhol,
                                BIOT_COEF = 1.,
                                PESA_X    = 0.,
                                PESA_Y    = 0.,
                                PESA_Z    = 0.,
                                PERM_IN   = k_int),
                   THM_LIQU=_F(RHO         = rhol,
                               UN_SUR_K    = UNSURK,
                               VISC        = viscoliq,
                               D_VISC_TEMP = dviscoli));

CHMAT1=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=_F(TOUT='OUI', MATER=SOL1));

inst_init_1=55.
inst_fin_1 =67.
U2=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHMAT1,
                 EXCIT=(_F(CHARGE = CHAR_U1, FONC_MULT = COEF1),
                        _F(CHARGE = CHAR_U2, FONC_MULT = COEF1),
                        _F(CHARGE = CHAR_U3, FONC_MULT = COEF3),
                        _F(CHARGE = DEPL_1)),
                 ETAT_INIT=_F(EVOL_NOLI=U1,
                              INST     =inst_init_1,
                              PRECISION=1.E-6),
                 COMP_INCR=_F(RELATION      = 'KIT_HM',
                              RELATION_KIT  = ('HUJEUX',
                                               'LIQU_SATU','HYDR_UTIL'),
                              RESI_INTE_RELA= 1.E-6,
                              ITER_INTE_PAS = -10),
                 NEWTON=_F(MATRICE   = 'TANGENTE',
                           REAC_ITER = 1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-6,
                                ITER_GLOB_MAXI = 20,),
                 ARCHIVAGE=_F(LIST_INST    = TEMPS1,),
                 INCREMENT=_F(LIST_INST    = TEMPS1,
                              SUBD_METHODE = 'UNIFORME',
                              SUBD_PAS     = 10,
                              SUBD_NIVEAU  = 10,
                              INST_INIT    = inst_init_1,
                              INST_FIN     = inst_fin_1),
                 RECH_LINEAIRE=_F(ITER_LINE_MAXI = 3),);
                 

#-------------------------
#    TEST_RESU AU POINT C
#-------------------------
U2=CALC_ELEM(reuse      = U2, 
             MODELE     = MODELE,
             CHAM_MATER = CHMAT1,
             OPTION     = ('SIEF_ELNO_ELGA','EPSI_ELNO_DEPL','VARI_ELNO_ELGA'),
             RESULTAT   = U2);

U2=CALC_NO(reuse      = U2,
           CHAM_MATER = CHMAT1,
           OPTION     = ('SIEF_NOEU_ELGA','EPSI_NOEU_DEPL','VARI_NOEU_ELGA'),
           RESULTAT   = U2);
           
TAB_SIG2=POST_RELEVE_T(ACTION=_F(INTITULE = 'SIEF_NOEU_ELGA',
                                 GROUP_NO = 'C',
                                 RESULTAT = U2,
                                 NOM_CHAM = 'SIEF_NOEU_ELGA',
                                 TOUT_CMP = 'OUI',
                                 OPERATION= 'EXTRACTION'));
                     
SIGMA_N = FORMULE(NOM_PARA=('SIXX','SIZZ'), VALE='0.5*(SIXX+SIZZ)');
SIGMA_D = FORMULE(NOM_PARA=('SIXX','SIZZ'), VALE='0.5*(SIXX-SIZZ)');

TAB_EPS2=POST_RELEVE_T(ACTION=_F(INTITULE = 'EPSI_NOEU_DEPL',
                                 GROUP_NO = 'C',
                                 RESULTAT = U2,
                                 NOM_CHAM = 'EPSI_NOEU_DEPL',
                                 TOUT_CMP = 'OUI',
                                 OPERATION= 'EXTRACTION'));

TAB_SIG2=CALC_TABLE(reuse=TAB_SIG2,
                    TABLE=TAB_SIG2,
                    ACTION=(_F(OPERATION='OPER',
                               FORMULE  =SIGMA_N,
                               NOM_PARA ='SIGMA_N',),
                            _F(OPERATION='OPER',
                               FORMULE  =SIGMA_D,
                               NOM_PARA ='SIGMA_D',),),);

TAB_VAR2=POST_RELEVE_T(ACTION=_F(INTITULE = 'VARI_NOEU_ELGA',
                                 GROUP_NO = 'C',
                                 RESULTAT = U2,
                                 NOM_CHAM = 'VARI_NOEU_ELGA',
                                 NOM_CMP  = ('V1','V2','V3','V4','V5','V6',
                                            'V7','V8','V23'),
                                 OPERATION= 'EXTRACTION'));

IMPR_TABLE(TABLE=TAB_SIG2);
IMPR_TABLE(TABLE=TAB_EPS2);
IMPR_TABLE(TABLE=TAB_VAR2);

# TEST DU DEVIATEUR DES CONTRAINTES PAR RAPPORT
# A UN CALCUL LAWYER (GEFDYN)
TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_D',
           VALE     =1590.,
           PRECISION=0.1,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =56.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_D',
           VALE     =7445.,
           PRECISION=0.02,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =60.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_D',
           VALE     =2910.,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =63.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_D',
           VALE     =-75.,
           PRECISION=100.,
           CRITERE  ='ABSOLU',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =65.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);


# TEST DE LA CONTRAINTE ISOTROPE PAR RAPPORT
# A UN CALCUL LAWYER (GEFDYN)
TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_N',
           VALE     =-7420.,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =56.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_N',
           VALE     =-11255.,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =60.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_N',
           VALE     =-7970.,
           PRECISION=0.1,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =63.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_SIG2,
           NOM_PARA ='SIGMA_N',
           VALE     =-3953.,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =65.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);
                     
                     
# TEST DU RAYON DEVIATOIRE CYCLIQUE PAR RAPPORT
# A UN CALCUL LAWYER (GEFDYN)
TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V5',
           VALE     =0.346,
           PRECISION=0.1,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =56.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V5',
           VALE     =0.005,
           PRECISION=0.01,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =60.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V5',
           VALE     =0.137,
           PRECISION=0.1,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =63.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V5',
           VALE     =0.302,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =65.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);


# TEST DE LA DEFORMATION PLASTIQUE VOLUMIQUE PAR RAPPORT
# A UN CALCUL LAWYER (GEFDYN)
TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V23',
           VALE     =-2.11E-04,
           PRECISION=0.15,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =56.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V23',
           VALE     =-2.05E-04,
           PRECISION=0.01,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =60.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V23',
           VALE     =-2.19E-04,
           PRECISION=0.05,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =63.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);

TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V23',
           VALE     =-2.52E-04,
           PRECISION=0.1,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =65.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);
                     
TEST_TABLE(TABLE    =TAB_VAR2,
           NOM_PARA ='V23',
           VALE     =-2.92E-04,
           PRECISION=0.2,
           CRITERE  ='RELATIF',
           REFERENCE='SOURCE_EXTERNE',
           FILTRE=_F(NOM_PARA ='INST',
                     VALE     =67.,
                     PRECISION=.01,
                     CRITERE  ='ABSOLU',),);
                     
FIN();
