# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#


DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='OUI'))

TCARS =MACR_CARA_POUTRE(GROUP_MA_BORD='LCERC', NOEUD='N1',)
IMPR_TABLE( TABLE=TCARS )

# ON CREE TCARS2 POUR TESTER LA LECTURE DE LA TABLE PAR AFFE_CARA_ELEM
# QUAND ON A TABLE_CARA='OUI'
TCARS2=MACR_CARA_POUTRE(GROUP_MA_BORD='LCERC', NOEUD='N1',TABLE_CARA='OUI',NOM='BIDUL')
IMPR_TABLE( TABLE=TCARS2 )
#
# --- VALEURS DE REFERENCE: OPERATEUR AFFE_CARA_ELEM
#
TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=5.0000000000000001E-3,
           VALE_CALC=1.9634950285986E-03,
           VALE_REFE=1.963495E-3,
           NOM_PARA='A',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=3.8336453439381E-19,
           VALE_REFE=0.0,
           NOM_PARA='CDG_Y',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=3.5724519249006E-19,
           VALE_REFE=0.0,
           NOM_PARA='CDG_Z',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=8.9999999999999993E-3,
           VALE_CALC=3.067960388736E-07,
           VALE_REFE=3.0679610000000001E-07,
           NOM_PARA='IY_G',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=8.9999999999999993E-3,
           VALE_CALC=3.067960388736E-07,
           VALE_REFE=3.0679610000000001E-07,
           NOM_PARA='IZ_G',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=2.866358537081E-22,
           VALE_REFE=0.0,
           NOM_PARA='IYZ_G',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=8.9999999999999993E-3,
           VALE_CALC=3.067960388736E-07,
           VALE_REFE=3.0679610000000001E-07,
           NOM_PARA='IY',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=8.9999999999999993E-3,
           VALE_CALC= 3.06796039E-07,
           VALE_REFE=3.0679610000000001E-07,
           NOM_PARA='IZ',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=-0.025000000000000,
           VALE_REFE=-0.025000000000000001,
           NOM_PARA='Y_MIN',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.025000000000000,
           VALE_REFE=0.025000000000000001,
           NOM_PARA='Y_MAX',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=-0.025000000000000,
           VALE_REFE=-0.025000000000000001,
           NOM_PARA='Z_MIN',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.025000000000000,
           VALE_REFE=0.025000000000000001,
           NOM_PARA='Z_MAX',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=8.9999999999999993E-3,
           VALE_CALC=6.1359094571794E-07,
           VALE_REFE=6.1358999999999998E-07,
           NOM_PARA='JX',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.1666649693004,
           VALE_REFE=1.1666666999999999,
           NOM_PARA='AY',
           TABLE=TCARS,
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.16666497545,
           VALE_REFE=1.1666666999999999,
           NOM_PARA='AZ',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=-1.284903358326E-18,
           VALE_REFE=0.0,
           NOM_PARA='EY',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=6.6219916930121E-19,
           VALE_REFE=0.0,
           NOM_PARA='EZ',
           TABLE=TCARS,
           )

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='ANALYTIQUE',
           VALE_CALC=8.7291661146501E-41,
           VALE_REFE=0.0,
           NOM_PARA='JG',
           TABLE=TCARS,
           )

# TEST DE L'ENCHAINEMENT AVEC UN CALCUL POUTRE
#

#
#     Affectation du reel contenu dans la table TCARS
#     (ligne 'DX', colonne 1) dans la variable python pop
#

#rext=TCARS['Y_MAX',2]

rext=2.5E-2

MA=LIRE_MAILLAGE(UNITE=21);

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='POU_D_E',),);

E=2.E11;

MATR=DEFI_MATERIAU(ELAS=_F(E=E,
                           NU=0.3,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=_F(TOUT='OUI',
                            MATER=MATR,),);

CAREL=AFFE_CARA_ELEM(MODELE=MO,
                     INFO=2,
                     POUTRE=_F(GROUP_MA='G4',
                               #SECTION='CERCLE',
                               #CARA=('R'),
                            ##   VALE=(0.025)
                               #VALE=rext,
                                SECTION='GENERALE',
                                TABLE_CARA=TCARS,
                                NOM_SEC='.9000000')
                               ,)
CAREL2=AFFE_CARA_ELEM(MODELE=MO,
                     INFO=2,
                     POUTRE=_F(GROUP_MA='G4',
                               #SECTION='CERCLE',
                               #CARA=('R'),
                            ##   VALE=(0.025)
                               #VALE=rext,
                                SECTION='GENERALE',
                                TABLE_CARA=TCARS2,
                                NOM_SEC='BIDUL')
                               ,)

FTOT=1000. ;

CHARG5=AFFE_CHAR_MECA(MODELE=MO,
                      DDL_IMPO=_F(GROUP_NO='A',
                                  DX=0.0,
                                  DY=0.0,
                                  DZ=0.0,
                                  DRX=0.0,
                                  DRY=0.0,
                                  DRZ=0.0,),
                      FORCE_NODALE=_F(GROUP_NO='B',
                                      FX=FTOT,),);

MEST5=MECA_STATIQUE(MODELE=MO,
                    CHAM_MATER=CHMAT,
                    CARA_ELEM=CAREL,
                    EXCIT=_F(CHARGE=CHARG5,),
                    );

MEST5=CALC_CHAMP(reuse =MEST5,
              RESULTAT=MEST5,
              FORCE='FORC_NODA',);

MEST6=MECA_STATIQUE(MODELE=MO,
                    CHAM_MATER=CHMAT,
                    CARA_ELEM=CAREL2,
                    EXCIT=_F(CHARGE=CHARG5,),
                    );

MEST6=CALC_CHAMP(reuse =MEST6,
              RESULTAT=MEST6,
              FORCE='FORC_NODA',);


# VALEUR DE REFERENCE

R = 0.025;

UX = FTOT/E/pi/R/R

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   GROUP_NO='B',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MEST5,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DX',
                   VALE_CALC=2.5464795821606E-06,
                   VALE_REFE=2.5464790894703252E-06,),
                _F(NUME_ORDRE=1,
                   GROUP_NO='B',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MEST5,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DX',
                   VALE_CALC=1000.0,
                   VALE_REFE=1000.0,),
                _F(NUME_ORDRE=1,
                   GROUP_NO='B',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MEST6,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DX',
                   VALE_CALC=2.5464795821606E-06,
                   VALE_REFE=2.5464790894703252E-06,),
                _F(NUME_ORDRE=1,
                   GROUP_NO='B',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MEST6,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DX',
                   VALE_CALC=1000.0,
                   VALE_REFE=1000.0,),
                ),
          )

FIN()
