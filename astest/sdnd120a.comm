# TITRE LACHER D'UNE MASSE AVEC DISPOSITIF ANTI SISMIQUE
# ======================================================================
# COPYRIGHT (C) 1991 - 2015  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# CAS_TEST__:SDND120A
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

#
MAILLAG0=LIRE_MAILLAGE( )

MAILLAG0=DEFI_GROUP(reuse=MAILLAG0,
                    MAILLAGE=MAILLAG0,
                    CREA_GROUP_NO=_F( NOM='GROUP_NO_GN2',
                                      NOEUD=('NO2',),),)

MAILLAG0=DEFI_GROUP(reuse=MAILLAG0,
                    MAILLAGE=MAILLAG0,
                    CREA_GROUP_NO=_F( NOM='GROUP_NO_GN12',
                                      NOEUD=('NO12',),),)

#
MAILLAGE=CREA_MAILLAGE(MAILLAGE=MAILLAG0,
    CREA_POI1=(
        _F(NOM_GROUP_MA='GROUP_NO_MASSES1', GROUP_NO = 'GROUP_NO_MASSES1', ),
        _F(NOM_GROUP_MA='GROUP_NO_MASSES2', GROUP_NO = 'GROUP_NO_MASSES2', ),
    ),
)

MODELE=AFFE_MODELE(  MAILLAGE=MAILLAGE,AFFE=(
              _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_T',
                     GROUP_MA = 'GROUP_MA_RESSORTS'),
                   _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_T',
                     GROUP_MA = ( 'GROUP_NO_MASSES1', 'GROUP_NO_MASSES2',)))
                    )

#
M=25.

K=1.E+10

CARA_ELE=AFFE_CARA_ELEM(  MODELE=MODELE,DISCRET=(
      _F( GROUP_MA = 'GROUP_MA_RESSORTS',  CARA = 'K_T_D_L',  VALE = (K, K, K,)),
      _F(  CARA = 'M_T_L',  GROUP_MA = 'GROUP_MA_RESSORTS',
                     VALE = (0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,
                        0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,0.,)),
      _F( GROUP_MA = 'GROUP_NO_MASSES1',  CARA = 'M_T_D_N',  VALE = M),
      _F( GROUP_MA = 'GROUP_NO_MASSES2',  CARA = 'M_T_D_N',  VALE = M))
                         )

#
CON_LIM=AFFE_CHAR_MECA(  MODELE=MODELE,DDL_IMPO=(
              _F(  GROUP_NO = 'GROUP_NO_ENCBICHO',    DX = 0.,  DY = 0.,  DZ = 0.),
              _F(  GROUP_NO = ( 'GROUP_NO_MASSES1', 'GROUP_NO_MASSES2',), DY = 0.,  DZ = 0.))
                       )

#
ASSEMBLAGE(  MODELE=MODELE,  CHARGE=(CON_LIM, ),
                  CARA_ELEM=CARA_ELE,
                   NUME_DDL=CO("NUMEDDL"),MATR_ASSE=(
                 _F(  MATRICE = CO("RIGIDITE"),  OPTION = 'RIGI_MECA'),
                           _F(  MATRICE = CO("MASSE"),  OPTION = 'MASS_MECA'))
               )

#
MODE_MEC=CALC_MODES(MATR_RIGI=RIGIDITE,
                    OPTION='BANDE',
                    CALC_FREQ=_F(FREQ=(3000.,3500.,),
                                 ),
                    MATR_MASS=MASSE,
                    )

#
# CALCUL DES MODES STATIQUES AUX POINTS D'ANCRAGE:
#-------------------------------------------------
MODE_STA=MODE_STATIQUE(  MATR_RIGI=RIGIDITE,   MATR_MASS=MASSE,
                           INFO=1,
                          MODE_STAT=_F(  TOUT = 'OUI', AVEC_CMP = 'DX') )

L_INST=DEFI_LIST_REEL(  DEBUT=0.,
                        INTERVALLE=_F(  JUSQU_A = 2., PAS = 0.0001) )

#
# DESCRIPTION DES ACCELEROGRAMMES:
#---------------------------------
OMEGAA=2.*pi*1.

ACCE1 = FORMULE(NOM_PARA='INST',VALE='-0.66*sin(OMEGAA*INST) ')
ACCELER1=CALC_FONC_INTERP( FONCTION=ACCE1, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                               PROL_DROITE='LINEAIRE',
                              PROL_GAUCHE='LINEAIRE',
                               NOM_RESU='ACCE',
                             INFO=1)

#
# INTEGRATION DES ACCELEROGRAMMES:
#---------------------------------

VITE1 = FORMULE(NOM_PARA='INST',VALE='0.66*cos(OMEGAA*INST)/OMEGAA ')
VITESSE1=CALC_FONC_INTERP( FONCTION=VITE1, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                       PROL_DROITE='LINEAIRE',
                      PROL_GAUCHE='LINEAIRE',
                      NOM_RESU='VITE',
                     INFO=1)

DEPL1 = FORMULE(NOM_PARA='INST',VALE='0.66*sin(OMEGAA*INST)/(OMEGAA**2)')
DEPLACE1=CALC_FONC_INTERP( FONCTION=DEPL1, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                       PROL_DROITE='LINEAIRE',
                      PROL_GAUCHE='LINEAIRE',
                      NOM_RESU='DEPL',
                     INFO=1)

ACCE2 = FORMULE(NOM_PARA='INST',VALE='0.*INST ')
ACCELER2=CALC_FONC_INTERP( FONCTION=ACCE2, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                       PROL_DROITE='LINEAIRE',
                      PROL_GAUCHE='LINEAIRE',
                      NOM_RESU='ACCE',
                     INFO=1)

#
VITE2 = FORMULE(NOM_PARA='INST',VALE='0.*INST ')
VITESSE2=CALC_FONC_INTERP( FONCTION=VITE2, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                       PROL_DROITE='LINEAIRE',
                      PROL_GAUCHE='LINEAIRE',
                      NOM_RESU='VITE',
                     INFO=1)

DEPL2 = FORMULE(NOM_PARA='INST',VALE='0.*INST ')
DEPLACE2=CALC_FONC_INTERP( FONCTION=DEPL2, LIST_PARA=L_INST,
NOM_PARA = 'INST',
                       PROL_DROITE='LINEAIRE',
                      PROL_GAUCHE='LINEAIRE',
                      NOM_RESU='DEPL',
                     INFO=1)

#
MULT_X1=CALC_CHAR_SEISME(  MATR_MASS=MASSE,   DIRECTION=( 1., 0., 0.,),
                             MODE_STAT=MODE_STA,    NOEUD='NO1' )

MULT_X2=CALC_CHAR_SEISME(  MATR_MASS=MASSE,   DIRECTION=( 1., 0., 0.,),
                             MODE_STAT=MODE_STA,   NOEUD='NO11' )

#
# PROJECTION DES MATRICES MET K SUR LA BASE MODALE
#-------------------------------------------------
PROJ_BASE(BASE=MODE_MEC,
          STOCKAGE='DIAG',
          MATR_ASSE_GENE=(
          _F( MATRICE = CO("MASS_GEN"),  MATR_ASSE = MASSE),
          _F( MATRICE = CO("RIGI_GEN"),  MATR_ASSE = RIGIDITE)),VECT_ASSE_GENE=(
          _F( VECTEUR = CO("VECT_X1"),  VECT_ASSE = MULT_X1),
          _F( VECTEUR = CO("VECT_X2"),  VECT_ASSE = MULT_X2))
         )

#
# CALCUL TRANSITOIRE PAR SUPERPOSITION MODALE
# -------------------------------------------
TRAN_GE1=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                    MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                    SCHEMA_TEMPS=_F(SCHEMA='EULER',),
                    INCREMENT=_F( INST_INIT = 0.,  INST_FIN = 1.,  PAS = 1.25E-5),
                    MODE_STAT=MODE_STA,
                    EXCIT=(
                _F( VECT_ASSE_GENE = VECT_X1,
                       MULT_APPUI = 'OUI',
                       DIRECTION = ( 1., 0., 0.,), NOEUD = 'NO1',
###                       MODE_STAT=MODE_STA,
                       ACCE = ACCELER1,
                       VITE = VITESSE1,  DEPL = DEPLACE1),
                _F( VECT_ASSE_GENE = VECT_X2,  ACCE = ACCELER2,
                       MULT_APPUI = 'OUI',
###                       MODE_STAT=MODE_STA,
                       DIRECTION = ( 1., 0., 0.,), NOEUD = 'NO11',
                       VITE = VITESSE2,  DEPL = DEPLACE2)),
                    ARCHIVAGE=_F(  PAS_ARCH = 80),
                    ANTI_SISM=_F(  NOEUD_1 = 'NO2',
                            NOEUD_2 = 'NO12',
                            RIGI_K1 = 6.E+06,
                            RIGI_K2 = 0.53E+06,
                            SEUIL_FX = 1200.,
                            C = 0.07E+05,
                            PUIS_ALPHA = 0.2,
                            DX_MAX = 0.03),
                    INFO=2
                          )

TRAN_GE2=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                    MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                    SCHEMA_TEMPS=_F(SCHEMA='EULER',),
                    INCREMENT=_F( INST_INIT = 0.,  INST_FIN = 1.,  PAS = 1.25E-5),
                    MODE_STAT=MODE_STA,
                    EXCIT=(
                _F( VECT_ASSE_GENE = VECT_X1,
                       MULT_APPUI = 'OUI',
                       DIRECTION = ( 1., 0., 0.,), NOEUD = 'NO1',
###                       MODE_STAT=MODE_STA,
                       ACCE = ACCELER1,
                       VITE = VITESSE1,  DEPL = DEPLACE1),
                _F( VECT_ASSE_GENE = VECT_X2,  ACCE = ACCELER2,
                       MULT_APPUI = 'OUI',
###                       MODE_STAT=MODE_STA,
                       DIRECTION = ( 1., 0., 0.,), NOEUD = 'NO11',
                       VITE = VITESSE2,  DEPL = DEPLACE2)),
                    ARCHIVAGE=_F(  PAS_ARCH = 80),
                    ANTI_SISM=_F(  GROUP_NO_1 = 'GROUP_NO_GN2',
                            GROUP_NO_2 = 'GROUP_NO_GN12',
                            RIGI_K1 = 6.E+06,
                            RIGI_K2 = 0.53E+06,
                            SEUIL_FX = 1200.,
                            C = 0.07E+05,
                            PUIS_ALPHA = 0.2,
                            DX_MAX = 0.03),
                    INFO=2
                          )


#
LISTIMP=DEFI_LIST_REEL(  DEBUT=0.,
                INTERVALLE=_F(  JUSQU_A = 0.998, PAS = 2.E-3))

# RECUPERATION DES DEPL ABSOLUS CALCULES
#----------------------------------------
N2_DXA1=RECU_FONCTION(  NOEUD='NO2',  NOM_CMP='DX',  NOM_CHAM='DEPL',
                            RESU_GENE=TRAN_GE1,    INFO=2,
                          MULT_APPUI='OUI',      INTERP_NUME='LIN',
                           LIST_INST=LISTIMP,   INTERPOL='LIN',
                            TITRE='ACCELERATION ABSOLUE AU NOEUD NO2'
                        )

MAX_N2A1=INFO_FONCTION( MAX=_F( FONCTION = N2_DXA1))

RMS_N2A1=INFO_FONCTION(RMS=_F(  FONCTION = N2_DXA1,
                               METHODE = 'TRAPEZE',
                               CRITERE = 'ABSOLU',
                                PRECISION = 1.E-6)
                         )

N2_DXA2=RECU_FONCTION(  NOEUD='NO2',  NOM_CMP='DX',  NOM_CHAM='DEPL',
                            RESU_GENE=TRAN_GE2,    INFO=2,
                          MULT_APPUI='OUI',      INTERP_NUME='LIN',
                           LIST_INST=LISTIMP,   INTERPOL='LIN',
                            TITRE='ACCELERATION ABSOLUE AU NOEUD NO2'
                        )

MAX_N2A2=INFO_FONCTION( MAX=_F( FONCTION = N2_DXA2))

TEST_TABLE(PRECISION=1.E-2,
           VALE_CALC=0.016716896,
           VALE_REFE=0.0167,
           REFERENCE='NON_DEFINI',
           NOM_PARA='DEPL',
           TABLE=MAX_N2A1,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='N2_DXA1',),
                   _F(NOM_PARA='INST',
                      VALE=0.25,),
                   _F(NOM_PARA='TYPE',
                      VALE_K='MAXI',),
                   ),
           )

TEST_TABLE(PRECISION=1.E-2,
           VALE_CALC=0.016716896,
           VALE_REFE=0.0167,
           REFERENCE='NON_DEFINI',
           NOM_PARA='DEPL',
           TABLE=MAX_N2A2,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='N2_DXA2',),
                   _F(NOM_PARA='INST',
                      VALE=0.25,),
                   _F(NOM_PARA='TYPE',
                      VALE_K='MAXI',),
                   ),
           )

TEST_TABLE(PRECISION=1.E-2,
           VALE_CALC=0.011832520,
           VALE_REFE=0.0118,
           REFERENCE='NON_DEFINI',
           NOM_PARA='RMS',
           TABLE=RMS_N2A1,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='N2_DXA1',),
                   _F(NOM_PARA='METHODE',
                      VALE_K='TRAPEZE',),
                   ),
           )

#
#RECUPERATION DES DEPL RELATIFS CALCULES
#----------------------------------------
NO2_DX_R=RECU_FONCTION(  NOEUD='NO2',  NOM_CMP='DX',  NOM_CHAM='DEPL',
                            RESU_GENE=TRAN_GE1,    INFO=2,
                          INTERP_NUME='LIN',
                           LIST_INST=LISTIMP,   INTERPOL='LIN' )

MAX_NO2R=INFO_FONCTION( MAX=_F( FONCTION = NO2_DX_R))

RMS_NO2R=INFO_FONCTION(RMS=_F(  FONCTION = NO2_DX_R,
                               METHODE = 'TRAPEZE',
                               CRITERE = 'ABSOLU',
                                PRECISION = 1.E-6)
                         )

TEST_TABLE(PRECISION=0.012999999999999999,
           VALE_CALC= 1.26436566E-06,
           VALE_REFE=1.266E-06,
           REFERENCE='NON_DEFINI',
           NOM_PARA='DEPL',
           TABLE=MAX_NO2R,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='NO2_DX_R',),
                   _F(NOM_PARA='INST',
                      VALE=0.70999999999999996,),
                   _F(NOM_PARA='TYPE',
                      VALE_K='MAXI',),
                   ),
           )

TEST_TABLE(PRECISION=0.012999999999999999,
           VALE_CALC= 7.89408806E-07,
           VALE_REFE=7.7975000000000003E-07,
           REFERENCE='NON_DEFINI',
           NOM_PARA='RMS',
           TABLE=RMS_NO2R,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='NO2_DX_R',),
                   _F(NOM_PARA='METHODE',
                      VALE_K='TRAPEZE',),
                   ),
           )

#
FCHOC=RECU_FONCTION(   RESU_GENE=TRAN_GE1,
                        NOEUD_CHOC='NO2',    INFO=2,
                       PARA_X='INST',  PARA_Y='FN' )

MAXFCHOC=INFO_FONCTION( MAX=_F( FONCTION = FCHOC) )

RMSFCHOC=INFO_FONCTION(RMS=_F(  FONCTION = FCHOC,
                               METHODE = 'TRAPEZE',
                               CRITERE = 'ABSOLU',
                                PRECISION = 1.E-6)
                         )

TEST_TABLE(PRECISION=1.E-2,
           VALE_CALC= 7.89397060E+03,
           VALE_REFE=7912.3000000000002,
           REFERENCE='NON_DEFINI',
           NOM_PARA='RMS',
           TABLE=RMSFCHOC,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='FCHOC',),
                   _F(NOM_PARA='METHODE',
                      VALE_K='TRAPEZE',),
                   ),
           )

TEST_TABLE(PRECISION=1.E-2,
           VALE_CALC= 1.26596358E+04,
           VALE_REFE=1.2660E4,
           REFERENCE='NON_DEFINI',
           NOM_PARA='FN',
           TABLE=MAXFCHOC,
           FILTRE=(_F(NOM_PARA='FONCTION',
                      VALE_K='FCHOC',),
                   _F(NOM_PARA='INST',
                      VALE=0.20999999999999999,),
                   _F(NOM_PARA='TYPE',
                      VALE_K='MAXI',),
                   ),
           )

FIN()
#
