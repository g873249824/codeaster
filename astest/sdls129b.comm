# TITRE CALCUL MODAL D'UNE ETOILE A 3 BRANCHES
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# CAS_TEST__: SDLS129B
#             VERIFICATION DE REST_SOUS_STRUCT AVEC
#             MODE_GENE COMPLEXE
# FICHIER DE COMMANDE ASTER
#
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'));

MA_BRAS=LIRE_MAILLAGE(UNITE=20,
                      FORMAT='MED',);

  
MA_CENTR=LIRE_MAILLAGE(UNITE=22,
                       FORMAT='MED',);


MO_BRAS=AFFE_MODELE(MAILLAGE=MA_BRAS,
                    AFFE=_F(GROUP_MA='bras',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='DKT',),);

MO_CENTR=AFFE_MODELE(MAILLAGE=MA_CENTR,
                     AFFE=_F(GROUP_MA='centre',
                             PHENOMENE='MECANIQUE',
                             MODELISATION='DKT',),);

                             
ACIER=DEFI_MATERIAU(ELAS=_F(E=2.1e11,
                            NU=0.3,
                            RHO=7800.,),);

CH_BRAS=AFFE_MATERIAU(MODELE=MO_BRAS,
                      MAILLAGE=MA_BRAS,
                      AFFE=_F(GROUP_MA='bras',
                              MATER=ACIER,),);

CH_CENTR=AFFE_MATERIAU(MODELE=MO_CENTR,
                       MAILLAGE=MA_CENTR,
                       AFFE=_F(GROUP_MA='centre',
                               MATER=ACIER,),);

CA_BRAS=AFFE_CARA_ELEM(MODELE=MO_BRAS,
                       COQUE=_F(GROUP_MA='bras',
                                EPAIS=0.005,),);

CA_CENTR=AFFE_CARA_ELEM(MODELE=MO_CENTR,
                        COQUE=_F(GROUP_MA='centre',
                                 EPAIS=0.005,),);

CL_BRAS=AFFE_CHAR_MECA(MODELE=MO_BRAS,
                       DDL_IMPO=(_F(GROUP_NO=('intf',),
                                    DX=0.,
                                    DY=0.,
                                    DZ=0.,
                                    DRX=0.,
                                    DRY=0.,
                                    DRZ=0.,
                                   ),
                                 _F(GROUP_NO=('CL',),
                                    DX=0.,
                                    DY=0.,
                                    DZ=0.,
                                    DRX=0.,
                                    DRY=0.,
                                    DRZ=0.,),  
                                   ),);

CL_CENTR=AFFE_CHAR_MECA(MODELE=MO_CENTR,
                        DDL_IMPO=_F(GROUP_NO=('intf_px','intf_py','intf_my',),
                                    DX=0.,
                                    DY=0.,
                                    DZ=0.,
                                    DRX=0.,
                                    DRY=0.,
                                    DRZ=0.,
                                    ),);

BRAS=CREA_ELEM_SSD(MODELE=MO_BRAS,
                   CHAM_MATER=CH_BRAS,
                   CARA_ELEM=CA_BRAS,
                   NUME_DDL=CO('NU_BRAS'),
                   CHARGE=CL_BRAS,
                   INTERFACE=_F(NOM='INT_BR',
                                TYPE='CRAIGB',
                                GROUP_NO='intf',),
                   CALC_FREQ=_F(NMAX_FREQ=10,
                                  APPROCHE='REEL',
                                  STOP_ERREUR='OUI',
                                  OPTION='PLUS_PETITE',),             
                   BASE_MODALE=_F(TYPE='CLASSIQUE',),
                   );

CENTRE=CREA_ELEM_SSD(MODELE=MO_CENTR,
                     CHAM_MATER=CH_CENTR,
                     CARA_ELEM=CA_CENTR,
                     NUME_DDL=CO('NU_CENTR'),
                     CHARGE=CL_CENTR,
                     INTERFACE=(_F(NOM='INT_PX',
                                   TYPE='CRAIGB',
                                   GROUP_NO='intf_px',),
                                _F(NOM='INT_PY',
                                   TYPE='CRAIGB',
                                   GROUP_NO='intf_py',),
                                _F(NOM='INT_MY',
                                   TYPE='CRAIGB',
                                   GROUP_NO='intf_my',),),
                     CALC_FREQ=_F(NMAX_FREQ=12,
                                  APPROCHE='REEL',
                                  STOP_ERREUR='OUI',
                                  OPTION='PLUS_PETITE',),
                     BASE_MODALE=_F(TYPE='CLASSIQUE',),
                     );

ASSE_ELEM_SSD(RESU_ASSE_SSD=_F(MODELE=CO('MODGEN'),
                               NUME_DDL_GENE=CO('NUMGEN'),
                               RIGI_GENE=CO('KGEN'),
                               MASS_GENE=CO('MGEN'),),
              SOUS_STRUC=(_F(NOM='CENTRE',
                             MACR_ELEM_DYNA=CENTRE,
                             ANGL_NAUT=(0.,0.,0.,),
                             TRANS=(0.,0.,0.,),),
                          _F(NOM='BR_PX',
                             MACR_ELEM_DYNA=BRAS,
                             ANGL_NAUT=(0.,0.,90.,),
                             TRANS=(0.,0.,0.,),),
                          _F(NOM='BR_PY',
                             MACR_ELEM_DYNA=BRAS,
                             ANGL_NAUT=(120.,0.,90.,),
                             TRANS=(0.,0.,0.,),),
                          _F(NOM='BR_MY',
                             MACR_ELEM_DYNA=BRAS,
                             ANGL_NAUT=(-120.,0.,90.,),
                             TRANS=(0.,0.,0.,),),),
              LIAISON=(_F(SOUS_STRUC_1='CENTRE',
                          INTERFACE_1='INT_PY',
                          SOUS_STRUC_2='BR_PY',
                          INTERFACE_2='INT_BR',
                          ),
                       _F(SOUS_STRUC_1='CENTRE',
                          INTERFACE_1='INT_PX',
                          SOUS_STRUC_2='BR_PX',
                          INTERFACE_2='INT_BR',
                          ),
                       _F(SOUS_STRUC_1='CENTRE',
                          INTERFACE_1='INT_MY',
                          SOUS_STRUC_2='BR_MY',
                          INTERFACE_2='INT_BR',
                          ),),
             METHODE='CLASSIQUE',
             STOCKAGE='PLEIN',
             VERIF=_F(STOP_ERREUR='NON',
                       PRECISION=1e-3,
                       CRITERE='ABSOLU',),
                       );


SQUEL=DEFI_SQUELETTE(MODELE_GENE=MODGEN,
                     SOUS_STRUC=(_F(NOM='CENTRE',
                                    GROUP_MA='centre',),
                                 _F(NOM='BR_PX',
                                    GROUP_MA='bras',),
                                 _F(NOM='BR_PY',
                                    GROUP_MA='bras',),
                                 _F(NOM='BR_MY',
                                    GROUP_MA='bras',),),);


pi=3.1415927
ksi1=0.15
om1=2*pi*10.
ksi2=0.15
om2=2*pi*50.
alpha=2*(ksi1*om1-ksi2*om2)/(om1**2-om2**2)
beta=2*ksi1*om1-alpha*om1**2

CGEN=COMB_MATR_ASSE(COMB_R=(_F(MATR_ASSE=MGEN,COEF_R=beta),_F(MATR_ASSE=KGEN,COEF_R=alpha),))

MOGS=CALC_MODES(MATR_RIGI=KGEN,
                MATR_MASS=MGEN,
                MATR_AMOR=CGEN,
                OPTION='CENTRE',
                CALC_FREQ=_F(NMAX_FREQ=10,FREQ=15.),
                SOLVEUR=_F(METHODE='MUMPS',
                           NPREC=-1,),
                VERI_MODE=_F(STOP_ERREUR='OUI',
                                   STURM='NON',
                                   SEUIL=1.E-04,),
                INFO=1,);
                      

MOGECOMP=REST_SOUS_STRUC(RESU_GENE=MOGS,
                         SQUELETTE=SQUEL);


TAB_RE1=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO56'),
                  FORMAT_C='REEL',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)
TAB_RE2=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO141'),
                  FORMAT_C='REEL',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)
TAB_RE3=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO244'),
                  FORMAT_C='REEL',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)                                    
                  
TAB_IM1=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO56'),
                  FORMAT_C='IMAG',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)
TAB_IM2=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO141'),
                  FORMAT_C='IMAG',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)
TAB_IM3=POST_RELEVE_T(ACTION=_F(
                  INTITULE='PARTIE_RE',
                  OPERATION='EXTRACTION',
                  NOEUD=('NO244'),
                  FORMAT_C='IMAG',
                  RESULTAT=MOGECOMP,
                  NOM_CHAM='DEPL',
                  TOUT_ORDRE='OUI',
                  TOUT_CMP='OUI',),)          

extrZ=FORMULE(NOM_PARA=('DZ'),VALE='DZ',)

TAB_RE1=CALC_TABLE(reuse=TAB_RE1,
                  TABLE=TAB_RE1,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N1ZR',
                             FORMULE=extrZ,),),
                             )
TAB_RE2=CALC_TABLE(reuse=TAB_RE2,
                  TABLE=TAB_RE2,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N2ZR',
                             FORMULE=extrZ,),),
                             )
TAB_RE3=CALC_TABLE(reuse=TAB_RE3,
                  TABLE=TAB_RE3,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N3ZR',
                             FORMULE=extrZ,),),
                             )

TAB_IM1=CALC_TABLE(reuse=TAB_IM1,
                  TABLE=TAB_IM1,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N1ZI',
                             FORMULE=extrZ,),),
                             )
TAB_IM2=CALC_TABLE(reuse=TAB_IM2,
                  TABLE=TAB_IM2,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N2ZI',
                             FORMULE=extrZ,),),
                             )
TAB_IM3=CALC_TABLE(reuse=TAB_IM3,
                  TABLE=TAB_IM3,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='N3ZI',
                             FORMULE=extrZ,),),
                             )
TAB_TOT=CALC_TABLE(TABLE=TAB_RE1,
                   ACTION=(_F(OPERATION='COMB',
                              NOM_PARA='NUME_ORDRE',
                             TABLE=TAB_RE2,),
                           _F(OPERATION='COMB',
                             NOM_PARA='NUME_ORDRE',
                             TABLE=TAB_RE3,),
                           _F(OPERATION='COMB',
                             NOM_PARA='NUME_ORDRE',
                             TABLE=TAB_IM1,),
                           _F(OPERATION='COMB',
                             NOM_PARA='NUME_ORDRE',
                             TABLE=TAB_IM2,),      
                           _F(OPERATION='COMB',
                             NOM_PARA='NUME_ORDRE',
                             TABLE=TAB_IM3,),),)
                  
reln1=FORMULE(NOM_PARA=('N1ZR','N1ZI'),
                VALE='N1ZI/N1ZR',)
reln2=FORMULE(NOM_PARA=('N2ZR','N2ZI'),
                VALE='N2ZI/N2ZR',)
reln3=FORMULE(NOM_PARA=('N3ZR','N3ZI'),
                VALE='N3ZI/N3ZR',)

TAB_REL=CALC_TABLE(TABLE=TAB_TOT,
                  ACTION=(_F(OPERATION='OPER',
                             NOM_PARA='RELN1',
                             FORMULE=reln1,), 
                          _F(OPERATION='OPER',
                             NOM_PARA='RELN2',
                             FORMULE=reln2,), 
                          _F(OPERATION='OPER',
                             NOM_PARA='RELN3',
                             FORMULE=reln3,), 
                          ),)

TEST_TABLE(TABLE=TAB_REL,
           NOM_PARA='RELN1',
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,
                     ),
           VALE_CALC=5.20615470017E-08,
           CRITERE='ABSOLU',)
           
TEST_TABLE(TABLE=TAB_REL,
           NOM_PARA='RELN2',
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,
                     ),
           VALE_CALC=-1.76935137026E-08,
           CRITERE='ABSOLU',)

TEST_TABLE(TABLE=TAB_REL,
           NOM_PARA='RELN1',
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,
                     ),
           VALE_CALC=-6.32045219166E-08,
           CRITERE='ABSOLU',)

TEST_TABLE(TABLE=TAB_REL,
           NOM_PARA='RELN3',
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,
                     ),
           VALE_CALC=-7.86254989276E-09,
           CRITERE='ABSOLU',)                                                      
          
FIN();

