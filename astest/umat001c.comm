# MODIF  DATE 14/05/2013   AUTEUR COURTOIS M.COURTOIS 
# TITRE TEST UMAT VARIABLES DE COMMANDES
# umat001c.para = tps_job 60 mem_job 512Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# CYLINDRE CREUX THERMOELASTICITE LINEAIRE
# test identique a UMAT001A

# Juste pour les besoins du cas-test.
# Il est preferable d'utiliser :
#       as_run --make_shared -o libumat.so src.f
# avant de lancer l'etude.
import os
from asrun.toolbox import make_shared

os.rename("fort.22", "fort.22.f")
make_shared("libumat.so", "fort.22.f")


DEBUT(CODE=_F(NOM='UMAT001C',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))


L_INST =DEFI_LIST_REEL(  DEBUT=0.0,
                        INTERVALLE=(
                        _F( PAS = 0.002,       JUSQU_A = 0.02),
                        _F( PAS = 0.004,       JUSQU_A = 0.06),
                        _F( PAS = 0.01,        JUSQU_A = 0.24),
)
                      )
MA = LIRE_MAILLAGE(FORMAT='MED');

MA = DEFI_GROUP(reuse =MA,
                MAILLAGE=MA,
                CREA_GROUP_NO =(
                       _F(GROUP_MA = 'DAB',),
                       _F(GROUP_MA = 'DCD',),
                       _F(GROUP_MA = 'DBC',),
                       _F(GROUP_MA = 'DDA',),
                        )
                )



FONC1= FORMULE(NOM_PARA=('X','INST'),VALE='(X**2)*INST ')

TP1=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='NOEU_TEMP_F',
               MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'TEMP',
                               VALE_F = FONC1)   )


TEMPE=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_THER',    NOM_CHAM='TEMP',AFFE=(
                      _F(  CHAM_GD = TP1,   LIST_INST =L_INST),)  )


                      
#CALCUL MECANIQUE

MO = AFFE_MODELE( MAILLAGE =MA,
                  AFFE=_F(
                       TOUT ='OUI',
                       PHENOMENE = 'MECANIQUE',
                       MODELISATION = 'AXIS',)
                 )

BLOC = AFFE_CHAR_MECA (MODELE = MO,
                       DDL_IMPO=_F(GROUP_NO =('DAB','DCD'),
                                   DY=0.)
                      )



# UMAT

E=1.
NU=0.3
ALP=0.7

LAMBDA=DEFI_CONSTANTE( VALE= E*NU/(1+NU)/(1-2.*NU) )
MU=DEFI_CONSTANTE( VALE= E/2/(1.0+NU) )
ZE=DEFI_CONSTANTE( VALE=0. )

YG=DEFI_CONSTANTE(VALE=E)
POISSON=DEFI_CONSTANTE(VALE=NU)
ALPHA=DEFI_CONSTANTE(VALE=ALP)

UMAT = DEFI_MATERIAU(
            ELAS_FO=_F( E = YG, NU = POISSON, ALPHA = ALPHA, B_ENDOGE=0.,K_DESSIC=0., TEMP_DEF_ALPHA=0.  ),
            UMAT_FO=_F( C1 = LAMBDA ,C2= MU , C3=ZE, C4= ZE, C5=ZE, C6=ALPHA, )
           )

# VARC/'CORR','IRRA','HYDR','SECH','NEUT1','NEUT2'/

HYDR1=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='NOEU_HYDR_R',
                 MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'HYDR',
                               VALE = 3.) 
                              # VALE = 0.) 
                                 )


HYDR=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_THER',    NOM_CHAM='HYDR_NOEU',AFFE=(
                      _F(  CHAM_GD = HYDR1,   INST=-10.),
                      _F(  CHAM_GD = HYDR1,   INST=100.),
                      ))

# comme la temperature                      
SECH=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_THER',    NOM_CHAM='TEMP',AFFE=(
                      _F(  CHAM_GD = TP1,   LIST_INST =L_INST),)  )
                      
NEUT11=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='NOEU_NEUT_R',
                 MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'X1',
                               VALE = 5.)   )


NEUT1=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_VARC',    NOM_CHAM='NEUT',AFFE=(
                      _F(  CHAM_GD = NEUT11,   INST=-10.),
                      _F(  CHAM_GD = NEUT11,   INST=100.),
                      ))
                      

NEUT21=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='NOEU_NEUT_R',
                 MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'X1',
                               VALE = 6.)   )


NEUT2=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_VARC',    NOM_CHAM='NEUT',AFFE=(
                      _F(  CHAM_GD = NEUT21,   INST=-10.),
                      _F(  CHAM_GD = NEUT21,   INST=100.),
                      ))
                      
IRRA1=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='NOEU_IRRA_R',
                 MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'IRRA',
                               VALE = 1.)   )


IRRA=CREA_RESU(    OPERATION='AFFE', TYPE_RESU='EVOL_VARC',    NOM_CHAM='IRRA',AFFE=(
                      _F(  CHAM_GD = IRRA1,   INST=-10.),
                      _F(  CHAM_GD = IRRA1,   INST=100.),
                      ))
                      
CORR=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='CART_CORR_R',
                 MAILLAGE=MA,
                            AFFE=_F(  TOUT ='OUI',
                                NOM_CMP = 'CORR',
                               VALE = 4.)   )

CHUMAT = AFFE_MATERIAU (MAILLAGE = MA,
                       AFFE =_F(TOUT='OUI',
                                MATER = UMAT,),
                       AFFE_VARC=(
                       _F( TOUT='OUI',
                                  EVOL=TEMPE,
                                  NOM_VARC='TEMP',
                                  NOM_CHAM='TEMP',VALE_REF=0.),
                       _F( TOUT='OUI',
                                  EVOL=HYDR,
                                  NOM_VARC='HYDR',
                                  NOM_CHAM='HYDR_NOEU'),
                       _F( TOUT='OUI',
                                  EVOL=SECH,
                                  NOM_VARC='SECH',
                                  NOM_CHAM='TEMP',VALE_REF=0.),
                        _F( TOUT='OUI',
                                   EVOL=IRRA,
                                   NOM_VARC='IRRA',),
                       _F( TOUT='OUI',
                                  CHAM_GD=CORR,
                                  NOM_VARC='CORR',),
                       _F( TOUT='OUI',
                                  EVOL=NEUT1,
                                  NOM_VARC='NEUT1',
                                  NOM_CHAM='NEUT'),
                       _F( TOUT='OUI',
                                  EVOL=NEUT2,
                                  NOM_VARC='NEUT2',
                                  NOM_CHAM='NEUT'),
                                  ),
                                  )

RESUMAT = STAT_NON_LINE (MODELE = MO,INFO=2,
                      CHAM_MATER = CHUMAT,
                      EXCIT =(_F( CHARGE = BLOC),),
                      COMP_INCR =_F(RELATION ='UMAT',
                                    NB_VARI=1,
                                    LIBRAIRIE='libumat.so',
                                    NOM_ROUTINE='umat'),
                      INCREMENT =_F(LIST_INST =L_INST),
                      NEWTON    =_F(
                                PREDICTION ='ELASTIQUE',
                                REAC_ITER= 1
                                ),
                        )

RESUMAT = CALC_CHAMP( reuse= RESUMAT,
                  RESULTAT = RESUMAT,
                   CONTRAINTE=('SIGM_ELNO'),
                  )
RESUMAT = CALC_CHAMP ( reuse= RESUMAT,
                  RESULTAT = RESUMAT,
                  CONTRAINTE='SIGM_NOEU',
                  )

IMPR_RESU(RESU=_F(RESULTAT=RESUMAT,VALE_MAX='OUI',VALE_MIN='OUI',NUME_ORDRE=38))

TEST_RESU(
          RESU= _F(RESULTAT = RESUMAT,
                   INST=0.24,
                   NOM_CHAM ='DEPL',
                   GROUP_NO ='B',
                   NOM_CMP ='DX',
                   VALE_CALC= 1.091992517978 ,
                   VALE_REFE= 1.092 ,
                   REFERENCE='AUTRE_ASTER')
         )

TEST_RESU(
          RESU= _F(RESULTAT = RESUMAT,
                   INST=0.24,
                   NOM_CHAM ='SIGM_NOEU',
                   GROUP_NO ='B',
                   NOM_CMP ='SIZZ',
                   VALE_CALC= -0.365808486454,
                   VALE_REFE= -0.3658085 ,
                   REFERENCE='AUTRE_ASTER')
         )


FIN()
