# MODIF  DATE 02/02/2011   AUTEUR PELLET J.PELLET 
# TITRE VALIDATION DE PROJ_MESU_MODAL : CAS 3D, BASE (MODE_MECA)
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
# (AT YOUR OPTION) ANY LATER VERSION.                                 
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
# ======================================================================
#
######################################################################
#
#         *** VALIDATION DE LA COMMANDE PROJ_MESU_MODAL ***
#
# POUTRE DE SAINT-VENANT EN 3D ENCASTREE-LIBRE AVEC EFFORT AXIAL
#    - L=4 M, R=0.1 M
#    - E=2.1E+11 PA, NU=0.3, RHO=7800. KG/M3
#    - 2667 NOEUDS, 3328 ELEMENTS
#
# REPONSE TRANSITOIRE A UN EFFORT ECHELON APPLIQUE A L'EXTREMITE LIBRE
#    - PAS D'AMORTISSEMENT
#    - FX = 1.E+6 AU NOEUD2 (EXTENSION)
#
# PROJECTION SUR UN CONCEPT MODE_MECA CREE PAR MODE_ITER_SIMULT
#
######################################################################
#
DEBUT(  CODE=_F( NOM = 'SDLV122A',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI') )

#
# DEFINITION DU MODELE NUMERIQUE
# ==============================

PRE_IDEAS()

#
MAIL=LIRE_MAILLAGE( )

#
MODELE=AFFE_MODELE(   MAILLAGE=MAIL,AFFE=(
                            _F( TOUT = 'OUI',
                                  PHENOMENE = 'MECANIQUE',
                                  MODELISATION = '3D'),
                            _F( GROUP_NO = ('NPOINT1', 'NPOINT2',),
                                  PHENOMENE = 'MECANIQUE',
                                  MODELISATION = 'DIS_TR'))           )

#
ACIER=DEFI_MATERIAU(   ELAS=_F( E = 2.1E+11,  NU = 0.3,  RHO = 7800.)         )

#
MATER=AFFE_MATERIAU(   MAILLAGE=MAIL,
                             AFFE=_F( TOUT = 'OUI',
                                   MATER = ACIER)                    )

#
CARAELEM=AFFE_CARA_ELEM(    MODELE=MODELE,
                             DISCRET=_F( GROUP_NO = ('NPOINT1', 'NPOINT2',),
                                      CARA = 'K_TR_D_N',
                                      VALE = (0., 0., 0., 0., 0., 0.,)))

#
# BLOQUAGE DE L'EXTREMITE 1
BLOQUAGE=AFFE_CHAR_MECA(     MODELE=MODELE,DDL_IMPO=(
                             _F( GROUP_NO = 'NPOINT1',
                                       DX = 0.,  DY = 0.,  DZ = 0.,
                                       DRX = 0., DRY = 0., DRZ = 0.),
#
# ON NE CHERCHE QUE LES MOUVEMENTS DE TRACTION-COMPRESSION
                             _F( GROUP_NO = ('NSUP',  'NFIBRE',),
                                       DY = 0.,  DZ = 0.)),LIAISON_ELEM=(
#
# AFFECTATION DES CONDITIONS DE RACCORD 3D-POUTRE AUX EXTREMITES
                             _F( OPTION = '3D_POU',
                                           GROUP_MA_1 = 'ESURF1',
                                           GROUP_NO_2 = 'NPOINT1'),
#
                             _F( OPTION = '3D_POU',
                                           GROUP_MA_1 = 'ESURF2',
                                           GROUP_NO_2 = 'NPOINT2'))     )

#
RIGIELEM=CALC_MATR_ELEM(       MODELE=MODELE,
                              CARA_ELEM=CARAELEM,
                             CHAM_MATER=MATER,
                                 CHARGE=BLOQUAGE,
                                 OPTION='RIGI_MECA'                  )

#
MASSELEM=CALC_MATR_ELEM(       MODELE=MODELE,
                              CARA_ELEM=CARAELEM,
                             CHAM_MATER=MATER,
                                 CHARGE=BLOQUAGE,
                                 OPTION='MASS_MECA'                  )

#
NU=NUME_DDL(   MATR_RIGI=RIGIELEM                                  )

#
RIGIASSE=ASSE_MATRICE(   MATR_ELEM=RIGIELEM,
                            NUME_DDL=NU                              )

#
MASSASSE=ASSE_MATRICE(   MATR_ELEM=MASSELEM,
                            NUME_DDL=NU                              )

#
MODES=MODE_ITER_SIMULT(      MATR_A=RIGIASSE,
                               MATR_B=MASSASSE,
                            CALC_FREQ=_F( NMAX_FREQ = 3),
                            )

#
MODES=CALC_ELEM( reuse=MODES,    RESULTAT=MODES,
                          OPTION='SIGM_ELNO'                    )

#
MODES=CALC_NO( reuse=MODES,    RESULTAT=MODES,
                        OPTION='SIGM_NOEU'                      )

#
# DEFINITION DU MAILLAGE DE MESURE
# ================================
#
PRE_IDEAS( UNITE_IDEAS=33, UNITE_MAILLAGE=21)

#
MAILMESU=LIRE_MAILLAGE(UNITE=21)


#
MODLMESU=AFFE_MODELE(   MAILLAGE=MAILMESU,AFFE=(
                              _F( MAILLE = ('M3','M4','M5',),
                                    PHENOMENE = 'MECANIQUE',
                                    MODELISATION = 'DIS_T'),
                              _F( NOEUD = ('N3','N4','N5',),
                                    PHENOMENE = 'MECANIQUE',
                                    MODELISATION = 'DIS_T'))          )

#
MESURE=LIRE_RESU(FORMAT='IDEAS_DS58',
                 UNITE=33,
                 MAILLAGE=MAILMESU,
                 TYPE_RESU='DYNA_TRANS',
                 NOM_CHAM=('DEPL','VITE','SIEF_NOEU',),
               #  NOM_CHAM='SIEF_NOEU',
                 TOUT_ORDRE='OUI',)
#
# PROJECTION DES MESURES SUR LA BASE MODALE DU MODELE
# ===================================================
#
REPGENE=PROJ_MESU_MODAL(
                         MODELE_CALCUL=_F( MODELE = MODELE,
                                    BASE = MODES,),
                         MODELE_MESURE=_F( MODELE = MODLMESU,
                                    MESURE = MESURE,
                                    NOM_CHAM = ('DEPL','VITE','SIEF_NOEU',),),
                        )

#
# RESTITUTION DES RESULTATS 
# =========================
#
#DEPLACE = REST_GENE_PHYS (RESU_GENE : REPGENE
#                          NOM_CHAM  : 'DEPL'                        );
#
#VITESSE = REST_GENE_PHYS (RESU_GENE : REPGENE
#                          NOM_CHAM  : 'VITE'                        );
#
#ACCELER = REST_GENE_PHYS (RESU_GENE : REPGENE
#                          NOM_CHAM  : 'ACCE'                        );
#
REPONSE=REST_GENE_PHYS(   RESU_GENE=REPGENE,
                            TOUT_CHAM='OUI'                          )

DEPL3=POST_RELEVE_T(ACTION=_F(INTITULE='DEPL3',
                      GROUP_NO=('NRES3'),
                      RESULTAT=REPONSE,
                      NOM_CHAM='DEPL',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='DX',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = DEPL3 )

VITE5=POST_RELEVE_T(ACTION=_F(INTITULE='VITE5',
                      GROUP_NO=('NRES5'),
                      RESULTAT=REPONSE,
                      NOM_CHAM='VITE',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='DX',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = VITE5 )

# POUR TEST LIRE_RESU

DEPLM=POST_RELEVE_T(ACTION=_F(INTITULE='DEPLM',
                      NOEUD=('N3'),
                      RESULTAT=MESURE,
                      NOM_CHAM='DEPL',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='D1',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = DEPLM )

VITEM=POST_RELEVE_T(ACTION=_F(INTITULE='VITEM',
                      NOEUD=('N5'),
                      RESULTAT=MESURE,
                      NOM_CHAM='VITE',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='D1',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = VITEM )

F1=FORMULE(NOM_PARA=('DX', 'D1',),
                VALE='abs (DX - D1)')

T1=CALC_TABLE(TABLE=DEPLM,
              ACTION=(
                               _F(OPERATION='COMB',
                                  TABLE=DEPL3,
                                  NOM_PARA=('INST',),),
                               _F(OPERATION='OPER',
                                  NOM_PARA='DIFF',
                                  FORMULE=F1),
                      ),
              TITRE='Comparaison calcul / mesure')

#IMPR_TABLE( UNITE = 8, TABLE = T1 )

T2=CALC_TABLE(TABLE=VITEM,
              ACTION=(
                               _F(OPERATION='COMB',
                                  TABLE=VITE5,
                                  NOM_PARA=('INST',),),
                               _F(OPERATION='OPER',
                                  NOM_PARA='DIFF',
                                  FORMULE=F1),
                      ),
              TITRE='Comparaison calcul / mesure')

#IMPR_TABLE( UNITE = 8, TABLE = T2 )

TEST_TABLE(
     TABLE     = T1,
     NOM_PARA  = 'DIFF',
     TYPE_TEST = 'SOMM',
     VALE      = 0.,
     CRITERE   = 'ABSOLU',
     PRECISION = 1.E-7,
     REFERENCE = 'AUTRE_ASTER',)


TEST_TABLE(
     TABLE     = T2,
     NOM_PARA  = 'DIFF',
     TYPE_TEST = 'SOMM',
     VALE      = 0.,
     CRITERE   = 'ABSOLU',
     PRECISION = 1.E-4,
     REFERENCE = 'AUTRE_ASTER',)

#
LTEMPS=DEFI_LIST_REEL(   VALE=(9.E-4,  17.E-4,  25.E-4,)              )

#
REPONS=CALC_ELEM( RESULTAT=REPONSE,
                            MODELE=MODELE,
                        CHAM_MATER=MATER,
                         LIST_INST=LTEMPS,
                            OPTION='EPSI_ELNO'                  )

#
REPONS=CALC_NO( reuse=REPONS,   RESULTAT=REPONS,
                      LIST_INST=LTEMPS,
                         OPTION='EPSI_NOEU'                     )

#
REPON=CALC_ELEM( RESULTAT=REPONSE,
                          MODELE=MODELE,
                        CHAM_MATER=MATER,
                         LIST_INST=LTEMPS,
                            OPTION='SIGM_ELNO'                  )

#
REPON=CALC_NO( reuse=REPON,   RESULTAT=REPON,
                      LIST_INST=LTEMPS,
                         OPTION='SIGM_NOEU'                     )

SIXX4=POST_RELEVE_T(ACTION=_F(INTITULE='SIXX4',
                      GROUP_NO=('NRES4'),
                      RESULTAT=REPON,
                      NOM_CHAM='SIGM_NOEU',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='SIXX',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = SIXX4 )

SIXXM=POST_RELEVE_T(ACTION=_F(INTITULE='SIXXM',
                      NOEUD=('N4'),
                      RESULTAT=MESURE,
                      NOM_CHAM='SIEF_NOEU',
                      TOUT_ORDRE='OUI',
                      NOM_CMP='SIXX',
                      OPERATION='EXTRACTION',
                      ),);

#IMPR_TABLE( UNITE = 8, TABLE = SIXXM )

F2=FORMULE(NOM_PARA=('SIXX', 'SIXXM',),
                VALE='abs (SIXX - SIXXM)')

T3=CALC_TABLE(TABLE=SIXXM,
             ACTION=(_F(OPERATION='RENOMME',
                                  NOM_PARA=('SIXX', 'SIXXM'),),
                               _F(OPERATION='COMB',
                                  TABLE=SIXX4,
                                  NOM_PARA=('INST',),),
                               _F(OPERATION='OPER',
                                  NOM_PARA='DIFF',
                                  FORMULE=F2),
                      ),
              TITRE='Comparaison calcul / mesure')

#IMPR_TABLE( UNITE = 8, TABLE = T3 )

TEST_TABLE(
     TABLE     = T3,
     NOM_PARA  = 'DIFF',
     TYPE_TEST = 'SOMM',
     VALE      = 0.,
     CRITERE   = 'ABSOLU',
     PRECISION = 1.E-6,
     REFERENCE = 'AUTRE_ASTER',)

#
# TEST DES RESULTATS 
# ==================
TEST_RESU(RESU=(  _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 90,           VALE = 2.68574E-04),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 170,          VALE = 3.07395E-04),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 250,          VALE = 1.44563E-05),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 90,           VALE = 5.79281E-04),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 170,          VALE = 9.15992E-04),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'DEPL',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 250,          VALE = 3.09472E-04),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 5.9E-2,
                   NUME_ORDRE = 90,           VALE = 6.22100E-01),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 12.6E-2,
                   NUME_ORDRE = 170,          VALE = -4.68338E-02),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 10.6E-2,
                   NUME_ORDRE = 250,          VALE = -3.54155E-01),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.1E-2,
                   NUME_ORDRE = 90,           VALE = 8.05642E-01),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 6.9E-2,
                   NUME_ORDRE = 170,          VALE = -3.55625E-01),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'VITE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 250,          VALE = -8.63754E-01),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 90,           VALE = -3.63306E+03),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 19.2E-2,
                   NUME_ORDRE = 170,          VALE = 6.33658E+02),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES2',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 250,          VALE = 3.80121E+03),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 11.4E-2,
                   NUME_ORDRE = 90,           VALE = 8.65464E+02),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 1.E-2,
                   NUME_ORDRE = 170,          VALE = -2.38709E+03),
#
             _F( RESULTAT = REPONSE,      GROUP_NO = 'NRES4',
                   NOM_CHAM = 'ACCE',       NOM_CMP = 'DX',
                   CRITERE = 'RELATIF',    PRECISION = 21.1E-2,
                   NUME_ORDRE = 250,          VALE = -6.35452E+02),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 90,               VALE = 1.95725E-04),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 170,              VALE = 3.01529E-04),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 250,              VALE = 5.42212E-05),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 90,               VALE = 1.82211E-04),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 170,              VALE = 2.61105E-04),
#
         _F( RESULTAT = REPONS,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'EPSI_NOEU', NOM_CMP = 'EPXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 250,              VALE = 1.68078E-04),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 90,               VALE = 5.01195E+07),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 170,              VALE = 7.71733E+07),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES2',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 250,              VALE = 1.38989E+07),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 90,               VALE = 4.64966E+07),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 170,              VALE = 6.67109E+07),
#
         _F( RESULTAT = REPON,          GROUP_NO = 'NRES4',
               NOM_CHAM = 'SIGM_NOEU', NOM_CMP = 'SIXX',
               CRITERE = 'RELATIF',        PRECISION = 1.E-2,
               NUME_ORDRE = 250,              VALE = 4.29307E+07)))

#
FIN()
#
