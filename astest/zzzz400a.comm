# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='NON'))

PRE_GIBI()
MAIL=LIRE_MAILLAGE()
#IMPR_RESU(UNITE=8, RESU=_F(MAILLAGE=MAIL))

MAIL=DEFI_GROUP(reuse =MAIL,
                MAILLAGE=MAIL,
                CREA_GROUP_NO=(_F(GROUP_MA='BBAS',),
                               _F(GROUP_MA='BORD3',),
                               _F(GROUP_MA='BORD1',),
                                ),);

MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=(
                       _F(TOUT='OUI',  PHENOMENE='MECANIQUE', MODELISATION='AXIS',),
                       ));

MAIL = MODI_MAILLAGE(reuse=MAIL,
                     MAILLAGE=MAIL,
                     ORIE_PEAU_2D=(_F(GROUP_MA='BORD3',),
                                   _F(GROUP_MA='BORD1',),),);

LI1=DEFI_LIST_REEL(DEBUT=0.0,
                   INTERVALLE=(  _F(JUSQU_A=1.E4, NOMBRE=4,),),);

LI2=DEFI_LIST_REEL(DEBUT=5.e3,
                   INTERVALLE=(  _F(JUSQU_A=1.E4, NOMBRE=2,),),);


MATE1=DEFI_MATERIAU(ELAS=_F(E=7.74E6, NU=0.285, ALPHA=0.,),
                    ECRO_LINE=_F(D_SIGM_EPSI = 7.7E5, SY = 7.7E3,),)

MATE2=DEFI_MATERIAU(ELAS=_F(E=5.74E6, NU=0.385, ALPHA=0.,),
                    ECRO_LINE=_F(D_SIGM_EPSI = 5.7E5, SY = 5.7E3,),)


CHM0=AFFE_MATERIAU(MAILLAGE=MAIL,
                  AFFE=(
                     _F(GROUP_MA='CARR1', MATER=MATE1,),
                     _F(GROUP_MA='CARR2', MATER=MATE2,),))


RAMPE=DEFI_FONCTION(NOM_PARA='INST',VALE=(0.0,0.0, 1.e4, 1.e4))

CHA0=AFFE_CHAR_MECA(MODELE=MODELE,
                    DDL_IMPO=(_F(GROUP_NO='BBAS', DY=0.0,),
                              _F(GROUP_NO='B',    DX=0.0,),),);

CHA2=AFFE_CHAR_MECA(MODELE=MODELE,
                      PRES_REP=(
                        _F(GROUP_MA=('BORD3',), PRES=1.E3,),
                        _F(GROUP_MA=('BORD1',), PRES=3.E3,),
                        ),
                     VERI_NORM='OUI');


# RESU1 : calcul de reference (en une seule fois) :
#===================================================
RESU1=STAT_NON_LINE(  MODELE=MODELE,  CHAM_MATER=CHM0,
                      EXCIT=(_F(CHARGE=CHA0, FONC_MULT=RAMPE),
                             _F(CHARGE=CHA2, FONC_MULT=RAMPE),),
                      COMPORTEMENT=(
                                     _F(GROUP_MA='CARR1',  RELATION='VMIS_ISOT_LINE',),
                                     _F(GROUP_MA='CARR2',  RELATION='VMIS_CINE_LINE',),
                                     ),
                      INCREMENT=_F(LIST_INST=LI1 ,),
                      NEWTON=_F( MATRICE='TANGENTE', REAC_ITER=2, ),
                      CONVERGENCE=_F(ITER_GLOB_MAXI=40, RESI_GLOB_RELA=1.E-06,),
                      SOLVEUR=_F(METHODE='LDLT',),);

#IMPR_RESU(UNITE=6, FORMAT='RESULTAT', RESU=_F(RESULTAT=RESU1, NOM_CHAM='VARI_ELGA',))
#IMPR_RESU(UNITE=80, FORMAT='MED', RESU=_F(RESULTAT=RESU1, IMPR_NOM_VARI='OUI',))


TEST_RESU(RESU=(
                _F(MAILLE='M1', POINT=1, INST=1.E4, RESULTAT=RESU1, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V1', VALE_CALC=4.02506835439875E+01,),
                _F(MAILLE='M1', POINT=1, INST=1.E4, RESULTAT=RESU1, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V2', VALE_CALC=1.0,),

                _F(MAILLE='M26', POINT=1, INST=1.E4, RESULTAT=RESU1, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V1', VALE_CALC=-3.50286336548130E+06,),
                _F(MAILLE='M26', POINT=1, INST=1.E4, RESULTAT=RESU1, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V7', VALE_CALC=1.0,),
          ))


# RESU2 : calcul en deux fois avec reprise sur fichier au format MED (NOM_CMP):
#==============================================================================
RESU20=STAT_NON_LINE(  MODELE=MODELE,  CHAM_MATER=CHM0,
                      EXCIT=(_F(CHARGE=CHA0, FONC_MULT=RAMPE),
                             _F(CHARGE=CHA2, FONC_MULT=RAMPE),),
                      COMPORTEMENT=(
                                     _F(GROUP_MA='CARR1',  RELATION='VMIS_ISOT_LINE',),
                                     _F(GROUP_MA='CARR2',  RELATION='VMIS_CINE_LINE',),
                                     ),
                      INCREMENT=_F(LIST_INST=LI1 , INST_FIN=5.e3),
                      NEWTON=_F( MATRICE='TANGENTE', REAC_ITER=2, ),
                      CONVERGENCE=_F(ITER_GLOB_MAXI=40, RESI_GLOB_RELA=1.E-06,),
                      SOLVEUR=_F(METHODE='LDLT',),);

IMPR_RESU(UNITE=80, FORMAT='MED', RESU=_F(RESULTAT=RESU20,))
 
RESU21=LIRE_RESU(TYPE_RESU='EVOL_NOLI', FORMAT='MED', MODELE=MODELE, UNITE=80,
                TOUT_ORDRE='OUI', CHAM_MATER=CHM0,
                COMPORTEMENT=(
                                     _F(GROUP_MA='CARR1',  RELATION='VMIS_ISOT_LINE',),
                                     _F(GROUP_MA='CARR2',  RELATION='VMIS_CINE_LINE',),
                                     ),
                FORMAT_MED=(
                    _F(   NOM_CHAM_MED='RESU20__DEPL',      NOM_CHAM ='DEPL',),
                    _F(   NOM_CHAM_MED='RESU20__SIEF_ELGA', NOM_CHAM ='SIEF_ELGA',),
                    _F(   NOM_CHAM_MED='RESU20__VARI_ELGA', NOM_CHAM ='VARI_ELGA',),
                ))

# NOM_CHAM ='VARI_ELGA',),)


RESU2=STAT_NON_LINE(  MODELE=MODELE,  CHAM_MATER=CHM0,
                      EXCIT=(_F(CHARGE=CHA0, FONC_MULT=RAMPE),
                             _F(CHARGE=CHA2, FONC_MULT=RAMPE),),
                      COMPORTEMENT=(
                                     _F(GROUP_MA='CARR1',  RELATION='VMIS_ISOT_LINE',),
                                     _F(GROUP_MA='CARR2',  RELATION='VMIS_CINE_LINE',),
                                     ),
                      ETAT_INIT=_F(EVOL_NOLI=RESU21 , INST_ETAT_INIT=5.e3),
                      INCREMENT=_F(LIST_INST=LI2 , INST_FIN=1.e4),
                      NEWTON=_F( MATRICE='TANGENTE', REAC_ITER=2, ),
                      CONVERGENCE=_F(ITER_GLOB_MAXI=40, RESI_GLOB_RELA=1.E-06,),
                      SOLVEUR=_F(METHODE='LDLT',),);



TEST_RESU(RESU=(
                _F(MAILLE='M1', POINT=1, INST=1.E4, RESULTAT=RESU2, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V1', VALE_CALC=4.02506835439875E+01,),
                _F(MAILLE='M1', POINT=1, INST=1.E4, RESULTAT=RESU2, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V2', VALE_CALC=1.0,),

                _F(MAILLE='M26', POINT=1, INST=1.E4, RESULTAT=RESU2, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V1', VALE_CALC=-3.50286336548130E+06,),
                _F(MAILLE='M26', POINT=1, INST=1.E4, RESULTAT=RESU2, NOM_CHAM='VARI_ELGA',
                    NOM_CMP='V7', VALE_CALC=1.0,),
          ))

FIN();
