# TITRE RUINE ELASTO-PLASTIQUE DU PORTIQUE DE LEE
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SSNL136B',NIV_PUB_WEB='INTERNET',VISU_EFICAS='OUI'),DEBUG=_F(SDVERI='OUI'))

#========================================================================
# CE CAS-TEST PRESENTE LA PARTICULARITE DE COMPARER LA FONCTIONNALITE
# DE DECOUPE DU PAS EN CAS DE SINGULARITE DE LA MATRICE
# DE STAT_NON_LINE EN VARIANT LE TYPE DE
# DETECTION DE SINGULARITE (MULT_FRONT/LDLT VERSUS MUMPS).
#========================================================================

MA=LIRE_MAILLAGE(UNITE=17,FORMAT='MED',);
IMPR_RESU(RESU=_F(MAILLAGE=MA))

MA=DEFI_GROUP(reuse =MA,
              MAILLAGE=MA,
              CREA_GROUP_NO=_F(TOUT_GROUP_MA='OUI',),);

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='POU_D_T_GD',),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=1.0E+7,
                            NU=0.,),);

MAT=AFFE_MATERIAU(MAILLAGE=MA,
                  AFFE=_F(TOUT='OUI',
                          MATER=ACIER,),);

CARA=AFFE_CARA_ELEM(MODELE=MO,
                    POUTRE=_F(GROUP_MA='AB',
                              SECTION='GENERALE',
                              CARA=('A','IY','IZ','AY','AZ','JX',),
                              VALE=(1.0,0.0833333333333,0.0833333333333,1.2,1.2,0.3333333333333,),),
                    ORIENTATION=_F(GROUP_MA='AB',
                                   CARA='ANGL_VRIL',
                                   VALE=0.,),);
#0.3333333333333,
#0.0069444444444,),),

CL=AFFE_CHAR_MECA(MODELE=MO,
                  DDL_IMPO=_F(GROUP_NO='PA',
                              DX=0.,
                              DY=0.,
                              DZ=0.,
                              DRX=0.,
                              DRY=0.,
                              DRZ=0.,),);

FORCE=AFFE_CHAR_MECA(MODELE=MO,
                     FORCE_NODALE=_F(GROUP_NO='PB',
                                     FZ=600.0,),);

F_FORCE=DEFI_FONCTION(NOM_PARA='INST',
                      VALE=(0.,0.,10.0,10.0,),);

TEMPS=DEFI_LIST_REEL(DEBUT=0.,
                     INTERVALLE=_F(JUSQU_A=1.0,
                                   NOMBRE=60,),);

DEFLIST =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST = TEMPS),
                        ECHEC=_F(ACTION='DECOUPE',
                                 SUBD_METHODE='MANUEL',
                                 SUBD_PAS=4,
                                 SUBD_PAS_MINI = 1e-6),)

# DETECTION DE SINGULARITE ET REDECOUPAGE DU PAS DE TEMPS AVEC
# LE SOLVEUR LINEAIRE MULT_FRONT
RESO=STAT_NON_LINE(MODELE=MO,
                   CHAM_MATER=MAT,
                   CARA_ELEM=CARA,
                   EXCIT=(_F(CHARGE=CL,),
                          _F(CHARGE=FORCE,
                             FONC_MULT=F_FORCE,),),
                   COMP_ELAS=_F(RELATION='ELAS_POUTRE_GR',
                                DEFORMATION='GROT_GDEP',),
                   INCREMENT=_F(LIST_INST=DEFLIST,),
                   NEWTON=_F(MATRICE='TANGENTE',
                             REAC_ITER=1,),
                   CONVERGENCE=_F(RESI_GLOB_RELA=1.0E-6,
                                  ITER_GLOB_MAXI=50,),
                   SOLVEUR=_F(METHODE='MULT_FRONT',
                   ),);


DEPZ=RECU_FONCTION(RESULTAT=RESO,
                   TOUT_ORDRE='OUI',
                   NOM_CHAM='DEPL',
                   NOM_CMP='DZ',
                   GROUP_NO='PB',);

TAB_DEPL=POST_RELEVE_T(ACTION=_F(INTITULE='DEPLA',
                                 GROUP_NO='PB',
                                 RESULTAT=RESO,
                                 NOM_CHAM='DEPL',
                                 TOUT_ORDRE='OUI',
                                 NOM_CMP=('DX','DY','DZ',),
                                 OPERATION='EXTRACTION',),);

GEOM_DX = FORMULE(VALE='DX+29.3',
                  NOM_PARA='DX',);

GEOM_DY = FORMULE(VALE='DY+70.7',
                  NOM_PARA='DY',);

TAB_DEPL=CALC_TABLE(reuse=TAB_DEPL,
                    TABLE=TAB_DEPL,
            ACTION=(_F(OPERATION='OPER', FORMULE=GEOM_DX, NOM_PARA='X_FINAL'),
                _F(OPERATION='OPER', FORMULE=GEOM_DY, NOM_PARA='Y_FINAL'),),)

COOR_X=RECU_FONCTION(TABLE=TAB_DEPL,
                     PARA_X='INST',
                     PARA_Y='X_FINAL',);

COOR_Y=RECU_FONCTION(TABLE=TAB_DEPL,
                     PARA_X='INST',
                     PARA_Y='Y_FINAL',);

X_REF=DEFI_FONCTION(NOM_PARA='INST',
                      VALE=(0.,29.3,0.5,22.28,1.0,15.67,),);

Y_REF=DEFI_FONCTION(NOM_PARA='INST',
                      VALE=(0.,70.7,0.5,58.74,1.0,46.99,),);

Z_REF=DEFI_FONCTION(NOM_PARA='INST',
                      VALE=(0.,0.,0.5,40.12,1.0,53.62,),);

IMPR_FONCTION(FORMAT='XMGRACE',
              COURBE=(_F(FONCTION=COOR_X,),
                      _F(FONCTION=COOR_Y,),
                      _F(FONCTION=DEPZ,),
                      _F(FONCTION=X_REF,),
                      _F(FONCTION=Y_REF,),
                      _F(FONCTION=Z_REF,),),
              TITRE='Coordonnees du point B en fonction du pseudo-temps',);

IMPR_RESU(FORMAT='CASTEM',
          RESU=_F(MAILLAGE=MA,
                  RESULTAT=RESO,
                  NOM_CHAM='DEPL',),);

TEST_FONCTION(VALEUR=(_F(VALE_CALC=22.6185108484,
                         VALE_REFE=22.280000000000001,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.02,
                         FONCTION=COOR_X,),
                      _F(VALE_CALC=59.5195625136,
                         VALE_REFE=58.740000000000002,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.02,
                         FONCTION=COOR_Y,),
                      _F(VALE_CALC=39.2895671303,
                         VALE_REFE=40.119999999999997,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.029999999999999999,
                         FONCTION=DEPZ,),
                      ),
              )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=16.0593660421,
                         VALE_REFE=15.67,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.029999999999999999,
                         FONCTION=COOR_X,),
                      _F(VALE_CALC=47.9663876152,
                         VALE_REFE=46.990000000000002,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.029999999999999999,
                         FONCTION=COOR_Y,),
                      _F(VALE_CALC=53.0150383969,
                         VALE_REFE=53.520000000000003,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=1.E-2,
                         FONCTION=DEPZ,),
                      ),
              )

# -------------- TESTS DE NON REGRESSION ----------------------

TEST_FONCTION(VALEUR=(_F(VALE_CALC=22.618510848408,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=COOR_X,
                         ),
                      _F(VALE_CALC=59.519562513555996,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=COOR_Y,
                         ),
                      _F(VALE_CALC=39.289567130315,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=DEPZ,
                         ),
                      ),
              )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=16.059366042097999,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=COOR_X,
                         ),
                      _F(VALE_CALC=47.966387615236002,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=COOR_Y,
                         ),
                      _F(VALE_CALC=53.015038396900998,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=DEPZ,
                         ),
                      ),
              )

# DETECTION DE SINGULARITE ET REDECOUPAGE DU PAS DE TEMPS AVEC
# LE SOLVEUR LINEAIRE MUMPS
RESOM=STAT_NON_LINE(MODELE=MO,
                   CHAM_MATER=MAT,
                   CARA_ELEM=CARA,
                   EXCIT=(_F(CHARGE=CL,),
                          _F(CHARGE=FORCE,
                             FONC_MULT=F_FORCE,),),
                   COMP_ELAS=_F(RELATION='ELAS_POUTRE_GR',
                                DEFORMATION='GROT_GDEP',),
                   INCREMENT=_F(LIST_INST=DEFLIST,),
                   NEWTON=_F(MATRICE='TANGENTE',
                             REAC_ITER=1,),
                   CONVERGENCE=_F(RESI_GLOB_RELA=1.0E-6,
                                  ITER_GLOB_MAXI=50,),
                   SOLVEUR=_F(METHODE='MUMPS',
                   ),);


DEPZM=RECU_FONCTION(RESULTAT=RESOM,
                   TOUT_ORDRE='OUI',
                   NOM_CHAM='DEPL',
                   NOM_CMP='DZ',
                   GROUP_NO='PB',);

TAB_DEPM=POST_RELEVE_T(ACTION=_F(INTITULE='DEPLA',
                                 GROUP_NO='PB',
                                 RESULTAT=RESOM,
                                 NOM_CHAM='DEPL',
                                 TOUT_ORDRE='OUI',
                                 NOM_CMP=('DX','DY','DZ',),
                                 OPERATION='EXTRACTION',),);


TAB_DEPM=CALC_TABLE(reuse=TAB_DEPM,
                    TABLE=TAB_DEPM,
            ACTION=(_F(OPERATION='OPER', FORMULE=GEOM_DX, NOM_PARA='X_FINAL'),
                _F(OPERATION='OPER', FORMULE=GEOM_DY, NOM_PARA='Y_FINAL'),),)

COOR_XM=RECU_FONCTION(TABLE=TAB_DEPM,
                     PARA_X='INST',
                     PARA_Y='X_FINAL',);

COOR_YM=RECU_FONCTION(TABLE=TAB_DEPM,
                     PARA_X='INST',
                     PARA_Y='Y_FINAL',);

TEST_FONCTION(VALEUR=(_F(VALE_CALC=22.6185108484,
                         VALE_REFE=22.280000000000001,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.02,
                         FONCTION=COOR_XM,),
                      _F(VALE_CALC=59.5195625136,
                         VALE_REFE=58.740000000000002,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.02,
                         FONCTION=COOR_Y,),
                      _F(VALE_CALC=39.2895671303,
                         VALE_REFE=40.119999999999997,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.029999999999999999,
                         FONCTION=DEPZM,),
                      ),
              )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=16.0593660421,
                         VALE_REFE=15.67,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.029999999999999999,
                         FONCTION=COOR_XM,),
                      _F(VALE_CALC=47.9663876152,
                         VALE_REFE=46.990000000000002,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=0.031,
                         FONCTION=COOR_YM,),
                      _F(VALE_CALC=53.0150383969,
                         VALE_REFE=53.520000000000003,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         REFERENCE='SOURCE_EXTERNE',
                         PRECISION=1.E-2,
                         FONCTION=DEPZM,),
                      ),
              )

# -------------- TESTS DE NON REGRESSION ----------------------

TEST_FONCTION(VALEUR=(_F(VALE_CALC=22.618510848408,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=COOR_XM,
                         ),
                      _F(VALE_CALC=59.519562513555996,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=COOR_YM,
                         ),
                      _F(VALE_CALC=39.289567130315,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=0.5,
                         FONCTION=DEPZM,
                         ),
                      ),
              )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=16.059366042097999,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=COOR_XM,
                         ),
                      _F(VALE_CALC=47.966387615236002,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=COOR_YM,
                         ),
                      _F(VALE_CALC=53.015038396900998,
                         TOLE_MACHINE=1.E-3,
                         CRITERE='RELATIF',
                         VALE_PARA=1.0,
                         FONCTION=DEPZM,
                         ),
                      ),
              )

FIN();
