# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

#......................................................................
# PLAQUE CARREE EN TRACTION CISAILLEMENT CALCUL 3D
# ELASTOPLASTICITE  ISOTROPE SIMO-MIEHE
# AVEC METALLURGIE  MATERIAU ZIRCALOY
#......................................................................

MA=LIRE_MAILLAGE( )

#
# Calcul Thermique
#

ZIRC=DEFI_MATERIAU(   
                   THER=_F(  RHO_CP = 2.0E-3, LAMBDA = 9.9999),
                   META_ZIRC=_F(
                               TDEQ = 809.,    K = 1.135E-2,   N = 2.187,
                               T1C = 831. ,    T2C=0.,
                               QSR_K = 14614., AC = 1.58E-4,  M = 4.7,
                               T1R=949.1, T2R=0., AR = -5.725,  BR = 0.05
                               )
                   )

CHMAT=AFFE_MATERIAU(    
                   MAILLAGE=MA,
                   AFFE=_F(  TOUT = 'OUI', MATER = ZIRC)
                   )

MOTH=AFFE_MODELE(    
                MAILLAGE=MA,
                AFFE=_F(  
                       TOUT = 'OUI',
                       MODELISATION = '3D',
                       PHENOMENE = 'THERMIQUE'
                       )
                )

TIMPO=DEFI_CONSTANTE(
                    VALE=600.
                    )

CHTH=AFFE_CHAR_THER_F(
                     MODELE=MOTH,
                     TEMP_IMPO=_F( 
                                 TOUT = 'OUI',
                                 TEMP = TIMPO
                                 )
                     )

LR8=DEFI_LIST_REEL(   
                  DEBUT=0.,
                  INTERVALLE=_F(  JUSQU_A = 3.0,  NOMBRE = 3)
                  )



TEMPE=THER_LINEAIRE(
                   MODELE=MOTH,
                   CHAM_MATER=CHMAT,
                   PARM_THETA=0.57,
                   EXCIT=_F(  CHARGE = CHTH),
                   INCREMENT=_F(  LIST_INST = LR8),
                   ETAT_INIT=_F(  VALE = 600.)
                   )
#
# Calcul Metallurgique
#
PHASINIT=CREA_CHAMP(
                   OPERATION='AFFE', TYPE_CHAM='CART_VAR2_R',
                   MAILLAGE=MA,
                   AFFE=_F(  
                          TOUT = 'OUI',
                          NOM_CMP = ('V1', 'V2', 'V3','V4'),
                          VALE = ( 1.0, 0.0, 20.,0.)
                          )
                   )
#
TEMPE=CALC_META(
               reuse=TEMPE,
               MODELE=MOTH,
               CHAM_MATER=CHMAT,
               RESULTAT=TEMPE,
               ETAT_INIT=_F(META_INIT_ELNO=PHASINIT),
               COMPORTEMENT=_F(
                              RELATION='ZIRC',
                              TOUT='OUI'
                              ),
               OPTION='META_ELNO'
               )
#
# Calcul Mecanique
#
MO=AFFE_MODELE(
               MAILLAGE=MA,                 
               AFFE=_F(
                      TOUT = 'OUI',
                      PHENOMENE = 'MECANIQUE',
                      MODELISATION = '3D' 
                      )
              )

FBM1=DEFI_CONSTANTE(  VALE=1930. )

AUS1=DEFI_CONSTANTE(  VALE=0. )

FBM2=DEFI_CONSTANTE(  VALE=181.    )

AUS2=DEFI_CONSTANTE(  VALE=0.    )

ALP1=DEFI_FONCTION(   NOM_PARA='TEMP',
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      VALE=( 0., 15.E-6,  900., 15.E-6, )
                  )

ALP2=DEFI_FONCTION(   NOM_PARA='TEMP',
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      VALE=( 0., 23.5E-6,  900., 23.5E-6, ))

FMEL=DEFI_FONCTION(      NOM_PARA='META',
                         PROL_DROITE='CONSTANT',
                         PROL_GAUCHE='CONSTANT',
                         VALE=( 0.,  0.,   1., 1., ))

YOUNG=DEFI_CONSTANTE( VALE=195000.)

NU=DEFI_CONSTANTE( VALE=0.3)

ZIRC2=DEFI_MATERIAU(
                     ELAS_META_FO=_F( E = YOUNG,
                              NU = NU,
                              F_ALPHA = ALP1,
                              C_ALPHA = ALP2,
                              TEMP_DEF_ALPHA=600.0,
                              PHASE_REFE = 'FROID',
                              EPSF_EPSC_TREF = 2.52E-3,
                              F1_SY = FBM2,
                              F2_SY = FBM2,
                              C_SY = AUS2,
                              SY_MELANGE = FMEL),
                     META_ECRO_LINE=_F(
                              F1_D_SIGM_EPSI = FBM1,
                              F2_D_SIGM_EPSI = FBM1,
                              C_D_SIGM_EPSI = AUS1)
                    )

CM=AFFE_MATERIAU(
                MAILLAGE=MA,
                AFFE=_F(
                TOUT = 'OUI',
                MATER = ZIRC2,),
                AFFE_VARC=(_F(TOUT='OUI',
                             EVOL=TEMPE,
                             NOM_VARC='M_ZIRC',
                             NOM_CHAM='META_ELNO'),
                           _F(TOUT='OUI',
                             EVOL=TEMPE,
                             NOM_VARC='TEMP',
                             NOM_CHAM='TEMP',
                             VALE_REF=600.),),

              )

SIGMA_F=DEFI_FONCTION(
              NOM_PARA='INST',
              PROL_DROITE='EXCLU',
              PROL_GAUCHE='EXCLU',
              VALE=(
                0.0,    0.0,
                1.0,    151.2,
                2.0,    257.2,
                3.0,    0.0,
                )
              )

TAU_F=DEFI_FONCTION(
              NOM_PARA='INST',
              PROL_DROITE='EXCLU',
              PROL_GAUCHE='EXCLU',
              VALE=(
                0.0,    0.0,
                1.0,    93.1,
                2.0,    33.1,
                3.0,    0.0,
                )
              )

TRACTION=AFFE_CHAR_MECA(
                MODELE=MO,
                FORCE_FACE=_F(   MAILLE = 'GAUCHE',
                                 FX = -1.)
              )

CISAIL=AFFE_CHAR_MECA(
                  MODELE=MO,
                  FORCE_FACE=(
                _F( MAILLE = 'GAUCHE',  FY = -1.),
                _F( MAILLE = 'DROITE',  FY = 1.),
                _F( MAILLE = 'HAUT',    FX = 1.),
                _F( MAILLE = 'BAS',     FX = -1.))
              )

LIAISON=AFFE_CHAR_MECA(

               MODELE=MO,DDL_IMPO=(

                _F( NOEUD = 'NO4',     DX = 0.,  DY = 0.),
                _F( NOEUD = 'NO8',     DX = 0.,  DY = 0.,  DZ = 0.),
                _F( NOEUD = 'NO2',     DX = 0.),
                _F( NOEUD = 'NO6',     DX = 0.))
              )

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=(_F(JUSQU_A=0.1,
                                     NOMBRE=1,),
                                  _F(JUSQU_A=0.9,
                                     NOMBRE=8,),
                                  _F(JUSQU_A=1.0,
                                     NOMBRE=1,),
                                  _F(JUSQU_A=2.0,
                                     NOMBRE=40,),
                                  _F(JUSQU_A=3.0,
                                     NOMBRE=1,),),);

U=STAT_NON_LINE(
                MODELE=MO,
                CHAM_MATER=CM,
                EXCIT=(
                      _F(CHARGE = LIAISON), 
                      _F(CHARGE = TRACTION,
                         FONC_MULT = SIGMA_F,
                        ), 
                      _F(CHARGE = CISAIL,
                         FONC_MULT = TAU_F,)
                      ),
                COMPORTEMENT=_F(
                               RELATION = 'META_P_IL',
                               RELATION_KIT = ('ZIRC',),
                DEFORMATION = 'SIMO_MIEHE'
                               ),
                INCREMENT=_F(
                            LIST_INST = L_INST
                            ),
                NEWTON=_F(
                         MATRICE = 'TANGENTE',
                         REAC_ITER = 1
                         ),
                CONVERGENCE=_F(
                              RESI_GLOB_MAXI = 1.E-6,
                              ITER_GLOB_MAXI = 50
                              ),
                RECH_LINEAIRE=_F(
                                ITER_LINE_MAXI = 5
                                )
              )

U=CALC_CHAMP(reuse=U,CONTRAINTE=('SIGM_ELNO'),VARI_INTERNE=('VARI_ELNO'),RESULTAT=U)

U=CALC_CHAMP(reuse=U,RESULTAT=U,DEFORMATION=('EPSI_ELNO'))
#
TEST_RESU(RESU=(_F(INST=1.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXX',
                   VALE_CALC=1.48566127010430E+02,
                   VALE_REFE=1.48566127010381E+02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=1.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXY',
                   VALE_CALC=9.46669933180737E+01,
                   VALE_REFE=9.46669933180748E+01,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=1.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXX',
                   VALE_CALC=1.54684756460053E-02,
                   VALE_REFE=1.54684756460052E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=1.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPYY',
                   VALE_CALC=-7.68174092805439E-03,
                   VALE_REFE=-7.68174092805423E-03,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=1.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXY',
                   VALE_CALC=1.41972994126721E-02,
                   VALE_REFE=1.41972994126723E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=2.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXX',
                   VALE_CALC=2.48713357259202E+02,
                   VALE_REFE=2.48713357259147E+02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=2.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXY',
                   VALE_CALC=2.75330374295990E+01,
                   VALE_REFE=2.75330374295997E+01,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=2.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXX',
                   VALE_CALC=3.85022874703871E-02,
                   VALE_REFE=3.85022874703870E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=2.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPYY',
                   VALE_CALC=-1.95587811986802E-02,
                   VALE_REFE=-1.95587811986799E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=2.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXY',
                   VALE_CALC=2.10883631485520E-02,
                   VALE_REFE=2.10883631485519E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=3.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXX',
                   VALE_CALC=1.40965168603165E+00,
                   VALE_REFE=1.40965168609997E+00,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=3.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='SIXY',
                   VALE_CALC=7.18644752342478E-01,
                   VALE_REFE=7.18644752329577E-01,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=3.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXX',
                   VALE_CALC=3.71734666739890E-02,
                   VALE_REFE=3.71734666739888E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=3.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPYY',
                   VALE_CALC=-1.91595912068506E-02,
                   VALE_REFE=-1.91595912068503E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                _F(INST=3.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSI_ELNO',
                   NOEUD='NO2',
                   NOM_CMP='EPXY',
                   VALE_CALC=2.09115907367270E-02,
                   VALE_REFE=2.09115907367268E-02,
                   REFERENCE='AUTRE_ASTER',
                   PRECISION=1.E-6,
                   MAILLE='CUBE',),
                ),
          )
FIN()
#--------------------------------------------------------------
#
# Solution de reference : Calcul Mecanique uniquement
#
#ZIRC3=DEFI_MATERIAU(ELAS=_F(E=195000.,
#                            NU=0.3,),
#                    ECRO_LINE=_F(D_SIGM_EPSI=1930.,
#                                 SY=181.,),
#                    );
#CM2=AFFE_MATERIAU(MAILLAGE=MA,
#                 AFFE=_F(TOUT='OUI',
#                         MATER=ZIRC3,),);
#
#U2=STAT_NON_LINE(
#                MODELE=MO,
#                CHAM_MATER=CM2,
#                EXCIT=(_F(CHARGE=LIAISON,),
#                       _F(CHARGE=TRACTION,
#                          FONC_MULT=SIGMA_F,),
#                       _F(CHARGE=CISAIL,
#                          FONC_MULT=TAU_F,),
#                      ),
#                COMPORTEMENT=_F(
#                             RELATION='VMIS_ISOT_LINE',
#                DEFORMATION = 'SIMO_MIEHE'
#                              ),
#                INCREMENT=_F(LIST_INST=L_INST,),
#                NEWTON=_F(MATRICE='TANGENTE',
#                          REAC_ITER=1,),
#                CONVERGENCE=_F(
#                              RESI_GLOB_MAXI = 1.E-6,
#                              ITER_GLOB_MAXI = 50
#                              ),
#                RECH_LINEAIRE=_F(
#                                ITER_LINE_MAXI = 5
#                                )
#                )
#U2=CALC_CHAMP(reuse=U2,CONTRAINTE=('SIGM_ELNO'),VARI_INTERNE=('VARI_ELNO'),RESULTAT=U2)
#
#
#U2=CALC_CHAMP(reuse=U2,RESULTAT=U2,DEFORMATION=('EPSI_ELNO'))
