# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
##############################################################################
#                                                                            #
# PLAQUE RECTANGULAIRE EN APPPUI  SIMPLE SUR TROIS BORD ET LIBRE SUR         #
# SUR LE DERNIER BORD, AVEC MASSE ET RAIDEUR LOCALISEES, UNE IMPULSION COMME #
# CHARGEMENT EXTERIEUR ET UNE BUTEE ELASTIQUE COMME NONLINEARITE LOCALISEE   #
#                                                                            #
##############################################################################

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='NON'))
# SDVERI='NON' car la verification est trop couteuse en CPU

##############################################################################
#                                                                            #
# CONSTRUCTION DU MODELE MOYEN ELEMENTS FINIS PUIS REDUCTION SUR LES MODES   #
# ELASTIQUES AVANT DE COMMENCER LA SIMULATION NUMERIQUE DE MONTE CARLO       #
#                                                                            #
##############################################################################

# MODELE MECANIQUE ET CALCUL DE SES MODES
M=4.
K=2.388E+7
MA=LIRE_MAILLAGE(FORMAT='MED', )
MA=DEFI_GROUP( reuse=MA,
               MAILLAGE=MA,
               CREA_GROUP_MA=( _F(  NOM = 'TOUT', TOUT = 'OUI'),
                               _F(  NOM = 'MASSE', MAILLE ='P02'),
                               _F(  NOM = 'RAIDEUR', MAILLE ='P01'),
                               _F(  NOM = 'DISCRET',
                                    UNION=('RAIDEUR','MASSE')),
                               _F(  NOM=  'PLAQUE',
                                    DIFFE = ('TOUT','DISCRET'))
                             )
              )
MAT=DEFI_MATERIAU( ELAS=_F( E   = 2.1E+11,
                            NU  = 0.29,
                            RHO = 7800.)
                           )
CHMAT=AFFE_MATERIAU( MAILLAGE=MA,
                     AFFE=_F( GROUP_MA= 'PLAQUE',
                              MATER = MAT
                             )
                    )
MO=AFFE_MODELE( MAILLAGE=MA,
                AFFE=( _F( GROUP_MA = 'PLAQUE',
                           PHENOMENE = 'MECANIQUE',
                           MODELISATION = 'DKT'),
                       _F( GROUP_MA = 'DISCRET',
                           PHENOMENE = 'MECANIQUE',
                           MODELISATION = 'DIS_T'),)
               )
CH=AFFE_CHAR_CINE( MODELE=MO,
                   MECA_IMPO=( _F( TOUT='OUI',
                                   DX=0.,
                                   DY=0.,
                                   DRZ=0.
                                 ),
                              _F(  GROUP_NO='C1',
                                   DZ=0.,
                                   DRX=0.
                                 ),
                              _F(  GROUP_NO='C2',
                                   DZ=0.,
                                   DRX=0.
                                 ),
                              _F(  GROUP_NO='C3',
                                   DZ=0.,
                                   DRY=0.
                                 ),
                           )
                  )
CA=AFFE_CARA_ELEM( MODELE=MO,
                   COQUE=_F( GROUP_MA = 'PLAQUE',
                               EPAIS = 4.0E-4),
                   DISCRET=( _F( GROUP_MA = 'RAIDEUR',
                                 CARA = 'K_T_D_N',
                                 VALE = ( K, K, K, )),
                             _F( GROUP_MA = 'RAIDEUR',
                                 CARA = 'M_T_D_N',
                                 VALE = ( 0., )),
                             _F( GROUP_MA = 'MASSE',
                                 CARA = 'M_T_D_N',
                                 VALE = M))
                  )
RIGIEL= CALC_MATR_ELEM(
                       OPTION='RIGI_MECA',
                       MODELE=MO,
                       CARA_ELEM=CA,
                       CHAM_MATER=CHMAT
                       )
MASSEL= CALC_MATR_ELEM(
                       OPTION='MASS_MECA',
                       MODELE=MO,
                       CARA_ELEM=CA,
                       CHAM_MATER=CHMAT
                       )
NUMDDL=NUME_DDL( MATR_RIGI=RIGIEL )
MATR=ASSE_MATRICE(MATR_ELEM=RIGIEL,
                  NUME_DDL=NUMDDL,
                  CHAR_CINE=CH)
MATM=ASSE_MATRICE(MATR_ELEM=MASSEL,
                  NUME_DDL=NUMDDL,
                  CHAR_CINE=CH)
MODE200=CALC_MODES(MATR_RIGI=MATR,
                   VERI_MODE=_F(SEUIL=1.E-5,
                                ),
                   OPTION='PLUS_PETITE',
                   CALC_FREQ=_F(NMAX_FREQ=5,
                                ),
                   MATR_MASS=MATM,
                   )

# CONTRUCTION DU CHARGEMENT (IMPULSION)
OMEGA=2*pi*20
DELTAW=2*OMEGA
T1= 2*pi/DELTAW
amred=0.04
Omin=4*pi
Omax=200*pi
a= 2*amred*Omax*Omin/(Omax+Omin)
b=2*amred/(Omax+Omin)
IMPULS= FORMULE( NOM_PARA='INST',VALE='''1./(DELTAW*(INST-T1))
                 * (sin((OMEGA+DELTAW/2.)*(INST-T1))
                 - sin((OMEGA-DELTAW/2.)*(INST-T1))) ''' )
LIINST= DEFI_LIST_REEL( DEBUT = 0.,
                        INTERVALLE = _F( JUSQU_A = 0.05,
                                         PAS = 0.00005),
                      )
IMPULF= CALC_FONC_INTERP( FONCTION = IMPULS,
                          LIST_PARA= LIINST,
NOM_PARA='INST',
                          NOM_RESU='IMPULSE',
                          PROL_GAUCHE='CONSTANT',
                          PROL_DROITE='CONSTANT',
#                          INTERPOL='INT',
                          INTERPOL='LIN',
                          TITRE='FONCTION IMPULSION'
                         )
CHARGE=AFFE_CHAR_MECA( MODELE=MO,
                         FORCE_NODALE=_F(
                                          GROUP_NO= 'F1',
                                          FZ = 1
                                         )
                        )
VECTEL=CALC_VECT_ELEM( CHARGE=CHARGE,
                       OPTION='CHAR_MECA'
                      )
MATD=COMB_MATR_ASSE( COMB_R=( _F( MATR_ASSE=MATM,
                                  COEF_R = a ),
                              _F( MATR_ASSE=MATR,
                                  COEF_R = b ),
                             )
                    )
VECTASS=ASSE_VECTEUR(VECT_ELEM=VECTEL,NUME_DDL=NUMDDL)

# CONSTRUCTION DU SYSTEME REDUIT
# ( LE STOCKAGE DU SYSTEME REDUIT DOIT ETRE PLEIN )
NUM100=NUME_DDL_GENE(  BASE=MODE200,
                       STOCKAGE='PLEIN',
                       NB_VECT=5 )
IM_G100=PROJ_VECT_BASE(   BASE=MODE200,  VECT_ASSE=VECTASS,
                          NUME_DDL_GENE=NUM100,
                          TYPE_VECT='FORC')
MA_G100=PROJ_MATR_BASE(     BASE=MODE200,
                            NUME_DDL_GENE=NUM100,
                            MATR_ASSE=MATM
                         )
RI_G100=PROJ_MATR_BASE(    BASE=MODE200,
                          NUME_DDL_GENE=NUM100,
                          MATR_ASSE=MATR
                         )

# CONSTRUCTION DE LA MATRICE DE DISSIPATION CORRESPONDANT
# A UN AMORTISSEMENT REDUIT DE 0.04 CONSTANT POUR TOUS LES MODES
AM_G100=PROJ_MATR_BASE(   BASE=MODE200,
                          NUME_DDL_GENE=NUM100,
                          MATR_ASSE=MATD
                         )
PLANZ=DEFI_OBSTACLE(   TYPE='PLAN_Z' )
LFREQ=DEFI_LIST_REEL(DEBUT=0.5,
                          INTERVALLE=_F(JUSQU_A=100.,
                                        PAS=0.5)
                          )
#############################################################
#                                                           #
# DEBUT DE LA  SIMULATION NUMERIQUE DE MONTE CARLO          #
#                                                           #
#############################################################

# COEFFICIENTS DE VARIATION DES MATRICES ALEATOIRES
DELTA_M = 0.2
DELTA_K = 0.2
DELTA_D = 0.2

ns=5
# 5 REALISATIONS DES PROCESSUS STOCHASTIQUES ( 5 TIRAGES)

for k in range(1,ns+1):

# GENERATION DES REALISATIONS ALEATOIRE DES MATRICES GENERALISEES DE MASSE,
# DE RAIDEUR ET D AMORTISSEMENT

    MATM100=GENE_MATR_ALEA(MATR_MOYEN=MA_G100,
                           COEF_VAR=DELTA_M,
                           INIT_ALEA=1000,
                           )
    MATK100=GENE_MATR_ALEA(MATR_MOYEN=RI_G100,
                           COEF_VAR=DELTA_K)

    MATD100=GENE_MATR_ALEA(MATR_MOYEN=AM_G100,
                           COEF_VAR=DELTA_D)

# GENERATION D UNE REALISATION ALEATOIRE DE LA RAIDEUR DE CHOC POUR TROIS LOI
# DISPO DANS GENE_VARI_ALEA
    KN =GENE_VARI_ALEA(TYPE='GAMMA', BORNE_INF=0.,
                       VALE_MOY=25000., COEF_VAR=0.01)

    KN1 =GENE_VARI_ALEA(TYPE='EXPONENTIELLE', BORNE_INF=0.,
                       VALE_MOY=25000.,)

    KN2 =GENE_VARI_ALEA(TYPE='EXP_TRONQUEE', BORNE_INF=0.,
                       BORNE_SUP=50000., VALE_MOY=25000.)


# GENERATION D UNE REALISATION ALEATOIRE DU PROCESSUS STOCHASTIQUE (RIGI_NOR: KN)

    DM100=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                            SCHEMA_TEMPS=_F(SCHEMA='DIFF_CENTRE',),
                            MATR_MASS=MATM100,
                            MATR_RIGI=MATK100,
                            MATR_AMOR=MATD100,
                            INCREMENT=_F( INST_INIT = 0.,
                                          INST_FIN = 4.,
                                          PAS = 0.00005),
                            EXCIT=_F( VECT_ASSE_GENE = IM_G100,
                                      FONC_MULT = IMPULF
                                    ),
                            COMPORTEMENT=_F(RELATION='DIS_CHOC',
                                     NOEUD_1 = 'N3201',
                                     OBSTACLE = PLANZ,
                                     ORIG_OBST = (0., 0., 0.,),
                                     NORM_OBST = (1., 0., 0.,),
                                     JEU = 0.002,
                                     RIGI_NOR = KN(),
                                     RIGI_TAN = 0.,
                                     FROTTEMENT='COULOMB',
                                     COULOMB = 0.),
                           )

# GENERATION D UNE REALISATION ALEATOIRE DU PROCESSUS STOCHASTIQUE (RIGI_NOR: KN1)

    DM101=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                            SCHEMA_TEMPS=_F(SCHEMA='DIFF_CENTRE',),
                            MATR_MASS=MATM100,
                            MATR_RIGI=MATK100,
                            MATR_AMOR=MATD100,
                            INCREMENT=_F( INST_INIT = 0.,
                                          INST_FIN = 4.,
                                          PAS = 0.00005),
                            EXCIT=_F( VECT_ASSE_GENE = IM_G100,
                                      FONC_MULT = IMPULF
                                    ),
                            COMPORTEMENT=_F(RELATION='DIS_CHOC',
                                     NOEUD_1 = 'N3201',
                                     OBSTACLE = PLANZ,
                                     ORIG_OBST = (0., 0., 0.,),
                                     NORM_OBST = (1., 0., 0.,),
                                     JEU = 0.002,
                                     RIGI_NOR = KN1(),
                                     RIGI_TAN = 0.,
                                     FROTTEMENT='COULOMB',
                                     COULOMB = 0.),
                                )

# GENERATION D UNE REALISATION ALEATOIRE DU PROCESSUS STOCHASTIQUE (RIGI_NOR: KN1)

    DM102=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                            SCHEMA_TEMPS=_F(SCHEMA='DIFF_CENTRE',),
                            MATR_MASS=MATM100,
                            MATR_RIGI=MATK100,
                            MATR_AMOR=MATD100,
                            INCREMENT=_F( INST_INIT = 0.,
                                          INST_FIN = 4.,
                                          PAS = 0.00005),
                            EXCIT=_F( VECT_ASSE_GENE = IM_G100,
                                      FONC_MULT = IMPULF
                                    ),
                            COMPORTEMENT=_F(RELATION='DIS_CHOC',
                                     NOEUD_1 = 'N3201',
                                     OBSTACLE = PLANZ,
                                     ORIG_OBST = (0., 0., 0.,),
                                     NORM_OBST = (1., 0., 0.,),
                                     JEU = 0.002,
                                     RIGI_NOR = KN2(),
                                     RIGI_TAN = 0.,
                                     FROTTEMENT='COULOMB',
                                     COULOMB = 0.),
                                )
# -----------------------------------------------------
# ----------------- POST_TRAITEMENT ------------------
# -----------------------------------------------------

# -----------------------------------------------------------------------
#    CAS LOI GAMMA
# -----------------------------------------------------------------------

    ACC3201=RECU_FONCTION(RESU_GENE = DM100,
                          NOM_CHAM='ACCE',
                          NOM_CMP='DZ',
                          NOEUD='N3201')
    SPO3201= CALC_FONCTION(SPEC_OSCI=_F(
                                      NATURE='ACCE',
                                      FONCTION=ACC3201,
                                      METHODE='NIGAM',
                                      NORME=9.81,
                                      LIST_FREQ=LFREQ,
                                      AMOR_REDUIT=(0.001)
                                      ),
                           INTERPOL='LOG',
                          )


# CONSTRUCTION DES ESTIMATIONS STATISTIQUES
    if k==1:
    #  ON INITIALISE LES ESTIMATEURS CAS LOI GAMMA
       UP_G=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                               )
       INF_G=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                                )
       M2_G=  CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                             EXPOSANT=2),)
       M1_G=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                                )

    else:
    #  ON CALCULE LES NOUVEAUX ESTIMATEURS EN PRENANT EN COMPTE LE
    #  DERNIER TIRAGE. ON LES STOCKE DANS DES VARIABLES INTERMEDIAIRES
    #  (CAR PAS DE CONCEPT REENTRANT)
       UP1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(UP_G,SPO3201),
                                         CRITERE='SUP'
                                         ),
                              )
       INF1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(INF_G,SPO3201),
                                         CRITERE='INF'
                                         ),
                              )
       M2 = CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                       EXPOSANT=2), )
       M2_2 =  CALC_FONCTION( COMB=(_F(FONCTION=M2,COEF=1.),
                                    _F(FONCTION=M2_G,COEF=1.))
                             )
       M1_2 =  CALC_FONCTION( COMB=(_F(FONCTION=SPO3201,COEF=1.),
                                    _F(FONCTION=M1_G,COEF=1.))
                             )
       DETRUIRE(CONCEPT=_F(NOM=(UP_G,INF_G,M1_G ,M2_G,M2)),INFO=1)

   # STOCKAGE DES ESTIMATEURS ET DESTRUCTION DES VARIABLES INTERMEDIAIRES
       UP_G=  CALC_FONCTION(COMB=_F(FONCTION=UP1,
                                        COEF=1.),
                               )
       INF_G= CALC_FONCTION(COMB=_F(FONCTION=INF1,
                                        COEF=1.),
                               )
       M1_G=  CALC_FONCTION(COMB=_F(FONCTION=M1_2,
                                        COEF=1.),
                               )
       M2_G=  CALC_FONCTION(COMB=_F(FONCTION=M2_2,
                                        COEF=1.),
                               )
       DETRUIRE(CONCEPT=_F(NOM=(M2_2,M1_2,INF1,UP1)),INFO=1)

    DETRUIRE(CONCEPT=_F(NOM=(DM100, ACC3201, SPO3201, MATM100, MATD100, MATK100, KN)),INFO=1)



# -----------------------------------------------------------------------
#    CAS LOI EXP
# -----------------------------------------------------------------------
    ACC3201=RECU_FONCTION(RESU_GENE = DM101,
                          NOM_CHAM='ACCE',
                          NOM_CMP='DZ',
                          NOEUD='N3201')
    SPO3201= CALC_FONCTION(SPEC_OSCI=_F(
                                      NATURE='ACCE',
                                      FONCTION=ACC3201,
                                      METHODE='NIGAM',
                                      NORME=9.81,
                                      LIST_FREQ=LFREQ,
                                      AMOR_REDUIT=(0.001)
                                      ),
                           INTERPOL='LOG',
                          )

    if k==1:
    #  ON INITIALISE LES ESTIMATEURS  CAS LOI EXP
       UP_E=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                               )
       INF_E=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                                )
       M2_E=  CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                             EXPOSANT=2),)
       M1_E=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                             )

    else:
    #  ON CALCULE LES NOUVEAUX ESTIMATEURS EN PRENANT EN COMPTE LE
    #  DERNIER TIRAGE. ON LES STOCKE DANS DES VARIABLES INTERMEDIAIRES
    #  (CAR PAS DE CONCEPT REENTRANT)
       UP1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(UP_E,SPO3201),
                                         CRITERE='SUP'
                                         ),
                              )
       INF1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(INF_E,SPO3201),
                                         CRITERE='INF'
                                         ),
                              )
       M2 = CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                       EXPOSANT=2), )
       M2_2 =  CALC_FONCTION( COMB=(_F(FONCTION=M2,COEF=1.),
                                    _F(FONCTION=M2_E,COEF=1.))
                             )
       M1_2 =  CALC_FONCTION( COMB=(_F(FONCTION=SPO3201,COEF=1.),
                                    _F(FONCTION=M1_E,COEF=1.))
                             )
       DETRUIRE(CONCEPT=_F(NOM=(UP_E,INF_E,M1_E ,M2_E,M2)),INFO=1)

   # STOCKAGE DES ESTIMATEURS ET DESTRUCTION DES VARIABLES INTERMEDIAIRES
       UP_E=  CALC_FONCTION(COMB=_F(FONCTION=UP1,
                                        COEF=1.),
                               )
       INF_E= CALC_FONCTION(COMB=_F(FONCTION=INF1,
                                        COEF=1.),
                               )
       M1_E=  CALC_FONCTION(COMB=_F(FONCTION=M1_2,
                                        COEF=1.),
                               )
       M2_E=  CALC_FONCTION(COMB=_F(FONCTION=M2_2,
                                        COEF=1.),
                               )
       DETRUIRE(CONCEPT=_F(NOM=(M2_2,M1_2,INF1,UP1),),INFO=1)




    DETRUIRE(CONCEPT=_F(NOM=(DM101, ACC3201, SPO3201, KN1)),INFO=1)



# -----------------------------------------------------------------------
#    CAS LOI EXP TRONQUEE
# -----------------------------------------------------------------------
    ACC3201=RECU_FONCTION(RESU_GENE = DM102,
                          NOM_CHAM='ACCE',
                          NOM_CMP='DZ',
                          NOEUD='N3201')
    SPO3201= CALC_FONCTION(SPEC_OSCI=_F(
                                      NATURE='ACCE',
                                      FONCTION=ACC3201,
                                      METHODE='NIGAM',
                                      NORME=9.81,
                                      LIST_FREQ=LFREQ,
                                      AMOR_REDUIT=(0.001)
                                      ),
                           INTERPOL='LOG',
                          )


    if k==1:
    #  ON INITIALISE LES ESTIMATEURS  CAS LOI EXP  TRONQUEE
       UP_ET=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                               )
       INF_ET=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                                )
       M2_ET=  CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                             EXPOSANT=2),)
       M1_ET=  CALC_FONCTION(COMB=_F(FONCTION=SPO3201,
                                        COEF=1.),
                               )
    else:
    #  ON CALCULE LES NOUVEAUX ESTIMATEURS EN PRENANT EN COMPTE LE
    #  DERNIER TIRAGE. ON LES STOCKE DANS DES VARIABLES INTERMEDIAIRES
    #  (CAR PAS DE CONCEPT REENTRANT)
       UP1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(UP_ET,SPO3201),
                                         CRITERE='SUP'
                                         ),
                              )
       INF1=CALC_FONCTION(ENVELOPPE=_F(
                                         FONCTION=(INF_ET,SPO3201),
                                         CRITERE='INF'
                                         ),
                              )
       M2 = CALC_FONCTION(PUISSANCE=_F(FONCTION=SPO3201,
                                       EXPOSANT=2), )
       M2_2 =  CALC_FONCTION( COMB=(_F(FONCTION=M2,COEF=1.),
                                    _F(FONCTION=M2_ET,COEF=1.))
                             )
       M1_2 =  CALC_FONCTION( COMB=(_F(FONCTION=SPO3201,COEF=1.),
                                    _F(FONCTION=M1_ET,COEF=1.))
                             )
       DETRUIRE(CONCEPT=_F(NOM=(UP_ET,INF_ET,M1_ET ,M2_ET,M2)),INFO=1)

   # STOCKAGE DES ESTIMATEURS ET DESTRUCTION DES VARIABLES INTERMEDIAIRES
       UP_ET=  CALC_FONCTION(COMB=_F(FONCTION=UP1,
                                        COEF=1.),
                               )
       INF_ET= CALC_FONCTION(COMB=_F(FONCTION=INF1,
                                        COEF=1.),
                               )
       M1_ET=  CALC_FONCTION(COMB=_F(FONCTION=M1_2,
                                        COEF=1.),
                               )
       M2_ET=  CALC_FONCTION(COMB=_F(FONCTION=M2_2,
                                        COEF=1.),
                               )

       DETRUIRE(CONCEPT=_F(NOM=(M2_2,M1_2,INF1,UP1),),INFO=1)



    DETRUIRE(CONCEPT=_F(NOM=(DM102,ACC3201,SPO3201, KN2),),INFO=1)


#-----------------------------------------------------------
# FIN BOUCLE PYTHON
#--------------------------------------------------------------




# CALCUL DES ESTIMATEURS FINAUX

M1GAM=  CALC_FONCTION(COMB=_F(   FONCTION=M1_G, COEF=1./ns),)
M2GAM=  CALC_FONCTION(COMB=_F(   FONCTION=M2_G, COEF=1./ns),)
NGAM=  INFO_FONCTION(NORME=_F(FONCTION=M1GAM),)


M1EXP=  CALC_FONCTION(COMB=_F(   FONCTION=M1_E, COEF=1./ns),)
M2EXP=  CALC_FONCTION(COMB=_F(   FONCTION=M2_E, COEF=1./ns),)
NEXP=  INFO_FONCTION(NORME=_F(FONCTION=M1EXP),)

M1EXT=  CALC_FONCTION(COMB=_F(   FONCTION=M1_ET, COEF=1./ns),)
M2EXT=  CALC_FONCTION(COMB=_F(   FONCTION=M2_ET, COEF=1./ns),)
NEXT=  INFO_FONCTION(NORME=_F(FONCTION=M1EXT),)



# FIN DE LA SIMULATION NUMERIQUE DE MONTE CARLO ET DES ESTIMATIONS STATISTIQUES
# DU PROCESSUS STOCHASTIQUE

#################################
#                               #
#     TESTS DE VALIDATION       #
#                               #
#################################
# PAS DE REFERENCE ANALYTIQUE => TESTS DE NON REGRESSION
# LA VALIDATION A ETE EFFECTUEE PAR REFERENCE BIBLIO (CF. DOC.)

TEST_FONCTION(VALEUR=(_F(VALE_CALC=208.9138, TOLE_MACHINE=1.E-05,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M1GAM,
                         ),
                      _F(VALE_CALC=44962.95, TOLE_MACHINE=1.2E-05,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M2GAM,
                         ),
                      _F(VALE_CALC=146.1142,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=INF_G,
                         ),
                      _F(VALE_CALC=245.6999,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=UP_G,
                         ),
                      ),
              )

TEST_TABLE(
           VALE_CALC=2341.90764703, TOLE_MACHINE=5.E-03,
           NOM_PARA='NORME',
           TABLE=NGAM,
           )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=303.9699,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M1EXP,
                         ),
                      _F(VALE_CALC=1.082249E+05,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M2EXP,
                         ),
                      _F(VALE_CALC=160.0512,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=INF_E,
                         ),
                      _F(VALE_CALC=536.1340,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=UP_E,
                         ),
                      ),
              )

TEST_TABLE(
           VALE_CALC=2141.8276166053,
           NOM_PARA='NORME',
           TABLE=NEXP,
           )

TEST_FONCTION(VALEUR=(_F(VALE_CALC=313.4957,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M1EXT,
                         ),
                      _F(VALE_CALC=99803.17,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=M2EXT,
                         ),
                      _F(VALE_CALC=265.4422,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=INF_ET,
                         ),
                      _F(VALE_CALC=366.7610,
                         VALE_PARA=(1.E-3, 50.0),
                         NOM_PARA=('AMOR', 'FREQ'),
                         FONCTION=UP_ET,
                         ),
                      ),
              )

TEST_TABLE(
           VALE_CALC=2178.1436138352,
           TOLE_MACHINE=1.0E-05,      #TODO TOLE_MACHINE variable entre les machines
           NOM_PARA='NORME',
           TABLE=NEXT,
           )

FIN()
