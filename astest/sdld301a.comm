# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))
#
MAILLAG0=LIRE_MAILLAGE(  )
#

MAILLAGE=CREA_MAILLAGE(MAILLAGE=MAILLAG0,
    CREA_POI1=(
        _F(NOM_GROUP_MA='MASSE',   GROUP_NO = 'MASSE', ),
    ),
)

MODELE=AFFE_MODELE(    MAILLAGE=MAILLAGE,AFFE=(

                                  _F(  GROUP_MA = ( 'RESK', 'RES2K',),
                                    PHENOMENE = 'MECANIQUE',
                                    MODELISATION = 'DIS_T'),
                                  _F(  GROUP_MA = ( 'MASSE', ),
                                    PHENOMENE = 'MECANIQUE',
                                    MODELISATION = 'DIS_T'))
                                   )

#
CARA=AFFE_CARA_ELEM(     MODELE=MODELE,DISCRET=(
                            _F(  GROUP_MA = 'RESK',
                                      CARA = 'K_T_D_L',
                                      VALE = ( 1.E5,  1., 1., )),
                            _F(  GROUP_MA = 'RESK',
                                      CARA = 'M_T_L',
                                      VALE = ( 0.,  0., 0., 0.,  0., 0., 0.,  0., 0.,
                                      0.,  0., 0., 0.,  0., 0., 0.,  0., 0., 0.,  0., 0., )),
                            _F(  GROUP_MA = 'RES2K',
                                      CARA = 'K_T_D_L',
                                      VALE = ( 2.E5,  1., 1., )),
                            _F(  GROUP_MA = 'RES2K',
                                      CARA = 'M_T_L',
                                      VALE = ( 0.,  0., 0., 0.,  0., 0., 0.,  0., 0.,
                                      0.,  0., 0., 0.,  0., 0., 0.,  0., 0., 0.,  0., 0., )),
                            _F(  GROUP_MA = 'MASSE',
                                      CARA = 'M_T_D_N',
                                      VALE = ( 2533., )))
                        )

#

MAT=DEFI_MATERIAU(     ELAS=_F(  E = 1.6E+11,
                                       RHO = 1.3E+04,
                                       NU = 0.3)
                           )

#

CHAMPMAT=AFFE_MATERIAU(    MAILLAGE=MAILLAGE,
                                   AFFE=_F(  TOUT = 'OUI',
                             MATER = MAT)
                           )

#

COND_LIM=AFFE_CHAR_MECA(     MODELE=MODELE,DDL_IMPO=(
                               _F(  NOEUD = ('P1', 'P4',),
                                          DX = 0.,
                                          DY = 0.,
                                          DZ = 0.),
                                        _F(  GROUP_NO = 'MASSE',
                                          DY = 0.,
                                          DZ = 0.))
                            )

#

RIGIELEM=CALC_MATR_ELEM(      MODELE=MODELE,
                                 OPTION='RIGI_MECA',
                                 CHARGE=COND_LIM,
                              CARA_ELEM=CARA
                           )

#

MASSELEM=CALC_MATR_ELEM(      MODELE=MODELE,
                                 OPTION='MASS_MECA',
                                 CHARGE=COND_LIM,
                              CARA_ELEM=CARA
                           )

#

NUMEROTA=NUME_DDL(        MATR_RIGI=RIGIELEM  )

#

MATRRIGI=ASSE_MATRICE(  MATR_ELEM=RIGIELEM,  NUME_DDL=NUMEROTA  )

MATRMASS=ASSE_MATRICE(  MATR_ELEM=MASSELEM,  NUME_DDL=NUMEROTA  )

#

MAS=POST_ELEM(         MODELE=MODELE,
                        CARA_ELEM=CARA,
                      MASS_INER=_F(  TOUT = 'OUI')
                  )

#

MODES=CALC_MODES(MATR_RIGI=MATRRIGI,
                 CALC_FREQ=_F(NMAX_FREQ=2,
                              ),
                 MATR_MASS=MATRMASS,
                 SOLVEUR_MODAL=_F(METHODE='SORENSEN',
                                  ),
                 )


#
MODES=NORM_MODE(reuse=MODES,
                          MODE=MODES,
                         NORME='TRAN',
                  )

#
MODES=CALC_CHAMP(reuse=MODES,RESULTAT=MODES,CONTRAINTE=('SIEF_ELGA','EFGE_ELNO'))


MODES=CALC_CHAMP(  reuse=MODES,
                        RESULTAT=MODES,
                          FORCE='FORC_NODA'
                  )

MODES=CALC_CHAMP(  reuse=MODES,
                        RESULTAT=MODES,
                          FORCE='REAC_NODA'
                  )

#
TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODES,
                   VALE_CALC=1.000005841,
                   VALE_REFE=1.0,),
                _F(NUME_ORDRE=2,
                   PARA='FREQ',
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODES,
                   VALE_CALC=2.236081039,
                   VALE_REFE=2.2360000000000002,),
                ),
          )

#
#-----------------------------------------------------------------------
#
# CALCUL DES MODES STATIQUES POUR L'ENTRAINEMENT
#
#-----------------------------------------------------------------------
#

MODE_STA=MODE_STATIQUE(   MATR_RIGI=MATRRIGI,
                              MATR_MASS=MATRMASS,
                              MODE_STAT=_F(  NOEUD = ( 'P1', 'P4', ),
                                          AVEC_CMP = ( 'DX', ))
                           )

#
MODE_STA=CALC_CHAMP(reuse=MODE_STA,RESULTAT=MODE_STA,CONTRAINTE=('SIEF_ELGA','EFGE_ELNO'))


MODE_STA=CALC_CHAMP(  reuse=MODE_STA,
                           RESULTAT=MODE_STA,
                             FORCE='FORC_NODA'
                     )

MODE_STA=CALC_CHAMP(  reuse=MODE_STA,
                           RESULTAT=MODE_STA,
                             FORCE='REAC_NODA'
                     )

#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_STA,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC=0.600000000,
                   VALE_REFE=0.59999999999999998,
                   NOEUD_CMP=('P1', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_STA,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC=0.400000000,
                   VALE_REFE=0.40000000000000002,
                   NOEUD_CMP=('P1', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_STA,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC=0.400000000,
                   VALE_REFE=0.40000000000000002,
                   NOEUD_CMP=('P4', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_STA,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC=0.600000000,
                   VALE_REFE=0.59999999999999998,
                   NOEUD_CMP=('P4', 'DX'),),
                ),
          )

#
#
#-----------------------------------------------------------------------
#
# CALCUL DES MODES STATIQUES POUR LA CORRECTION STATIQUE
#
#-----------------------------------------------------------------------
#

MODE_CO2=MODE_STATIQUE(   MATR_RIGI=MATRRIGI,
                          MATR_MASS=MATRMASS,
                          PSEUDO_MODE=_F(  NOEUD = ( 'P1', 'P4', ),
                                           AVEC_CMP = ( 'DX', ))
                          )

#
MODE_CO2=CALC_CHAMP(reuse=MODE_CO2,RESULTAT=MODE_CO2,CONTRAINTE=('SIEF_ELGA','EFGE_ELNO'))


MODE_CO2=CALC_CHAMP(  reuse=MODE_CO2,
                           RESULTAT=MODE_CO2,
                             FORCE='FORC_NODA'
                     )

MODE_CO2=CALC_CHAMP(  reuse=MODE_CO2,
                           RESULTAT=MODE_CO2,
                             FORCE='REAC_NODA'
                     )

#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_CO2,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC=0.013171600,
                   VALE_REFE=0.013169999999999999,
                   NOEUD_CMP=('P1', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_CO2,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC=0.012158400,
                   VALE_REFE=0.012160000000000001,
                   NOEUD_CMP=('P1', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_CO2,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC=0.012158400,
                   VALE_REFE=0.012160000000000001,
                   NOEUD_CMP=('P4', 'DX'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MODE_CO2,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC=0.013171600,
                   VALE_REFE=0.013169999999999999,
                   NOEUD_CMP=('P4', 'DX'),),
                ),
          )

#
# -------------------------------
#
#   DEFINITION DU SEISME
#
#--------------------------------
#
F0=1.0

#
F1=1.5

F2=2.0

OMEGA1=2*pi*F1

OMEGA2=2*pi*F2

A1=0.5

A2=0.5

#
L_FREQ=DEFI_LIST_REEL(        DEBUT=0.01,
                             INTERVALLE=_F( JUSQU_A = 20., PAS = 0.002))

#
FSRO1 = FORMULE(NOM_PARA='FREQ',VALE='''
A1*(2*pi*FREQ)**2/abs(OMEGA1**2-(2*pi*FREQ)**2)''')
#
FSRO2 = FORMULE(NOM_PARA='FREQ',VALE='''
A2*(2*pi*FREQ)**2/abs(OMEGA2**2-(2*pi*FREQ)**2)''')
#

SRO1=CALC_FONC_INTERP(           FONCTION=FSRO1,
                                 NOM_PARA='FREQ',
                                  LIST_PARA=L_FREQ,
                                  PROL_DROITE='LINEAIRE',
                                PROL_GAUCHE='LINEAIRE',
                                   INTERPOL='LOG'
                        )

SRO2=CALC_FONC_INTERP(           FONCTION=FSRO2,
                                 NOM_PARA='FREQ',
                                  LIST_PARA=L_FREQ,
                                  PROL_DROITE='LINEAIRE',
                                PROL_GAUCHE='LINEAIRE',
                                   INTERPOL='LOG'
                        )

#
SPEC1=DEFI_NAPPE(                NOM_PARA='AMOR',
                                   INTERPOL=( 'LIN', 'LOG', ),
                                       PARA=( 0.00, 0.05,   ),
                                   FONCTION=( SRO1,  SRO1,  )
                       )

SPEC2=DEFI_NAPPE(                NOM_PARA='AMOR',
                                   INTERPOL=( 'LIN', 'LOG', ),
                                       PARA=( 0.00, 0.05,   ),
                                   FONCTION=( SRO2,  SRO2,  )
                       )

#
L_TEMPS=DEFI_LIST_REEL(        DEBUT=0.0,
                             INTERVALLE=_F( JUSQU_A = 30., PAS = 0.01))

#
#--------------------------------
#
MUQASRS=COMB_SISM_MODAL( MODE_MECA=MODES,
                         AMOR_REDUIT=0.0,
                         MASS_INER=MAS,
                         CORR_FREQ='NON',
                         MULTI_APPUI ='DECORRELE',
                         EXCIT=(_F( NOEUD = 'P1',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC1,
                                    ECHELLE = 1.),
                                _F( NOEUD = 'P4',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC2,
                                    ECHELLE = 1.)),
                         GROUP_APPUI=(_F( NOEUD = ( 'P1', ),),
                                      _F( NOEUD = ( 'P4', ),),),
                         DEPL_MULT_APPUI=_F(  NUME_CAS =1,
                                          NOM_CAS ='DEPL EN X NUL EN P1 ET P4',
                                          MODE_STAT = MODE_STA,
                                          NOEUD_REFE = 'P1',
                                          NOEUD = ( 'P1', 'P4', ),
                                          DX = 0.),
                         COMB_MODE=_F(  TYPE = 'SRSS'),
                         OPTION=( 'DEPL',
                                  'SIEF_ELGA',
                                  'EFGE_ELNO',
                                  'FORC_NODA',
                                  'REAC_NODA', )
                           )
#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQASRS,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65129788E-03,
                   VALE_REFE=5.6499999999999996E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQASRS,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65129788E-03,
                   VALE_REFE=5.6499999999999996E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                ),
          )

MUQAABS=COMB_SISM_MODAL( MODE_MECA=MODES,
                         AMOR_REDUIT=0.0,
                         MASS_INER=MAS,
                         CORR_FREQ='NON',
                         MULTI_APPUI ='DECORRELE',
                         EXCIT=(_F( NOEUD = 'P1',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC1,
                                    ECHELLE = 1.),
                               _F( NOEUD = 'P4',
                                   AXE = ( 1., 0., 0., ),
                                   SPEC_OSCI = SPEC2,
                                   ECHELLE = 1.)),
                         GROUP_APPUI=(_F( NOEUD = ( 'P1', ),),
                                      _F( NOEUD = ( 'P4', ),),),
                         DEPL_MULT_APPUI=_F( NUME_CAS =1,
                                             NOM_CAS ='DEPL EN X NUL EN P1 ET P4',
                                             MODE_STAT = MODE_STA,
                                             NOEUD_REFE = 'P1',
                                             NOEUD = ( 'P1', 'P4', ),
                                             DX = 0.),
                         COMB_MODE=_F(  TYPE = 'ABS'),
                         OPTION=( 'DEPL',
                                  'SIEF_ELGA',
                                  'EFGE_ELNO',
                                  'FORC_NODA',
                                  'REAC_NODA', )
                           )

#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQAABS,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC= 6.47688578E-03,
                   VALE_REFE=6.476E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQAABS,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC= 6.47688578E-03,
                   VALE_REFE=6.476E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                ),
          )

#
MUQADPC=COMB_SISM_MODAL(
                         MODE_MECA=MODES,
                         AMOR_REDUIT=0.0,
                         MASS_INER=MAS,
                         CORR_FREQ='NON',
                         MULTI_APPUI ='DECORRELE',
                         EXCIT=(_F( NOEUD = 'P1',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC1,
                                    ECHELLE = 1.),
                                _F( NOEUD = 'P4',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC2,
                                    ECHELLE = 1.)),
                         GROUP_APPUI=(_F(  NOEUD = ( 'P1',),),
                                      _F(  NOEUD = ( 'P4',),),),
                         DEPL_MULT_APPUI=_F(  NUME_CAS =1,
                                          NOM_CAS ='DEPL EN X NUL EN P1 ET P4',
                                          MODE_STAT = MODE_STA,
                                          NOEUD_REFE = 'P1',
                                          NOEUD = ( 'P1', 'P4', ),
                                          DX = 0.),
                         COMB_MODE=_F(  TYPE = 'DPC'),
                         OPTION=( 'DEPL',
                                       'SIEF_ELGA',
                                       'EFGE_ELNO',
                                       'FORC_NODA',
                                       'REAC_NODA', )
                      )

TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQADPC,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65129788E-03,
                   VALE_REFE=5.6499999999999996E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQADPC,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65129788E-03,
                   VALE_REFE=5.6499999999999996E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                ),
          )

MUQACQC=COMB_SISM_MODAL( MODE_MECA=MODES,
                         AMOR_REDUIT=0.05,
                         MASS_INER=MAS,
                         CORR_FREQ='NON',
                         MULTI_APPUI ='DECORRELE',
                         EXCIT=(_F( NOEUD = 'P1',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC1,
                                    ECHELLE = 1.),
                                _F( NOEUD = 'P4',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC2,
                                    ECHELLE = 1.)),
                         DEPL_MULT_APPUI=_F(  NUME_CAS =1,
                                          NOM_CAS ='DEPL EN X NUL EN P1 ET P4',
                                          MODE_STAT = MODE_STA,
                                          NOEUD_REFE = 'P1',
                                          NOEUD = ( 'P1', 'P4', ),
                                          DX = 0.),
                         COMB_MODE=_F( TYPE = 'CQC'),
                         OPTION=( 'DEPL',
                                  'SIEF_ELGA',
                                  'EFGE_ELNO',
                                  'FORC_NODA',
                                  'REAC_NODA', )
                           )

#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQACQC,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65049549E-03,
                   VALE_REFE=5.6499999999999996E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQACQC,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65210016E-03,
                   VALE_REFE=5.6515699999999999E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                ),
          )

#
MUQADSC=COMB_SISM_MODAL( MODE_MECA=MODES,
                         AMOR_REDUIT=0.05,
                         MASS_INER=MAS,
                         CORR_FREQ='NON',
                         MULTI_APPUI ='DECORRELE',
                         EXCIT=(_F( NOEUD = 'P1',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC1,
                                    ECHELLE = 1.),
                                _F( NOEUD = 'P4',
                                    AXE = ( 1., 0., 0., ),
                                    SPEC_OSCI = SPEC2,
                                    ECHELLE = 1.)),
                         GROUP_APPUI=(_F( NOEUD = ( 'P1',),),
                                      _F( NOEUD = ( 'P4',),),),
                         DEPL_MULT_APPUI=_F( NUME_CAS =1,
                                             NOM_CAS ='DEPL EN X NUL EN P1 ET P4',
                                             MODE_STAT = MODE_STA,
                                             NOEUD_REFE = 'P1',
                                             NOEUD = ( 'P1', 'P4', ),
                                             DX = 0.),
                         COMB_MODE=_F( TYPE = 'DSC',
                                       DUREE = 15.),
                         OPTION=( 'DEPL',
                                  'SIEF_ELGA',
                                  'EFGE_ELNO',
                                  'FORC_NODA',
                                  'REAC_NODA', )
                           )

#
TEST_RESU(RESU=(_F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQADSC,
                   NOM_CHAM='DEPL',
                   NOEUD='P2',
                   NOM_CMP='DX',
                   VALE_CALC= 5.64969441E-03,
                   VALE_REFE=5.6490000000000004E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                _F(REFERENCE='ANALYTIQUE',
                   RESULTAT=MUQADSC,
                   NOM_CHAM='DEPL',
                   NOEUD='P3',
                   NOM_CMP='DX',
                   VALE_CALC= 5.65290090E-03,
                   VALE_REFE=5.6521000000000002E-3,
                   NOEUD_CMP=('DIR', 'X'),),
                ),
          )

#
#
# --------------------------------------
#
FIN( )
