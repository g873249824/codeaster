# ======================================================================
# COPYRIGHT (C) 1991 - 2017  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# ( AVEC PLASTICITE DE TRANSFORMATION ET RESTAURATION D'ECROUISSAGE)
# CAS_TEST__: HSNV104A
# HSNV104A
# ESSAI DE TYPE SATOH
# MODELISATION D_PLAN_META  (ELEMENTS DPLAN METALLURGIQUES)
#             13 NOEUDS  2 MAILLES QUAD8
#======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), BASE=_F(FICHIER='GLOBALE', LONG_REPE=7000), DEBUG=_F(SDVERI='OUI'))

MAIL=LIRE_MAILLAGE(FORMAT="ASTER", )

TRCMNDA=DEFI_TRC(HIST_EXP=(

 _F( VALE = (
-1.106E+03,  1.100E+01,  0.000E+00,  0.000E+00,
 0.000E+00,  0.000E+00,  0.000E+00,  0.000E+00,
 0.000E+00,  0.000E+00,  0.000E+00,  8.360E+02,
 0.000E+00,  0.000E+00,  0.000E+00,  6.001E+02,
 0.000E+00,  0.000E+00,  1.000E+00,  3.450E+02,
      )),
 _F( VALE = (
-2.206E+03,  1.100E+01,  0.000E+00,  0.000E+00,
 0.000E+00,  0.000E+00,  0.000E+00,  0.000E+00,
 0.000E+00,  0.000E+00,  0.000E+00,  8.360E+02,
 0.000E+00,  0.000E+00,  0.000E+00,  6.001E+02,
 0.000E+00,  0.000E+00,  1.000E+00,  3.450E+02,
      ))),
   TEMP_MS=_F(
    SEUIL = 4.500E-01,
    AKM = -3.125E+01,
    BKM = 1.406E+01,
    TPLM = -3.497E+03)
   )

ACIER=DEFI_MATERIAU(         THER=_F(  RHO_CP = 2000000.0, LAMBDA = 9999.9),
                           META_ACIER=_F(  TRC = TRCMNDA,    AR3 = 830.0,
                                       ALPHA = -0.0300,    MS0 = 200.0,
                                       AC1 = 724.0,     AC3 = 846.0,
                                       TAUX_1 = 0.34,     TAUX_3 = 0.34)
                       )

CHMAT=AFFE_MATERIAU(    MAILLAGE=MAIL,
                               AFFE=_F(  TOUT = 'OUI', MATER = ACIER)
                       )

MOTH=AFFE_MODELE(    MAILLAGE=MAIL,
                             AFFE=_F(  TOUT = 'OUI',
                                    MODELISATION = 'PLAN',
                                    PHENOMENE = 'THERMIQUE')
                     )

TIMPO=DEFI_FONCTION(       NOM_PARA='INST',
                              NOM_RESU='TEMP',
                                  VALE=(0.0, 900.0, 180.0,  0.0,),
                           PROL_GAUCHE='LINEAIRE',
                            PROL_DROITE='LINEAIRE',
                              INTERPOL='LIN'
                       )

CHTH=AFFE_CHAR_THER_F(       MODELE=MOTH,
                              TEMP_IMPO=_F( TOUT = 'OUI',
                                         TEMP = TIMPO)
                       )

LR8=DEFI_LIST_REEL(   DEBUT=0.,
                          INTERVALLE=_F(  JUSQU_A = 176.0,  NOMBRE = 88)
                      )

DEFLISTT=DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST=       LR8))

PHASINIT=CREA_CHAMP(OPERATION='AFFE', TYPE_CHAM='CART_VAR2_R',
                           MAILLAGE=MAIL,
                           AFFE=_F(  TOUT = 'OUI',
             NOM_CMP = ( 'V1', 'V2', 'V3', 'V4', 'V5',),
             VALE = ( 0.0, 0.0, 0.0, 0.0, 10.,  ))
                        )

TEMPE=THER_LINEAIRE(        MODELE=MOTH,
                           CHAM_MATER=CHMAT,
                           PARM_THETA=0.57,
                                EXCIT=_F(  CHARGE = CHTH),
                            INCREMENT=_F(  LIST_INST = DEFLISTT),
                            ETAT_INIT=_F(  VALE = 900.)

                        )

TEMPE=CALC_META(reuse=TEMPE,
                RESULTAT=TEMPE,
                ETAT_INIT=_F(META_INIT_ELNO=PHASINIT),
                COMPORTEMENT=_F(RELATION='ACIER',
                             TOUT='OUI'),
                OPTION='META_ELNO',);

FBM1=DEFI_FONCTION(      NOM_PARA='TEMP',
                            PROL_DROITE='CONSTANT',
                           PROL_GAUCHE='CONSTANT',
                                 VALE=(0.,  2000.E+6,  900., 2000.E+6, ))

FBM2=DEFI_FONCTION(      NOM_PARA='TEMP',
                           PROL_DROITE='CONSTANT',
                          PROL_GAUCHE='CONSTANT',
                                VALE=( 0.,  12.E+8,  900., 12.E+8, ))

AUS1=DEFI_FONCTION(      NOM_PARA='TEMP',
                           PROL_DROITE='CONSTANT',
                          PROL_GAUCHE='CONSTANT',
                                VALE=(0.,  2000.E+6,  900.,  2000.E+6, ))

AUS2=DEFI_FONCTION(      NOM_PARA='TEMP',
                           PROL_DROITE='CONSTANT',
                          PROL_GAUCHE='CONSTANT',
                                VALE=( 0., 400.E+6,  900., 400.E+6, ))

ALP1=DEFI_FONCTION(      NOM_PARA='TEMP',
                           PROL_DROITE='CONSTANT',
                          PROL_GAUCHE='CONSTANT',
                                VALE=( 0., 20.E-6,  900., 20.E-6, ))

ALP2=DEFI_FONCTION(      NOM_PARA='TEMP',
                           PROL_DROITE='CONSTANT',
                          PROL_GAUCHE='CONSTANT',
                                VALE=( 0., 20.E-6,  900., 20.E-6, ))

FMEL=DEFI_FONCTION(      NOM_PARA='META',
                          PROL_DROITE='CONSTANT',
                         PROL_GAUCHE='CONSTANT',
                               VALE=( 0.,  0.,   1.,  1., ))

YOUNG=DEFI_CONSTANTE( VALE=200000.E+6)

NU=DEFI_CONSTANTE( VALE=0.3)

ACIER2=DEFI_MATERIAU(
            ELAS_META_FO=_F( E = YOUNG,
                      NU = NU,
                      F_ALPHA = ALP1,
                      C_ALPHA = ALP2,
                      TEMP_DEF_ALPHA=900.0,
               PHASE_REFE = 'CHAUD',
               EPSF_EPSC_TREF = 2.52E-3,
               F1_SY = FBM2,
               F2_SY = FBM2,
               F3_SY = FBM2,
        F4_SY = FBM2,
               C_SY = AUS2,
               SY_MELANGE = FMEL),
             META_ECRO_LINE=_F(
                        F1_D_SIGM_EPSI = FBM1,
                        F2_D_SIGM_EPSI = FBM1,
                        F3_D_SIGM_EPSI = FBM1,
 F4_D_SIGM_EPSI = FBM1,
                        C_D_SIGM_EPSI = AUS1),
             META_RE=_F(    C_F1_THETA = 0.,
                         C_F2_THETA = 0.,
                         C_F3_THETA = 0.,
                         C_F4_THETA = 1.,
                         F1_C_THETA = 0.,
                         F2_C_THETA = 0.,
                         F3_C_THETA = 0.,
                         F4_C_THETA = 0.)
           )

CM2=AFFE_MATERIAU(
                         MAILLAGE=MAIL,
                        AFFE=_F( TOUT = 'OUI',MATER = ACIER2,),
                        AFFE_VARC=(_F(TOUT='OUI',
                                     EVOL=TEMPE,
                                     NOM_VARC='M_ACIER',
                                     NOM_CHAM='META_ELNO'),
                                   _F(TOUT='OUI',
                                     EVOL=TEMPE,
                                     NOM_VARC='TEMP',
                                     NOM_CHAM='TEMP',
                                     VALE_REF=900),),

         )

MO=AFFE_MODELE(
           MAILLAGE=MAIL,    
          AFFE=_F( TOUT = 'OUI',PHENOMENE = 'MECANIQUE',
                MODELISATION = 'D_PLAN'))

CH_FO=AFFE_CHAR_MECA(
            MODELE=MO,
            DDL_IMPO=(
                 _F(  NOEUD = 'N4',  DY = 0., DX = 0.),
                 _F(  NOEUD = 'N2',  DY = 0.),
                 _F(  NOEUD = 'N5',  DY = 0.))
           )

L_INST=DEFI_LIST_REEL(  DEBUT=0.0,
             INTERVALLE=_F( JUSQU_A = 176.,      NOMBRE = 176)
           )

DEFLISTM=DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST=       L_INST)) 

U=STAT_NON_LINE(
                            MODELE=MO,
                        CHAM_MATER=CM2,
                             EXCIT=_F(
                CHARGE = CH_FO),
                         COMPORTEMENT=_F(
                RELATION = 'META_P_IL_RE',
                RELATION_KIT = ('ACIER',)),
                         INCREMENT=_F(
                LIST_INST = DEFLISTM,
                NUME_INST_FIN = 176),
                            NEWTON=_F(
                MATRICE = 'TANGENTE',
                REAC_ITER = 1),
                       CONVERGENCE=_F(
                RESI_GLOB_RELA = 1.E-6,
                ITER_GLOB_MAXI = 40)
              )

U=CALC_CHAMP(reuse=U,
             RESULTAT=U,
             CONTRAINTE=('SIGM_ELNO'),
             VARI_INTERNE=('VARI_ELNO'),
             DEFORMATION = ('EPVC_ELNO','EPME_ELNO','EPSP_ELNO'))


TEST_RESU(RESU=(_F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='N13',
                   NOM_CMP='SIZZ',
                   VALE_CALC=4.0800000000002E+08,
                   VALE_REFE=4.07920000E8,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V3',
                   VALE_CALC=0.0E+00,
                   VALE_REFE=0.0,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',
                   ORDRE_GRANDEUR=1e-6),
                _F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V5',
                   VALE_CALC=3.96E-03,
                   VALE_REFE=3.9604000000000002E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='EPVC_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPTHER_L',
                   VALE_CALC=-6.E-3,
                   VALE_REFE=-6.E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSP_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.00198,
                   VALE_REFE=-1.9802E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=60.0,
                   RESULTAT=U,
                   NOM_CHAM='EPME_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.002592,
                   VALE_REFE=-2.59208E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V3',
                   VALE_CALC=0.0E+00,
                   VALE_REFE=0.0,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',
                   ORDRE_GRANDEUR=1e-6),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V5',
                   VALE_CALC=3.96E-03,
                   VALE_REFE=3.9604000000000002E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='N13',
                   NOM_CMP='SIZZ',
                   VALE_CALC=7.0152410819288E+08,
                   VALE_REFE=7.06840000E8,
                   CRITERE='RELATIF',
                   REFERENCE = 'ANALYTIQUE',
                   PRECISION=8.0E-3,
                   MAILLE='M1',),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='EPVC_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPTHER_L',
                   VALE_CALC=-0.00746762054096,
                   VALE_REFE=-7.4946E-3,
                   REFERENCE = 'ANALYTIQUE',
                   PRECISION=5.0E-3,
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSP_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.00198,
                   VALE_REFE=-1.9802E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=89.0,
                   RESULTAT=U,
                   NOM_CHAM='EPME_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.00303228616229,
                   VALE_REFE=-3.04046E-3,
                   REFERENCE = 'ANALYTIQUE',
                   PRECISION=3.0E-3,
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V3',
                   VALE_CALC=0.0E+00,
                   VALE_REFE=0.0,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',
                   ORDRE_GRANDEUR=1e-6),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V5',
                   VALE_CALC=0.0E+00,
                   VALE_REFE=0.0,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',
                   ORDRE_GRANDEUR=1e-6),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='N13',
                   NOM_CMP='SIZZ',
                   VALE_CALC=9.4400000000002E+08,
                   VALE_REFE=9.43920000E8,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='EPVC_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPTHER_L',
                   VALE_CALC=-0.00868,
                   VALE_REFE=-8.68E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSP_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.00198,
                   VALE_REFE=-1.9802E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=112.0,
                   RESULTAT=U,
                   NOM_CHAM='EPME_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.003396,
                   VALE_REFE=-3.39608E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V3',
                   VALE_CALC=5.0688E-03,
                   VALE_REFE=5.0689000000000003E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='VARI_ELNO',
                   NOEUD='N13',
                   NOM_CMP='V5',
                   VALE_CALC=0.0E+00,
                   VALE_REFE=0.0,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='ABSOLU',
                   MAILLE='M1',
                   ORDRE_GRANDEUR = 1E-6),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='SIGM_ELNO',
                   NOEUD='N13',
                   NOM_CMP='SIZZ',
                   VALE_CALC=1.21024E+09,
                   VALE_REFE=1.210100000E9,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='EPVC_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPTHER_L',
                   VALE_CALC=-0.01508,
                   VALE_REFE=-1.508E-2,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='EPSP_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.0045144,
                   VALE_REFE=-4.51465E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                _F(INST=176.0,
                   RESULTAT=U,
                   NOM_CHAM='EPME_ELNO',
                   NOEUD='N13',
                   NOM_CMP='EPXX',
                   VALE_CALC=-0.00632976,
                   VALE_REFE=-6.3298E-3,
                   REFERENCE = 'ANALYTIQUE',
                   CRITERE='RELATIF',
                   MAILLE='M1',),
                ),
          )

FIN()
#
