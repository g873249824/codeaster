# TITRE ONDE DE COMPRESSION DANS UNE COLONNE POROELASTIQUE
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
#=======================================================================
# CAS_TEST__: WDNP102B
#
# PROPAGATION D UNE ONDE DE COMPRESSION DANS UNE COLONNE POROELASTIQUE
# REFLEXION AU SOMMET ET ABSORPTION DE L ONDE A LA BASE
# CAS 3D
#=======================================================================


# Nombre de couches
# (dont la couche elastique correspondant au BEDROCK)
nbcouche  = 11;

Kref = 313.1*1.e6;
Gref = 215.6*1.e6;

YOUNG = 9.*Kref*Gref /(3.*Kref+Gref)
NU    = (3.*Kref-2.*Gref) /(6.*Kref+2.*Gref)

RHO = 2105.; # Valeur homogeneisee

CS = sqrt(Gref/RHO);

CP = sqrt((Kref+4./3.*Gref)/RHO);

# => Choix Onde S ou P

Onde ='P'

print '>> Onde %s CS= %f CP= %f' %(Onde,CS,CP)

# ------------------------------------------------------------------------------


DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='NON'));

INV_K_EAU = 1.E-5 ;

VISCOLIQ = DEFI_CONSTANTE(VALE=0.001 );

DVISCOL  = DEFI_CONSTANTE(VALE=0.0   );

KINT     = DEFI_CONSTANTE(VALE=1.E-12);

MA=LIRE_MAILLAGE(FORMAT='MED');

MAIL = CREA_MAILLAGE(MAILLAGE=MA,
                  CREA_POI1=_F(NOM_GROUP_MA ='RESBAS',
                                GROUP_MA ='BAS'));

MAIL = DEFI_GROUP(reuse=MAIL,
                MAILLAGE=MAIL,
                INFO=1,
                CREA_GROUP_NO=(_F(TOUT_GROUP_MA='OUI'),

                               _F(NOM='LATBG',
                                  DIFFE=('LAT_LEFT','BAS')),
                               _F(NOM='LATBD',
                                  DIFFE=('LAT_RIGH','BAS')),

                               _F(NOM='LATHG',
                                  DIFFE=('LAT_LEFT','HA10')),
                               _F(NOM='LATHD',
                                  DIFFE=('LAT_RIGH','HA10'))));

list_group_ma=['ELEM'+str(n) for n in range(nbcouche)];

print '>> list_group_ma=',list_group_ma

MAT1=DEFI_MATERIAU(ELAS=_F(E =YOUNG, NU =NU, RHO =RHO, ALPHA=0.),
                   COMP_THM='LIQU_SATU',
                   THM_INIT=_F(PRE1 = 0.0,
                               PORO = 0.23),
                   THM_DIFFU=_F(RHO       = RHO,
                                BIOT_COEF = 1.0,
                                PESA_X    = 0.0,
                                PESA_Y    = -9.81,
                                PESA_Z    = 0.0,
                                PERM_IN   = KINT),
                   THM_LIQU=_F(RHO        = 1000.0,
                               UN_SUR_K   = INV_K_EAU,
                               VISC       = VISCOLIQ,
                               D_VISC_TEMP= DVISCOL));

MAT_PAR=DEFI_MATERIAU(ELAS=_F(E =YOUNG, NU =NU, RHO =RHO));

INCLUDE(UNITE=38,INFO=1);

Paraxia = 'BAS';

MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=(_F(GROUP_MA = list_group_ma,
                            PHENOMENE = 'MECANIQUE',
                            MODELISATION = '3D_HM'),
                         _F(GROUP_MA='RESBAS',
                            PHENOMENE   ='MECANIQUE',
                            MODELISATION='DIS_T'),
                         _F(GROUP_MA = Paraxia,
                            PHENOMENE = 'MECANIQUE',
                            MODELISATION = '3D_ABSO')));

CARA=AFFE_CARA_ELEM(MODELE=MODELE,
                    DISCRET=(_F(GROUP_MA='RESBAS',
                                  CARA='K_T_D_N',
                                  VALE=(1.E+14,1.E+14,1.E+14)),
                               _F(GROUP_MA='RESBAS',
                                  CARA='M_T_D_N',
                                  VALE=0.),
                               _F(GROUP_MA='RESBAS',
                                  CARA='A_T_D_N',
                                  VALE=(0.,0.,0.))));

CARA1=AFFE_CARA_ELEM(MODELE=MODELE,
                    DISCRET=(_F(GROUP_MA='RESBAS',
                                  CARA='K_T_D_N',
                                  VALE=(1.E+01,1.E+01,1.E+01)),
                               _F(GROUP_MA='RESBAS',
                                  CARA='M_T_D_N',
                                  VALE=0.),
                               _F(GROUP_MA='RESBAS',
                                  CARA='A_T_D_N',
                                  VALE=(0.,0.,0.))));

CHAMPMAT=AFFE_MATERIAU(MAILLAGE=MAIL,
                       AFFE=(_F(GROUP_MA = list_group_ma, MATER = MAT1),
                             _F(GROUP_MA = Paraxia, MATER = MAT_PAR)));

# La hauteur de la colonne est dirigee suivant (OY)
LIAISON0=AFFE_CHAR_MECA(MODELE=MODELE,
                        VERI_NORM='NON',
                        LIAISON_GROUP=(_F(GROUP_NO_1='LAT_LEFT',
                                         GROUP_NO_2='LAT_RIGH',
                                         DDL_1=('DX'),
                                         DDL_2=('DX'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.),
                                       _F(GROUP_NO_1='FRONT',
                                         GROUP_NO_2='BACK',
                                         DDL_1=('DZ'),
                                         DDL_2=('DZ'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.),
                                      _F(GROUP_NO_1='LATHG',
                                         GROUP_NO_2='LATHD',
                                         DDL_1=('DY'),
                                         DDL_2=('DY'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.)));
LIAISON=AFFE_CHAR_MECA(MODELE=MODELE,
                        VERI_NORM='NON',
                        LIAISON_GROUP=(_F(GROUP_NO_1='LAT_LEFT',
                                         GROUP_NO_2='LAT_RIGH',
                                         DDL_1=('DX'),
                                         DDL_2=('DX'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.),
                                       _F(GROUP_NO_1='FRONT',
                                         GROUP_NO_2='BACK',
                                         DDL_1=('DZ'),
                                         DDL_2=('DZ'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.),
                                      _F(GROUP_NO_1='LAT_LEFT',
                                         GROUP_NO_2='LAT_RIGH',
                                         DDL_1=('DY'),
                                         DDL_2=('DY'),
                                         COEF_MULT_1 = 1.,
                                         COEF_MULT_2 = -1.,
                                         COEF_IMPO = 0.)));

BLOQ_BAS=AFFE_CHAR_CINE(MODELE=MODELE,
                    MECA_IMPO=_F(GROUP_MA=('BAS'),DX=0.0,DY=0.0,DZ=0.0));

BLOQ_HAU=AFFE_CHAR_MECA(MODELE=MODELE,
                    DDL_IMPO=_F(GROUP_MA=('HA10'),DY=0.0));

BLOQ_PRE=AFFE_CHAR_CINE(MODELE=MODELE,
                    MECA_IMPO=_F(GROUP_MA=('HA10'),PRE1=0.0));

ONDE=AFFE_CHAR_MECA_F(MODELE=MODELE,
                      ONDE_PLANE=_F(DIRECTION = (0.,+1.,0.),
                            TYPE_ONDE = Onde,
                            FONC_SIGNAL = vite,
                            GROUP_MA= 'BAS'));
# ---Fin


PES =AFFE_CHAR_MECA(MODELE=MODELE,
                    PESANTEUR=_F(GRAVITE=9.81,
                                DIRECTION=(0.0,-1.0,0.0)));

TANBID=DEFI_LIST_REEL(DEBUT=-1.E-1,
                      INTERVALLE=_F(JUSQU_A=0., NOMBRE=2));

UBID=STAT_NON_LINE(MODELE=MODELE,
                 CARA_ELEM=CARA,
                 CHAM_MATER=CHAMPMAT,
                 EXCIT=(#_F(CHARGE = BLOQ_PRE),
                        _F(CHARGE = LIAISON),
                        _F(CHARGE = PES)),
                 COMPORTEMENT=(_F(RELATION = 'KIT_HM',
                                RELATION_KIT=('ELAS','LIQU_SATU','HYDR_UTIL'),
                                GROUP_MA=list_group_ma),
                              _F(RELATION='ELAS',
                               DEFORMATION='PETIT',
                               GROUP_MA=Paraxia,
                               PARM_THETA=0.57)),
                 INCREMENT=_F(LIST_INST=TANBID),
                 NEWTON=_F(MATRICE='TANGENTE',
                           REAC_ITER=1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-10,
                                ARRET='OUI'));

BIDDEP0=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                OPERATION='EXTR',
                RESULTAT=UBID,
                NOM_CHAM='DEPL',
                INST=0.,
                INFO=1);

UBID=CALC_CHAMP(reuse=UBID,FORCE='FORC_NODA',
            RESULTAT=UBID,
            GROUP_MA='RESBAS',
            );

FORCE0=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                OPERATION='EXTR',
                RESULTAT=UBID,
                NOM_CHAM='FORC_NODA',
                INST=0.,
                INFO=1);

IMPR_RESU(RESU=_F(CHAM_GD=BIDDEP0));


CHFORCE0=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                  OPERATION='ASSE',
                  CHAM_NO=BIDDEP0,
                  MODELE=MODELE,
                  ASSE=(_F(TOUT='OUI',
                           CHAM_GD=BIDDEP0,
                           CUMUL='OUI',
                           COEF_R=0.0),
                        _F(TOUT='OUI',
                           CHAM_GD=FORCE0,
                           CUMUL='OUI',
                           COEF_R=-1.0)));

VFORCE0 = AFFE_CHAR_MECA(MODELE=MODELE,VECT_ASSE=CHFORCE0,INFO=1);

DYNB=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHAMPMAT,
                 CARA_ELEM=CARA1,
                 EXCIT=(_F(CHARGE = BLOQ_HAU,TYPE_CHARGE='DIDI'),
                        _F(CHARGE = VFORCE0),
                        _F(CHARGE = LIAISON0),
                        _F(CHARGE = PES)),
                 COMPORTEMENT=(_F(RELATION = 'KIT_HM',
                                RELATION_KIT=('ELAS','LIQU_SATU','HYDR_UTIL'),
                                GROUP_MA=list_group_ma),
                              _F(RELATION='ELAS',
                               DEFORMATION='PETIT',
                               GROUP_MA=Paraxia,
                               PARM_THETA=0.57),
                               ),
                 INCREMENT=_F(LIST_INST=TANBID),
                 NEWTON=_F(MATRICE='TANGENTE',
                           REAC_ITER=1),
                 CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-10,
                                ARRET='OUI'));

BIDDEP=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                OPERATION='EXTR',
                RESULTAT=DYNB,
                NOM_CHAM='DEPL',
                INST=0.,
                INFO=1);

INIZERO=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                   OPERATION='ASSE',
                   MODELE=MODELE,

                   ASSE=(_F(TOUT   ='OUI',
                            CHAM_GD=BIDDEP,
                            CUMUL  ='OUI',
                            COEF_R =0.0)));

pas_ttfin = 0.001;

TEMLI=DEFI_LIST_REEL(DEBUT=0.,
                     INTERVALLE=_F(JUSQU_A = 0.3, PAS =pas_ttfin));

DYNB=DYNA_NON_LINE(reuse=DYNB,INFO=1,MODELE=MODELE,
                   CHAM_MATER=CHAMPMAT,
                   CARA_ELEM=CARA1,
                   EXCIT=(# Si on bloque, il ne se passe rien ...
                          _F(CHARGE = BLOQ_HAU,TYPE_CHARGE='DIDI'),
                          _F(CHARGE = VFORCE0),
                          _F(CHARGE = LIAISON0),
                          _F(CHARGE = PES),
                          _F(CHARGE = ONDE)),
                   ETAT_INIT=_F(EVOL_NOLI=DYNB, INST=0.,
                                VITE=INIZERO, ACCE=INIZERO),
                   COMPORTEMENT=(_F(RELATION = 'KIT_HM',
                                RELATION_KIT=('ELAS','LIQU_SATU','HYDR_UTIL'),
                                GROUP_MA=list_group_ma),
                              _F(RELATION='ELAS',
                               DEFORMATION='PETIT',
                               GROUP_MA=Paraxia,
                               PARM_THETA=0.57)),
                   CONVERGENCE=_F(RESI_GLOB_RELA = 1.E-10,
                                  ITER_GLOB_MAXI = 5,
                                  ARRET='OUI'),
                   SOLVEUR=_F(METHODE = 'MUMPS'),
                   NEWTON=_F(MATRICE = 'TANGENTE',
                             REAC_ITER = 1),
                   INCREMENT=_F(LIST_INST = TEMLI,
                                INST_INIT = 0.,
                                INST_FIN =0.2),
                   #ARCHIVAGE=_F(LIST_INST = L_ARCH),
                   SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                   FORMULATION='DEPLACEMENT'));

# TEST DE LA VITESSE

DYNV56=RECU_FONCTION(RESULTAT=DYNB,
                    NOEUD='N56',
                    NOM_CHAM='VITE',
                    NOM_CMP='DY');

TEST_FONCTION(VALEUR=(_F(VALE_CALC=0.08575917,
                         CRITERE='RELATIF',
                         VALE_PARA=0.062,
                         FONCTION=DYNV56,
                         ),
                      _F(VALE_CALC=-0.085229780000000005,
                         CRITERE='RELATIF',
                         VALE_PARA=0.1,
                         FONCTION=DYNV56,
                         ),
                      _F(VALE_CALC=-3.55383218292e-06,
                         VALE_REFE=0.0,
                         CRITERE='ABSOLU',
                         VALE_PARA=0.17999999999999999,
                         REFERENCE='ANALYTIQUE',
                         PRECISION=1.0E-05,
                         FONCTION=DYNV56,),
                      ),
              )

# TEST DE LA PRESSION HYDRAULIQUE

DYNP56=RECU_FONCTION(RESULTAT=DYNB,
                    NOEUD='N56',
                    NOM_CHAM='DEPL',
                    NOM_CMP='PRE1');

TEST_FONCTION(VALEUR=(_F(VALE_CALC=219.5214,
                         CRITERE='RELATIF',
                         VALE_PARA=0.062,
                         FONCTION=DYNP56,
                         ),
                      _F(VALE_CALC=219.0561,
                         CRITERE='RELATIF',
                         VALE_PARA=0.1,
                         FONCTION=DYNP56,
                         ),
                      _F(VALE_CALC=149.4400,
                         CRITERE='RELATIF',
                         VALE_PARA=0.18,
                         FONCTION=DYNP56,
                         ),
                      ),
              )

FIN();
