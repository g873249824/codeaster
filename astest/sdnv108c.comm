# CYLINDRE 3D CREUX EN ROTATION AUTOUR DE SON AXE AVEC GYROSCOPIE 3D
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
#
import numpy as NP

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),
      DEBUG=_F(SDVERI='OUI'),);

MBI=LIRE_MAILLAGE(FORMAT='MED',);

MOD=AFFE_MODELE(MAILLAGE=MBI,
                AFFE=_F(TOUT='OUI',
                        PHENOMENE='MECANIQUE',
                        MODELISATION='3D_SI',),);

ELAS=DEFI_MATERIAU(ELAS=_F(E=2.07E11,
                           NU=0.28,
                           RHO=7860.0,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MBI,
                    AFFE=_F(TOUT='OUI',
                            MATER=ELAS,),);


DEBV=1000; # VITESSE DEBUT
FINV=3000. # VITESSE FIN
PASV = 1000. # PAS DE VITESSE DE ROTATION
VIT=NP.arange(DEBV,FINV+1,PASV); #LISTE DES VITESSES EN TR/MIN
nbV=len(VIT)
# LISTE DES VITESSES EN RAD/S
omega=[VIT[ii]*pi/30. for ii in range(nbV)];
# VECTEUR DIRECTEUR AXE DE ROTATION : nx,ny,nz
nx=0;ny=0;nz=1;
CL1=AFFE_CHAR_MECA(MODELE=MOD,
                   ROTATION=_F(VITESSE= 1,
                   AXE = (nx,ny,nz,),),);

ASSEMBLAGE(MODELE=MOD,
           CHAM_MATER=CHMAT,
           NUME_DDL=CO('NUMEDDL'),
           CHARGE=(CL1),
           MATR_ASSE=(_F(MATRICE=CO('RIGID'),
                              OPTION='RIGI_MECA',),
                           _F(MATRICE=CO('MASSE'),
                              OPTION='MASS_MECA',),
                           _F(MATRICE=CO('AMOR'),
                              OPTION='AMOR_MECA',),
                           _F(MATRICE=CO('RIGIDR'),
                              OPTION='RIGI_ROTA',),),);

GYELEM=CALC_MATR_ELEM(OPTION='MECA_GYRO',
                      MODELE=MOD,
                      CHARGE=(CL1),
                      CHAM_MATER=CHMAT,
                      );

GYASS=ASSE_MATRICE(MATR_ELEM=GYELEM,
                   NUME_DDL=NUMEDDL,);

# CALCUL DES MODES A L'ARRET
MODES0=CALC_MODES(MATR_RIGI=RIGID,
                  VERI_MODE=_F(STOP_ERREUR='NON',
                               ),
                  OPTION='CENTRE',
                  CALC_FREQ=_F(NMAX_FREQ=20,
                               FREQ=(500.,),
                               ),
                  SOLVEUR=_F(RENUM='METIS',
                             METHODE='MULT_FRONT',
                             NPREC=12,
                             ),
                  MATR_MASS=MASSE,
                  SOLVEUR_MODAL=_F(METHODE='SORENSEN',
                                   ),
                  TYPE_RESU='DYNAMIQUE',
                  )

#VITESSE DE ROTATION OMEGA=0
TEST_RESU(RESU=(_F(NUME_ORDRE=7,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=2601.74482843,
                   VALE_REFE=2562.0800000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=8,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=2601.74482843,
                   VALE_REFE=2562.0800000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=9,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=2997.81485586,
                   VALE_REFE=2962.72000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=10,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=2997.81485586,
                   VALE_REFE=2962.72000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=11,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6285.75371272,
                   VALE_REFE=6231.3400000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=12,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6285.75371272,
                   VALE_REFE=6231.3400000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=13,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6313.96551467,
                   VALE_REFE=6313.7300000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=14,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6414.60774305,
                   VALE_REFE=6420.4200000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=15,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6414.60774305,
                   VALE_REFE=6420.4200000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=16,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6774.35154987,
                   VALE_REFE=6658.7500000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=17,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=6774.35154987,
                   VALE_REFE=6658.7500000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=18,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=7044.06812003,
                   VALE_REFE=7040.8500000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=19,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=7044.06812003,
                   VALE_REFE=7040.8500000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=20,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=MODES0,
                   VALE_CALC=7263.30378952,
                   VALE_REFE=7159.0200000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                ),
          )

lmod1=[None]*nbV;
lmod2=[None]*nbV;
for i in range(nbV):
    OM=omega[i]
    RIGIDi=COMB_MATR_ASSE(COMB_R=(_F(MATR_ASSE=RIGID,COEF_R=1.0,),
                                  _F(MATR_ASSE=RIGIDR,COEF_R=OM**2,),),)
    GYASSi=COMB_MATR_ASSE(COMB_R=(_F(MATR_ASSE=AMOR,COEF_R=1.0,),
                                  _F(MATR_ASSE=GYASS,COEF_R=OM,),),),                                    
    # CALCUL DES MODES AVEC GYROSCOPIE ET SANS RAIDEUR CENTRIFUGE
    lmod1[i]=CALC_MODES(MATR_RIGI=RIGID,
                            VERI_MODE=_F(STOP_ERREUR='NON',
                                         ),
                            OPTION='CENTRE',
                            CALC_FREQ=_F(NMAX_FREQ=15,
                                         FREQ=(500.,),
                                         ),
                            SOLVEUR=_F(RENUM='METIS',
                                       METHODE='MULT_FRONT',
                                       NPREC=12,
                                       ),
                            MATR_AMOR=GYASSi,
                            MATR_MASS=MASSE,
                            SOLVEUR_MODAL=_F(METHODE='SORENSEN',
                                             ),
                            TYPE_RESU='DYNAMIQUE',
                            )
    # CALCUL DES MODES AVEC GYROSCOPIE ET AVEC RAIDEUR CENTRIFUGE
    lmod2[i]=CALC_MODES(MATR_RIGI=RIGIDi,
                            VERI_MODE=_F(STOP_ERREUR='NON',
                                         ),
                            TYPE_RESU='DYNAMIQUE',
                            CALC_FREQ=_F(NMAX_FREQ=15,
                                         FREQ=(500.,),
                                         ),
                            SOLVEUR=_F(RENUM='METIS',
                                       METHODE='MULT_FRONT',
                                       NPREC=12,
                                       ),
                            OPTION='CENTRE',
                            MATR_AMOR=GYASSi,
                            MATR_MASS=MASSE,
                            SOLVEUR_MODAL=_F(COEF_DIM_ESPACE=4,
                                             METHODE='SORENSEN',
                                             ),
                            )
    DETRUIRE(CONCEPT=_F(NOM=RIGIDi),INFO=1)
    DETRUIRE(CONCEPT=_F(NOM=GYASSi),INFO=1)    

#VITESSE DE ROTATION OMEGA=3000 TR/MIN
TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=53.89838086,
                   VALE_REFE=53.2600000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=2,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=100.000000001,
                   VALE_REFE=100.0000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=3,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=2563.36981821,
                   VALE_REFE=2524.20000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=4,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=2640.66555503,
                   VALE_REFE=2601.50000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=5,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=2963.08539115,
                   VALE_REFE=2928.5000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=3032.91605566,
                   VALE_REFE=2998.1000000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=6265.88011463,
                   VALE_REFE=6211.4000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=6306.00528119,
                   VALE_REFE=6251.8000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=6313.12140575,
                   VALE_REFE=6313.0000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod1_2,
                   VALE_CALC=6382.10889873,
                   VALE_REFE=6388.2000000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                ),
          )

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=26.95065297,
                   VALE_REFE=26.6300000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=2,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=49.99920088,
                   VALE_REFE=49.9900000000001,
                   TOLE_MACHINE=5.E-6,      # ajustement pour calibre7
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,),
                _F(NUME_ORDRE=3,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=50.00079911,
                   VALE_REFE=50.00000000000001,
                   TOLE_MACHINE=5.E-6,      # ajustement pour calibre7
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,),
                _F(NUME_ORDRE=4,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=2562.88948240,
                   VALE_REFE=2523.7400000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=2640.18522150,
                   VALE_REFE=2600.9900000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=2962.72006550,
                   VALE_REFE=2928.0900000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=3032.55103131,
                   VALE_REFE=2997.7200000000001,
                   CRITERE='RELATIF',
                   PRECISION=2.E-2,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=6265.78581699,
                   VALE_REFE=6211.3300000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=6305.90802445,
                   VALE_REFE=6251.7300000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=6312.92345718,
                   VALE_REFE=6312.8400000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                _F(NUME_ORDRE=11,
                   PARA='FREQ',
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=lmod2_2,
                   VALE_CALC=6381.94883085,
                   VALE_REFE=6388.0300000000001,
                   CRITERE='RELATIF',
                   PRECISION=1.E-2,
                   ),
                ),
          )

FIN()
