# TITRE Modes propres de vibration d'un cadre auto-contraint
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),
      DEBUG=_F( SDVERI     = 'OUI',),
)

# lecture du maillage
mail=LIRE_MAILLAGE(FORMAT='MED',)

affect=AFFE_MODELE(
    MAILLAGE=mail,
    AFFE=(
        _F(GROUP_MA='Group_barre', PHENOMENE='MECANIQUE', MODELISATION='BARRE',),
        _F(GROUP_MA='Group_cable', PHENOMENE='MECANIQUE', MODELISATION='CABLE',),
    ),
)

# Caractéristique du câble
Cable_Aire = 5.026e-5
Cable_Rho  = 7800.0

# Définition du matériau CABLE
mat_cabl=DEFI_MATERIAU(
    ELAS=_F(E=2.1E+11, NU=0.3, ALPHA=1.0E-05,RHO=Cable_Rho),
    CABLE=_F(EC_SUR_E=0.0001,),
)

# Définition du matériau BARRE
mat_bar=DEFI_MATERIAU(
    ELAS=_F(E=2.1e+11, NU=0.3, ALPHA=0.0,RHO=7800.0),
)

# Affectation des caractéristiques élémentaires pour les barres et les cables
calbar=AFFE_CARA_ELEM(
    MODELE=affect,
    VERIF='MAILLE',
    BARRE=_F(GROUP_MA='Group_barre', SECTION='GENERALE', CARA='A', VALE=0.0001,),
    CABLE=_F(GROUP_MA='Group_cable', SECTION=Cable_Aire,),
)

# Création des champs de température
ChZero=CREA_CHAMP(
    TYPE_CHAM='NOEU_TEMP_R',
    OPERATION='AFFE',
    MAILLAGE=mail,
    AFFE=(
        _F(TOUT='OUI', NOM_CMP='TEMP', VALE=0.0,),
    ),
)
tempstr=CREA_CHAMP(
    TYPE_CHAM='NOEU_TEMP_R',
    OPERATION='AFFE',
    MAILLAGE=mail,
    AFFE=(
        _F(TOUT='OUI', NOM_CMP='TEMP', VALE=0.0,),
        _F(GROUP_MA='Group_cable', NOM_CMP='TEMP', VALE=-200.0,),
    ),
)

Tfin = 1.0 ; NPas = 20
TPas    = Tfin / NPas
TMilieu = TPas*(NPas/2)

L_LIST=DEFI_LIST_REEL(
    DEBUT=0.0,
    INTERVALLE=_F(JUSQU_A=Tfin, PAS=TPas,),
)

tempresu=CREA_RESU(
    OPERATION='AFFE',
    TYPE_RESU='EVOL_THER',
    NOM_CHAM='TEMP',
    AFFE=(
        _F(CHAM_GD=ChZero,  INST=0.0,),
        _F(CHAM_GD=tempstr, INST=Tfin,),
    ),
)

CTM=AFFE_MATERIAU(
    MAILLAGE=mail,
    MODELE=affect,
    AFFE=(
        _F(GROUP_MA='Group_barre', MATER=mat_bar,),
        _F(GROUP_MA='Group_cable', MATER=mat_cabl,),
    ),
    AFFE_VARC=_F(TOUT='OUI',NOM_VARC='TEMP', EVOL=tempresu, NOM_CHAM='TEMP', VALE_REF=0,),
)


LIAISON=AFFE_CHAR_MECA(
    MODELE=affect,
    DDL_IMPO=(
        _F(GROUP_NO='GN4', DY=0.0, DZ=0.0,),
        _F(GROUP_NO='GN3', DX=0.0, DY=0.0, DZ=0.0),
        _F(GROUP_NO=('GN1','GN2'),  DZ=0.0,),
    ),
)

RESUD=DYNA_NON_LINE(
    MODELE=affect,
    CHAM_MATER=CTM,
    CARA_ELEM=calbar,
    EXCIT=_F(CHARGE=LIAISON,),
    COMPORTEMENT=(
        _F(GROUP_MA = 'Group_cable', RELATION = 'CABLE', DEFORMATION = 'GROT_GDEP'),
        _F(GROUP_MA = 'Group_barre', RELATION = 'ELAS'),
    ),
    INCREMENT=_F(LIST_INST=L_LIST),
    NEWTON=_F(MATRICE='TANGENTE', REAC_ITER=1,),
    CONVERGENCE=_F(
        #RESI_GLOB_MAXI=1.E-3,
        ITER_GLOB_MAXI=15,
        RESI_REFE_RELA=1.0E-06 , FORC_REFE=(1.0,1.0)),
    SCHEMA_TEMPS=_F(SCHEMA='HHT',FORMULATION='DEPLACEMENT',),
    MODE_VIBR=_F(INST=(TMilieu,Tfin),MATR_RIGI='TANGENTE',NB_FREQ=5,),
)

"""
IMPR_RESU(FORMAT='RESULTAT',
    RESU=_F(RESULTAT=RESUD,NOM_CHAM=('DEPL','SIEF_ELGA','DEPL_VIBR'), INST=(TMilieu,Tfin), ),
)
"""

TEST_RESU(
    RESU=(
        _F(PARA='FREQ', INST=TMilieu, RESULTAT=RESUD, VALE_CALC= 6.27962E+01,),
        _F(PARA='FREQ', INST=Tfin,    RESULTAT=RESUD, VALE_CALC= 8.85701E+01,),
    ),
)

FIN()
