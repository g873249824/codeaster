# MODIF  DATE 29/04/2013   AUTEUR DELMAS J.DELMAS 
# TITRE : FISSURE CLASSIQUE EN THERMO-ELASTICITE 2D 
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F(NOM='HSNV132A', NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

MAILLE=LIRE_MAILLAGE(FORMAT='MED',)

MAILLAGE=CREA_MAILLAGE(MAILLAGE=MAILLE,LINE_QUAD=_F(TOUT='OUI'))

MAILLAGE=DEFI_GROUP(reuse =MAILLAGE,
                    MAILLAGE=MAILLAGE,
                    CREA_GROUP_NO=(
                                   _F(NOM='LIGGAU',OPTION='PLAN',POINT=(0.,0.,),VECT_NORMALE=(1.,0.),PRECISION=1.e-6),
                                   _F(NOM='LIGDRO',OPTION='PLAN',POINT=(1.,0.,),VECT_NORMALE=(1.,0.),PRECISION=1.e-6),
                                   _F(NOM='LIGINF',OPTION='PLAN',POINT=(0.,0.,),VECT_NORMALE=(0.,1.),PRECISION=1.e-6),
                                   _F(NOM='PTEXTR',OPTION='ENV_SPHERE',POINT=(1.,1.,),RAYON=1.e-6,PRECISION=1.e-6),
                                   ),
                     );

#--------------------------------------------------------------------
#               DEBUT DU THERMIQUE                                  #
#--------------------------------------------------------------------

MOTH=AFFE_MODELE(MAILLAGE=MAILLAGE,
                 AFFE=_F(TOUT='OUI',
                         PHENOMENE='THERMIQUE',
                         MODELISATION='PLAN',),);

MATH=DEFI_MATERIAU(THER=_F(LAMBDA=1.0,
                           RHO_CP=0.0,),);

CMTH=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                   AFFE=_F(TOUT='OUI',
                           MATER=MATH,),);

CHTH=AFFE_CHAR_THER(MODELE=MOTH,
                    TEMP_IMPO=(_F(GROUP_NO='LIGGAU',TEMP=20.0,),
                               _F(GROUP_NO='LIGDRO',TEMP=220.0,),),);

THLI=THER_LINEAIRE(MODELE=MOTH,
                   CHAM_MATER=CMTH,
                   EXCIT=_F(CHARGE=CHTH,),);

TEMP=CREA_CHAMP(TYPE_CHAM='NOEU_TEMP_R',
                OPERATION='EXTR',
                RESULTAT=THLI,
                NOM_CHAM='TEMP',
                INST=0.0,);

#IMPR_RESU(FORMAT='GMSH',UNITE=37,RESU=_F(CHAM_GD = TEMP,))   
#--------------------------------------------------------------------
#               FIN DU THERMIQUE                                    #
#--------------------------------------------------------------------


MODELE=AFFE_MODELE(MAILLAGE=MAILLAGE,
                   AFFE=(_F(GROUP_MA='SURF',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='D_PLAN',),),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=205000000000.0,
                            NU=0.3,
                            RHO=7800.0,
                            ALPHA=1.282E-05,),);

CHAMPMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                       MODELE=MODELE,
                       AFFE=_F(GROUP_MA='SURF', 
                                 MATER=ACIER,),
                       AFFE_VARC=_F( GROUP_MA='SURF',
                                     NOM_VARC='TEMP',
                                     CHAM_GD=TEMP,
                                     VALE_REF=20.0),
                       );


#*********************************************************************
#                          CONDITIONS AUX LIMITES                    *
#*********************************************************************

CHARBLO=AFFE_CHAR_MECA(MODELE=MODELE,
                       DDL_IMPO=_F(GROUP_NO='LIGINF',
                                   DX=0.0,
                                   DY=0.0,),
                       INFO=1,);

UTOT=MECA_STATIQUE(MODELE=MODELE,
                   CHAM_MATER=CHAMPMAT,
                   EXCIT=_F(CHARGE=CHARBLO,),
                   INST=1.,
                   SOLVEUR=_F(METHODE='MULT_FRONT',
                              RENUM='METIS',),
                   INFO=1,);

#---------------POST-------------------------------------------

#IMPR_RESU(FORMAT='GMSH',UNITE=37,RESU=_F(RESULTAT=UTOT,NOM_CHAM='DEPL'))   

TABDEP= POST_RELEVE_T ( ACTION =_F(INTITULE  = 'DEPLACEMENT',
                        GROUP_NO  = 'PTEXTR',
                        RESULTAT   = UTOT,
                        NOM_CHAM   = 'DEPL',
                        NOM_CMP   = ( 'DX','DY'),
                        OPERATION = 'EXTRACTION',),);
                        
IMPR_TABLE(TABLE=TABDEP)

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=-8.7404262899510004E-4,
           NOM_PARA='DX',
           TABLE=TABDEP,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=3.8260958514619E-3,
           NOM_PARA='DY',
           TABLE=TABDEP,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

FOND1=DEFI_FOND_FISS(MAILLAGE=MAILLAGE,
                     FOND_FISS=_F( GROUP_NO = 'PFON',),
                     LEVRE_SUP=_F( GROUP_MA = 'LEVSUP',),
                     LEVRE_INF=_F( GROUP_MA = 'LEVINF',),
                       )

TABSIF=CALC_G(RESULTAT=UTOT,
              THETA=_F( MODULE = 1.,
                        R_INF = 0.01,
                        R_SUP = 0.05,
                        DIRECTION=(-1., 0., 0.,),
                        FOND_FISS=FOND1),
              OPTION='CALC_K_G'
              )

IMPR_TABLE(TABLE=TABSIF,);

TABG=CALC_G(RESULTAT=UTOT,
              THETA=_F( MODULE = 1.,
                        R_INF = 0.01,
                        R_SUP = 0.05,
                        DIRECTION=(-1., 0., 0.,),
                        FOND_FISS=FOND1),
              OPTION='CALC_G'
              )

IMPR_TABLE(TABLE=TABG,);

PK=POST_K1_K2_K3(MODELISATION='D_PLAN',
                 MATER=ACIER,
                 FOND_FISS = FOND1,
                 RESULTAT  = UTOT,
                )

IMPR_TABLE(TABLE = PK)

# Cas test de non regression sur K1
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=9.0328413451143E6,
           
           NOM_PARA='K1',
           TABLE=TABSIF,
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=8.4543655482163001E6,
           
           NOM_PARA='K1',
           TABLE=PK,
           )

# Cas test de non regression sur G
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=492.81784641923002,
           
           NOM_PARA='G',
           TABLE=TABG,
           )

FIN();
