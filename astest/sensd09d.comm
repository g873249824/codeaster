# MODIF  DATE 13/01/2011   AUTEUR PELLET J.PELLET 
# TITRE SENSIBILITE EFGE_ELNO_DEPL / SIPO_ELNO
# sensd09d.para = tps_job 60 mem_job 128Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#       D'UNE POUTRE 'POU_D_E' PAR RAPPORT AUX PARAMETRES MATERIAU
#       DANS LE CADE D'UNE ANALYSE DYNAMIQUE LINEAIRE HARMONIQUE

DEBUT(CODE=_F(NOM='SENSD09D', NIV_PUB_WEB='INTERNET', VISU_EFICAS='NON'), PAR_LOT='OUI', DEBUG=_F(SDVERI='NON'))
# ----------------------------------------------------------------------
# Poutre a section circulaire (L=0.4m, r=0.02m, ep=0.02m)
# Sensibilite des efforts gene et contrainte par rapport a E et NU
# Conditions aux limites : appuyee-appuyee (flexion)
# La solution de reference est obtenue par difference fines
# ----------------------------------------------------------------------

pi = 3.14159
r = 0.02
ep = 0.02
l = 0.4
rho = 7800.

#           E     NU
sensible=[2.1E11, 0.3, ]

n=len(sensible)
PS=[None]*n

for i in range(n):
    PS[i]=DEFI_PARA_SENSI(VALE=sensible[i])

MAILLAGE=LIRE_MAILLAGE();

MO=AFFE_MODELE(MAILLAGE=MAILLAGE,
               AFFE=_F(GROUP_MA=('POUTRE',),
                       PHENOMENE='MECANIQUE',
                       MODELISATION='POU_D_E',),);

MAT=DEFI_MATERIAU(ELAS_FO=_F(E=PS[0],
                             RHO=rho,
                             NU=PS[1],
                             ),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                    AFFE=(_F(GROUP_MA=('POUTRE',),MATER=MAT,),),)

CARELE=AFFE_CARA_ELEM(MODELE= MO,
                      POUTRE= (_F(GROUP_MA= ( 'POUTRE',),
                                 SECTION= 'CERCLE',
                                 CARA= ('R','EP',),
                                 VALE= (r, ep,),),
                      ),)

CLIM=AFFE_CHAR_MECA(MODELE=MO,
                    DDL_IMPO=(_F(GROUP_NO='FIXE',DX=0.,DZ=0.,DRX=0.,),
                              _F(GROUP_NO='TOUT',DY=0.,DRZ=0.,),),);

CHARGE=AFFE_CHAR_MECA(MODELE=MO,
                    FORCE_NODALE=(_F(NOEUD='NO6',FZ =-1.E5),),);


MATELER=CALC_MATR_ELEM(MODELE=MO,OPTION='RIGI_MECA',
                       CHAM_MATER=CHMAT,
                       CARA_ELEM=CARELE,
                       CHARGE=CLIM);

MATELEM=CALC_MATR_ELEM(MODELE=MO,
                       OPTION='MASS_MECA',
                       CHAM_MATER=CHMAT,
                       CARA_ELEM=CARELE,
                       CHARGE=CLIM);

VECT=CALC_VECT_ELEM(  CHARGE=CHARGE,
                      OPTION='CHAR_MECA' )


NUM=NUME_DDL(MATR_RIGI=MATELER);

MATASSR=ASSE_MATRICE(MATR_ELEM=MATELER,NUME_DDL=NUM);

MATASSM=ASSE_MATRICE(MATR_ELEM=MATELEM,NUME_DDL=NUM);

VECTASS=ASSE_VECTEUR(VECT_ELEM=VECT,NUME_DDL=NUM  )

#LIFREQ=DEFI_LIST_REEL(DEBUT=0., INTERVALLE=_F( JUSQU_A = 5000., NOMBRE = 500))

LIFREQ=DEFI_LIST_REEL(DEBUT=0., INTERVALLE=_F( JUSQU_A = 500., NOMBRE = 50))

DYH=DYNA_LINE_HARM( MODELE=MO, CHAM_MATER=CHMAT,CARA_ELEM=CARELE,
                    MATR_MASS=MATASSM, MATR_RIGI=MATASSR,
                    LIST_FREQ=LIFREQ,
                    TOUT_CHAM='OUI',
                    SENSIBILITE=tuple(PS),
                    EXCIT=_F(  COEF_MULT = 1.,VECT_ASSE = VECTASS)
                     )


DYH = CALC_ELEM(
                reuse = DYH,
                RESULTAT= DYH,NUME_ORDRE=20,
                OPTION = ('EFGE_ELNO_DEPL','SIPO_ELNO',),);

CALC_SENSI(reuse = DYH,RESULTAT= DYH,NUME_ORDRE=20,SENSIBILITE=(PS[0],PS[1]),
                OPTION = ('EFGE_ELNO_DEPL','SIPO_ELNO',),);

IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='EFGE_ELNO_DEPL',NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='EFGE_ELNO_DEPL',SENSIBILITE=(PS[0]),NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='EFGE_ELNO_DEPL',SENSIBILITE=(PS[1]),NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
# MFY = (-1.13115E+04+0.0j)
# MFY(/PS[0]) = (-7.25323E-09+0.0j)
# MFY(/PS[1]) = (0.0+0.0j)

IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='SIPO_ELNO',NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='SIPO_ELNO',SENSIBILITE=(PS[0]),NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
IMPR_RESU(RESU=_F(RESULTAT=DYH,NOM_CHAM='SIPO_ELNO',SENSIBILITE=(PS[1]),NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
# SMFY = (-1.80028E+09+0.0j)
# SMFY(/PS[0]) = (1.15439E-03+0.0j)
# SMFY(/PS[1]) = (0.0+0.0j)

#
# 5. Test par differences finies
#
MATD   = [None]*n
CHMATD = [None]*n
MATELR = [None]*n
MATASR = [None]*n
DYHD   = [None]*n

epsilon= 1.E-3

for i in range(n):
  eps=[1.]*n
  eps[i]=1.0+epsilon
  MATD[i]=DEFI_MATERIAU(ELAS=_F(E=sensible[0]*eps[0],
                             RHO=rho ,
                             NU=sensible[1]*eps[1]))

  CHMATD[i]=AFFE_MATERIAU(MAILLAGE=MAILLAGE,
                       AFFE=_F(TOUT='OUI',MATER=MATD[i],),);

  MATELR[i]=CALC_MATR_ELEM(MODELE=MO,OPTION='RIGI_MECA',
                          CHAM_MATER=CHMATD[i],CARA_ELEM=CARELE,
                          CHARGE=CLIM)

  MATASR[i]=ASSE_MATRICE(MATR_ELEM=MATELR[i],NUME_DDL=NUM)

  DYHD[i]=DYNA_LINE_HARM( MODELE=MO, CHAM_MATER=CHMAT,CARA_ELEM=CARELE,
                          MATR_MASS=MATASSM, MATR_RIGI=MATASR[i],
                          LIST_FREQ=LIFREQ,
                          EXCIT=_F(  COEF_MULT = 1.,VECT_ASSE = VECTASS)
                     )

  DYHD[i] = CALC_ELEM(
                 reuse = DYHD[i],
                 RESULTAT= DYHD[i],
                 OPTION = ('EFGE_ELNO_DEPL','SIPO_ELNO',),);

  IMPR_RESU(RESU=_F(RESULTAT=DYHD[i],NOM_CHAM='EFGE_ELNO_DEPL',NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))
  IMPR_RESU(RESU=_F(RESULTAT=DYHD[i],NOM_CHAM='SIPO_ELNO',NUME_ORDRE=20,NOEUD='NO6',MAILLE='EL6'))

# MFY(/eps[0]) = (-1.13100E+04+0.0j)
# SMFY(/eps[0]) = (-1.80004E+09+0.0j)
# MFY(/eps[1]) = (-1.13115E+04+0.0j)
# SMFY(/eps[1]) = (-1.80028E+09+0.0j)

#
#  Test_Resu non regression
#
TEST_RESU(RESU=(
                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='EFGE_ELNO_DEPL',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='RELATIF',PRECISION=1.E-4,
                   NOM_CMP='MFY',
                   VALE_C =(-1.13115E+04+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='EFGE_ELNO_DEPL',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='RELATIF',PRECISION=2.E-2,
                   NOM_CMP='MFY',SENSIBILITE=PS_0,
                   VALE_C =(-7.14E-09+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='EFGE_ELNO_DEPL',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='ABSOLU',PRECISION=1.E-10,
                   NOM_CMP='MFY',SENSIBILITE=PS_1,
                   VALE_C =(0.0+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='SIPO_ELNO',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='RELATIF',PRECISION=1.E-4,
                   NOM_CMP='SMFY',
                   VALE_C =(-1.80028E+09+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='SIPO_ELNO',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='RELATIF',PRECISION=2.E-2,
                   NOM_CMP='SMFY',SENSIBILITE=PS_0,
                   VALE_C =(1.14E-03+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                _F(RESULTAT=DYH,NUME_ORDRE=20,
                   NOM_CHAM='SIPO_ELNO',NOEUD='NO6',MAILLE='EL6',
                   CRITERE='ABSOLU',PRECISION=1.E-10,
                   NOM_CMP='SMFY',SENSIBILITE=PS_1,
                   VALE_C =(0.0+0.0j),REFERENCE='NON_REGRESSION',VERSION='9.0.23'),

                ),)

FIN()


