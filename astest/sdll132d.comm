# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET', VISU_EFICAS='NON'), DEBUG=_F(SDVERI='OUI'))

# Lecture du maillage
MA = LIRE_MAILLAGE(FORMAT='MED',)

# AFFECTATION DES MODELES DE COMPORTEMENT
MO = AFFE_MODELE(
   MAILLAGE= MA,
   AFFE=(
      _F(GROUP_MA=('S008','S007','S006','S005','S004','S003','S002','S001',),
         PHENOMENE= 'MECANIQUE',
         MODELISATION= 'POU_D_E'),
))


# DEFINITION DES MATERIAUX
MAT0001 = DEFI_MATERIAU(
   ELAS =_F( E= 2.100000e+11, NU= 3.000000e-01, RHO= 7.850000e+03,
             ALPHA= 6.700000e-06) )


# AFFECTATION DES CARACTERISTIQUES DES ELEMENTS
CAREL = AFFE_CARA_ELEM( MODELE= MO,
  # Sections /HEA200
  POUTRE=(
     _F(SECTION= 'GENERALE', GROUP_MA=('S008','S007',),
     CARA= ( 'A','IY','IZ','AY',
             'AZ','EY','EZ','JX',
             'JG','IYR2','IZR2'),
     VALE= ( 5.385256E-03,3.6989697138E-005,1.32140128E-005,1.474994e+00,
             4.466038e+00,0.000000e+00,0.000000e+00,1.969457e-07,
             1.055952e-07,0.000000e+00,0.000000e+00 ),),
  # Sections /IPE220
     _F(SECTION= 'GENERALE', GROUP_MA=('S006',),
     CARA= ( 'A','IY','IZ','AY',
             'AZ','EY','EZ','JX',
             'JG','IYR2','IZR2'),
     VALE= ( 3.33891E-003,2.768639799119360E-005,2.022355764E-006,1.789865e+00,
             2.633754e+00,0.000000e+00,0.000000e+00,8.664922e-08,
             2.232286e-08,0.000000e+00,0.000000e+00 ), ),
  # Sections /IPE160
     _F(SECTION= 'GENERALE', GROUP_MA=('S005','S003',),
     CARA= ( 'A','IY','IZ','AY',
             'AZ','EY','EZ','JX',
             'JG','IYR2','IZR2'),
     VALE= ( 2.0104208E-003,8.685298209498242E-006,6.738155768240001E-007,1.792884e+00,
             2.586199e+00,0.000000e+00,0.000000e+00,3.365044e-08,
             3.891633e-09,0.000000e+00,0.000000e+00 ), ),

  # Sections /HEA140
     _F(SECTION= 'GENERALE', GROUP_MA=('S004',),
     CARA= ( 'A','IY','IZ','AY',
             'AZ','EY','EZ','JX',
             'JG','IYR2','IZR2'),
     VALE= ( 3.1431454E-003,1.034387822400600E-005,3.851526028000000E-006,1.464032e+00,
             4.464173e+00,0.000000e+00,0.000000e+00,7.758124e-08,
             1.473133e-08,0.000000e+00,0.000000e+00 ), ),

  # Sections /IPE120
     _F(SECTION= 'GENERALE', GROUP_MA=('S002','S001',),
     CARA= ( 'A','IY','IZ','AY',
             'AZ','EY','EZ','JX',
             'JG','IYR2','IZR2'),
     VALE= ( 1.3220088E-003,3.175760411570161E-006,2.72719097856E-007,1.774392e+00,
             2.590182e+00,0.000000e+00,0.000000e+00,1.627955e-08,
             8.727362e-10,0.000000e+00,0.000000e+00 ), ),
  ),
  ORIENTATION=(
  # Pour les poutres
     _F(GROUP_MA= 'S008', CARA= 'ANGL_VRIL',
        VALE= -9.000000e+01 ),
     _F(GROUP_MA= 'S007', CARA= 'ANGL_VRIL',
        VALE= -9.000000e+01 ),
     _F(GROUP_MA= 'S006', CARA= 'ANGL_VRIL',
        VALE= 0.000000e+00 ),
     _F(GROUP_MA= 'S005', CARA= 'ANGL_VRIL',
        VALE= 0.000000e+00 ),
     _F(GROUP_MA= 'S004', CARA= 'ANGL_VRIL',
        VALE= -9.000000e+01 ),
     _F(GROUP_MA= 'S003', CARA= 'ANGL_VRIL',
        VALE= -9.000000e+01 ),
     _F(GROUP_MA= 'S002', CARA= 'ANGL_VRIL',
        VALE= 0.000000e+00 ),
     _F(GROUP_MA= 'S001', CARA= 'ANGL_VRIL',
        VALE= 0.000000e+00 ),
    ),
)


CHMAT = AFFE_MATERIAU( MAILLAGE= MA, MODELE= MO,
   AFFE=_F( GROUP_MA= ('S008','S007','S006','S005','S004','S003','S002','S001',),
            MATER= MAT0001 ),
             )

# TEST MASS_INER

INER=POST_ELEM(MASS_INER=_F(TOUT='OUI',),
               MODELE=MO,
               CHAM_MATER=CHMAT,
               CARA_ELEM=CAREL,);

# ----------------------------------------------------------------------
# ----------------------- DEPLACEMENTS ---------------------------------

DEPL = AFFE_CHAR_MECA(
   MODELE= MO,
   DDL_IMPO= (
      _F( NOEUD= 'G00802',
        DX =  0.000000e+00,
        DY =  0.000000e+00,
        DZ =  0.000000e+00,
        DRX=  0.000000e+00,
        DRY=  0.000000e+00,
        DRZ=  0.000000e+00,
         ),
      _F( NOEUD= 'G00702',
        DX =  0.000000e+00,
        DY =  0.000000e+00,
        DZ =  0.000000e+00,
        DRX=  0.000000e+00,
        DRY=  0.000000e+00,
        DRZ=  0.000000e+00,
         ),
      _F( NOEUD= 'G00401',
        DX =  0.000000e+00,
        DY =  0.000000e+00,
        DZ =  0.000000e+00,
        DRX=  0.000000e+00,
        DRY=  0.000000e+00,
        DRZ=  0.000000e+00,
         ),
      _F( NOEUD= 'G00302',
        DX =  0.000000e+00,
        DY =  0.000000e+00,
        DZ =  0.000000e+00,
        DRX=  0.000000e+00,
        DRY=  0.000000e+00,
        DRZ=  0.000000e+00,
         ),
))

# *****************************************************************
#                 A N A L Y S E   M O D A L E
# *****************************************************************

# Poids et inerties de la structure
MASSINER = POST_ELEM(
  MODELE    = MO,
  CHAM_MATER= CHMAT,
  CARA_ELEM = CAREL,
  MASS_INER = _F ( TOUT = 'OUI' ))

# Verification des resultats de POST_ELEM
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=585.758468537,
           NOM_PARA='MASSE',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=2.000000000,
           NOM_PARA='CDG_X',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=2.03967574925,
           NOM_PARA='CDG_Z',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC= 1.56561735E+03,
           NOM_PARA='IX_PRIN_G',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC= 1.81820975E+03,
           NOM_PARA='IY_PRIN_G',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC= 2.23485157E+03,
           NOM_PARA='IZ_PRIN_G',
           TABLE=MASSINER,
           FILTRE=_F(NOM_PARA='ENTITE',
                     VALE_K='TOUT',),
           )

# Matrice elementaire de rigidite
MELRI = CALC_MATR_ELEM(
   MODELE    = MO,
   CHAM_MATER= CHMAT,
   CARA_ELEM = CAREL,
# Conditions aux limites de bloquages
   CHARGE= ( DEPL ),
   OPTION= 'RIGI_MECA' )

# Matrice elementaire de masse
MELMA = CALC_MATR_ELEM(
   MODELE=     MO,
   CHAM_MATER= CHMAT,
   CARA_ELEM=  CAREL,
   OPTION=    'MASS_MECA')

# Numerotation des equations du systeme
NUMDDL  = NUME_DDL( MATR_RIGI= MELRI )
# Matrice assemblee de rigidite
MASRI = ASSE_MATRICE( MATR_ELEM= MELRI, NUME_DDL= NUMDDL )
# Matrice assemblee de masse
MASMA = ASSE_MATRICE( MATR_ELEM= MELMA, NUME_DDL= NUMDDL )


MODAL01=CALC_MODES(MATR_RIGI=MASRI,
                   VERI_MODE=_F(STOP_ERREUR='NON',
                                ),
                   OPTION='BANDE',
                   CALC_FREQ=_F(FREQ=( 0.0,20.0),
                                ),
                   MATR_MASS=MASMA,
                   TYPE_RESU='DYNAMIQUE',
                   )


MODAL02=CALC_MODES(MATR_RIGI=MASRI,
                   VERI_MODE=_F(STOP_ERREUR='NON',
                                ),
                   OPTION='BANDE',
                   CALC_FREQ=_F(FREQ=(20.0,40.0),
                                ),
                   MATR_MASS=MASMA,
                   TYPE_RESU='DYNAMIQUE',
                   )



NORMM01 = NORM_MODE(  MODE  = MODAL01, NORME = 'MASS_GENE',)
NORMM02 = NORM_MODE(  MODE  = MODAL02, NORME = 'MASS_GENE',)

EXTRMODE = EXTR_MODE(
  FILTRE_MODE = ( _F( MODE = NORMM01, CRIT_EXTR='MASS_EFFE_UN', SEUIL=5.0E-4,),
                  _F( MODE = NORMM02, CRIT_EXTR='MASS_EFFE_UN', SEUIL=5.0E-4,),
                ),
  IMPRESSION  = _F( CUMUL='OUI',CRIT_EXTR='MASS_EFFE_UN')
)


TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=9.98316178503,
                   ),
                _F(NUME_ORDRE=2,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=12.3054090119,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=13.0421930932,
                   ),
                _F(NUME_ORDRE=4,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=19.0267560923,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=22.2977469834,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=26.7653558109,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=33.6499455758,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=34.476790496,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=35.1296888165,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='FREQ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=36.8646125525,
                   ),
                _F(NUME_ORDRE=1,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.240393876317,
                   ),
                _F(NUME_ORDRE=2,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.433081172981,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.527057012444,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='MASS_EFFE_UN_DZ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC= 4.1536989003E-4,
                   ),
                _F(NUME_ORDRE=4,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.0799412335197,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.136506718973,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='MASS_EFFE_UN_DZ',
                   RESULTAT=EXTRMODE,
                   VALE_CALC= 2.23671001532E-4,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.0630112344329,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=EXTRMODE,
                   VALE_CALC= 6.12175711067E-4,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC= 5.71540151554E-4,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC= 1.47389085571E-3,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=EXTRMODE,
                   VALE_CALC=0.0126681569373,
                   ),
                ),
          )



# TESTE LA MACRO_COMMANDE : CALC_MODES

MODMECA=CALC_MODES(MATR_RIGI=MASRI,
                   OPTION='BANDE',
                   IMPRESSION=_F(CRIT_EXTR='MASS_EFFE_UN',
                                 CUMUL='OUI',
                                 ),
                   CALC_FREQ=_F(FREQ=( 0.0,20.0,40.0),
                                ),
                   FILTRE_MODE=_F(CRIT_EXTR='MASS_EFFE_UN',
                                  SEUIL=5.0E-4,
                                  ),
                   MATR_MASS=MASMA,
                   NORM_MODE=_F(NORME='MASS_GENE',
                                ),
                   )

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=9.98316178503,
                   ),
                _F(NUME_ORDRE=2,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=12.3054090119,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=13.0421930932,
                   ),
                _F(NUME_ORDRE=4,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=19.0267560923,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=22.2977469834,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=26.7653558109,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=33.6499455758,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=34.476790496,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=35.1296888165,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='FREQ',
                   RESULTAT=MODMECA,
                   VALE_CALC=36.8646125525,
                   ),
                _F(NUME_ORDRE=1,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.240393876317,
                   ),
                _F(NUME_ORDRE=2,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.433081172981,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.527057012444,
                   ),
                _F(NUME_ORDRE=3,
                   PARA='MASS_EFFE_UN_DZ',
                   RESULTAT=MODMECA,
                   VALE_CALC= 4.1536989003E-4,
                   ),
                _F(NUME_ORDRE=4,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.0799412335197,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.136506718973,
                   ),
                _F(NUME_ORDRE=5,
                   PARA='MASS_EFFE_UN_DZ',
                   RESULTAT=MODMECA,
                   VALE_CALC= 2.23671001532E-4,
                   ),
                _F(NUME_ORDRE=6,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.0630112344329,
                   ),
                _F(NUME_ORDRE=7,
                   PARA='MASS_EFFE_UN_DY',
                   RESULTAT=MODMECA,
                   VALE_CALC= 6.12175711067E-4,
                   ),
                _F(NUME_ORDRE=8,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC= 5.71540151554E-4,
                   ),
                _F(NUME_ORDRE=9,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC= 1.47389085571E-3,
                   ),
                _F(NUME_ORDRE=10,
                   PARA='MASS_EFFE_UN_DX',
                   RESULTAT=MODMECA,
                   VALE_CALC=0.0126681569373,
                   ),
                ),
          )

FIN()
