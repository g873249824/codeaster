# MODIF  DATE 08/12/2008   AUTEUR SELLENET N.SELLENET 
# TITRE VIBRATIONS D UN PENDULE EN ROTATION
# RESPONSABLE VABHHTS J.PELLET
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# ELEMENTS  : HEXA20

DEBUT(CODE=_F(NOM='SDLL403A',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

ACIER=DEFI_MATERIAU(ELAS=_F(E=7.E10,
                            NU=0.3,
                            RHO=2700.0,),);

MAYA=LIRE_MAILLAGE();

MATER=AFFE_MATERIAU(MAILLAGE=MAYA,
                    AFFE=_F(TOUT='OUI',
                            MATER=ACIER,),);

STRUCTUR=AFFE_MODELE(MAILLAGE=MAYA,
                     AFFE=(_F(GROUP_MA='VOLUME',
                              PHENOMENE='MECANIQUE',
                              MODELISATION='3D',),
                           _F(GROUP_MA='FACES',
                              PHENOMENE='MECANIQUE',
                              MODELISATION='3D',),),);
# CONDITIONS AUX LIMITES

CHARGE_1=AFFE_CHAR_MECA(MODELE=STRUCTUR,
                        PESANTEUR=(-9.81,0.0,0.0,1.0,),
                        ROTATION=(10.0,0.0,0.0,1.0,),
                        DDL_IMPO=(_F(GROUP_NO='POINT_A',
                                     DX=0.0,
                                     DY=0.0,
                                     DZ=0.0,),
                                  _F(NOEUD='NO000697',
                                     DY=0.0,
                                     DZ=0.0,),
                                  _F(NOEUD='NO000001',
                                     DY=0.0,),),
                        LIAISON_SOLIDE=_F(GROUP_MA='FACES',),);
# CALCUL DES MATRICES ELEMENTAIRES DE RAIDEUR
# ET DU VECTEUR DE CHARGE

K1_ELEM=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                       MODELE=STRUCTUR,
                       CHAM_MATER=MATER,
                       CHARGE=CHARGE_1,);

KW_ELEM=CALC_MATR_ELEM(OPTION='RIGI_ROTA',
                       MODELE=STRUCTUR,
                       CHAM_MATER=MATER,
                       CHARGE=CHARGE_1,);

CH_ELEM=CALC_VECT_ELEM(OPTION='CHAR_MECA',
                       CHARGE=CHARGE_1,
                       CHAM_MATER=MATER,);
# NUMEROTATION

NUMERO_1=NUME_DDL(MATR_RIGI=(K1_ELEM,KW_ELEM,),);
#
# ASSEMBLAGE DE LA MATRICE DE RAIDEUR STATIQUE KTOT = K + KW

K1_ASSE=ASSE_MATRICE(MATR_ELEM=K1_ELEM,
                     NUME_DDL=NUMERO_1,);

KW_ASSE=ASSE_MATRICE(MATR_ELEM=KW_ELEM,
                     NUME_DDL=NUMERO_1,);

K_STAT=COMB_MATR_ASSE(COMB_R=(_F(MATR_ASSE=K1_ASSE,
                                 COEF_R=1.0,),
                              _F(MATR_ASSE=KW_ASSE,
                                 COEF_R=1.0,),),);
#
# ASSEMBLAGE DU VECTEUR DE CHARGE

CH_ASSE=ASSE_VECTEUR(VECT_ELEM=CH_ELEM,
                     NUME_DDL=NUMERO_1,);
#
# CALCUL STATIQUE

RESU=MECA_STATIQUE(MODELE=STRUCTUR,
                   CHAM_MATER=MATER,
                   EXCIT=_F(CHARGE=CHARGE_1,),);

#
# CALCUL DU CHAMP DE CONTRAINTES

SIGMA=CREA_CHAMP( OPERATION='EXTR',
                  TYPE_CHAM='ELGA_SIEF_R',
                  RESULTAT=RESU, NUME_ORDRE=1,
                  NOM_CHAM='SIEF_ELGA_DEPL' )

CHARGE_2=AFFE_CHAR_MECA(MODELE=STRUCTUR,
                        PESANTEUR=(-9.81,0.0,0.0,1.0,),
                        ROTATION=(10.0,0.0,0.0,1.0,),
                        DDL_IMPO=(_F(GROUP_NO='POINT_A',
                                     DX=0.0,
                                     DY=0.0,
                                     DZ=0.0,),
                                  _F(NOEUD='NO000697',
                                     DY=0.0,),
                                  _F(NOEUD='NO000001',
                                     DY=0.0,),),
                        LIAISON_SOLIDE=_F(GROUP_MA='FACES',),);
#
# CALCUL DES MATRICES ELEMENTAIRES POUR LE CALCUL MODAL

KS_ELEM=CALC_MATR_ELEM(OPTION='RIGI_GEOM',
                       MODELE=STRUCTUR,
                       SIEF_ELGA=SIGMA,);

K2_ELEM=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                       MODELE=STRUCTUR,
                       CHAM_MATER=MATER,
                       CHARGE=CHARGE_2,);

M_ELEM=CALC_MATR_ELEM(OPTION='MASS_MECA',
                      MODELE=STRUCTUR,
                      CHAM_MATER=MATER,
                      CHARGE=CHARGE_2,);
#
# NUMEROTATION POUR LE CALCUL MODAL

NUMERO_2=NUME_DDL(MATR_RIGI=(K2_ELEM,KS_ELEM,),
                  METHODE='MULT_FRONT',);
#
# ASSEMBLAGE DE LA MATRICE DE RAIDEUR STATIQUE KTOT = K + KW

K2_ASSE=ASSE_MATRICE(MATR_ELEM=K2_ELEM,
                     NUME_DDL=NUMERO_2,);

KS_ASSE=ASSE_MATRICE(MATR_ELEM=KS_ELEM,
                     NUME_DDL=NUMERO_2,);

K_MODAL=COMB_MATR_ASSE(COMB_R=(_F(MATR_ASSE=K2_ASSE,
                                  COEF_R=1.0,),
                               _F(MATR_ASSE=KS_ASSE,
                                  COEF_R=1.0,),),);

M_ASSE=ASSE_MATRICE(MATR_ELEM=M_ELEM,
                    NUME_DDL=NUMERO_2,);

MODE_1=MODE_ITER_SIMULT(MATR_A=K_MODAL,
                        MATR_B=M_ASSE,
                        CALC_FREQ=_F(OPTION='PLUS_PETITE',
                                     NMAX_FREQ=20,
                                     NPREC_SOLVEUR=9,),
                        VERI_MODE=_F(SEUIL=0.0001,),);
#----------------------------------------------------------------------
# pour tester la possibilite d'imprimer un MODE_MECA au format 'IDEAS'
# et de poursuivre la calcul apres l'avoir relu :
#----------------------------------------------------------------------

IMPR_RESU( FORMAT='IDEAS',UNITE=75,
           RESU=_F(RESULTAT=MODE_1, ),);

MODE_2=LIRE_RESU(TYPE_RESU='MODE_MECA',
                 FORMAT='IDEAS',
                 MAILLAGE=MAYA,
                 UNITE=75,
                 NOM_CHAM='DEPL',
                 FORMAT_IDEAS=_F(NOM_CHAM='DEPL',
                                 NUME_DATASET=55,
                                 RECORD_6=(1,2,3,8,2,6,),
                                 POSI_ORDRE=(7,3,),
                                 POSI_NUME_MODE=(7,4,),
                                 POSI_MASS_GENE=(8,2,),
                                 POSI_FREQ=(8,1,),
                                 NOM_CMP=('DX','DY','DZ',),),
                 TOUT_ORDRE='OUI',);
#----------------------------------------------------------------------

TEST_RESU(RESU=(_F(RESULTAT=MODE_2,
                   NUME_MODE=1,
                   PARA='FREQ',
                   VALE=1.75,
                   CRITERE='RELATIF',
                   PRECISION=0.023,
                   REFERENCE='SOURCE_EXTERNE',),
                _F(RESULTAT=MODE_2,
                   NUME_MODE=4,
                   PARA='FREQ',
                   VALE=100.2,
                   CRITERE='RELATIF',
                   PRECISION=0.001,
                   REFERENCE='SOURCE_EXTERNE',),
                _F(RESULTAT=MODE_2,
                   NUME_MODE=6,
                   PARA='FREQ',
                   VALE=324.0,
                   CRITERE='RELATIF',
                   PRECISION=0.003,
                   REFERENCE='SOURCE_EXTERNE',),
                _F(RESULTAT=MODE_2,
                   NUME_MODE=9,
                   PARA='FREQ',
                   VALE=674.4,
                   CRITERE='RELATIF',
                   PRECISION=0.005,
                   REFERENCE='SOURCE_EXTERNE',),
                _F(RESULTAT=MODE_2,
                   NUME_MODE=12,
                   PARA='FREQ',
                   VALE=1150.0,
                   CRITERE='RELATIF',
                   PRECISION=0.007,
                   REFERENCE='SOURCE_EXTERNE',),
                _F(RESULTAT=MODE_2,
                   NUME_MODE=15,
                   PARA='FREQ',
                   VALE=1748.0,
                   CRITERE='RELATIF',
                   PRECISION=0.011,
                   REFERENCE='SOURCE_EXTERNE',),),);

FIN();
