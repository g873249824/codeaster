# TITRE CHAUFFAGE D UN MILIEU POREUX SANS AIR
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# (CALCUL D_PLAN_THVD)
DEBUT(CODE=_F(NOM='WTNP107A',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

# Liste des premiers instants de sauvegarde :

INST1=DEFI_LIST_REEL(
                     DEBUT=0.0,
                     INTERVALLE=(_F(JUSQU_A=250,
                                    NOMBRE=10,),)
                                    ,);

MAIL=LIRE_MAILLAGE(FORMAT='MED',);
# Definition des groupes pour les conditions aux limites :

MAIL=DEFI_GROUP(reuse =MAIL,
                MAILLAGE=MAIL,
                CREA_GROUP_NO=(_F(
                                 GROUP_MA='HAUT',),
                               _F(GROUP_MA='BAS',),
                               _F(GROUP_MA='DROITE',),
                               _F(GROUP_MA='GAUCHE',)
                  ,),);
MAIL=DEFI_GROUP( reuse=MAIL,
               MAILLAGE=MAIL,
               CREA_GROUP_NO=(_F(NOM='DROITES',
                                 CRIT_NOEUD='SOMMET',
                                 GROUP_MA='DROITE'),),)
MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=(_F(TOUT='OUI',
                            PHENOMENE='MECANIQUE',
                            MODELISATION='D_PLAN_THVD',),),);
#----------------------------------------------------------------------

UN=DEFI_CONSTANTE(VALE=1.0,);
ZERO=DEFI_CONSTANTE(VALE=0.0,);
T80=DEFI_CONSTANTE(VALE=80.0,);



VISCOLIQ=DEFI_CONSTANTE(VALE=0.000354,);

DVISCOL=DEFI_CONSTANTE(VALE=0.0,);
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Viscosites dynamiques de l air et la vapeur,
# supposees egales dans Code_ASTER :

VISCOGAZ=DEFI_CONSTANTE(VALE=1.21e-05,);
# Derivee de la viscosite dynamique de l air et de la vapeur
# par rapport a la temperature :

DVISCOG=DEFI_CONSTANTE(VALE=0.0,);
#----------------------------------------------------------------------
# Coefficient de conductivite thermique de l eau :

LAMBL_CO=DEFI_CONSTANTE(VALE=0.669,);
# Coefficient de conductivite thermique du sable HUMIDE

LAMBS_CO=DEFI_CONSTANTE(VALE=2.4,);
# Coefficients de conductivite thermique de l air sec et de la vapeur
# supposes egaux dans Code_ASTER :

LAMB=DEFI_CONSTANTE(VALE=0.0245,);
#----------------------------------------------------------------------
#    FONCTION SATURATION ET SA DERIVEE (UNITE DE PRESSION : Pa)
#    en fonction de la pression capillaire
#    par une loi du type Van Gernuchten (doc. CEA) :
# NOTABENE : contrairement a la modelisation THH, la modelisation THV
#            evite les singularites numeriques et permet
#            d atteindre un degre de saturation maximal de 1
# Intervalle de pression capillaire
# pour le calcul de la saturation (liquide) :

LIPCAP=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=_F(JUSQU_A=70000.0,
                                    PAS=1000.0,),);

SL = FORMULE(NOM_PARA='PCAP',VALE='(((PCAP/(6.81E3))**(1./0.37)+1.)**(-1./1.37))')

DSL = FORMULE(NOM_PARA='PCAP',VALE=''' (-1/(1.37*0.37))*(((PCAP/(6.81E3))**(1./0.37)
+1.)**(-2.37/1.37))*((PCAP**(0.63/0.37))/((6.81E3)**(1./0.37)))''');
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

SATU=CALC_FONC_INTERP(FONCTION=SL,
                      NOM_PARA='PCAP',
                      LIST_PARA=LIPCAP,
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      INFO=2,);

DSATU=CALC_FONC_INTERP(FONCTION=DSL,
                      NOM_PARA='PCAP',
                       LIST_PARA=LIPCAP,
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);
#----------------------------------------------------------------------
#       FONCTIONS PERMEABILITES RELATIVES ET LEURS DERIVEES :
# Intervalle de saturation pour le calcul des permeabilites relatives
# de l eau liquide et du melange gazeux :

LISAT=DEFI_LIST_REEL(DEBUT=0.0,
                     INTERVALLE=_F(JUSQU_A=1,
                                   PAS=0.1,),);
# -----------
#  POUR L EAU :
# -----------

PERM = FORMULE(NOM_PARA='SAT',VALE='''(1/(tanh(4.9896)+tanh(4.2504)))
*tanh(9.24*(SAT-0.54))+1/(tanh(4.9896)+
tanh(4.2504))*tanh(4.9896)''');


DPERM = FORMULE(NOM_PARA='SAT',VALE='''(36.96/(tanh(4.9896)
+tanh(4.2504)))
*exp(-18.48*(SAT+0.54))/((exp(-18.48*SAT)+exp(-9.9792))**2)''');



# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

PERML=CALC_FONC_INTERP(FONCTION=PERM,
                      NOM_PARA='SAT',
                       LIST_PARA=LISAT,
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

DPERML=CALC_FONC_INTERP(FONCTION=DPERM,
                      NOM_PARA='SAT',
                        LIST_PARA=LISAT,
                        PROL_DROITE='CONSTANT',
                        PROL_GAUCHE='CONSTANT',
                        INFO=2,);

# -----------------------
#  POUR LE MELANGE GAZEUX :
# -----------------------

PG = FORMULE(NOM_PARA='SAT',VALE=''' (1/(tanh(2.8749)+tanh(4.8951)))
*tanh(7.77*(0.37-SAT))
+(1/(tanh(2.8749)+tanh(4.8951)))*tanh(4.8951)''');

DPG = FORMULE(NOM_PARA='SAT',VALE='''(-31.08/(tanh(2.8749)+tanh(4.8951)))
*exp(15.54*(SAT+0.37))
/((exp(15.54*SAT)+exp(5.7498))**2.)''');


# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

PERMG=CALC_FONC_INTERP(FONCTION=PG,
                       NOM_PARA='SAT',
                       LIST_PARA=LISAT,
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

DPERMG=CALC_FONC_INTERP(FONCTION=DPG,
                        NOM_PARA='SAT',
                        LIST_PARA=LISAT,
                        PROL_DROITE='CONSTANT',
                        PROL_GAUCHE='CONSTANT',
                        INFO=2,);

LISA=DEFI_LIST_REEL(DEBUT=0.0,
                     INTERVALLE=_F(JUSQU_A=1.0,
                                   PAS=0.1,),);

LAS = FORMULE(NOM_PARA='SAT',VALE='0.4*SAT');

LS=CALC_FONC_INTERP(FONCTION=LAS,
                       NOM_PARA='SAT',
                       LIST_PARA=LISA,
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

DLS=DEFI_CONSTANTE(VALE=0.4,);

#----------------------------------------------------------------------
#           CARACTERISTIQUES PHYSIQUES DU MILIEU POREUX
#             (SABLE  +  EAU  +  VAPEUR  +  AIR SEC)
#----------------------------------------------------------------------
# Permeabilite intrinseque du squelette de sable :

KINT=DEFI_CONSTANTE(VALE=2.5e-12,);
#----------------------------------------------------------------------
# Caracteristiques physiques du squelette de sable :

MATER=DEFI_MATERIAU(ELAS=_F(E=70000000.0,
                            NU=0.4,
                            RHO=1600.0,
                            ALPHA=0.0,),
                      COMP_THM = 'LIQU_VAPE',
                    THM_LIQU=_F(RHO=958.6,
                                UN_SUR_K=0.0,
                                ALPHA=0.0,
                                CP=4199.0,
                                VISC=VISCOLIQ,
                                D_VISC_TEMP=DVISCOL,
                                ),
                    THM_GAZ=_F(MASS_MOL=0.02896,
                               CP=1009.0,
                               VISC=VISCOGAZ,
                               D_VISC_TEMP=ZERO,
                               ),
                    THM_VAPE_GAZ=_F(MASS_MOL=0.018,
                                    CP=1890.0,
                                    VISC=VISCOGAZ,
                                    D_VISC_TEMP=ZERO,),
                    THM_INIT=_F(TEMP=273.0,
                                PRE1=101325.0,
                                PRE2=0.0,
                                PORO=0.4,
                                PRES_VAPE=47444.0,
                                DEGR_SATU=0.803483,),
                    THM_DIFFU=_F(R_GAZ=8.31451,
                                 RHO=1348.0,
                                 CP=800.0,
                                 BIOT_COEF=1.0,
                                 SATU_PRES=SATU,
                                 D_SATU_PRES=DSATU,
                                 PESA_X=0.0,
                                 PESA_Y=0.0,
                                 PESA_Z=0.0,
                                 PERM_IN=KINT,
                                 PERM_LIQU=PERML,
                                 D_PERM_LIQU_SATU=DPERML,
                                 PERM_GAZ=PERMG,
                                 D_PERM_SATU_GAZ=DPERMG,
                                 D_PERM_PRES_GAZ=ZERO,
                                 LAMB_T=LAMBL_CO,
                                 D_LB_T=ZERO,
                                 LAMB_S=LS,
                                 D_LB_S=DLS,
                                 LAMB_CT=1.44,
                                 ),);
#----------------------------------------------------------------------
#    AFFECTATION DES CARACTERISTIQUES DU MILIEU POREUX AU MAILLAGE

CHMAT0=AFFE_MATERIAU(MAILLAGE=MAIL,
                     AFFE=_F(TOUT='OUI',
                             MATER=MATER,),);
#----------------------------------------------------------------------
#                     AFFECTATION DE L ETAT INITIAL
# Type d affectation :

CHAMNO=CREA_CHAMP(MAILLAGE=MAIL,
                    OPERATION='AFFE',
                    TYPE_CHAM='NOEU_DEPL_R',
                    AFFE=(_F(TOUT='OUI',
                             NOM_CMP='TEMP',
                             VALE=80,),
                          _F(TOUT='OUI',
                             NOM_CMP='PRE1',
                             VALE=0.0,),),);


FPRES = FORMULE(NOM_PARA=('X','Y','Z'),VALE=' 0.0 ');



#---------------------------------------------------------------------
#             AFFECTATION DES CONDITIONS AUX LIMITES

CALDEP=AFFE_CHAR_MECA_F(MODELE=MODELE,
                        DDL_IMPO=(_F(GROUP_NO='DROITES',
                                     TEMP=T80,
                                     PRE1=FPRES,),
                                 ),);

# Puissance rayonnee par le colis :

CAL_CAN=AFFE_CHAR_MECA(MODELE=MODELE,
                       FLUX_THM_REP=(_F(GROUP_MA='GAUCHE',
                                        FLUN=50000.0,
                                        FLUN_HYDR1=0.0,
                                        ),
                                        _F(GROUP_MA='BAS',
                                        FLUN=0.0,
                                        FLUN_HYDR1=0.0,
                                        ),
                                        _F(GROUP_MA='HAUT',
                                        FLUN=0.0,
                                        FLUN_HYDR1=0.0,
                                        ),
                                        ),);
#---------------------------------------------------------------------
#           AFFECTATION DES FLUX ET ENTHALPIES INITIAUX

SIGINIT=CREA_CHAMP(TYPE_CHAM='CART_SIEF_R',
                   OPERATION='AFFE',
                   MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           NOM_CMP=('M11','FH11X','FH11Y','ENT11','M12','FH12X','FH12Y','ENT12','QPRIM','FHTX','FHTY',),
                           VALE=(0.0,0.0,0.0,10,0.0,0.0,0.0,2307539.,0.0,0.0,0.0,),),);
#---------------------------------------------------------------------

DEFLIST1 =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST = INST1),
                        ECHEC=_F(EVENEMENT     = 'ERREUR',
                                 ACTION        = 'DECOUPE',
                                 SUBD_METHODE  = 'MANUEL',
                                 SUBD_PAS      = 2,
                                 SUBD_PAS_MINI = 5.,),)

U0=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHMAT0,
                 EXCIT=(_F(CHARGE=CALDEP,),
                        _F(CHARGE=CAL_CAN,),
                        ),
                 COMP_INCR=_F(RELATION='KIT_THV',
                              RELATION_KIT=('LIQU_VAPE','HYDR_UTIL',),
                  ),
                 ETAT_INIT=_F(DEPL=CHAMNO,
                              SIGM=SIGINIT,),
                 INCREMENT=_F(LIST_INST=DEFLIST1,
                              ),
                 NEWTON=_F(MATRICE='TANGENTE',
                           REAC_ITER=1,),
                 CONVERGENCE=_F(RESI_GLOB_RELA=1e-12,
                                ITER_GLOB_MAXI=30,),
                 ARCHIVAGE=_F(PAS_ARCH=1,),);
# * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ** * * *

U0=CALC_CHAMP(reuse=U0,RESULTAT=U0,CONTRAINTE=('SIEF_ELNO'),VARI_INTERNE=('VARI_ELNO'))

#---------------------------------------------------------------------

ZMP=INTE_MAIL_2D (MAILLAGE=MAIL,
               DEFI_CHEMIN=_F(GROUP_MA='BAS',),);



TEST_RESU(RESU=_F(INST=250.0,
                  RESULTAT=U0,
                  NOM_CHAM='DEPL',
                  NOEUD='NO13',
                  NOM_CMP='TEMP',
                  VALE_CALC=115.74798806406,
                  CRITERE='RELATIF',
                  ),
          )

FIN();
