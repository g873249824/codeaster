# TITRE CALCUL DE MODE NON-LINEAIRE TUBE (CONTACT ANNULAIRE)
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.                                                   
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

jeu = 2.9E-4
Ko = 4.E+6 #/ 5

DEBUT(CODE=_F(NOM='SDNL137A',NIV_PUB_WEB='INTERNET'),
      DEBUG=_F( SDVERI     = 'OUI',),
     )

maill=LIRE_MAILLAGE(UNITE=20, FORMAT='MED',
                    INFO=1,);

modele=AFFE_MODELE(MAILLAGE=maill,
                   INFO=1,
                   AFFE=( _F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='POU_D_E',),
                   ),);

mat=DEFI_MATERIAU(ELAS=_F(E=2.056E+11,
                          NU=0.3,
                          RHO=8357.0,),);

affemat=AFFE_MATERIAU(MAILLAGE=maill,
                      AFFE=_F(TOUT='OUI',
                              MATER=mat,),);

carel=AFFE_CARA_ELEM(MODELE=modele,
                     POUTRE=_F(GROUP_MA='Tube',
                               SECTION='CERCLE',
                               CARA=('R','EP',),
                               VALE=(11.11E-3, 1.27E-3,),),
                    );

carm=AFFE_CHAR_CINE(MODELE=modele,
                   MECA_IMPO=(_F(GROUP_NO='BaseL',
                                 DX=0., DY=0., DZ=0.,
                                 DRX=0., DRY=0., DRZ=0.,),
                              _F(GROUP_NO='BaseR',
                                 DX=0., DY=0., DZ=0.,
                                 DRX=0., DRY=0., DRZ=0.,),
                             )
                    );

K_ELEM=CALC_MATR_ELEM(OPTION='RIGI_MECA',
                      MODELE=modele,
                      CHAM_MATER=affemat,
                      CARA_ELEM=carel,);

M_ELEM=CALC_MATR_ELEM(OPTION='MASS_MECA',
                      MODELE=modele,
                      CHAM_MATER=affemat,
                      CARA_ELEM=carel,);

NUM=NUME_DDL(MATR_RIGI=K_ELEM,);


K_ASSE=ASSE_MATRICE(MATR_ELEM=K_ELEM,
                    NUME_DDL=NUM,
                    CHAR_CINE=carm,);

M_ASSE=ASSE_MATRICE(MATR_ELEM=M_ELEM,
                    NUME_DDL=NUM,
                    CHAR_CINE=carm,);

MODES=MODE_ITER_SIMULT(MATR_RIGI=K_ASSE,
                       MATR_MASS=M_ASSE,
                       METHODE='SORENSEN',
                       CALC_FREQ=_F(OPTION = 'BANDE',FREQ = (3., 7.,),),
                       SOLVEUR=_F(METHODE='MUMPS',),
                      );

ndiscr=1
decal=0.1*jeu

hu=1
hf=201
eta=2.5e-5
nbranch=25

MNL=MODE_NON_LINE(ETAT_INIT=_F(MODE_LINE = MODES,NUME_ORDRE = 1,
                               DIR_EVOLUTION =-1,),
                  MATR_RIGI=K_ASSE,
                  MATR_MASS=M_ASSE,
                  RESOLUTION=_F(METHODE='EHMAN',
                                NB_HARM_LINE=hu,
                                NB_HARM_NONL=hf,
                                NB_PAS_MAN=ndiscr,
                                NB_BRANCHE=nbranch,
                                CRIT_ORDR_BIFURCATION=5, 
                                RESI_RELA_BIFURCATION=1.E-10,
                                ),
                  CHOC=(
                      _F(OBSTACLE='CERCLE',
                         GROUP_NO='ObsL',
                         NOM_CMP=('DX','DY'),
                         JEU=jeu,
                         RIGI_NOR=Ko,
                         PARA_REGUL=eta,
                         ORIG_OBST=(0.,decal,0.),
                         ),
                      _F(OBSTACLE='CERCLE',
                         GROUP_NO='ObsR',
                         NOM_CMP=('DX','DY'),
                         JEU=jeu,
                         RIGI_NOR=Ko,
                         PARA_REGUL=eta,
                         ORIG_OBST=(0.,decal,0.),
                         ),
                      ),
         ) 


#IMPR_TABLE(TABLE = MNL)

TTTS =CALC_TABLE(TABLE=MNL,
                 ACTION=(
                       _F(OPERATION='FILTRE',NOM_PARA=('FREQUENCE'),CRIT_COMP = 'GT',
                          VALE=11.5,),
                       _F(OPERATION='FILTRE',NOM_PARA=('FREQUENCE'),CRIT_COMP = 'LT',
                          VALE=12.8,),
                       _F(OPERATION='FILTRE',NOM_PARA=('ENERGIE'),CRIT_COMP = 'GT',
                          VALE=4e-4,),
                       _F(OPERATION='FILTRE',NOM_PARA=('ENERGIE'),CRIT_COMP = 'LT',
                          VALE=5e-4,),
                 ),)

#IMPR_TABLE(TABLE = TTTS)
#valeurs calculees sur machine locale
fi = 11.9664953639255
ei = 4.35944621218825E-4

TEST_TABLE( TABLE   = TTTS,NOM_PARA  = 'FREQUENCE',
           FILTRE=_F(NOM_PARA='STABILITE',
                     VALE_K='NON_EVALUE',),
             VALE_CALC= fi,
             TOLE_MACHINE=1.E-02,  # variation du point de controle en fonction de la machine
             REFERENCE = 'AUTRE_ASTER',
             VALE_REFE= fi,
             PRECISION = 1.E-2,
              )

TEST_TABLE( TABLE   = TTTS,NOM_PARA  = 'ENERGIE',
           FILTRE=_F(NOM_PARA='STABILITE',
                     VALE_K='NON_EVALUE',),
             VALE_CALC= ei,
             TOLE_MACHINE=1.E-02,  # variation du point de controle en fonction de la machine
             REFERENCE = 'AUTRE_ASTER',
             VALE_REFE= ei,
             PRECISION = 1.E-2,
              )


FIN()
