# MODIF  DATE 11/10/2005   AUTEUR VABHHTS J.PELLET 
# RESPONSABLE VABHHTS J.PELLET
# TITRE VALIDATION DE LA COMMANDE PROJ_CHAMP/ELEM (EN 2D ET EN FILAIRE)
#            CONFIGURATION MANAGEMENT OF EDF VERSION
#======================================================================
# COPYRIGHT (C)1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE,OR
# (AT YOUR OPTION)ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL,BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT,WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE,92141 CLAMART CEDEX,FRANCE.
#======================================================================
#CAS_TEST__: ZZZZ110A

DEBUT(CODE=_F(  NOM='ZZZZ110A',NIV_PUB_WEB='INTERNET'))

#---------------------------------------------------------------------------------
# Description du test :
#-----------------------
# 0) Les modeles CARRE1 et CARRE2 sont 2 maillages differents du meme carre ABCD
#    situe dans l'espace [0,1]X[0,1]       D--C
#    AC est une diagonale de ce carre.     !  !
#                                          A--B
#
# 1) les 3 "modeles" CARRE1, CARRE2 et AC sont en fait des GROUP_MA de
#    l'unique maillage GIBI zzzz110a.mgib
# 2) le champ que l'on projette d'un modele sur l'autre est un champ analytique de
#     temperature : T= 3. + X + Y
#    On doit donc avoir : T(A)=3 ; T(B)=4 ; T(C)=5
#---------------------------------------------------------------------------------

FTEMP = FORMULE(NOM_PARA=('X','Y','INST'),VALE='3. + X + Y')
PRE_GIBI(UNITE_GIBI=19,UNITE_MAILLAGE=20)
MA=LIRE_MAILLAGE(UNITE=20)
XX1=CREA_CHAMP(OPERATION='EXTR',TYPE_CHAM='NOEU_GEOM_R',MAILLAGE=MA,NOM_CHAM='GEOMETRIE',INFO=1,)
DETRUIRE(CONCEPT=_F(NOM=XX1),INFO=1)


# creation des 3 modeles CARRE1, CARRE2 et AC :
#----------------------------------------------
CARRE1=AFFE_MODELE(MAILLAGE=MA, AFFE=_F( GROUP_MA='CARRE1',PHENOMENE='THERMIQUE',MODELISATION='PLAN'))
CARRE2=AFFE_MODELE(MAILLAGE=MA, AFFE=_F( GROUP_MA='CARRE2',PHENOMENE='THERMIQUE',MODELISATION='PLAN'))
AC    =AFFE_MODELE(MAILLAGE=MA, AFFE=_F( GROUP_MA='AC',PHENOMENE='THERMIQUE',MODELISATION='COQUE_PLAN'))


# creation des 3 evol_ther sur CARRE1, CARRE2 et AC :  T_CARRE1, T_CARRE2 et T_AC
#---------------------------------------------------------------------------------
XX=CREA_CHAMP(OPERATION='AFFE',TYPE_CHAM='NOEU_TEMP_F', MAILLAGE=MA,
                  AFFE=_F(GROUP_MA='CARRE1', NOM_CMP=('TEMP',), VALE_F=(FTEMP,))  )
T_CARRE1=CREA_RESU(OPERATION='AFFE', TYPE_RESU='EVOL_THER', NOM_CHAM='TEMP',
                 AFFE=_F(INST=1., CHAM_GD = XX)  )
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)

XX=CREA_CHAMP(OPERATION='AFFE',TYPE_CHAM='NOEU_TEMP_F', MAILLAGE=MA,
                  AFFE=_F(GROUP_MA='CARRE2', NOM_CMP=('TEMP',), VALE_F=(FTEMP,))  )
T_CARRE2=CREA_RESU(OPERATION='AFFE', TYPE_RESU='EVOL_THER', NOM_CHAM='TEMP',
                 AFFE=_F(INST=1., CHAM_GD = XX)  )
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)

XX=CREA_CHAMP(OPERATION='AFFE',TYPE_CHAM='NOEU_TEMP_F', MAILLAGE=MA,
                  AFFE=_F(GROUP_MA='AC', NOM_CMP=('TEMP',), VALE_F=(FTEMP,))  )
T_AC=CREA_RESU(OPERATION='AFFE', TYPE_RESU='EVOL_THER', NOM_CHAM='TEMP',
                 AFFE=_F(INST=1., CHAM_GD = XX)  )
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)


#=================================================================================
# 1) projection d'un maillage 2D sur un maillage 2D  (CARRE1 -> CARRE2)
#=================================================================================
XX=PROJ_CHAMP(RESULTAT=T_CARRE1,METHODE='ELEM',  MODELE_1=CARRE1,MODELE_2=CARRE2, CAS_FIGURE='2D')
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='A', VALE=3.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='B', VALE=4.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='C', VALE=5.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   NOEUD='N21', VALE=4.66666, REFERENCE='ANALYTIQUE'),) #   N21: X=1. Y=0.666666
XX1=CREA_CHAMP(OPERATION='EXTR',TYPE_CHAM='NOEU_TEMP_R',RESULTAT=XX,NUME_ORDRE=1,NOM_CHAM='TEMP',INFO=1,)
DETRUIRE(CONCEPT=_F(NOM=XX1),INFO=1)
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)


#=================================================================================
# 2) projection d'un maillage 2D sur un maillage 2D  (CARRE2 -> CARRE1)
#=================================================================================
XX=PROJ_CHAMP(RESULTAT=T_CARRE2,METHODE='ELEM',  MODELE_1=CARRE2,MODELE_2=CARRE1,
              VIS_A_VIS=_F(GROUP_MA_1='CARRE2',GROUP_MA_2='CARRE1', CAS_FIGURE='2D'))
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='A', VALE=3.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='B', VALE=4.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='C', VALE=5.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   NOEUD='N16', VALE=3.75, REFERENCE='ANALYTIQUE'),) # N16: X=0.5 Y=0.25
XX1=CREA_CHAMP(OPERATION='EXTR',TYPE_CHAM='NOEU_TEMP_R',RESULTAT=XX,NUME_ORDRE=1,NOM_CHAM='TEMP',INFO=1,)
DETRUIRE(CONCEPT=_F(NOM=XX1),INFO=1)
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)


#=================================================================================
# 3) projection d'un maillage 2D sur un maillage filaire  (CARRE2 -> AC)
#=================================================================================
XX=PROJ_CHAMP(RESULTAT=T_CARRE2,METHODE='ELEM',  MODELE_1=CARRE2,MODELE_2=AC, CAS_FIGURE='2D' )
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='A', VALE=3.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='C', VALE=5.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   NOEUD='N15', VALE=4.0, REFERENCE='ANALYTIQUE'),) # N15: X=0.5 Y=0.5
XX1=CREA_CHAMP(OPERATION='EXTR',TYPE_CHAM='NOEU_TEMP_R',RESULTAT=XX,NUME_ORDRE=1,NOM_CHAM='TEMP',INFO=1,)
DETRUIRE(CONCEPT=_F(NOM=XX1),INFO=1)
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)



#=================================================================================
# 4) projection d'un maillage filaire sur un maillage 2D  (AC -> CARRE2)
#=================================================================================
XX=PROJ_CHAMP(RESULTAT=T_AC,METHODE='ELEM',  MODELE_1=AC,MODELE_2=CARRE2, CAS_FIGURE='1.5D',ALARME='NON' )
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='A', VALE=3.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='B', VALE=4.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   GROUP_NO='C', VALE=5.0, REFERENCE='ANALYTIQUE'),)
TEST_RESU(RESU=_F( RESULTAT=XX,NOM_CHAM='TEMP',INST=1.,NOM_CMP='TEMP',
                   NOEUD='N26', VALE=3.333333, REFERENCE='ANALYTIQUE'),)  # N26: X=0.33333 Y=0.
XX1=CREA_CHAMP(OPERATION='EXTR',TYPE_CHAM='NOEU_TEMP_R',RESULTAT=XX,NUME_ORDRE=1,NOM_CHAM='TEMP',INFO=1,)
DETRUIRE(CONCEPT=_F(NOM=XX1),INFO=1)
DETRUIRE(CONCEPT=_F(NOM=XX),INFO=1)


FIN()
