# TITRE FISSURATION INTERFACE 3D (PENTA15) LOIS CZM_OUV_MIX ET CZM_TAC_MIX
# ======================================================================
# COPYRIGHT (C) 1991 - 2015  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET', VISU_EFICAS='OUI'), DEBUG=_F(SDVERI='OUI'))

tfin=10
tfinc=9.00001
nbpas=10
Gc = 0.9
Sc = 1.1
young  = 0.5
dc = 2*Gc/Sc
cmupi = 10.

MA=LIRE_MAILLAGE(FORMAT='MED')


MO=AFFE_MODELE(

                MAILLAGE=MA,
                

                AFFE= (
                _F(
                        MAILLE = ('PRISM','DROITE'),
                        PHENOMENE = 'MECANIQUE',
                        MODELISATION = '3D'
                     ),
                 _F(
                   MAILLE = 'PRISMDEG',
                   PHENOMENE = 'MECANIQUE',
                   MODELISATION = '3D_INTERFACE_S'
                   )
                 )
              )

GC=DEFI_CONSTANTE(VALE=Gc)
SC=DEFI_CONSTANTE(VALE=Sc)

MATCST=DEFI_MATERIAU(

     ELAS=_F(
              E =  young,
              NU = 0.0),
     RUPT_FRAG = _F(
                     GC = Gc,
                     SIGM_C = Sc,
                     PENA_LAGR = 100,
                     RIGI_GLIS = 10,
                    )
            )

MAT=DEFI_MATERIAU(

     ELAS=_F(
              E  =  young,
              NU =  0.0),
     RUPT_FRAG_FO = _F(
                     GC        = GC,
                     SIGM_C    = SC,
                     PENA_LAGR = 100,
                     RIGI_GLIS = 10,
                    )
            )


CM=AFFE_MATERIAU(

               MAILLAGE=MA,
               AFFE=_F(
                       TOUT = 'OUI',
                       MATER = MAT),
              )

# AFFECTATION DES ANGLES NAUTIQUES : POSITION DE LA FISSURE DANS LE REPERE GLOBAL

ORIEN_FI=AFFE_CARA_ELEM(MODELE=MO,
                     MASSIF=(
           _F(MAILLE='PRISMDEG',ANGL_REP=(30,0,0)),
                                 ));


LIAISON=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
    _F(MAILLE='GAUCHE2', DX=0, DY=0, DZ=0 ),
    )
  )

# CHARGEMENT MODE I PUR
TRAC_N=AFFE_CHAR_MECA(
  MODELE=MO,
  FACE_IMPO= (
    _F(MAILLE='DROITE', DX=cos(pi/6), DY= sin(pi/6)),
    ))

L_INST=DEFI_LIST_REEL(

                     DEBUT   = -1.,
     INTERVALLE=(
      _F( JUSQU_A = 0,       NOMBRE = 1 ),
      _F( JUSQU_A = 0.0001,  NOMBRE = 1 ),
      _F( JUSQU_A = 10.0,    NOMBRE = 10 ),
      )
     )

DEFLIST =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST =L_INST ))

FCT = DEFI_FONCTION(
  NOM_PARA = 'INST',
  VALE     = (-1, 0, 0, 1.E-8),
  PROL_DROITE = 'LINEAIRE'
  )


#----------------------------------------------------------------------------------
# CALCUL AVEC CHARGEMENT EN MODE I AVEC LOI CZM_OUV_MIX
#-----------------------------------------------------------------------------------

U_OUV=STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CM,
  CARA_ELEM  = ORIEN_FI,
  EXCIT      = (
    _F(CHARGE = LIAISON ),
    _F(CHARGE = TRAC_N, FONC_MULT = FCT),
  ),
  COMPORTEMENT  = (
          _F(RELATION = 'CZM_OUV_MIX',
             MAILLE = 'PRISMDEG'),
          _F(RELATION = 'ELAS',
             MAILLE = 'PRISM'),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = 0.),
  CONVERGENCE = _F(
    RESI_REFE_RELA = 1.E-6,
    SIGM_REFE      = Sc,
    DEPL_REFE      = dc,
    ITER_GLOB_MAXI = 5,
    ),
  SOLVEUR = _F(METHODE = 'MUMPS'),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  )

STAT_NON_LINE(reuse = U_OUV,
  ETAT_INIT  = _F(EVOL_NOLI = U_OUV),
  MODELE     = MO,
  CHAM_MATER = CM,
  CARA_ELEM  = ORIEN_FI,
  EXCIT      = (
    _F(CHARGE = LIAISON),
    _F(CHARGE = TRAC_N ,TYPE_CHARGE = 'FIXE_PILO'),
  ),
  PILOTAGE   = _F(
    SELECTION = 'RESIDU',
    TYPE = 'PRED_ELAS',
    MAILLE = 'PRISMDEG',
    COEF_MULT = cmupi,
    ETA_PILO_R_MIN = 0.,
    ),
  COMPORTEMENT  = (
          _F(RELATION = 'CZM_OUV_MIX',
             MAILLE = 'PRISMDEG'),
          _F(RELATION = 'ELAS',
             GROUP_MA = 'G_PRISM'),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = tfinc),
  CONVERGENCE = _F(
    RESI_REFE_RELA = 1.E-6,
    SIGM_REFE      = Sc,
    DEPL_REFE      = dc,
    ITER_GLOB_MAXI = 5,
    ),
  SOLVEUR = _F(METHODE = 'MUMPS'),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  ARCHIVAGE  = _F(LIST_INST = L_INST)
  )

# INTERPOLATION NODALE DES CHAMPS AUX PG
U_OUV=CALC_CHAMP(reuse = U_OUV,
                 RESULTAT = U_OUV,
                 VARI_INTERNE='VARI_ELNO',
                 CONTRAINTE='SIEF_ELNO',
                 MAILLE='PRISMDEG'
                );

U_OUV=CALC_CHAMP(
                 reuse = U_OUV,
                 RESULTAT = U_OUV,
                 VARI_INTERNE='VARI_NOEU',
                 CONTRAINTE='SIEF_NOEU',
                 MAILLE='PRISMDEG'
                 );

#----------------------------------------------------------------------------------
# CALCUL AVEC CHARGEMENT EN MODE I AVEC LOI CZM_TAC_MIX
#-----------------------------------------------------------------------------------

U_TAC=STAT_NON_LINE(
  MODELE     = MO,
  CHAM_MATER = CM,
  CARA_ELEM  = ORIEN_FI,
  EXCIT      = (
    _F(CHARGE = LIAISON ),
    _F(CHARGE = TRAC_N, FONC_MULT = FCT),
  ),
  COMPORTEMENT  = (
          _F(RELATION = 'CZM_TAC_MIX',
             MAILLE = 'PRISMDEG'),
          _F(RELATION = 'ELAS',
             MAILLE = 'PRISM'),
          ),
  INCREMENT  = _F(LIST_INST = L_INST, INST_FIN = 0.),
  CONVERGENCE = _F(
    RESI_REFE_RELA = 1.E-6,
    SIGM_REFE      = Sc,
    DEPL_REFE      = dc,
    ITER_GLOB_MAXI = 5,
    ),
  SOLVEUR = _F(METHODE = 'MUMPS'),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  )

STAT_NON_LINE(reuse = U_TAC,
  ETAT_INIT  = _F(EVOL_NOLI = U_TAC),
  MODELE     = MO,
  CHAM_MATER = CM,
  CARA_ELEM  = ORIEN_FI,
  EXCIT      = (
    _F(CHARGE = LIAISON),
    _F(CHARGE = TRAC_N ,TYPE_CHARGE = 'FIXE_PILO'),
  ),
  PILOTAGE   = _F(
    SELECTION = 'RESIDU',
    TYPE = 'PRED_ELAS',
    MAILLE = 'PRISMDEG',
    COEF_MULT = cmupi,
    ETA_PILO_R_MIN = 0.,
    ),
  COMPORTEMENT  = (
          _F(RELATION = 'CZM_TAC_MIX',
             MAILLE = 'PRISMDEG'),
          _F(RELATION = 'ELAS',
             GROUP_MA = 'G_PRISM'),
          ),
  INCREMENT  = _F(LIST_INST = DEFLIST, INST_FIN = tfinc),
  CONVERGENCE = _F(
    RESI_REFE_RELA = 1.E-6,
    SIGM_REFE      = Sc,
    DEPL_REFE      = dc,
    ITER_GLOB_MAXI = 5,
    ),
  SOLVEUR = _F(METHODE = 'MUMPS'),
  NEWTON     = _F(MATRICE = 'TANGENTE', REAC_ITER=1),
  ARCHIVAGE  = _F(LIST_INST = L_INST)
  )

# INTERPOLATION NODALE DES CHAMPS AUX PG
U_TAC=CALC_CHAMP(reuse =U_TAC,
                 RESULTAT=U_TAC,
                 VARI_INTERNE='VARI_ELNO',
                 CONTRAINTE='SIEF_ELNO',
                 MAILLE='PRISMDEG'
                );

U_TAC=CALC_CHAMP(
                 reuse =U_TAC,
                 RESULTAT=U_TAC,
                 VARI_INTERNE='VARI_NOEU',
                 CONTRAINTE='SIEF_NOEU',
                 MAILLE='PRISMDEG'
                 );

#----------------------------------------------------------------------------------
# TESTS CALCUL MODE I AVEC LOI CZM_OUV_MIX
#-----------------------------------------------------------------------------------

FDX_OUV=RECU_FONCTION( RESULTAT=U_OUV,
              NOM_CHAM='DEPL',NOM_CMP='DX',GROUP_NO='TOUTSEUL')
TDX_OUV=CREA_TABLE(FONCTION=_F(FONCTION=FDX_OUV))


FETA_OUV=RECU_FONCTION( RESULTAT=U_OUV,
              NOM_PARA_RESU='ETA_PILOTAGE')
TETA_OUV=CREA_TABLE(FONCTION=_F(FONCTION=FETA_OUV))


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.795229356,
           VALE_REFE=1.7952300000000001,
           NOM_PARA='DX',
           TABLE=TDX_OUV,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=4.0000600000000004,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=2.0729523025,
           VALE_REFE=2.0729525,
           NOM_PARA='ETA_PILO',
           TABLE=TETA_OUV,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=4.0000600000000004,),
           )

TEST_RESU(RESU=_F(GROUP_NO='TOUTSEUL',
                  INST=0,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=U_OUV,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  VALE_CALC= 8.66025404E-09,
                  VALE_REFE= 8.66024E-09),
          )

TEST_RESU(RESU=_F(INST=2.0000800000000001,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_OUV,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIXX',
                  VALE_CALC=0.737898743,
                  VALE_REFE=0.73789899999999997,
                  MAILLE='PRISM',),
          )

TEST_RESU(RESU=_F(INST=9.0000099999999996,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_OUV,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.347848803,
                  VALE_REFE=0.34784900000000002,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=9.0000099999999996,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=U_OUV,
                  NOM_CHAM='DEPL',
                  NOEUD='NS15',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.347848803,
                  VALE_REFE=0.34784900000000002,),
          )

TEST_RESU(RESU=_F(INST=8.0000199999999992,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_OUV,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITX',
                  VALE_CALC= 4.10028602E-15,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=3.00007,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_OUV,
                  NOM_CHAM='VARI_ELGA',
                  NOM_CMP='V1',
                  VALE_CALC=0.267290438,
                  VALE_REFE=0.26729000000000003,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=7.0000299999999998,
                  REFERENCE='ANALYTIQUE',
                  POINT=2,
                  RESULTAT=U_OUV,
                  NOM_CHAM='VARI_ELGA',
                  NOM_CMP='V4',
                  VALE_CALC=0.700003000,
                  VALE_REFE=0.70000300000000004,
                  MAILLE='PRISMDEG',),
          )

# TESTS DES INTERPOLATIONS AUX NOEUDS

TEST_RESU(RESU=_F(INST=9.0000099999999996,
                  REFERENCE='ANALYTIQUE',
                  NOEUD='NS15',
                  RESULTAT=U_OUV,
                  NOM_CHAM='SIEF_NOEU',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.347848803,
                  VALE_REFE=0.34784900000000002,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=7.0000299999999998,
                  REFERENCE='ANALYTIQUE',
                  NOEUD='NO1',
                  RESULTAT=U_OUV,
                  NOM_CHAM='VARI_NOEU',
                  NOM_CMP='V4',
                  VALE_CALC=0.700003000,
                  VALE_REFE=0.70000300000000004,
                  MAILLE='PRISMDEG',),
          )



#----------------------------------------------------------------------------------
# TESTS CALCUL MODE I AVEC LOI CZM_TAC_MIX
#-----------------------------------------------------------------------------------

FDX_TAC=RECU_FONCTION( RESULTAT=U_TAC,
              NOM_CHAM='DEPL',NOM_CMP='DX',GROUP_NO='TOUTSEUL')
TDX_TAC=CREA_TABLE(FONCTION=_F(FONCTION=FDX_TAC))


FETA_TAC=RECU_FONCTION( RESULTAT=U_TAC,
              NOM_PARA_RESU='ETA_PILOTAGE')
TETA_TAC=CREA_TABLE(FONCTION=_F(FONCTION=FETA_TAC))


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.795229356,
           VALE_REFE=1.7952300000000001,
           NOM_PARA='DX',
           TABLE=TDX_TAC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=4.0000600000000004,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=2.0729523025,
           VALE_REFE=2.0729525,
           NOM_PARA='ETA_PILO',
           TABLE=TETA_TAC,
           FILTRE=_F(NOM_PARA='INST',
                     VALE=4.0000600000000004,),
           )

TEST_RESU(RESU=_F(GROUP_NO='TOUTSEUL',
                  INST=0,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=U_TAC,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  VALE_CALC= 8.66025404E-09,
                  VALE_REFE= 8.66024E-09),
          )

TEST_RESU(RESU=_F(INST=2.0000800000000001,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_TAC,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIXX',
                  VALE_CALC=0.737898743,
                  VALE_REFE=0.73789899999999997,
                  MAILLE='PRISM',),
          )

TEST_RESU(RESU=_F(INST=9.0000099999999996,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_TAC,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.347848803,
                  VALE_REFE=0.34784900000000002,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=9.0000099999999996,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=U_TAC,
                  NOM_CHAM='DEPL',
                  NOEUD='NS15',
                  NOM_CMP='SIGN',
                  VALE_CALC=0.347848803,
                  VALE_REFE=0.34784900000000002,),
          )

TEST_RESU(RESU=_F(INST=8.0000199999999992,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_TAC,
                  NOM_CHAM='SIEF_ELGA',
                  NOM_CMP='SITX',
                  VALE_CALC= 2.60260746E-15,
                  VALE_REFE=0.0,
                  CRITERE='ABSOLU',
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=3.00007,
                  REFERENCE='ANALYTIQUE',
                  POINT=1,
                  RESULTAT=U_TAC,
                  NOM_CHAM='VARI_ELGA',
                  NOM_CMP='V1',
                  VALE_CALC=0.267290438,
                  VALE_REFE=0.26729000000000003,
                  MAILLE='PRISMDEG',),
          )

TEST_RESU(RESU=_F(INST=7.0000299999999998,
                  REFERENCE='ANALYTIQUE',
                  POINT=2,
                  RESULTAT=U_TAC,
                  NOM_CHAM='VARI_ELGA',
                  NOM_CMP='V4',
                  VALE_CALC=0.700003000,
                  VALE_REFE=0.70000300000000004,
                  MAILLE='PRISMDEG',),
          )

#-----------------------------------------------------------------------------------

IMPR_TABLE(TABLE=TDX_OUV)
IMPR_TABLE(TABLE=TETA_OUV)

IMPR_RESU(
  FORMAT   = 'RESULTAT',
  RESU=_F(
          RESULTAT = U_OUV, MAILLE  = 'PRISMDEG',
    ))

IMPR_RESU(FORMAT='GMSH',RESU=(_F(RESULTAT=U_OUV,NOM_CHAM='DEPL',TYPE_CHAM='VECT_3D',NOM_CMP=('DX','DY','DZ')))),
IMPR_RESU(FORMAT='GMSH',RESU=(_F(RESULTAT=U_TAC,NOM_CHAM='DEPL',TYPE_CHAM='VECT_3D',NOM_CMP=('DX','DY','DZ')))),

FIN()
