# MODIF  DATE 28/09/2004   AUTEUR DURAND C.DURAND 
# ======================================================================
# TITRE : SIMULATION D'EXCAVATION EN COMPORTEMENT HYDRO-MECANIQUE ------
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2004  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
# ----- : MISE EN OEUVRE D'UN CAS-TEST 1D POUR LE BENCHMARK PROPOSE ----
# ----- : DANS LE CADRE DU GDR MOMAS -----------------------------------
# ----- : DANS CETTE MODELISATION LA PERMEABILITE DEPEND DE LA POROSITE-
# ======================================================================

DEBUT(CODE=_F(NOM='WTNL103B',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON',),PAR_LOT='NON',);

PRE_GIBI();

MAILLAGE = LIRE_MAILLAGE();

MODELE   = AFFE_MODELE( MAILLAGE = MAILLAGE,
                        AFFE     = _F( TOUT         = 'OUI',
                                       PHENOMENE    = 'MECANIQUE',
                                       MODELISATION = 'AXIS_HM',),);

MAILLAGE = MODI_MAILLAGE( reuse        = MAILLAGE,
                          MAILLAGE     = MAILLAGE,
                          MODELE       = MODELE,
                          ORIE_PEAU_2D = _F( GROUP_MA = ('HAUT',
                                                         'BAS',
                                                         'GAUCHE',
                                                         'DERECHA',),  )
                     )

MAILLAGE = DEFI_GROUP( reuse    = MAILLAGE,
                       MAILLAGE = MAILLAGE,
                       CREA_GROUP_NO = ( _F(GROUP_MA='ROCHE',),
                                         _F(GROUP_MA='DERECHA',),
                                         _F(GROUP_MA='GAUCHE',),
                                         _F(GROUP_MA='HAUT',),
                                         _F(GROUP_MA='BAS',),),);

UNM3 = DEFI_CONSTANTE(VALE = 1.0E-3,);

ZERO = DEFI_CONSTANTE(VALE = 0.0,);

LIPPORO=DEFI_LIST_REEL(DEBUT=0.15,
                  INTERVALLE=_F(JUSQU_A=0.16,
                                 PAS=0.0001,),);

KI = FORMULE(NOM_PARA='PORO',VALE='(1.01937E-19*(1+2.E12*(PORO-0.15)**3))');

KINT=CALC_FONC_INTERP(FONCTION=KI,
                      LIST_PARA=LIPPORO,
                      NOM_PARA='PORO',
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      INFO=2,);

SOL  = DEFI_MATERIAU( ELAS      = _F( E           = 5800.0E6,
                                      NU          = 0.3,
                                      RHO         = 2764.0,
                                      ALPHA       = 0.0,),
                      DRUCK_PRAGER   = _F( ECROUISSAGE = 'PARABOLIQUE',
                                      ALPHA       =    0.328     ,
                                      P_ULTM      =    1.225E-2  ,
                                      SY          =    2.11E6    ,
                                      SY_ULTM     =    2.11E2    ,),
        COMP_THM  =    'LIQU_SATU',
        THM_INIT  = _F( PRE1        = 0.0,
                                      PORO        = 0.15,),
        THM_DIFFU = _F( RHO         = 2500,
                                      BIOT_COEF   = 0.8,
                                      PESA_X      = 0.0,
                                      PESA_Y      = 0.0,
                                      PESA_Z      = 0.0,
                                      PERM_IN     = KINT,),
                      THM_LIQU  = _F( RHO         = 1000,
                                      UN_SUR_K    = 5E-10,
                                      VISC        = UNM3,
                                      D_VISC_TEMP = ZERO,),);
                  
CHMAT = AFFE_MATERIAU( MAILLAGE = MAILLAGE,
                       AFFE     = _F( TOUT  = 'OUI',
                                      MATER =  SOL,),);

SIGINIT = CREA_CHAMP( TYPE_CHAM = 'CART_SIEF_R',
                      OPERATION = 'AFFE',
                      MAILLAGE  = MAILLAGE,
                      AFFE      = _F(TOUT    =  'OUI',
                                     NOM_CMP = ('SIXX',
                    'SIYY',
      'SIZZ',
      'SIXY',
      'SIXZ',
      'SIYZ',
      'SIP',
      'M11',
      'FH11X',
      'FH11Y',),
                                     VALE    = ( -7.74E6,
                     -7.74E6,
       -7.74E6,
           0.0,
                  0.0,
           0.0,
              -3.76E6,
           0.0,
           0.0,
           0.0,),),);

CHAMNO=CREA_CHAMP(TYPE_CHAM = 'NOEU_DEPL_R',
                  OPERATION = 'AFFE',
                  MAILLAGE  =  MAILLAGE,
                  AFFE      = _F( TOUT    = 'OUI',
                                  NOM_CMP = 'PRE1',
                                  VALE    = 4.70E6,),);

CALDEP=AFFE_CHAR_MECA(MODELE=MODELE,
                      DDL_IMPO=(_F(GROUP_NO=('HAUT','BAS',),
                                   DY=0.0,),
       ),);

CALGAU=AFFE_CHAR_MECA(MODELE=MODELE,
                      DDL_IMPO=_F(GROUP_NO = 'GAUCHE',
                                  PRE1     = 4.70E6,),
                      PRES_REP=_F(GROUP_MA = 'GAUCHE',
                                  PRES     = 11.5E6,),);
      
COEF  = DEFI_FONCTION( NOM_PARA    = 'INST',
                       VALE        = ( 0.0,    1.0,
                         1.50E6, 0.0, ),
                       PROL_DROITE = 'CONSTANT',);
         
CALEXT=AFFE_CHAR_MECA(MODELE=MODELE,
                      DDL_IMPO=_F(GROUP_NO = 'DERECHA',
                                  PRE1     = 4.70E6,),
                      PRES_REP=_F(GROUP_MA = 'DERECHA',
                                  PRES     = 11.5E6,),);

TEMPS=DEFI_LIST_REEL( DEBUT      = 0.0,
                      INTERVALLE = (_F(JUSQU_A=1.500E6,
                                       NOMBRE=150,),
),
)

TEMPS_AR=DEFI_LIST_REEL( DEBUT=0.0,
                      INTERVALLE=(
      _F(JUSQU_A=1.49E6,
         NOMBRE=1,),),);

try :
     U1    = STAT_NON_LINE( MODELE      =     MODELE,
                       CHAM_MATER  =     CHMAT,
                       EXCIT       =(_F( CHARGE         = CALDEP,),
                                     _F( CHARGE         = CALEXT,),
                                     _F( CHARGE         = CALGAU,
                                         FONC_MULT      = COEF,),),
                       COMP_INCR   = _F( RELATION       = 'KIT_HM',
                                         RELATION_KIT   = ( 'DRUCKER_PRAGER',
                                       'LIQU_SATU',
                         'HYDR_UTIL',),),
                       ETAT_INIT   = _F( DEPL           = CHAMNO,
                                         SIGM           = SIGINIT,),
                       INCREMENT   = _F( LIST_INST      = TEMPS,
                                         SUBD_PAS       = 4,
                                         SUBD_PAS_MINI  = 200.,),
                       NEWTON      = _F( MATRICE        = 'TANGENTE',
                                         REAC_ITER      = 1,),
                       CONVERGENCE = _F( RESI_GLOB_RELA = 1E-06,
                                         ITER_GLOB_MAXI = 25,
                                         RESI_INTE_RELA = 1E-06,
                                         ITER_INTE_MAXI = 5,
                                         ITER_INTE_PAS  = 10,),
                       ARCHIVAGE   = _F( LIST_INST      = TEMPS_AR,),
                       );
except aster.NonConvergenceError:
     last_iter=U1.LIST_VARI_ACCES()['INST'][-1]
     TEMPS2=DEFI_LIST_REEL( DEBUT      = last_iter,
                      INTERVALLE = (_F(JUSQU_A=1.500E6,
                                       NOMBRE=64,),),)

     TEMPS_A2=DEFI_LIST_REEL( DEBUT=last_iter,
                      INTERVALLE=(_F(JUSQU_A=1.50E6,
         NOMBRE=1,),),);

     U1    = STAT_NON_LINE( reuse = U1,
                       MODELE      =     MODELE,
                       CHAM_MATER  =     CHMAT,
                       EXCIT       =(_F( CHARGE         = CALDEP,),
                                     _F( CHARGE         = CALEXT,),
                                     _F( CHARGE         = CALGAU,
                                         FONC_MULT      = COEF,),),
                       COMP_INCR   = _F( RELATION       = 'KIT_HM',
                                         RELATION_KIT   = ( 'DRUCKER_PRAGER',
                                       'LIQU_SATU',
                         'HYDR_UTIL',),),
                       ETAT_INIT   = _F( EVOL_NOLI      = U1,),
                       INCREMENT   = _F( LIST_INST      = TEMPS2,
                                         INST_FIN       = 1.490156250E6,
                                         SUBD_PAS       = 4,
                                         SUBD_PAS_MINI  = 1,),
                       NEWTON      = _F( MATRICE        = 'TANGENTE',
                           PAS_MINI_ELAS  = 201.0,
                                         REAC_ITER_ELAS      = 1000,),
                       CONVERGENCE = _F( RESI_GLOB_RELA = 1E-06,
                                         ITER_GLOB_MAXI = 25,
                                         ITER_GLOB_ELAS = 4000,
                                         RESI_INTE_RELA = 1E-06,
                                         ITER_INTE_MAXI = 5,
                                         ITER_INTE_PAS  = 10,),
                       ARCHIVAGE   = _F( LIST_INST      = TEMPS_A2,),
                       );
         
U1=CALC_ELEM( reuse      = U1,
              OPTION     = ('SIEF_ELNO_ELGA','VARI_ELNO_ELGA'),
              RESULTAT   = U1,
              MODELE     = MODELE,
              CHAM_MATER = CHMAT,
              );
       
U1       = CALC_NO( reuse    = U1,     
                   RESULTAT = U1,
                   OPTION   = ( 'SIEF_NOEU_ELGA', 'VARI_NOEU_ELGA')
                  )
    
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='SIEF_NOEU_ELGA',
                  NOM_CMP='SIXX',
                  NOEUD='N5',
                  VALE=-3.23826E+05,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  

TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='SIEF_NOEU_ELGA',
                  NOM_CMP='SIYY',
                  NOEUD='N5',
                  VALE=-1.10677E+06,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),); 

TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='SIEF_NOEU_ELGA',
                  NOM_CMP='SIZZ',
                  NOEUD='N5',
                  VALE=-1.30157E+06,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  

TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='VARI_NOEU_ELGA',
                  NOM_CMP='V1',
                  NOEUD='N5',
                  VALE=3.39056E-01,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  
   
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='VARI_NOEU_ELGA',
                  NOM_CMP='V2',
                  NOEUD='N5',
                  VALE=3.33631E-01,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  
   
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='VARI_NOEU_ELGA',
                  NOM_CMP='V4',
                  NOEUD='N5',
                  VALE=-2.39452E+00,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  
   
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='VARI_NOEU_ELGA',
                  NOM_CMP='V5',
                  NOEUD='N5',
                  VALE=1.85017E-01,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  
   
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='DEPL',
                  NOM_CMP='DX',
                  NOEUD='N5',
                  VALE=-4.39761E-01,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),);  
   
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST = 1.490156250E6,
                  NOM_CHAM='DEPL',
                  NOM_CMP='PRE1',
                  NOEUD='N5',
                  VALE=-9.47875E+04,
                  CRITERE='RELATIF',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),); 

U1 = CALC_ELEM(
              reuse      = U1,
              INST       = 1.490156250E6,
              OPTION     = ('INDI_LOCA_ELGA',),
              RESULTAT   = U1,
              PRECISION  = 1.E-4,
              MODELE     = MODELE,
              CHAM_MATER = CHMAT,
              );
              
TEST_RESU(RESU=_F(RESULTAT=U1,
                  INST    = 1.490156250E6,
                  NOM_CHAM='INDI_LOCA_ELGA',
                  NOM_CMP ='INDICE',
                  MAILLE  ='M1',
                  POINT   =1,
                  VALE    = 0.0,
                  CRITERE ='ABSOLU',
                  PRECISION=1.E-4,
                  VERSION = '7.3.8',
                  REFERENCE='NON_REGRESSION',),); 

FIN();
