# MODIF  DATE 05/02/2013   AUTEUR BARGELLI R.BARGELLINI 
# TITRE CALCUL DU CRITERE ENERGETIQUE GP EN 2D
# ssnp131a.para = tps_job 800 mem_job 512Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# RESPONSABLE ADBHHFA Y.WADIER

DEBUT(CODE=_F(NOM='SSNP131A',NIV_PUB_WEB='INTERNET',VISU_EFICAS='NON'),DEBUG=_F(SDVERI='OUI'))

#
MA=LIRE_MAILLAGE(FORMAT='MED',);

MA=DEFI_GROUP(reuse =MA,
              MAILLAGE=MA,
              CREA_GROUP_NO=_F(TOUT_GROUP_MA='OUI',),);

MOD=AFFE_MODELE(MAILLAGE=MA,
                AFFE=_F(GROUP_MA=('SEPRO','FOND_0','SGOUP',),
                 PHENOMENE='MECANIQUE',
                 MODELISATION='D_PLAN',),);

                 

#----------------------------------------------------------------------
#---------------- DONNEES MECANIQUES ACIER  -------------------
#----------------------------------------------------------------------

# ECROUISSAGE ISOTROPE NON LINEAIRE

CT_100 = DEFI_FONCTION ( NOM_PARA = 'EPSI',
                            VALE = (
0.003439678,    740.6632663,
0.004628373,    842.148772,
0.00607988,     876.3117064,
0.007654628,    895.2063119,
0.010417548,    911.0718694,
0.014178015,    925.022448,
0.017543214,    935.2135771,
0.021942493,    945.6948965,
0.027416704,    960.732311,
0.033866984,    975.8041996,
0.040205805,    988.2450325,
0.046616375,    1000.143035,
0.052903597,    1010.004051,
0.058235889,    1017.5664,
                            ),
                            PROL_DROITE = 'CONSTANT',
                            PROL_GAUCHE = 'LINEAIRE',);


ACIER=DEFI_MATERIAU(ELAS=_F(E=214100,
                               NU=0.3,),
                    TRACTION=_F(SIGM=CT_100,),);

#----------------------------------------------------------------------
#---------------- DONNEES MECANIQUES GOUPILLE  -------------------
#----------------------------------------------------------------------
#-- GOUPILLE ELASTIQUE "RIGIDE"


MATGOUP=DEFI_MATERIAU(ELAS=_F(   E=2.E6,
                                 NU=0.3,
                                 ALPHA = 0.),
                      ECRO_LINE=_F(D_SIGM_EPSI=200000.,
                                   SY=200000, )
                      );

#----------------------------------------------------------------------
# DEFINITION D UNE RAMPE ET D UNE LISTE D INSTANTS
# ----------------------------------------------------------------------

RAMPD=DEFI_FONCTION(NOM_PARA='INST',
                    VALE=(   0.0   ,    0.0 ,
                           100.    ,    0.25 ),
                    PROL_DROITE='LINEAIRE',
                    PROL_GAUCHE='LINEAIRE',);

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                    INTERVALLE=(_F(JUSQU_A=40.0,
                                   NOMBRE=10,),
                     ),);

#----------------------------------------------------------------------
# AFFECTATION DES PROPRIETES MECANIQUES
# ----------------------------------------------------------------------
#

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                   AFFE=(_F(GROUP_MA='SEPRO',
                            MATER=ACIER,),
                         _F(GROUP_MA='FOND_0',
                            MATER=ACIER,),
                         _F(GROUP_MA='SGOUP',
                            MATER=MATGOUP,),),
                         );


#----------------------------------------------------------------------
# CHARGEMENT ET CONDITIONS LIMITES
# ----------------------------------------------------------------------

COND_LIM=AFFE_CHAR_CINE(MODELE=MOD,
                        MECA_IMPO=(_F(GROUP_NO='LIGBE',
                                     DY=0.0,),
                                  _F(GROUP_NO='PGOUP',
                                     DX=0.0,),),);
CHAD=AFFE_CHAR_MECA_F(MODELE=MOD,
                      DDL_IMPO=_F(GROUP_NO='PGOUP',
                                      DY=RAMPD,),);

#----------------------------------------------------------------------
#---------------  RESOLUTION   ------------------
#----------------------------------------------------------------------

RESU=STAT_NON_LINE(MODELE=MOD,
                CHAM_MATER=CHMAT,
                EXCIT=(_F(CHARGE=COND_LIM,),
                       _F(CHARGE=CHAD,),),
                COMP_INCR=(_F(RELATION='VMIS_ISOT_TRAC',
                             DEFORMATION='PETIT',
                             GROUP_MA='SEPRO',),
                          _F(RELATION='VMIS_ISOT_TRAC',
                             DEFORMATION='PETIT',
                             GROUP_MA='FOND_0',),
                          _F(RELATION='VMIS_ISOT_LINE',
                             DEFORMATION='PETIT',
                             GROUP_MA='SGOUP',),),
                INCREMENT=_F(LIST_INST=L_INST,),
                NEWTON=_F(REAC_ITER=3,),
                RECH_LINEAIRE=_F(ITER_LINE_MAXI=3,),
                CONVERGENCE=_F(RESI_GLOB_RELA=1.E-8,
                               ITER_GLOB_MAXI=50,),
                   SOLVEUR=_F(METHODE='MULT_FRONT',
                              RENUM='METIS',),);

#----------------------------------------------------------------------
#---------------  POST_TRAITEMENT 
#----------------------------------------------------------------------
nbcop = 10
l_copeaux = ['COPS_%d' % k for k in range(1, nbcop+1)]

L_INSTGP=DEFI_LIST_REEL(DEBUT=4.0,
                    INTERVALLE=(_F(JUSQU_A=40.0,
                                   NOMBRE=9,),
                     ),);

#----------------------------------------------------------------------
#---------------  POST_TRAITEMENT_CALC_GP ------------------
#----------------------------------------------------------------------


L_COP=DEFI_LIST_REEL(DEBUT=0.02,
                    INTERVALLE=(_F(JUSQU_A=nbcop*0.02,
                                   PAS=0.02,),
                     ),);
#avec copeaux définis
TESTCOP= CALC_GP(RESULTAT=RESU,
               LIST_INST=L_INSTGP,
               ZONE=_F(ZONE_MAIL='OUI',
                       GROUP_MA= l_copeaux,
                       TAILLE=L_COP),
               SYME='OUI',
               ) 
#avec definition automatique des copeaux
TESTSCOP= CALC_GP(RESULTAT=RESU,
             LIST_INST=L_INSTGP,
             ZONE=_F(ZONE_MAIL='NON',
                     CENTRE=(0.,0.),
                     RAYON=(0.1),
                     ANGLE=0,
                     TAILLE=0.02,
                     NB_ZONE=10,
                     CHAMP_VISU=CO('CH_VISU')
                        ),
             GPMAX=CO('GPMAXSCO'),
             SYME='OUI',
             ) 
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.023662413,
           NOM_PARA='GP',
           TABLE=TESTCOP,
           FILTRE=(_F(NOM_PARA='INST',
                      VALE=4,),
                   _F(NOM_PARA='ZONE',
                      VALE_K = 'COPS_8'),)
           )
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.0234148559,
           NOM_PARA='GP',
           TABLE=TESTSCOP,
           FILTRE=(_F(NOM_PARA='INST',
                      VALE=4,),
                   _F(NOM_PARA='ZONE',
                      VALE_K = 'COPS_8'),)
           )
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.674949376,
           NOM_PARA='GP',
           TABLE=TESTSCOP,
           FILTRE=(_F(NOM_PARA='INST',
                      VALE=40,),
                   _F(NOM_PARA='ZONE',
                      VALE_K = 'COPS_3'),)
           )
TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.727738207,
           NOM_PARA='GP',
           TABLE=TESTCOP,
           FILTRE=(_F(NOM_PARA='INST',
                      VALE=40,),
                   _F(NOM_PARA='ZONE',
                      VALE_K = 'COPS_3'),)
           )
#----------------------------------------------------------------------
#---------------  POST_TRAITEMENT_POST_GP ------------------
#----------------------------------------------------------------------

# conversion MPa.m^1/2 vers MPa.mm^1/2
conv = 1000 ** 0.5
kjc1 = 25.684 * conv
kjc2 = 34.228  * conv
kjc3 = 38.498  * conv

tab = POST_GP(RESULTAT=RESU,
              MODELE=MOD,
              MATER=ACIER,
              COMP_ELAS=_F(RELATION='ELAS_VMIS_TRAC',
                           DEFORMATION='PETIT'),
              LIST_INST = L_INSTGP,
              SYME='OUI',
              DIRECTION=(1., 0., 0.),
              THETA_2D=(_F(GROUP_NO='PFON_0',
                           R_INF=0.25,
                           R_SUP=0.5),
                        _F(GROUP_NO='PFON_0',
                           R_INF=0.5,
                           R_SUP=1.),
                        _F(GROUP_NO='PFON_0',
                           R_INF=1.,
                           R_SUP=2.),
                        _F(GROUP_NO='PFON_0',
                           R_INF=2.,
                           R_SUP=5.),),
              TRANCHE=_F(GROUP_MA=l_copeaux),
              IDENTIFICATION=_F(KJ_CRIT=(kjc1, kjc2, kjc3),
                                TEMP   =(100, 100, 100),),
              TABL_GPMAX=CO('tabident'),
              TABL_GP     = CO('tabgp'),
              INFO=2)

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.64998705424086001,
           NOM_PARA='GP_CRIT',
           TABLE=tabident,
           FILTRE=_F(NOM_PARA='KJ_CRIT',
                     VALE=812.19939423764652,),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.81698768976298997,
           NOM_PARA='GP_CRIT',
           TABLE=tabident,
           FILTRE=_F(NOM_PARA='KJ_CRIT',
                     VALE=1082.3843975224329,),
           )

TEST_TABLE(CRITERE='RELATIF',
           VALE_CALC=0.90087666322161997,
           NOM_PARA='GP_CRIT',
           TABLE=tabident,
           FILTRE=_F(NOM_PARA='KJ_CRIT',
                     VALE=1217.4136536116225,),
           )

FIN()
