# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

#.....................................................................

M=LIRE_MAILLAGE(FORMAT='MED');

M=DEFI_GROUP(reuse =M,
             MAILLAGE=M,
             CREA_GROUP_NO=(_F(GROUP_MA='SSUP',),
                            _F(GROUP_MA='SINF',),),);

MO=AFFE_MODELE(AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='3D',),
               MAILLAGE=M,);

SIGY=DEFI_FONCTION(PROL_GAUCHE='LINEAIRE',
                   NOM_PARA='TEMP',
                   VALE=(-150.0,750.0,-100.0,700.0,-50.0,650.0),
                   PROL_DROITE='LINEAIRE',);

SIGREF=DEFI_FONCTION(PROL_GAUCHE='LINEAIRE',
                     NOM_PARA='TEMP',
                     VALE=(-150.0,2600.0,-50.0,2800.0),
                     PROL_DROITE='LINEAIRE',);

YOUNG=DEFI_CONSTANTE(VALE=2.E5,);

NUT=DEFI_CONSTANTE(VALE=0.29999999999999999,);

ALPHAT=DEFI_CONSTANTE(VALE=0.0,);

ET=DEFI_CONSTANTE(VALE=2000.0,);

ACIER=DEFI_MATERIAU(ECRO_LINE_FO=_F(D_SIGM_EPSI=ET,
                                    SY=SIGY,),
                    ELAS_FO=_F(NU=NUT,
                               ALPHA=ALPHAT,
                               E=YOUNG,TEMP_DEF_ALPHA=0.),
                    WEIBULL_FO=_F(M=24.,
                               VOLU_REFE=1.25E-4,
                               SIGM_CNV=2600.0,
                               SIGM_REFE=SIGREF,),);


ZERO=DEFI_CONSTANTE(VALE=0.0,);

TRAC50=DEFI_FONCTION(PROL_GAUCHE='EXCLU',
                     PROL_DROITE='EXCLU',
                     NOM_PARA='INST',
                     VALE=(0.0,0.0,10.0,20.35,
                     20.0,20.30,30.0,20.30,
                     40.0,30.525),);

T_T=DEFI_FONCTION(PROL_GAUCHE='CONSTANT',
                  NOM_PARA='INST',
                  VALE=(0.0,-50.0,20.0,-50.0,30.0,-150.0,40.0,-150.0),
                  PROL_DROITE='CONSTANT',);

TEMP_T=CREA_CHAMP(AFFE=_F(NOM_CMP='TEMP',
                          TOUT='OUI',
                          VALE_F=T_T,),
                  TYPE_CHAM='NOEU_TEMP_F',
                  MAILLAGE=M,
                  OPERATION='AFFE',);

L_INST=DEFI_LIST_REEL(INTERVALLE=_F(JUSQU_A=40.0, NOMBRE=4,),
                      DEBUT=0.0,);

RESU_T=CREA_RESU(OPERATION='AFFE', TYPE_RESU='EVOL_THER', NOM_CHAM='TEMP',
                 AFFE=(_F(CHAM_GD=TEMP_T, LIST_INST=L_INST, NUME_FIN=4,),
                       _F(CHAM_GD=TEMP_T, INST=41,),),
                 );

CM=AFFE_MATERIAU(AFFE=_F(MATER=ACIER,
                         TOUT='OUI',),
                 AFFE_VARC=_F(EVOL=RESU_T,NOM_VARC='TEMP',VALE_REF=0.,
                         TOUT='OUI',),
                 MAILLAGE=M,);


CHARG=AFFE_CHAR_MECA_F(MODELE=MO,
                       DDL_IMPO=(_F(DY=TRAC50,
                                    GROUP_NO='SSUP',),
                                 _F(DY=ZERO,
                                    GROUP_NO='SINF',),
                                 _F(DX=ZERO,
                                    DZ=ZERO,
                                    GROUP_NO='P5',),
                                 _F(DZ=ZERO,
                                    GROUP_NO='P6',),),);

U=STAT_NON_LINE(CHAM_MATER=CM,
                MODELE=MO,
                CONVERGENCE=_F(ITER_GLOB_MAXI=100,
                               RESI_GLOB_RELA=9.9999999999999995E-07,),
                COMPORTEMENT=_F(RELATION='VMIS_ISOT_LINE'),
                EXCIT=_F(CHARGE=CHARG,),
                INCREMENT=_F(NUME_INST_FIN=4,
                             LIST_INST=L_INST,),
                NEWTON=_F(MATRICE ='TANGENTE',
                          REAC_ITER=3,),);

U=CALC_CHAMP(reuse =U,
             RESULTAT=U,
             DEFORMATION=('EPSG_ELGA',),);

# WEIBULL AVEC OPTION SIGM_ELGA
WEIB=POST_ELEM(CHARGE=CHARG,
               WEIBULL=_F(CORR_PLAST='NON',
                          TOUT='OUI',
                          COEF_MULT=2.0,
                          OPTION='SIGM_ELGA',),
               RESULTAT=U,
               TOUT_ORDRE='OUI',);

# WEIBULL AVEC OPTION SIGM_ELMOY ET CORR_PLAST=NON
WEIB2=POST_ELEM(CHARGE=CHARG,
                WEIBULL=_F(CORR_PLAST='NON',
                           TOUT='OUI',
                           COEF_MULT=2.0,
                           OPTION='SIGM_ELMOY',),
                RESULTAT=U,
                TOUT_ORDRE='OUI',);

# WEIBULL AVEC OPTION SIGM_ELMOY ET CORR_PLAST=OUI
WEIB3=POST_ELEM(CHARGE=CHARG,
                WEIBULL=_F(CORR_PLAST='OUI',
                           TOUT='OUI',
                           COEF_MULT=2.0,
                           OPTION='SIGM_ELMOY',),
                RESULTAT=U,
                TOUT_ORDRE='OUI',);

# RICE ET TRACEY
RET=POST_ELEM(
              RICE_TRACEY=_F(LOCAL='OUI',
                             TOUT='OUI',
                             OPTION='SIGM_ELMOY',),
              NUME_ORDRE=(1,2,3,4),
              RESULTAT=U,);


# TESTS WEIBULL

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.99999938317436,
           VALE_REFE=1.0,
           PRECISION=1.E-4,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=4,),
           )


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB2,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB2,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.014809636445635,
           VALE_REFE=0.01465,
           PRECISION=1.2E-2,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB2,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=0.999999383,
           VALE_REFE=1.0,
           PRECISION=1.E-4,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB2,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=4,),
           )

TEST_TABLE(
           VALE_CALC=4.2096053489425E-03,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB3,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

TEST_TABLE(
           VALE_CALC=4.2096053489425E-03,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB3,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

TEST_TABLE(
           VALE_CALC=4.2096053489425E-03,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB3,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,),
           )

TEST_TABLE(
           VALE_CALC=0.8718524058861,
           NOM_PARA='PROBA_WEIBULL',
           TABLE=WEIB3,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=4,),
           )

# TESTS RICE ET TRACEY

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-2,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=RET,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=1,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-2,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=RET,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-2,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=RET,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=3,),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0700729120909,
           VALE_REFE=1.068,
           PRECISION=2.E-2,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=RET,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=4,),
           )

#--------------------------------------------------
# POST_ELEM
#   RICE_TRACEY
#     LOCAL='OUI',
#     OPTION='SIGM_ELMOY'
#     TOUT, GROUP_MA, MAILLE

#----------------------
AOUI_MOY=POST_ELEM(
              RICE_TRACEY=_F(LOCAL='OUI',
                             TOUT='OUI',
                             OPTION='SIGM_ELMOY',),
               NUME_ORDRE=(1,2,3,4),
              RESULTAT=U,);


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-3,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=AOUI_MOY,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

#----------------------
BOUI_MOY=POST_ELEM(
              RICE_TRACEY=_F(LOCAL='OUI',
                             GROUP_MA='CYL',
                             OPTION='SIGM_ELMOY',),
                             NUME_ORDRE=(1,2,3,4),
              RESULTAT=U,);


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-3,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=BOUI_MOY,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

#----------------------
COUI_MOY=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='OUI',
                             MAILLE=('M1','M2','M3','M4','M5','M6','M7',
                                     'M8','M9','M10','M11','M12','M13','M14'),
                             OPTION='SIGM_ELMOY',),
              RESULTAT=U,);


TEST_TABLE(
           VALE_CALC=14387.843158606,
           NOM_PARA='VOLUME_CONCERNE',
           TABLE=COUI_MOY,
           FILTRE=(_F(NOM_PARA='NUME_ORDRE',
                      VALE_I=4,),
                   _F(NOM_PARA='LIEU',
                      VALE_K='M14',),
                   ),
           )

#--------------------------------------------------
# POST_ELEM
#   RICE_TRACEY
#     LOCAL='OUI',
#     OPTION='SIGM_ELGA'
#     TOUT, GROUP_MA, MAILLE

DOUI_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='OUI',
                             TOUT='OUI',
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);


TEST_TABLE(REFERENCE='ANALYTIQUE',
           VALE_CALC=1.0458236434468,
           VALE_REFE=1.0447,
           PRECISION=2.E-3,
           NOM_PARA='TX_CROIS_CAVITES',
           TABLE=DOUI_ELG,
           FILTRE=_F(NOM_PARA='NUME_ORDRE',
                     VALE_I=2,),
           )

#----------------------
EOUI_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='OUI',
                             GROUP_MA='CYL',
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);


#----------------------

FOUI_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='OUI',
                             MAILLE=('M1','M2','M3','M4','M5','M6','M7',
                                     'M8','M9','M10','M11','M12','M13','M14'),
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);

#
# ATTENTION : ON NE TESTE PAS LES VOLUMES USES POUR CES 2 TABLES
#             EOUI_ELG ET FOUI_ELG
#
# EN EFFET, ON RECHERCHE LE MAXIMUM DE RSR0
# C'EST LA MAILLE (OU SOUS-MAILLE, PT DE GAUSS) QUI DETECTE CE MAX
# QUI DETERMINE LA VALEUR DU VOLUME EN QUESTION.
# POUR UNE SITUATION UNIFORME COMME ICI, SI LE MAX NE CHANGE PAS
# D'UNE CONFIG D'EXECUTION A L'AUTRE (MACHINE ...), SON LIEU DE
# DETECTION VARIE : D'OU RESULTAT VARIABLE.

#--------------------------------------------------

ANON_MOY=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             TOUT='OUI',
                             OPTION='SIGM_ELMOY',),
              RESULTAT=U,);

#----------------------

BNON_MOY=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             GROUP_MA='CYL',
                             OPTION='SIGM_ELMOY',),
              RESULTAT=U,);


#----------------------

CNON_MOY=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             MAILLE=('M1','M2','M3','M4','M5','M6','M7',
                                     'M8','M9','M10','M11','M12','M13','M14'),
                             OPTION='SIGM_ELMOY',),
              RESULTAT=U,);


#--------------------------------------------------
# POST_ELEM
#   RICE_TRACEY
#     LOCAL='NON',
#     OPTION='SIGM_ELGA'
#     TOUT, GROUP_MA, MAILLE

DNON_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             TOUT='OUI',
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);


#----------------------

ENON_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             GROUP_MA='CYL',
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);


#----------------------

FNON_ELG=POST_ELEM(NUME_ORDRE=(1,2,3,4),
              RICE_TRACEY=_F(LOCAL='NON',
                             MAILLE=('M1','M2','M3','M4','M5','M6','M7',
                                     'M8','M9','M10','M11','M12','M13','M14'),
                             OPTION='SIGM_ELGA',),
              RESULTAT=U,);

FIN()
#
