# MODIF  DATE 20/10/2011   AUTEUR SELLENET N.SELLENET 
# TITRE PROJECTION DE CONTRAINTES ET DE VARIABLES INTERNES EN 2D ET 3D
# zzzz271a.para = tps_job 60 mem_job 64Mo ncpus 1 liste_test S
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================

DEBUT(CODE=_F(NOM='ZZZZ271A',NIV_PUB_WEB='INTERNET'),
      DEBUG=_F(SDVERI='OUI'),)

##########
# CAS 2D #
##########


# 1. Lecture des maillages
#----------------------

MA1=LIRE_MAILLAGE(FORMAT='MED',UNITE=11)

MA2=LIRE_MAILLAGE(FORMAT='MED',UNITE=12)


# 2. Affectation des modeles
#------------------------

MO1=AFFE_MODELE(MAILLAGE=MA1, AFFE=_F( TOUT='OUI',PHENOMENE='MECANIQUE',MODELISATION='C_PLAN'))
MO2=AFFE_MODELE(MAILLAGE=MA2, AFFE=_F( TOUT='OUI',PHENOMENE='MECANIQUE',MODELISATION='C_PLAN'))


# 3.1. Creation du champ de contraintes
#---------------------------------

FONC = FORMULE(NOM_PARA=('X','Y'),VALE='1+X+Y')

CHFONC=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='ELGA_NEUT_F', MODELE=MO1,PROL_ZERO='OUI',
              AFFE=_F(  TOUT = 'OUI', NOM_CMP = ('X1', ), VALE_F = FONC))

CHXN=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
                    NOM_CHAM='GEOMETRIE', MAILLAGE=MA1)

CHXG1=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_GEOM_R',PROL_ZERO='OUI',
                     MODELE=MO1,   CHAM_GD=CHXN)

CHREEL=CREA_CHAMP( OPERATION='EVAL', TYPE_CHAM='ELGA_NEUT_R',
              CHAM_F=CHFONC,CHAM_PARA=CHXG1)

CHSIEFR=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELGA_SIEF_R',
          MODELE=MO1 , PROL_ZERO='OUI',
           ASSE=_F(TOUT='OUI', CHAM_GD=CHREEL,
              NOM_CMP= ('X1' ),
           NOM_CMP_RESU=('SIXX'),))

DETRUIRE(CONCEPT=(_F(NOM=CHFONC),
                  _F(NOM=CHXN),
                  _F(NOM=CHXG1),
                  _F(NOM=CHREEL),))


# 3.2. Projection du champ de contraintes
#----------------------------------------

PJSIEF=PROJ_CHAMP(CHAM_GD=CHSIEFR,MODELE_1=MO1, MODELE_2=MO2,METHODE='ECLA_PG')


# 3.3. Validation de la projection du champ de contraintes
#---------------------------------------------------------

TEST_RESU(CHAM_ELEM=(_F( CHAM_GD = PJSIEF,
                         MAILLE = 'M69',
                         POINT = 2,
                         NOM_CMP = 'SIXX' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 2.83094, 
                         PRECISION=2.5E-2),
                     _F( CHAM_GD = PJSIEF,
                         MAILLE = 'M77',
                         POINT = 4,
                         NOM_CMP = 'SIXX' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 1.16906, 
                         PRECISION=2.0E-2),))


# 4.1. Creation du champ de variables internes
#----------------------------------------
CHFONC=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='CART_NEUT_F', MODELE=MO1,
                 AFFE=_F(TOUT= 'OUI', NOM_CMP= 'X1', VALE_F = FONC))

CHFON2=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_NEUT_F',PROL_ZERO='OUI',
                     MODELE=MO1,   CHAM_GD=CHFONC)

CHXN=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
                    NOM_CHAM='GEOMETRIE', MAILLAGE=MA1)

CHXG1=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_GEOM_R',PROL_ZERO='OUI',
                     MODELE=MO1,   CHAM_GD=CHXN)

CHREEL=CREA_CHAMP( OPERATION='EVAL', TYPE_CHAM='ELGA_NEUT_R',
              CHAM_F=CHFON2,CHAM_PARA=CHXG1)

CHVARIR=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELGA_VARI_R',
          MODELE=MO1 , PROL_ZERO='OUI',
           ASSE=_F(TOUT='OUI', CHAM_GD=CHREEL,
             NOM_CMP= 'X1', 
           NOM_CMP_RESU= 'V1'))

DETRUIRE(CONCEPT=(_F(NOM=CHFONC),
                  _F(NOM=CHFON2),
                  _F(NOM=CHXN),
                  _F(NOM=CHXG1),
                  _F(NOM=CHREEL),))



# 4.2. Projection du champ de variables internes
#-----------------------------------------------

PJVARI=PROJ_CHAMP(CHAM_GD=CHVARIR,MODELE_1=MO1, MODELE_2=MO2,METHODE='ECLA_PG')



# 4.3. Validation de la projection du champ de variables internes
#----------------------------------------------------------------

TEST_RESU(CHAM_ELEM=(_F( CHAM_GD = PJVARI,
                         MAILLE = 'M69',
                         POINT = 2,
                         NOM_CMP = 'V1' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 2.83094, 
                         PRECISION=2.5E-2),
                     _F( CHAM_GD = PJVARI,
                         MAILLE = 'M77',
                         POINT = 4,
                         NOM_CMP = 'V1' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 1.16906, 
                         PRECISION=2.0E-2),))

DETRUIRE(CONCEPT=(_F(NOM=PJSIEF),
                  _F(NOM=PJVARI),
                  _F(NOM=CHSIEFR),
                  _F(NOM=CHVARIR),
                  _F(NOM=FONC)))



##########
# CAS 3D #
##########


# 1. Lecture des maillages
#----------------------
MA3=LIRE_MAILLAGE(FORMAT='MED',UNITE=13)

MA4=LIRE_MAILLAGE(FORMAT='MED',UNITE=14)


# 2. Affectation des modeles
#------------------------

MO3=AFFE_MODELE(MAILLAGE=MA3, AFFE=_F( TOUT='OUI',PHENOMENE='MECANIQUE',MODELISATION='3D'))
MO4=AFFE_MODELE(MAILLAGE=MA4, AFFE=_F( TOUT='OUI',PHENOMENE='MECANIQUE',MODELISATION='3D'))


# 3.1. Creation du champ de contraintes
#---------------------------------

FONC = FORMULE(NOM_PARA=('X','Y','Z'),VALE='1+X')

CHFONC=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='ELGA_NEUT_F', MODELE=MO3,PROL_ZERO='OUI',
              AFFE=_F(  TOUT = 'OUI', NOM_CMP = ('X1', ), VALE_F = FONC))

CHXN=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
                    NOM_CHAM='GEOMETRIE', MAILLAGE=MA3)

CHXG1=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_GEOM_R',PROL_ZERO='OUI',
                     MODELE=MO3,   CHAM_GD=CHXN)

CHREEL=CREA_CHAMP( OPERATION='EVAL', TYPE_CHAM='ELGA_NEUT_R',
              CHAM_F=CHFONC,CHAM_PARA=CHXG1)

CHSIEFR=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELGA_SIEF_R',
          MODELE=MO3 , PROL_ZERO='OUI',
           ASSE=_F(TOUT='OUI', CHAM_GD=CHREEL,
              NOM_CMP= ('X1' ),
           NOM_CMP_RESU=('SIXX'),))

DETRUIRE(CONCEPT=(_F(NOM=CHFONC),
                  _F(NOM=CHXN),
                  _F(NOM=CHXG1),
                  _F(NOM=CHREEL),))


# 3.2. Projection du champ de contraintes
#----------------------------------------

PJSIEF=PROJ_CHAMP(CHAM_GD=CHSIEFR,MODELE_1=MO3, MODELE_2=MO4,METHODE='ECLA_PG')


# 3.3. Validation de la projection du champ de contraintes
#---------------------------------------------------------

TEST_RESU(CHAM_ELEM=(_F( CHAM_GD = PJSIEF,
                         MAILLE = 'M272',
                         POINT = 8,
                         NOM_CMP = 'SIXX' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 1.197169, 
                         PRECISION=6.5E-2),))


# 4.1. Creation du champ de variables internes
#----------------------------------------
CHFONC=CREA_CHAMP( OPERATION='AFFE', TYPE_CHAM='CART_NEUT_F', MODELE=MO3,
                 AFFE=_F(TOUT= 'OUI', NOM_CMP= 'X1', VALE_F = FONC))

CHFON2=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_NEUT_F',PROL_ZERO='OUI',
                     MODELE=MO3,   CHAM_GD=CHFONC)

CHXN=CREA_CHAMP(OPERATION='EXTR', TYPE_CHAM='NOEU_GEOM_R',
                    NOM_CHAM='GEOMETRIE', MAILLAGE=MA3)

CHXG1=CREA_CHAMP(OPERATION='DISC', TYPE_CHAM='ELGA_GEOM_R',PROL_ZERO='OUI',
                     MODELE=MO3,   CHAM_GD=CHXN)

CHREEL=CREA_CHAMP( OPERATION='EVAL', TYPE_CHAM='ELGA_NEUT_R',
              CHAM_F=CHFON2,CHAM_PARA=CHXG1)

CHVARIR=CREA_CHAMP(OPERATION='ASSE', TYPE_CHAM='ELGA_VARI_R',
          MODELE=MO3 , PROL_ZERO='OUI',
           ASSE=_F(TOUT='OUI', CHAM_GD=CHREEL,
             NOM_CMP= 'X1', 
           NOM_CMP_RESU= 'V1'))

DETRUIRE(CONCEPT=(_F(NOM=CHFONC),
                  _F(NOM=CHFON2),
                  _F(NOM=CHXN),
                  _F(NOM=CHXG1),
                  _F(NOM=CHREEL),))



# 4.2. Projection du champ de variables internes
#-----------------------------------------------

PJVARI=PROJ_CHAMP(CHAM_GD=CHVARIR,MODELE_1=MO3, MODELE_2=MO4,METHODE='ECLA_PG')



# 4.3. Validation de la projection du champ de variables internes
#----------------------------------------------------------------

TEST_RESU(CHAM_ELEM=(_F( CHAM_GD = PJVARI,
                         MAILLE = 'M272',
                         POINT = 8,
                         NOM_CMP = 'V1' ,
                         REFERENCE = 'ANALYTIQUE',
                         VALE = 1.197169, 
                         PRECISION=6.5E-2),))


FIN();
