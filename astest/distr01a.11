DEBUT()

# Post-traitement de l'étude paramétrique : on relit chaque table
# de VMIS=f(ABSC_CURV) pour produire une courbe et une table
# avec l'ensemble des fonctions le long de la poutre.
# (ne peut pas fonctionner sur le cas-test seul)

# Lancement du post-traitement suite à l'étude paramétrique, il faut
# dans le profil astk :
#  - distr01a.11, type comm, unité 1
#  - le répertoire des résultats, type repe, en donnée (noté "repe_resu"
# dans distr01a.comm)
#  - courbe résultat, type dat, unité 29
#  - table résultat, type resu, unité 8

# Nombre de cas de calcul (on pourrait utiliser la longueur de VALE
# du fichier 'distr' pour cela)
nbcalc = 5

# Concepts fonction
Fonc = [None] * (nbcalc + 1)   # +1 car on n'utilise pas l'indice 0
courbes = []

for i in range(1, nbcalc + 1):

    fname = './REPE_IN/calc_%d/REPE_OUT/poutre.vmis' % i
    DEFI_FICHIER(UNITE=38,FICHIER=fname)

    # pour produire une courbe avec les fonctions VMIS=f(ABSC_CURV)
    Fonc[i] = LIRE_FONCTION(UNITE=38,
                            NOM_PARA='ABSC',
                            NOM_RESU='VMIS_%d' % i)
    courbes.append(_F(FONCTION=Fonc[i],
                         LEGENDE='calc_%d' % i))

    # pour fusionner les tables en une seule
    if i == 1:
        tab = LIRE_TABLE(UNITE=38,)

    else:
        tab_i = LIRE_TABLE(UNITE=38,)

        tab = CALC_TABLE(reuse=tab,
                         TABLE=tab,
                         ACTION=_F(OPERATION='COMB',
                                   TABLE=tab_i,
                                   NOM_PARA='ABSC_CURV'),)

        DETRUIRE(CONCEPT=_F(NOM=tab_i),)

    DEFI_FICHIER(UNITE=38, ACTION='LIBERER')

    tab = CALC_TABLE(reuse=tab,
                     TABLE=tab,
                     ACTION=_F(OPERATION='RENOMME',
                               NOM_PARA=('VMIS', 'VMIS_%d' % i),),
                     TITRE='Contrainte équivalente pour chaque cas de calcul')


IMPR_FONCTION(FORMAT='XMGRACE',
              COURBE=courbes)

IMPR_TABLE(TABLE=tab)

FIN()
