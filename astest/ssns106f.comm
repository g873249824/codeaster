# MODIF  DATE 17/07/2007   AUTEUR PELLET J.PELLET 
# TITRE  : ENDOMMAGEMENT D UNE PLAQUE PLANE SOUS SOLLICITATIONS VARIEES
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

#  DETAILS : MODELISATION : MULTI-COUCHES
#                          (DKT- ENDO_ISOT_BETON+2*GRILLE ACIER)
#                                           VS.
#                           DKTG (KIT_DDI - GLRC_DM + VMIS_CINE_LINE)
#            MAILLAGE     : TRIA3
#            CHARGEMENT   : CYCLIQUE TRACTION - COMPRESSION

DEBUT(CODE=_F(NOM='SSNS106F', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

PRE_GIBI();

EP = 0.1
DEP0 = 5.E-4
t1 = 1.0
t2 = 2*t1
dt = 0.03
fx = 5E5

MAIL=LIRE_MAILLAGE();

MAIL=DEFI_GROUP(reuse =MAIL,
                MAILLAGE=MAIL,
                CREA_GROUP_NO=(_F(GROUP_MA='A1A2',),
                               _F(GROUP_MA='A4A3' ,),
                               _F(GROUP_MA='A2A4' ,),
                               _F(GROUP_MA='A3A1' ,),
                             ),);

MAIL=MODI_MAILLAGE(reuse=MAIL,
                   MAILLAGE=MAIL,
                   ORIE_NORM_COQUE=_F(GROUP_MA='DALLE',
                                      VECT_NORM=(0.,0.,1.),
                                      GROUP_NO='A1',),
                   );

MA5=CREA_MAILLAGE(MAILLAGE=MAIL,
                  CREA_GROUP_MA=_F(NOM = 'ACIER2L',
                                   PREF_MAILLE = 'A2L',
                                   GROUP_MA = 'DALLE',),
                 )
MA4=CREA_MAILLAGE(MAILLAGE=MA5,
                  CREA_GROUP_MA=_F(NOM = 'ACIER1T',
                                   PREF_MAILLE = 'A1T',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM = MA5))

MA3=CREA_MAILLAGE(MAILLAGE=MA4,
                  CREA_GROUP_MA=_F(NOM = 'ACIER2T',
                                   PREF_MAILLE = 'A2T',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM = MA4))

MA2=CREA_MAILLAGE(MAILLAGE=MA3,
                  CREA_GROUP_MA=_F(NOM = 'ACIER1L',
                                   PREF_MAILLE = 'A1L',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM = MA3))

MA1=CREA_MAILLAGE(MAILLAGE=MA2,
                  CREA_GROUP_MA=_F(NOM = 'ACIER1',
                                   PREF_MAILLE = 'A1',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM =MA2))

MA0=CREA_MAILLAGE(MAILLAGE=MA1,
                  CREA_GROUP_MA=_F(NOM = 'DALLE_G',
                                   PREF_MAILLE = 'G',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM = MA1))


MA=CREA_MAILLAGE(MAILLAGE=MA0,
                  CREA_GROUP_MA=_F(NOM = 'ACIER2',
                                   PREF_MAILLE = 'A2',
                                   GROUP_MA = 'DALLE',),
                 )

DETRUIRE(CONCEPT = _F(NOM = MA0))

MO=AFFE_MODELE(INFO=1,
                 MAILLAGE=MA,
                 AFFE=(
                       _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='DALLE',
                          MODELISATION='DKT'),
                        _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='ACIER1L',
                          MODELISATION='GRILLE_EXCENTRE'
                          ),
                       _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='ACIER1T',
                          MODELISATION='GRILLE_EXCENTRE'
                          ),
                       _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='ACIER2L',
                          MODELISATION='GRILLE_EXCENTRE'
                          ),
                       _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='ACIER2T',
                          MODELISATION='GRILLE_EXCENTRE'
                          ),
                 )
                 );

MO_G=AFFE_MODELE(INFO=1,
               MAILLAGE=MA,
              AFFE = _F(PHENOMENE='MECANIQUE',
                          GROUP_MA='DALLE_G',
                          MODELISATION='DKTG'),
              )

E = 3.2308E10
BETON_E=DEFI_MATERIAU(
                      ELAS=(_F(
                               E=E,
                               NU=0.2,
                               RHO=2500)),
                       BETON_ECRO_LINE=_F(
                       SYT = 3.4E6,
                       D_SIGM_EPSI = -0.20*E)
               )

ACIER = DEFI_MATERIAU(INFO=1,
                       ELAS=(_F(AMOR_ALPHA=3.7771128018011707E-05,
                                E=2.E11,
                                NU=0.2,
                                RHO=7800.0,
                                AMOR_BETA=2.6476993459625175)),
                       ECRO_LINE=(_F(
                                     SY=5.0E7,
                                     D_SIGM_EPSI= 3.0*E
                                     )
                                 ),
                       );

EGM =5.275E10
EGF = EGM*1.35
NUF = 0.0933

MAT_G = DEFI_MATERIAU(
                      ELAS  =_F(
                                 E = EGM,
                                 NU=  0.125,
                              ),
                     GLRC_DM =_F(
                                        GAMMA_T = 0.225,
                                        GAMMA_F = 0.32,
                                        SYT     = 4.85E5,
                                        SYF     = 9.6E3,
                                       ),
                     ECRO_LINE=_F(  D_SIGM_EPSI = EGM*0.05,
                                    SY = 7.5E6)
                                          )

MATER=AFFE_MATERIAU( MAILLAGE=MA,

                     AFFE=(
                          _F(GROUP_MA='DALLE_G',
                               MATER=MAT_G),
                          _F(GROUP_MA='DALLE',
                               TEMP_REF=0.0,
                               MATER=BETON_E),
                          _F(GROUP_MA = 'ACIER1',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                          _F(GROUP_MA = 'ACIER2',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                          _F(GROUP_MA = 'ACIER1L',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                          _F(GROUP_MA = 'ACIER1T',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                          _F(GROUP_MA = 'ACIER2L',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                          _F(GROUP_MA = 'ACIER2T',
                               TEMP_REF=0.0,
                               MATER=ACIER),
                      )
                    )

CAEL=AFFE_CARA_ELEM(INFO=1,
                      COQUE=(
                             _F(EPAIS=EP,
                                GROUP_MA='DALLE',
                                COQUE_NCOU=11,
                                INER_ROTA = 'OUI',
                                ANGL_REP=(0.0,0.0,),
                                MODI_METRIQUE='NON')),
                      MODELE=MO,
                       GRILLE=(
                              _F(
                                 GROUP_MA='ACIER1L',
                                 SECTION=5.0E-3,
                                 EXCENTREMENT = -EP*0.4,
                                 ANGL_REP=(0,0,),
                                 GRILLE_NCOU=1,
                                 COEF_RIGI_DRZ=1.E-10),
                              _F(
                                 GROUP_MA='ACIER1T',
                                 SECTION=5.0E-3,
                                 EXCENTREMENT = -EP*0.4,
                                 ANGL_REP=(90,0,),
                                 GRILLE_NCOU=1,
                                 COEF_RIGI_DRZ=1.E-10),
                              _F(GROUP_MA='ACIER2L',
                                 SECTION=5.0E-3,
                                 EXCENTREMENT = EP*0.4,
                                 ANGL_REP=(0,0,),
                                 GRILLE_NCOU=1,
                                 COEF_RIGI_DRZ=1.E-10),
                              _F(GROUP_MA='ACIER2T',
                                 SECTION=5.0E-3,
                                 EXCENTREMENT = EP*0.4,
                                 ANGL_REP=(90,0,),
                                 GRILLE_NCOU=1,
                                 COEF_RIGI_DRZ=1.E-10),
                       ),
                    )

CAEL_G=AFFE_CARA_ELEM(MODELE=MO_G,
                        COQUE=_F(GROUP_MA='DALLE_G',
                                 EPAIS=EP,
                                 INER_ROTA = 'OUI',
                                 ANGL_REP=(0.0,0.0),
                                ),
                        )

COND_0 = AFFE_CHAR_MECA(MODELE=MO,
                        DDL_IMPO=(_F(GROUP_NO='A1',
                                     DX=0.0,
                                     DY=0.0,
                                     DZ=0.0,
                                     DRX=0.0,
                                     DRY=0.0,
                                     DRZ=0.0,
                                     ),
                                 _F(GROUP_MA='A3A1',
                                     DX=0.0,
                                     DRY=0.0,
                                      ),
                                  ),
                       )

COND_1 = AFFE_CHAR_MECA(MODELE=MO,
                       DDL_IMPO=(
                                 _F(GROUP_MA='A2A4',
                                      DX=DEP0,
                                      ),
                                 ),
                       );

chf1 = DEFI_FONCTION(NOM_PARA='INST',
                     VALE=(0.0, 0.0,
                           t1 ,     1.,
                           t2 ,    0.,
                           ),
                     PROL_DROITE='CONSTANT',
                     PROL_GAUCHE='CONSTANT',
                    );

inst1=DEFI_LIST_REEL(DEBUT=0.0,INTERVALLE=(
                          _F(JUSQU_A = t2,PAS = dt),
                      ),);

RESU1 = STAT_NON_LINE(
                     NEWTON=_F(
                              REAC_ITER=1,
                              PAS_MINI_ELAS=0.0,
                              MATRICE='TANGENTE',
                              REAC_INCR=1),


                      MODELE=MO,
                      CHAM_MATER= MATER,
                      CARA_ELEM = CAEL,
                      COMP_INCR=(_F(RESO_INTE='IMPLICITE',
                                    GROUP_MA='DALLE',
                                    RESI_INTE_RELA=1.0E-06,
                                    ITER_INTE_PAS=0,
                                    ALGO_1D='ANALYTIQUE',
                                    ITER_INTE_MAXI=10,
                                    RELATION='ENDO_ISOT_BETON',
                                    ALGO_C_PLAN='DEBORST',
                                    DEFORMATION='PETIT'),
                                 _F(RESO_INTE='IMPLICITE',
                                    GROUP_MA=('ACIER1L','ACIER2L',
                                              'ACIER1T','ACIER2T'),
                                    RESI_INTE_RELA=1.0E-06,
                                    ITER_INTE_PAS=0,
                                    ALGO_1D='ANALYTIQUE',
                                    ITER_INTE_MAXI=10,
                                     RELATION='GRILLE_ISOT_LINE',
                                    ALGO_C_PLAN='ANALYTIQUE',
                                    DEFORMATION='PETIT'),
                                  ),
                      CONVERGENCE=(_F(
                                      ITER_GLOB_MAXI=25,
                                      )),
                      INCREMENT=_F( LIST_INST = inst1,
                                    PRECISION =1.E-1,
                                  ),
                      EXCIT=(
                             _F( CHARGE = COND_0,
                                    FONC_MULT = chf1 ),
                             _F( CHARGE = COND_1,
                                    FONC_MULT = chf1 ),
                            ),
                     );

RESU1=CALC_NO(reuse = RESU1,
               OPTION='FORC_NODA',
               PRECISION=1.E-3,
               RESULTAT=RESU1,
               MODELE=MO,
               CHAM_MATER=MATER,
               );

RESU_G = STAT_NON_LINE(
                     CONVERGENCE=_F(
                                     ITER_GLOB_MAXI=25,
                                     ),
                     NEWTON=_F(
                              REAC_ITER=1,
                              PAS_MINI_ELAS=0.0,
                              MATRICE='TANGENTE',
                              REAC_INCR=1),


                      MODELE=MO_G,
                      CHAM_MATER= MATER,
                      CARA_ELEM = CAEL_G,
#                      COMP_INCR=_F(
#                                   RELATION ='GLRC_DM',
#                                  ),
                      COMP_INCR=_F(
                                   RELATION ='KIT_DDI',
                                   RELATION_KIT=('GLRC_DM','VMIS_CINE_LINE')
                                  ),
                      INCREMENT=_F( LIST_INST = inst1,
                                    PRECISION =1.E-1,
                                  ),
                      EXCIT=(
                             _F( CHARGE = COND_0,
                                    FONC_MULT = chf1 ),
                             _F( CHARGE = COND_1,
                                    FONC_MULT = chf1 ),
                            ),
                     );

RESU_G=CALC_NO(reuse = RESU_G,
               OPTION='FORC_NODA',
               PRECISION=1.E-3,
               RESULTAT=RESU_G,
               MODELE=MO_G,
               CHAM_MATER=MATER,
               );

TDYA4 = POST_RELEVE_T(ACTION=_F(INTITULE='A4DY',
                               GROUP_NO = 'A4',
                              RESULTAT=RESU1,
                              NOM_CHAM='DEPL',
                              NOM_CMP='DY',
                              OPERATION='EXTRACTION',),);

TDYA4_G = POST_RELEVE_T(ACTION=_F(INTITULE='A4DY',
                               GROUP_NO = 'A4',
                              RESULTAT=RESU_G,
                              NOM_CHAM='DEPL',
                              NOM_CMP='DY',
                              OPERATION='EXTRACTION',),);

TFXA4 = POST_RELEVE_T(ACTION=_F(INTITULE='A4FX',
                               GROUP_NO = 'A4',
                              RESULTAT=RESU1,
                              NOM_CHAM='FORC_NODA',
                              NOM_CMP='DX',
                              OPERATION='EXTRACTION',),);

TFXA4_G = POST_RELEVE_T(ACTION=_F(INTITULE='A4FX',
                               GROUP_NO = 'A4',
                              RESULTAT=RESU_G,
                              NOM_CHAM='FORC_NODA',
                              NOM_CMP='DX',
                              OPERATION='EXTRACTION',),);

FORM_Y = FORMULE(NOM_PARA=('DY','DYG'),VALE='(DY-DYG)/DY')
FORM_X = FORMULE(NOM_PARA=('DX','DXG'),VALE='(DX-DXG)/DX')

TDYA4_G0 = CALC_TABLE(TABLE = TDYA4_G,
                      ACTION = _F (OPERATION = 'EXTR',
                                   NOM_PARA = ('INST','DY')))
TFXA4_G0 = CALC_TABLE(TABLE = TFXA4_G,
                      ACTION = _F (OPERATION = 'EXTR',
                                   NOM_PARA = ('INST','DX')))

TDYA4_G1 = CALC_TABLE(TABLE = TDYA4_G0,
                      ACTION = _F(OPERATION = 'RENOMME',
                      NOM_PARA = ('DY','DYG')))

TFXA4_G1 = CALC_TABLE(TABLE = TFXA4_G0,
                      ACTION = _F(OPERATION = 'RENOMME',
                      NOM_PARA = ('DX','DXG')))

#DETRUIRE(CONCEPT = _F(NOM =TDYA4_G0))
#DETRUIRE(CONCEPT = _F(NOM =TFXA4_G0))

TDYA4_G2 = CALC_TABLE(TABLE = TDYA4,
                      ACTION = _F(OPERATION = 'COMB',
                      TABLE = TDYA4_G1,NOM_PARA = ('INST')))
TFXA4_G2 = CALC_TABLE(TABLE = TFXA4,
                      ACTION = _F(OPERATION = 'COMB',
                      TABLE = TFXA4_G1,NOM_PARA = ('INST')))

DETRUIRE(CONCEPT = _F(NOM =TDYA4_G1))
DETRUIRE(CONCEPT = _F(NOM =TFXA4_G1))

D_DYA4 = CALC_TABLE(TABLE = TDYA4_G2,
                     ACTION = _F (OPERATION = 'OPER',
                                  FORMULE = FORM_Y,
                                  NOM_PARA = ('DY_DYG')))

D_FXA4 = CALC_TABLE(TABLE = TFXA4_G2,
                    ACTION = _F (OPERATION = 'OPER',
                                 FORMULE = FORM_X,
                                 NOM_PARA = ('DX_DXG')))

DETRUIRE(CONCEPT = _F(NOM =TDYA4_G2))
DETRUIRE(CONCEPT = _F(NOM =TFXA4_G2))

tt = 1.5E-4/DEP0
# TRACTION - PHASE ELASTIQUE
TEST_TABLE(TABLE=D_DYA4,
           FILTRE=_F(NOM_PARA='INST',VALE=tt/2.0,),
           NOM_PARA='DY_DYG',
           VALE = 0.0,
           CRITERE = 'ABSOLU',
           PRECISION = 0.5E-2,
           REFERENCE='AUTRE_ASTER',)

TEST_TABLE(TABLE=D_FXA4,
           FILTRE=_F(NOM_PARA='INST',VALE=tt/2.0,),
           NOM_PARA='DX_DXG',
           VALE = 0.0,
           CRITERE = 'ABSOLU',
           PRECISION = 2.0E-3,
           REFERENCE='AUTRE_ASTER',)

# TRACTION - PHASE ENDOMMAGEMENT
TEST_TABLE(TABLE=D_DYA4,
           FILTRE=_F(NOM_PARA='INST',VALE=tt,),
           NOM_PARA='DY_DYG',
           VALE = 0.0,
           CRITERE = 'ABSOLU',
           PRECISION = 30.E-2,
           REFERENCE='AUTRE_ASTER',)

TEST_TABLE(TABLE=D_FXA4,
           FILTRE=_F(NOM_PARA='INST',VALE=tt,),
           NOM_PARA='DX_DXG',
           VALE = 0.0,
           CRITERE = 'ABSOLU',
           PRECISION = 2.E-3,
           REFERENCE='AUTRE_ASTER',)

# TRACTION - PHASE PLASTICITE + ENDOMMAGEMENT
TEST_TABLE(TABLE=D_FXA4,
           FILTRE=_F(NOM_PARA='INST',VALE=0.99,),
           NOM_PARA='DX_DXG',
           VALE = 0.0,
           CRITERE = 'ABSOLU',
           PRECISION = 5.E-3,
           REFERENCE='AUTRE_ASTER',)

# DECHARGE
TEST_TABLE(TABLE=TFXA4_G0,
           FILTRE=_F(NOM_PARA='INST',VALE=t2,),
           NOM_PARA='DX',
           VALE = -1.7801E+05,
           CRITERE = 'RELATIF',
           PRECISION = 1.E-4,
           REFERENCE='NON_REGRESSION',)

FIN();
