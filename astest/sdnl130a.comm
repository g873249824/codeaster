# TITRE POUTRE EULER_BERNOULLI MULTIFIBRES (DYNA NON-LINEAIRE)
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
DEBUT(CODE=_F( NOM = 'SDNL130A',NIV_PUB_WEB='INTERNET'));
# LECTURE DU SEISME
INCLUDE(UNITE=92);
# LECTURE MAILLAGE LINEIQUE
MAPOU = LIRE_MAILLAGE(FORMAT='MED',UNITE = 17,);
# LECTURE MAILLAGE SECTION1
MASEC = LIRE_MAILLAGE(FORMAT='MED',UNITE = 18,);
#
MAPOU = DEFI_GROUP (reuse=MAPOU, MAILLAGE =MAPOU, CREA_GROUP_NO =_F(NOM='TOUS_NO',GROUP_MA='POUTRE',),);

MOPOU=AFFE_MODELE(MAILLAGE=MAPOU,
                  AFFE=_F(TOUT='OUI', PHENOMENE='MECANIQUE', MODELISATION='POU_D_EM',),);

# LES MATERIAUX
BETON=DEFI_MATERIAU(ELAS=_F(E=3.7272E10, NU=0.25, RHO=2400., ALPHA=1.E-5,
                            AMOR_ALPHA=8.E-5,AMOR_BETA=20.,),
                    LABORD_1D=_F(Y01=310., Y02=0.070E+5, A1=9.E-3, A2=.52E-5,
                       B1=1.2, B2=2., BETA1=.1E+7, BETA2=-.4E+8, SIGF=3.5E+6,),);
ACIER=DEFI_MATERIAU(ELAS=_F(E=2.1E11, NU=0.3, RHO=7800., ALPHA=1.E-5,
                            AMOR_ALPHA=8.E-5,AMOR_BETA=20.,),
                    ECRO_LINE=_F(D_SIGM_EPSI=3.28E+9, SY=4.E+8,),);
#

#
GF=DEFI_GEOM_FIBRE(SECTION = _F ( GROUP_FIBRE = 'BETON',
                            MAILLAGE_SECT = MASEC , TOUT_SECT = 'OUI',
                            COOR_AXE_POUTRE = (0.,0.,)),
                   FIBRE =_F ( CARA = 'SURFACE', GROUP_FIBRE = 'ACIER',
                            COOR_AXE_POUTRE = (0., 0.,),
                            VALE =( 0.056, -0.218, 0.804E-3,
                                   -0.056, -0.218, 0.804E-3,
                                    0.056, 0.218, 0.804E-3,
                                   -0.056, 0.218, 0.804E-3, ),  ),)
#
# ORIENTATIONS ET RIGIDITE DE TORSION
POUCA=AFFE_CARA_ELEM(MODELE=MOPOU,    INFO=1,
           POUTRE=_F(GROUP_MA=('POUTRE'),
                     SECTION='RECTANGLE',
                     CARA = ('HY','HZ'),
                     VALE = (.2 , .5 ), ),
           ORIENTATION=_F(GROUP_MA=('POUTRE'),
                          CARA='ANGL_VRIL', VALE=-90.0,),
            GEOM_FIBRE=GF,
            MULTIFIBRE=_F(GROUP_MA='POUTRE',GROUP_FIBRE=('BETON','ACIER'),
                           PREC_AIRE=3.3E-02, PREC_INERTIE=2.8E-01,),
);

COMP1=DEFI_COMPOR(GEOM_FIBRE=GF,MATER_SECT=BETON,
                  MULTIFIBRE=(_F(GROUP_FIBRE='BETON',MATER=BETON,RELATION='LABORD_1D'),
                              _F(GROUP_FIBRE='ACIER',MATER=ACIER,RELATION='VMIS_CINE_LINE'),))
# LES CHAMPS DE MATERIAUX
CHMAT=AFFE_MATERIAU(MAILLAGE=MAPOU,
                    AFFE=_F(GROUP_MA='POUTRE', MATER=(BETON,ACIER)),
                    AFFE_COMPOR=_F(GROUP_MA='POUTRE',COMPOR=COMP1) )
#
BLOQUAGE=AFFE_CHAR_MECA(MODELE=MOPOU,
                        DDL_IMPO=(_F(GROUP_NO='A', DX=0.0, DY=0.0, DZ=0.0, DRX=0.0, DRY=0.0,),
                                  _F(GROUP_NO='B', DY=0.0,),
                                  _F(GROUP_NO='TOUS_NO', DZ=0.0, DRX=0.0, DRY=0.0,),
                                 ),);

MASS_ELE=CALC_MATR_ELEM(MODELE=MOPOU, OPTION='MASS_MECA', CARA_ELEM=POUCA, CHAM_MATER=CHMAT, CHARGE=BLOQUAGE,);
RIGI_ELE=CALC_MATR_ELEM(MODELE=MOPOU, OPTION='RIGI_MECA', CARA_ELEM=POUCA, CHAM_MATER=CHMAT, CHARGE=BLOQUAGE,);
NUMEDDL=NUME_DDL(MATR_RIGI=RIGI_ELE, METHODE='LDLT', RENUM='SANS',);
MASSE=ASSE_MATRICE(MATR_ELEM=MASS_ELE, NUME_DDL=NUMEDDL,);
#
# ON DEFINIT L'ACCELEROGRAMME DU SEISME
ACCELERO = CALC_FONCTION( COMB= _F(FONCTION= ACS2C11, COEF= 45.));
# ET SA DIRECTION SOUS FORME DE CHAM_NO_DEPL_R
DEPSEISM=CALC_CHAR_SEISME (MATR_MASS=MASSE, MONO_APPUI='OUI', DIRECTION=(0., -1., 0.),);

# ON TRANSFORME LE CHAM_NO_DEPL_R ET CHAR_MECA
CHASEISM=AFFE_CHAR_MECA (MODELE=MOPOU, VECT_ASSE=DEPSEISM,);

# LES INSTANTS DE CALCUL
LINST = DEFI_LIST_REEL(DEBUT=0.0, INTERVALLE=(_F(JUSQU_A =  2.5 , NOMBRE =  250),
                                              _F(JUSQU_A =  3. , NOMBRE =  100), )
                                               );

# CALCUL DYNAMIQUE NON LINEAIRE
RERE = DYNA_NON_LINE (MODELE=MOPOU, CHAM_MATER=CHMAT, CARA_ELEM=POUCA,
                      SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                FORMULATION='DEPLACEMENT',),
                      NEWTON=_F(MATRICE='ELASTIQUE',),
                      EXCIT=(_F(CHARGE=BLOQUAGE,),
                             _F(CHARGE=CHASEISM, FONC_MULT=ACCELERO,),
                             ),
                      COMPORTEMENT=_F(RELATION='MULTIFIBRE', TOUT='OUI'),
                      INCREMENT=_F(LIST_INST=LINST,
                                 NUME_INST_FIN=2,
                      ),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-5, ITER_GLOB_MAXI=350, ARRET='OUI',),
                      ARCHIVAGE=_F( LIST_INST=LINST, ),
                          ) ;

RERE = DYNA_NON_LINE (reuse=RERE,ETAT_INIT=_F(EVOL_NOLI=RERE),
                      MODELE=MOPOU, CHAM_MATER=CHMAT, CARA_ELEM=POUCA,
                      SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                FORMULATION='DEPLACEMENT',),
                      NEWTON=_F(MATRICE='ELASTIQUE',),
                      EXCIT=(_F(CHARGE=BLOQUAGE,),
                             _F(CHARGE=CHASEISM, FONC_MULT=ACCELERO,),
                             ),
                      COMPORTEMENT=_F(RELATION='MULTIFIBRE', TOUT='OUI'),
                      INCREMENT=_F(LIST_INST=LINST,
                                 NUME_INST_FIN=250,
                      ),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-5, ITER_GLOB_MAXI=350, ARRET='OUI',),
                      ARCHIVAGE=_F( LIST_INST=LINST, ),
                          ) ;


DEPL=CREA_CHAMP(
    TYPE_CHAM='NOEU_DEPL_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='DEPL',
    NUME_ORDRE= 250 )

VITE=CREA_CHAMP(
    TYPE_CHAM='NOEU_DEPL_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='VITE',
    NUME_ORDRE= 250 )

ACCE=CREA_CHAMP(
    TYPE_CHAM='NOEU_DEPL_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='ACCE',
    NUME_ORDRE= 250 )


SIGM=CREA_CHAMP(
    TYPE_CHAM='ELGA_SIEF_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='SIEF_ELGA',
    NUME_ORDRE= 250 )

VARI=CREA_CHAMP(
    TYPE_CHAM='ELGA_VARI_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='VARI_ELGA',
    NUME_ORDRE= 250 )

STRX=CREA_CHAMP(
    TYPE_CHAM='ELGA_STRX_R',
    OPERATION='EXTR',
    RESULTAT=RERE,
    NOM_CHAM='STRX_ELGA',
    NUME_ORDRE= 250 )

RERE = DYNA_NON_LINE (reuse=RERE,ETAT_INIT=_F(DEPL=DEPL,VITE=VITE,ACCE=ACCE,SIGM=SIGM,VARI=VARI,STRX=STRX,INST_ETAT_INIT=2.5),
                      MODELE=MOPOU, CHAM_MATER=CHMAT, CARA_ELEM=POUCA,
                      SCHEMA_TEMPS=_F(SCHEMA='NEWMARK',
                                FORMULATION='DEPLACEMENT',),
                      NEWTON=_F(MATRICE='ELASTIQUE',),
                      EXCIT=(_F(CHARGE=BLOQUAGE,),
                             _F(CHARGE=CHASEISM, FONC_MULT=ACCELERO,),
                             ),
                      COMPORTEMENT=_F(RELATION='MULTIFIBRE', TOUT='OUI'),
                      INCREMENT=_F(LIST_INST=LINST,
                      ),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-5, ITER_GLOB_MAXI=350, ARRET='OUI',),
                      ARCHIVAGE=_F( LIST_INST=LINST, ),
                          ) ;

T_STRX = CREA_TABLE(RESU=_F(RESULTAT=RERE,NOM_CHAM='STRX_ELGA',NUME_ORDRE=350,TOUT='OUI',TOUT_CMP='OUI'))
IMPR_TABLE(TABLE=T_STRX)

#
RERE=CALC_CHAMP(reuse =RERE, RESULTAT=RERE, FORCE='FORC_NODA',
             TOUT_ORDRE='OUI', TOUT='OUI',);

#RERE=CALC_CHAMP(reuse =RERE, RESULTAT=RERE, FORCE='REAC_NODA',
#             TOUT_ORDRE='OUI', TOUT='OUI',);

# QUELQUES TEST DE RESULTATS
TEST_RESU(RESU=(_F(GROUP_NO='A',
                   INST=1.76,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DY',
                   VALE_CALC=-3.95677674E+04,
                   VALE_REFE=-4.2000E4,
                   PRECISION=0.06, ),
                _F(GROUP_NO='C',
                   INST=1.76,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DY',
                   VALE_CALC=1.60886646E-03,
                   VALE_REFE=1.70E-3,
                   PRECISION=0.06, ),
                _F(GROUP_NO='A',
                   INST=2.05,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DY',
                   VALE_CALC=2.87138645E+04,
                   VALE_REFE=3.E4,
                   PRECISION=0.1, ),
                _F(GROUP_NO='C',
                   INST=2.05,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DY',
                   VALE_CALC=-8.70541997E-04,
                   VALE_REFE=-1.E-3,
                   PRECISION=0.13,),
                _F(GROUP_NO='A',
                   INST=2.68,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DY',
                   VALE_CALC=-7.53581346E+04,
                   VALE_REFE=-7.5000E4,
                   PRECISION=0.05,),
                _F(GROUP_NO='C',
                   INST=2.68,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DY',
                   VALE_CALC=5.08355126E-03,
                   VALE_REFE=5.0E-3,
                   PRECISION=0.05, ),
                _F(GROUP_NO='A',
                   INST=2.87,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='FORC_NODA',
                   NOM_CMP='DY',
                   VALE_CALC=5.15048380E+04,
                   VALE_REFE=5.1000E4,
                   PRECISION=0.05, ),
                _F(GROUP_NO='C',
                   INST=2.87,
                   REFERENCE='SOURCE_EXTERNE',
                   RESULTAT=RERE,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DY',
                   VALE_CALC=-3.31186062E-03,
                   VALE_REFE=-3.40E-3,
                   PRECISION=0.05, ),
                ),
          )

FIN();
