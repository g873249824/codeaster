# person_in_charge: samuel.geniaut at edf.fr
# TITRE MOUILLAGE D'UNE COLONNE EN BETON AVEC LOI D'ENDOMMMAGEMENT
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# -----------------------------------------------------
#  MAZARS
# -----------------------------------------------------
DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

####################################
#######################
### SATURATION ET SA DERIVEE
##### PERMEABILITE RELATIVE AU LIQ.ET SA DERIVEE
##### PERMEABILITE RELATIVE AU GAZ
###### DERIVEE DE PERMG DU GAZ PAR RAPPORT A SAT
############################

#  LISTE DES INSTANTS DE CALCUL
#
L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                     INTERVALLE=(
                                 _F(  JUSQU_A = 1.,
                                  NOMBRE = 1),
                                 ),
                                 );

MA=LIRE_MAILLAGE(FORMAT='MED',)


MO=AFFE_MODELE(
                MAILLAGE=MA,
                AFFE=_F(
               TOUT='OUI',
               PHENOMENE = 'MECANIQUE',
               MODELISATION = '3D_HHM')
             )
MA=DEFI_GROUP( reuse=MA,
               MAILLAGE=MA,
               CREA_GROUP_MA=(_F(NOM='ROCHE',
                                     TOUT='OUI'),),
               CREA_GROUP_NO=(_F(TOUT_GROUP_MA = 'OUI'),),)




MA=DEFI_GROUP( reuse=MA,
               MAILLAGE=MA,
                CREA_GROUP_NO=(_F(NOM='FIXE1S',
                                 CRIT_NOEUD='SOMMET',
                                 GROUP_MA='FIXE1',),
                              _F(NOM='ROCHES',
                                 CRIT_NOEUD='SOMMET',
                                 GROUP_MA='ROCHE',),),
              )
#
# PROPRIETES DU MATERIAU
#

BIDON=DEFI_CONSTANTE(VALE=1.)
UN=DEFI_CONSTANTE(VALE=1.)
ZERO=DEFI_CONSTANTE(VALE=0.)

VISCOLIQ=DEFI_CONSTANTE(VALE=1.E-3)
VISCOGAZ=DEFI_CONSTANTE(VALE=1.8E-5)
DVISCOL=DEFI_CONSTANTE(VALE=0.)
DVISCOG=DEFI_CONSTANTE(VALE=0.)

# PERMEABILITE INTRINSEQUE AU MATERIAU

LI3=DEFI_LIST_REEL(DEBUT=0.0,
                   INTERVALLE=_F(JUSQU_A=1.,
                                 PAS=0.1,),);

EN = FORMULE(NOM_PARA='ENDO',VALE='(1.e-13*(1.+1.e6*ENDO**3))')

KENDO=CALC_FONC_INTERP(FONCTION=EN,
                      LIST_PARA=LI3,
                       NOM_PARA='ENDO',
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      INFO=2,);

####  FONCTION SATURATION ET SA DERIVEE : UNITE DE PRESSION : PA
LI2=DEFI_LIST_REEL(DEBUT=0.0,
                   INTERVALLE=_F(JUSQU_A=5.E8,
                                 PAS=1.E5,),);

SL = FORMULE(NOM_PARA='PCAP',VALE='(1.+(PCAP*2.1433E-8)**1.825)**(-0.57609)')

SATU=CALC_FONC_INTERP(FONCTION=SL,
                      LIST_PARA=LI2,
                       NOM_PARA='PCAP',
                      PROL_DROITE='CONSTANT',
                      PROL_GAUCHE='CONSTANT',
                      INFO=2,);

DSL = FORMULE(NOM_PARA='PCAP',VALE='''-2.2565573E-8*(PCAP*2.1433E-8)**0.825
          *(1+(PCAP*2.143365E-8)**1.825)**-1.57609''')

DSATU=CALC_FONC_INTERP(FONCTION=DSL,
                       LIST_PARA=LI2,
                       NOM_PARA='PCAP',
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

#####PERMEABILITE RELATIVE AU LIQUIDE ET SA DERIVEE
LI1=DEFI_LIST_REEL(DEBUT=1.E-3,
                   INTERVALLE=_F(JUSQU_A=0.995,
                                 PAS=0.001,),);


PERM = FORMULE(NOM_PARA='SAT',VALE=''' SAT**0.5*(1-(1-SAT
                      **(1. / 0.57609))**0.57609)**2''')

PERML=CALC_FONC_INTERP(FONCTION=PERM,
                       LIST_PARA=LI1,
                       NOM_PARA='SAT',
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

DPERM = FORMULE(NOM_PARA='SAT',VALE=''' 0.5*SAT**(-0.5)
                    *(1.-(1.-SAT**(1. / 0.57609))**0.57609)**2
                    +2.*SAT**0.5*(SAT**((1.-0.57609) / 0.57609)
                    *(1.-SAT**(1. / 0.57609))**(0.57609-1.))*(1.-(1.-SAT
                    **(1. / 0.57609))**0.57609)''')

DPERML=CALC_FONC_INTERP(FONCTION=DPERM,
                        LIST_PARA=LI1,
                        NOM_PARA='SAT',
                        PROL_DROITE='CONSTANT',
                        PROL_GAUCHE='CONSTANT',
                        INFO=2,);

#####PERMEABILITE RELATIVE AU GAZ ET SA DERIVEE

PG = FORMULE(NOM_PARA='SAT',VALE='''  (1.-SAT)**0.5
                     *(1.-SAT**(1. / 0.57609))**(2.*0.57609)''')

PERMG=CALC_FONC_INTERP(FONCTION=PG,
                       LIST_PARA=LI1,
                       NOM_PARA='SAT',
                       PROL_DROITE='CONSTANT',
                       PROL_GAUCHE='CONSTANT',
                       INFO=2,);

DPG = FORMULE(NOM_PARA='SAT',VALE=''' -0.5*(1.-SAT)**(-0.5)
                     *(1.-SAT**(1. / 0.57609))**(2.*0.57609)
                     -2.*(1.-SAT)**0.5*SAT**((1. / 0.57609)-1.)
                     *(1.-SAT**(1. / 0.57609))**(2.*0.57609-1.)''')

DPERMG=CALC_FONC_INTERP(FONCTION=DPG,
                        LIST_PARA=LI1,
                        NOM_PARA='SAT',
                        PROL_DROITE='CONSTANT',
                        PROL_GAUCHE='CONSTANT',
                        INFO=2,);
#


MATERIAU=DEFI_MATERIAU(
                  ELAS=_F(E = 39.5E9,
                            NU = 0.245,
                            RHO = 2370.,
                            ALPHA = 1.E-5,
                            ),
                  COMP_THM = 'LIQU_GAZ',
                  MAZARS=_F(K=0.7,
                            EPSD0=1.5e-4,
                            AC   =1.15,
                            AT   =1.0,
                            BC   =1391.3,
                            BT   =10000.),
                  THM_LIQU=_F(
                                RHO = 1000.,
                                UN_SUR_K = 0.5E-9,
                                ALPHA = 0.66193E-4,
                                CP = 4180.,
                                VISC = VISCOLIQ,
                                D_VISC_TEMP = DVISCOL,
                                        ),
                   THM_GAZ=_F(
                                MASS_MOL = 28.96E-3,
                                CP = 1000.,
                                VISC = VISCOGAZ,
                                D_VISC_TEMP = DVISCOG,
                                  ),
                    THM_VAPE_GAZ=_F(
                                MASS_MOL = 18.E-3,
                                CP = 1870.,
                                VISC = VISCOGAZ,
                                D_VISC_TEMP = ZERO,
                                 ),
                    THM_DIFFU=_F(
                                R_GAZ = 8.315,
                                RHO = 2265.,
                                CP = 1000.,
                                BIOT_COEF = 1.,
                                SATU_PRES = SATU,
                                D_SATU_PRES = DSATU,
                                PESA_X = 0.,
                                PESA_Y = 0.,
                                PESA_Z = 0.,
                                PERM_END = KENDO,
                                PERM_LIQU = PERML,
                                D_PERM_LIQU_SATU = DPERML,
                                PERM_GAZ = PERMG,
                                D_PERM_SATU_GAZ = DPERMG,
                                D_PERM_PRES_GAZ = ZERO,
                                 ),
                    THM_INIT=_F(
                                TEMP = 293.,
                                PRE1 = 0.0,
                                PRE2 = 0.1013E6,
                                PORO = 0.149,
                                PRES_VAPE = 1725.04,
                                DEGR_SATU = 0.74
                                )
                              );

CHMAT=AFFE_MATERIAU(
                MAILLAGE=MA,
                AFFE=(
                _F(TOUT = 'OUI',
                   MATER = MATERIAU), )
                   )

#
#CONDITIONS AUX LIMITES
#
CLIM=AFFE_CHAR_MECA(
               MODELE=MO,
               DDL_IMPO=(_F( GROUP_NO=('FIXE','FIXE1') , DZ=0),
                         _F( GROUP_NO=('ABFE','CDHG') , DY=0),
                         _F( GROUP_NO=('DAEH','BCGF') , DX=0),),
              )


#
#CHARGEMENT - MOUILLAGE
#
CHARGT = AFFE_CHAR_MECA(MODELE=MO,
                          DDL_IMPO=(_F( GROUP_NO=('FIXE1S') ,PRE1=1.0),),);


CAP = DEFI_FONCTION(NOM_PARA='INST',
                     VALE=( 0.,         3.7144951E7,
                            31536.E3,   3.0959123E7,
                            31536.E4 ,  1.9352131E7,
                            157680.E4 , 0.),
                     PROL_DROITE='CONSTANT',
                     PROL_GAUCHE='CONSTANT')
#
# AFFECTATION DE L ETAT INITIAL
#
DEPINIT=CREA_CHAMP(MAILLAGE=MA,
                    OPERATION='AFFE',
                    TYPE_CHAM='NOEU_DEPL_R',
                    AFFE=(_F(TOUT='OUI',
                             NOM_CMP=('DX','DY','DZ','PRE1','PRE2',),
                             VALE=(0.,0.,0.,0.,0.),),
                         _F(GROUP_NO='ROCHES',
                             NOM_CMP='PRE1',
                             VALE=6.92413E7,),),);


SIGINIT=CREA_CHAMP(MAILLAGE=MA,
                   OPERATION='AFFE',
                   TYPE_CHAM='CART_SIEF_R',
                   AFFE=_F(TOUT='OUI',
                           NOM_CMP=
                           ('SIXX','SIYY','SIZZ','SIXY','SIXZ',
                            'SIYZ',
                            'SIPXX','SIPYY','SIPZZ','SIPXY','SIPXZ',
                            'SIPYZ',
                            'M11','FH11X','FH11Y','FH11Z',
                            'ENT11','M12','FH12X','FH12Y','FH12Z','ENT12',
                            'M21','FH21X','FH21Y','FH21Z','ENT21','QPRIM',
                                     'FHTX','FHTY','FHTZ'),
                           VALE=
                           (0.0,0.0,0.0,0.0,0.0,
                            0.0,
                            0.0,0.0,0.0,0.0,0.0,
                            0.0,
                            0.0,0.0,0.0,0.0,
                            0.0,0.0,0.0,0.0,0.0,0.0,
                            0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0),),);

REPONSE=STAT_NON_LINE(
                     MODELE=MO,
                     CHAM_MATER=CHMAT,
                     EXCIT=(
                           _F( CHARGE = CLIM),
                           _F( CHARGE = CHARGT,FONC_MULT=CAP)
                           ),
                     COMPORTEMENT  =_F(RELATION='KIT_HHM',
                                    PARM_THETA=0.56999999999999995,
                                    DEFORMATION='PETIT',
                                    RELATION_KIT = (
                  'MAZARS',
                  'LIQU_GAZ',
                  'HYDR_ENDO',  ),
                                ),
                      ETAT_INIT = _F(SIGM=SIGINIT,DEPL=DEPINIT),
                     INCREMENT=_F(
                                  LIST_INST = L_INST,
                                  INST_FIN=1.,
                                  ),
                     NEWTON=_F(
                                  MATRICE = 'TANGENTE',
                                 REAC_ITER = 1
                                 ),
                     CONVERGENCE=_F(
                                   RESI_GLOB_RELA = 1.E-6,
                                   ITER_GLOB_MAXI = 200)
             )

REPONSE=CALC_CHAMP(reuse=REPONSE,RESULTAT=REPONSE,PRECISION=1.E-10,CONTRAINTE=('SIGM_ELNO'),VARI_INTERNE=('VARI_ELNO'))


REPONSE=CALC_CHAMP(reuse =REPONSE,
               RESULTAT=REPONSE,
               PRECISION = 1.E-10,
               CONTRAINTE='SIGM_NOEU',VARI_INTERNE='VARI_NOEU',
               TOUT='OUI');

TEST_RESU(RESU=(_F(GROUP_NO='E',
                   INST=1.0,
                   RESULTAT=REPONSE,
                   NOM_CHAM='SIGM_NOEU',
                   NOM_CMP='SIZZ',
                   VALE_CALC=2531.64454,
                   ),
                _F(GROUP_NO='E',
                   INST=1.0,
                   RESULTAT=REPONSE,
                   NOM_CHAM='DEPL',
                   NOM_CMP='PRE1',
                   VALE_CALC=3.7144950E7,
                   ),
                ),
          )

FIN () ;
