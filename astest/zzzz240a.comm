# MODIF  DATE 30/06/2008   AUTEUR PELLET J.PELLET 
# TITRE VALIDATION IMPR_RESU / RESTREINT
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2008  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
DEBUT(CODE=_F(NOM='ZZZZ240A', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))
#...........................................................................................
# CECI EST UN TEST DE LA FONCTIONNALITE IMPR_RESU / RESTREINT :
#  - ON CREE UN EVOL_NOLI U1 SUR UN MAILLAGE MA1
#  - ON IMPRIME U1 ET MA1 SUR UN SOUS-ENSEMBLE DES MAILLES DE MA1
#  - ON RELIT LE FICHIER ET ON RECUPERE UN EVOL_NOLI U2 SUR UN MAILLAGE MA2 PLUS PETIT
#  - ON VERIFIE QUE L'ON PEUT FAIRE QUELQUES POST-TRAITEMENT SUR U2
#  - ON VERIFIE QUE LE CONTENU DE U2 EST LE MEME QUE CELUI DE U1 SUR LES MAILLES RETENUES
#...........................................................................................



#  1. ON FAIT UN (PETIT) CALCUL NON-LINEAIRE => MA1, U1
#  ----------------------------------------------------------------------------------------

EXEC_LOGICIEL(MAILLAGE=_F(FORMAT='GIBI', UNITE_GEOM=14, UNITE=20, MAILLAGE=CO('MA1'),),INFO=1,)


MO1=AFFE_MODELE(MAILLAGE=MA1, AFFE=_F(TOUT='OUI', PHENOMENE='MECANIQUE', MODELISATION='D_PLAN') )
LINST=DEFI_LIST_REEL(VALE=(1., 3., 5., 7.))
ACIER=DEFI_MATERIAU(ELAS=_F( E = 225.E6, NU = 0.3,))
CHMAT=AFFE_MATERIAU(MAILLAGE=MA1, AFFE=_F( TOUT = 'OUI', MATER = ACIER) )
CHAR1=AFFE_CHAR_MECA(   MODELE=MO1,
                        DDL_IMPO=( _F(GROUP_MA = 'AB', DX = 0., DY = 0., ),
                                   _F(GROUP_NO = 'C',  DX = 1., DY = 2., ),))

U1=STAT_NON_LINE( MODELE=MO1, CHAM_MATER=CHMAT,
                      EXCIT=_F( CHARGE = CHAR1),
                      COMP_INCR=_F( RELATION = 'ELAS'),
                      INCREMENT=_F( LIST_INST = LINST),
              )

CALC_ELEM(reuse=U1, RESULTAT=U1, OPTION='SIEF_ELNO_ELGA',)




#  2. ON IMPRIME LE RESULTAT ET LE MAILLAGE SUR UN SOUS-ENSEMBLE DES MAILLES
#     PUIS ON RELIT LE FICHIER => MA2, U2
#  ------------------------------------------------------------------------------------------

MA1=DEFI_GROUP( reuse=MA1,   MAILLAGE=MA1,
     CREA_GROUP_MA=(_F(  NOM = 'G1', MAILLE = ( 'M1', 'M2', ),),
     ))

IMPR_RESU(FORMAT='MED', UNITE=80,
        RESTREINT=_F(MODELE=MO1, GROUP_MA=('CARRE1','G1'), MAILLE=('M1','M5')),
        RESU=_F(MAILLAGE=MA1,  RESULTAT=U1,),);

MA2=LIRE_MAILLAGE(FORMAT='MED',UNITE=80);
MO2=AFFE_MODELE(MAILLAGE=MA2, AFFE=_F(TOUT='OUI', PHENOMENE='MECANIQUE', MODELISATION='D_PLAN') )

U2=LIRE_RESU( TYPE_RESU='EVOL_NOLI', FORMAT='MED', UNITE=80, MODELE=MO2,  TOUT_ORDRE='OUI',
              FORMAT_MED=(
                 _F( NOM_CHAM_MED='&REDUIT_DEPL____________________', NOM_CHAM  ='DEPL' ),
                 _F( NOM_CHAM_MED='&REDUIT_SIEF_ELGA_______________', NOM_CHAM  ='SIEF_ELGA' ),
                 _F( NOM_CHAM_MED='&REDUIT_VARI_ELGA_______________', NOM_CHAM  ='VARI_ELGA',
                     NOM_CMP=('V1',), NOM_CMP_MED=('V1',), ),
                 _F( NOM_CHAM_MED='&REDUIT_SIEF_ELNO_ELGA__________', NOM_CHAM  ='SIEF_ELNO_ELGA' ),
              ),)



#  3. ON VERIFIE U2 :
#  --------------------

# 3.1 : ON PEUT FAIRE MACR_LIGNE_COUPE :
#----------------------------------------
ML1=MACR_LIGN_COUPE( RESULTAT= U2,NOM_CHAM = 'SIEF_ELNO_ELGA',
                     LIGN_COUPE  =   _F( NB_POINTS  = 11,
                                         COOR_ORIG  = ( 0.01, 0.01,),
                                         COOR_EXTR  = ( 0.49, 0.49,), ),)

IMPR_TABLE(TABLE=ML1, NOM_PARA=( 'ABSC_CURV', 'SIXY',),
              FILTRE= _F( NOM_PARA = 'INST', VALE  = 3. ), )

# 3.2 : VALIDATION (AUTRE_ASTER) AVEC POST_ELEM :
#------------------------------------------------
POST1=POST_ELEM(MODELE=MO1, INST=3., RESULTAT=U1,
                INTEGRALE=_F(NOM_CHAM='SIEF_ELGA',
                             NOM_CMP=('SIYY'), GROUP_MA='CARRE1'),)

POST2=POST_ELEM(MODELE=MO2, INST=3., RESULTAT=U2,
                INTEGRALE=_F(NOM_CHAM='SIEF_ELGA',
                             NOM_CMP=('SIYY'), GROUP_MA='CARRE1'),)

TEST_TABLE( TABLE=POST1, NOM_PARA='INTE_SIYY', VALE=7.93087E+07 ,REFERENCE='NON_REGRESSION',)
TEST_TABLE( TABLE=POST2, NOM_PARA='INTE_SIYY', VALE=7.93087E+07 ,REFERENCE='AUTRE_ASTER',)



FIN()
