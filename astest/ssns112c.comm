# TITRE POUTRE DKTG MODELE DHRC (STAT NON-LINEAIRE): TRACTION COMPRESSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#

# epaisseur de la plaque
ep_beton = 0.15

DEBUT(CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'),)

#-----------------------------------------------
# LECTURE DU MAILLAGE
#-----------------------------------------------
MAIL=LIRE_MAILLAGE(FORMAT='MED',);

MAIL=DEFI_GROUP(reuse =MAIL,
                MAILLAGE=MAIL,
                CREA_GROUP_NO=(_F(GROUP_MA='A',),
                               _F(GROUP_MA='B',),),);

MAIL=MODI_MAILLAGE(reuse =MAIL,
                   MAILLAGE=MAIL,
                   ORIE_NORM_COQUE=_F(GROUP_MA='POUTRE',
                                      VECT_NORM=(0.,0.,1.,),
                                      GROUP_NO='AA',),);

#-----------------------------------------------
# CREATION DU MODELE
#-----------------------------------------------
MO=AFFE_MODELE(MAILLAGE=MAIL,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='DKTG',),);

#-----------------------------------------------
# DEFINTION DES MATERIAUX ET CARACTERSISTIQUES
#-----------------------------------------------

INCLUDE(UNITE=22, INFO=1,);

MATER=AFFE_MATERIAU(MAILLAGE=MAIL,
                    AFFE=(_F(TOUT='OUI',
                             MATER=mat_dhrc,),),);

CAEL=AFFE_CARA_ELEM(MODELE=MO,
                    COQUE=_F(GROUP_MA='POUTRE',
                             EPAIS=ep_beton,
                             ANGL_REP=(0.0,0.0,),
                             INER_ROTA='OUI',),);

#-----------------------------------------------
# DEFINTION DES CONDITIONS AUX LIMITES ET CHARGEMENTS
#-----------------------------------------------
CL=AFFE_CHAR_MECA(MODELE=MO,
                  DDL_IMPO=(_F(GROUP_NO='AA',
                               DX=0.0,
                               DY=0.0,
                               DZ=0.0,
                               DRX=0.0,
                               DRY=0.0,
                               DRZ=0.0,),
                            _F(GROUP_MA='A',
                               DX=0.0,
                               DRZ=0.0,),),);

CHARGE=AFFE_CHAR_MECA(MODELE=MO,
                      FORCE_ARETE=_F(GROUP_MA='B',
                                     FX=1000.0/0.15,),);

t1 = 1.0
t2 = 3.0
t3 = 5.0
t4 = 7.0
t5 = 9.0
t6 = 11.0
t7 = 13.0
t8 = 15.0
t9 = 17.0
t10 = 19.0

dt = 0.05;

FOFO=DEFI_FONCTION(NOM_PARA='INST',
                   VALE=(0.0,0.0,
                         t1,-250.,
                         t2,55.,
                         t3,-365.0,
                         t4,176.0,
                         t5,-490.0,
                         t6,298.0,
                         t7,-675.0,
                         t8,368.0,
                         t9,-790.0,
                         t10,376.0,),
                   PROL_DROITE='CONSTANT',
                   PROL_GAUCHE='CONSTANT',);

INST=DEFI_LIST_REEL(DEBUT=0.0,
                    INTERVALLE=_F(JUSQU_A=t10,
                                  PAS=dt,),);

LINST=DEFI_LIST_INST(DEFI_LIST=_F(METHODE='MANUEL',
                                  LIST_INST=INST,),
                     ECHEC=_F(ACTION='DECOUPE',
                              SUBD_METHODE='MANUEL',),);

#-----------------------------------------------
# CALCUL DES RESULTATS POUR LE CHARGEMENT
#-----------------------------------------------
RESU=STAT_NON_LINE(MODELE=MO,
                   CHAM_MATER=MATER,
                   CARA_ELEM=CAEL,
                   EXCIT=(_F(CHARGE=CL),
                          _F(CHARGE=CHARGE,
                             FONC_MULT=FOFO,),),
                   COMPORTEMENT=_F(RELATION='DHRC',
                                   ITER_INTE_MAXI=30,),
                   INCREMENT=_F(LIST_INST=LINST,),
                   NEWTON=_F(REAC_ITER=1,),);

#-----------------------------------------------
# CALCUL DES TEST_RESU
#-----------------------------------------------
# les resultats experimentaux sont donnees dans le fichier joint
# il s'agit des points de la numerisation de la courbe de reponse du specimen: deformation (-) et force (kN)                   
INCLUDE(UNITE = 12)

# on a identifie les points numerises les plus proches des pic de chaque cycle pour la comparaison avec la solution numerique
# les deformations sont converties en deplacement par la multiplication par la longueur du speciment l= 0.7m
TEST_RESU(RESU=(_F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t1,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=-2.34710756253E-04,
                   VALE_REFE=val_exp[2*247]*0.7,
                   PRECISION=0.04,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t2,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(5.16363663758E-05, ),
                   VALE_REFE=(val_exp[2*367]*0.7 ),
                   PRECISION=0.7,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t3,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(-4.3023906357E-04, ),
                   VALE_REFE=(val_exp[2*171]*0.7, ),
                   PRECISION=0.12,
                   VALE_ABS='NON',),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t4,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(7.19531208332E-04, ),
                   VALE_REFE=(val_exp[2*501]*0.7, ),
                   PRECISION=0.25,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t5,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(-6.97725743551E-04, ),
                   VALE_REFE=(val_exp[2*113]*0.7, ),
                   PRECISION=0.25,
                   VALE_ABS='NON',),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t6,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(1.44842453903E-03 , ),
                   VALE_REFE=(val_exp[2*568]*0.7, ),
                   PRECISION=0.07,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t7,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(-1.10863199812E-03, ),
                   VALE_REFE=(val_exp[2*14]*0.7, ),
                   PRECISION=0.02,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t8,
                   NOM_CHAM='DEPL',
                   RESULTAT=RESU,
                   CRITERE=('RELATIF', 'ABSOLU'),
                   REFERENCE='SOURCE_EXTERNE',
                   VALE_CALC=(1.94003942697E-03, ),
                   VALE_REFE=(val_exp[2*602]*0.7, ),
                   PRECISION=0.02,),
                _F(NOM_CMP='DX',
                   GROUP_NO=('BB', ),
                   INST=t9,
                    NOM_CHAM='DEPL',
                    RESULTAT=RESU,
                    CRITERE=('RELATIF', 'ABSOLU'),
                    REFERENCE='SOURCE_EXTERNE',
                    VALE_CALC=(-1.3759139955E-03 , ),
                    VALE_REFE=(val_exp[2*1]*0.7, ),
                    PRECISION=0.001,),
                 _F(NOM_CMP='DX',
                    GROUP_NO=('BB', ),
                    INST=t10,
                    NOM_CHAM='DEPL',
                    RESULTAT=RESU,
                    CRITERE=('RELATIF', 'ABSOLU'),
                    REFERENCE='SOURCE_EXTERNE',
                    VALE_CALC=(2.03392227077E-03, ),
                    VALE_REFE=(val_exp[2*604]*0.7, ),
                    PRECISION=0.03,),),);

#CALC_CHAMP(reuse=RESU,RESULTAT=RESU,FORCE = ('FORC_NODA'));

#tb_f=CREA_TABLE(RESU=_F(TOUT_CMP='OUI',
                #RESULTAT=RESU,
                #NOM_CHAM='FORC_NODA',
                #GROUP_MA='B',),);

#tb_db=CREA_TABLE(RESU=_F(TOUT_CMP='OUI',
                         #RESULTAT=RESU,
                         #NOM_CHAM='DEPL',
                         #GROUP_NO ='BB',),);

#DX=tb_db.EXTR_TABLE().values()['DX']
#table_f = tb_f.EXTR_TABLE().values()
#FX=[]
#for i in range(len(table_f['DX'])/3):
    #FX.append(table_f['DX'][i*3]+table_f['DX'][i*3+1]+table_f['DX'][i*3+2])

#for i in range(len(FX)):
    #print DX[i], FX[i]

FIN()