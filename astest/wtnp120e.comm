# TITRE -    APPARITION/DISPARITION DE PHASE DANS UN ECOULEMENT DIPHASIQUE
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
# (AT YOUR OPTION) ANY LATER VERSION.                                                    
#                                                                       
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
#                                                                       
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.        
# ======================================================================
#            INJECTION DE GAZ DANS UN BARREAU SATURE EN EAU PURE

DEBUT(CODE=_F(NOM='WTNP120E', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))
#=============================================================
#=============================================================
METHODE='VFDM'
#=============================================================
#=============================================================

MODELISA = '3D_HH2SUDM'

#=============================================================
#                     DONNEES
#=============================================================
PARM_ALPHA=1.

UN_SUR_K=1.E-20

LOI='LIQU_AD_GAZ'


#=============================================================
#                     DONNEES
#=============================================================
#
#*********************************************************
# COEFFICIENTS DE VAN-GENUCHTEN :
#*********************************************************
N = 1.49
PR = 2.E6
SR = 0.4
SMAX = 0.999
SATUC = 1.


#*********************************************************
# CI
#*********************************************************
PREF = 1.
PLIQ0 = 1.E6
PC0 = PREF - PLIQ0
#*********************************************************
# CL
#*********************************************************
T1JOUR=86400
UNMOIS = 2.592E+6
T1ANS       =3.1536E7
T10ANS      =3.1536E8
T50ANS     =1.5768E+09
T100ANS     =3.1536E9
T500ANS     =1.5768E+10
T1000ANS    =3.1536E10
T1500ANS    =4.73364E10
T2000ANS    =2*T1000ANS
T5000ANS    =1.5768E+11
T8000ANS    =8*T1000ANS
T10_000ANS  =3.1536E11
T20_000ANS  =2*T10_000ANS
T40_000ANS  =4*T10_000ANS
T60_000ANS  =6*T10_000ANS
T100_000ANS =3.1536E12
T200_000ANS =2*T100_000ANS
T400_000ANS =4*T100_000ANS
T500_000ANS =1.5768E+13
TMILLION    =3.1536E13

#TINJ=T500_000ANS
#FINJ=1.629360000E+13
#TSIM=TMILLION
#TFIN=TMILLION


TINJ=T10_000ANS

TFIN=T10_000ANS



LISPOST=DEFI_LIST_REEL(VALE=(
          T1ANS,
          T10ANS,
          T100ANS,
          T1000ANS,
          T10_000ANS,
#          T100_000ANS,
#          T500_000ANS,
#          TMILLION,
          ),);
         
UN=DEFI_CONSTANTE(VALE=1.0,);
ZERO=DEFI_CONSTANTE(VALE=0.0,);

VISCOLIQ=DEFI_CONSTANTE(VALE=1.E-3,);
VISCOGAZ=DEFI_CONSTANTE(VALE=9.E-06,);

DVISCOL=DEFI_CONSTANTE(VALE=0.0,);
DVISCOG=DEFI_CONSTANTE(VALE=0.0,);

HENRY=DEFI_CONSTANTE(VALE=130719.,);

KINT=DEFI_CONSTANTE(VALE=5.E-20,);

FICKWAR=DEFI_CONSTANTE ( VALE = 0.45E-9); 
FLUGAZ=5.57E-6/(365.*24.*3600.)    #FLUGAZ=1.766E-13KG.M^2.S^-1

#*********************************************************
# CRITERES DE CONVERGENCE
#*********************************************************
#
RESI_GLOB_RELA =  1.E-05
ITER_GLOB_MAXI = 10 

FLUXG = DEFI_FONCTION ( NOM_PARA  = 'INST' ,
           VALE = (
   0.               ,  FLUGAZ ,
   TINJ             ,  FLUGAZ , 
#   FINJ             ,  0. , 
#   TSIM             ,  0. , 
   ),
            PROL_DROITE ='EXCLU' ,
            PROL_GAUCHE ='EXCLU' , );
            
#================================
# FICK DANS LE MELANGE LIQUIDE
#================================
LI2  = DEFI_LIST_REEL ( DEBUT      = 0.,
                       INTERVALLE = (
                         _F( JUSQU_A = 1. , NOMBRE = 1000,),
                                    ),);   
                                
                                         
# ================================
# SATURATION DU LIQUIDE
# ================================   
FFAS  = FORMULE(NOM_PARA='SAT', VALE='SAT');  

FAS   = CALC_FONC_INTERP ( FONCTION     =  FFAS      ,
                           LIST_PARA    =  LI2       ,
                           NOM_PARA     = 'SAT'      ,
                           PROL_GAUCHE  = 'CONSTANT' ,
                           PROL_DROITE  = 'CONSTANT' ,
                           INFO         = 2          , );

#
#
#*************************************************************
# LISTE DES INSTANTS DE CALCULS
#*************************************************************
#
INST1=DEFI_LIST_REEL(DEBUT=0.0,
                     INTERVALLE=(
 _F( JUSQU_A = 86400, NOMBRE = 1,),                   #DT=1J         
 _F( JUSQU_A = 864000 , NOMBRE = 9 ,),                #DT=1J   
 _F( JUSQU_A = T1ANS      , NOMBRE = 10 ,),           #DT=0.1 AN 
 _F( JUSQU_A = T10ANS     , NOMBRE = 10 ,),           #DT=0.9 AN   
 _F( JUSQU_A = 6.3072E+08 , NOMBRE = 10 ,),           #DT=1 AN   
 _F( JUSQU_A = 9.4608E+08 , NOMBRE = 10 ,),           #DT=1 AN   
 _F( JUSQU_A = 1.2614E+09 , NOMBRE = 10 ,),           #DT=1 AN   
 _F( JUSQU_A = T50ANS     , NOMBRE = 5  ,),           #DT=2 AN   
 _F( JUSQU_A = 1.8922E+09 , NOMBRE = 5  ,),           #DT=2 AN   
 _F( JUSQU_A = T100ANS    , NOMBRE = 10 ,),           #DT=4 AN   
 _F( JUSQU_A = 6.3072E+09 , NOMBRE = 24 ,),           #DT=5 AN  
 _F( JUSQU_A = 9.4608E+09 , NOMBRE = 20 ,),           #DT=5 AN    
 _F( JUSQU_A = T500ANS    , NOMBRE = 20 ,),           #DT=10 AN            
 _F( JUSQU_A = T1000ANS   , NOMBRE = 20 ,),           #DT=25 ANS 
 _F( JUSQU_A = T1500ANS   , NOMBRE = 10 ,),           #DT=50 ANS 
 _F( JUSQU_A = T2000ANS   , NOMBRE = 5 ,),            #DT=100 ANS 
 _F( JUSQU_A = T5000ANS   , NOMBRE = 15 ,),           #DT=200 ANS
 _F( JUSQU_A = T8000ANS   , NOMBRE = 10 ,),           #DT=300 ANS 
 _F( JUSQU_A = T10_000ANS , NOMBRE = 5 ,),            #DT=400 ANS 
 _F( JUSQU_A = T20_000ANS , NOMBRE = 20 ,),           #DT=500 ANS  
 _F( JUSQU_A = T40_000ANS , NOMBRE = 32 ,),           #DT=625 ANS 
 _F( JUSQU_A = T60_000ANS , NOMBRE = 25 ,),           #DT=800 ANS
 _F( JUSQU_A = T100_000ANS , NOMBRE = 40 ,),          #DT=1000 ANS
 _F( JUSQU_A = T200_000ANS , NOMBRE = 50 ,),          #DT=2000 ANS   
 _F( JUSQU_A = T400_000ANS , NOMBRE = 40 ,),          #DT=5000 ANS   
 _F( JUSQU_A = T500_000ANS , NOMBRE = 20 ,),          #DT=15000 ANS
 _F( JUSQU_A = TMILLION , NOMBRE = 30 ,),             #DT=16666 ANS
                     ),);
                   
LI =DEFI_LIST_INST(DEFI_LIST=_F(LIST_INST =INST1 ,),
                                ECHEC=_F(ACTION        = 'DECOUPE',
                                 SUBD_METHODE  = 'MANUEL',
                                         SUBD_PAS=5,
                                         SUBD_PAS_MINI=0.1,),)                   
#=============================================================
#=============================================================
#=============================================================



#*********************
# LECTURE DU MAILLAGE
#*********************


MAILINI=LIRE_MAILLAGE(FORMAT='MED',);




MAILINI=MODI_MAILLAGE(reuse =MAILINI,
          MAILLAGE=MAILINI,ECHELLE=2.,);
MAIL=CREA_MAILLAGE( MAILLAGE=MAILINI,
          HEXA20_27=_F(TOUT='OUI',PREF_NOEUD='NH'),);
           
MAIL=DEFI_GROUP(reuse =MAIL,
         MAILLAGE=MAIL,
         CREA_GROUP_NO=(
         _F(GROUP_MA='HAUT',NOM='NSHAUT',CRIT_NOEUD='MILIEU',),
         _F(GROUP_MA='BAS',NOM='NSBAS',CRIT_NOEUD='MILIEU',),
         _F(GROUP_MA='DROITE',),
         _F(GROUP_MA='GAUCHE',),
         _F(GROUP_MA='DEVANT',),
         _F(GROUP_MA='DERRIERE',),
       _F(NOM='MILIEU',NOEUD=('NH3','NH401','NH403','NH404','NH405','NH407','NH408',  
'NH409','NH410','NH411','NH412','NH413',  'NH414',  
'NH415','NH416','NH417','NH418','NH419',  
'NH420', 'NH423',  'NH424',  
'NH425', 'NH426',  'NH428',  
'NH430',  'NH432',  
'NH434',  'NH436',  'NH440',  'NH441',  
'NH442',  'NH444',  'NH446',  'NH448',  'NH449',  'NH450',  
'NH452',  'NH454',  'NH455',  'NH456',  'NH458',  'NH460',  'NH462',  
'NH463',  'NH464',  'NH468',  'NH470',  'NH472',  'NH474',  'NH476',  
'NH478',  'NH479',  
'NH480',  'NH481',  'NH484',  'NH485',  'NH486',  'NH487',  'NH488',  
'NH489', 'NH490', 'NH491',  'NH492',  
'NH493', 'NH494',  'NH495',  'NH496',  'NH497',  'NH499',  'NH500',  'NH501',  'NH502',
'NH503',  'NH504',  
'NH507',  'NH508',  'NH509',  'NH510',  
'NH511',  'NH512',  'NH513',  'NH514',  'NH515',  'NH516',  'NH517',  'NH518',  
'NH519','NH523',  'NH524',  'NH525',  
'NH540', 'NH541',  'NH548',  'NH549',  'NH554',  'NH555',  'NH562',  'NH563',  'NH578',  
'NH579',  'NH580',  'NH584',  'NH585',  'NH586', 'NH587',  'NH588',  'NH589',  'NH590',  
'NH591','NH592','NH593','NH594','NH595','NH596','NH599','NH600','NH601',),),
       ),);        
       

#*********************************************************
# MODELE DE CALCUL
#*********************************************************
#  
MODELE=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION=MODELISA,),);


MATER=DEFI_MATERIAU(ELAS=_F(E=5.15E8,
                              NU=0.20,
                              RHO=2670.0,
                              ALPHA=0.,),
                    COMP_THM = LOI,
                      
                    THM_LIQU=_F(RHO=1000.0,
                                UN_SUR_K=UN_SUR_K,
                                VISC=VISCOLIQ,
                                D_VISC_TEMP=DVISCOL,),
                      
                    THM_GAZ=_F(MASS_MOL=0.002,
                               CP=1017.0,
                               VISC=VISCOGAZ,
                               D_VISC_TEMP=ZERO,),
                      
                    THM_VAPE_GAZ=_F(MASS_MOL=0.0001,
                                    CP=1900.0,
                                    VISC=VISCOGAZ,
                                    D_VISC_TEMP=ZERO,),
                     
                    THM_AIR_DISS=_F(CP=0.0,
                                    COEF_HENRY=HENRY,
                                      ),
                      
                    THM_INIT=_F(TEMP=303.0,
                                PRE1=0.,
                                PRE2=PREF,
                                PORO=0.15,
                                PRES_VAPE=0.1,
                                ),
                    THM_DIFFU=_F(R_GAZ=8.315,
                                 RHO=2200.0,
                                 CP=1050.0,
                                 BIOT_COEF=1.0,
                                 PESA_X=0.0,
                                 PESA_Y=0.0,
                                 PESA_Z=0.0,
                                 PERM_IN=KINT,
                                 VG_N            = N,
                                 VG_PR           = PR,
                                 VG_SR           = SR,
                                 VG_SMAX         = SMAX,
                                 VG_SATUR        = SATUC,
                                 FICKV_T=ZERO,
                                 FICKA_T= FICKWAR,
                                 FICKA_S  = FAS   , 
                                 LAMB_T=ZERO,),);
#****************************************************************
# AFFECTATION DES MATERIAUX
#****************************************************************
#
CHMAT0=AFFE_MATERIAU(MAILLAGE=MAIL,
                     AFFE=(_F(TOUT='OUI',
                              MATER=MATER,),
                              ),);

#*************************************************************
# AFFECTATION DE L ETAT INITIAL
#*************************************************************
#

CHAMNO=CREA_CHAMP(MAILLAGE=MAIL,
                    OPERATION='AFFE',
                    TYPE_CHAM='NOEU_DEPL_R',
                    AFFE    = ( 
                          _F(TOUT='OUI',
                             NOM_CMP='PRE1',
                             VALE=PC0,),
                          _F(TOUT='OUI',
                             NOM_CMP='PRE2',
                             VALE=0.,),
                             ),);

#*************************************************************
# AFFECTATION DES CL
#*************************************************************
#
           
CHG = AFFE_CHAR_MECA ( MODELE = MODELE ,
        FLUX_THM_REP = _F( GROUP_MA  = 'GAUCHE' ,
        FLUN_HYDR2 = 1.0 ,));
        
                     
                     
CHIMP = AFFE_CHAR_MECA ( MODELE = MODELE ,
                         DDL_IMPO  = (
                                  _F ( GROUP_MA = 'DROITE',
                                       PRE1   = PC0 ,),
                                  _F ( GROUP_MA = 'DROITE',
                                       PRE2   = 0. ,),                
                                      ),
                       );

#
#
#*************************************************************
#     STAT NON LINE
#*************************************************************
#

U0=STAT_NON_LINE(MODELE=MODELE,
                 CHAM_MATER=CHMAT0,
                 EXCIT    =(
                          _F( CHARGE   = CHIMP ),
                          _F( CHARGE   = CHG ,
                              FONC_MULT = FLUXG ) ,
                           ),
                 COMP_INCR=_F(RELATION='KIT_HH',
                              PARM_THETA=1.,
                              PARM_ALPHA=PARM_ALPHA,
                              ITER_INTE_MAXI=5,
                              RELATION_KIT=(LOI,'HYDR_VGM'),),
                           
                 ETAT_INIT=_F(DEPL=CHAMNO,),
               
                INCREMENT=_F(  
                   LIST_INST = LI,
                     INST_FIN=TFIN,
                ),
                           
                 NEWTON=_F(MATRICE='TANGENTE',
                           REAC_ITER=1,),
                        
                 CONVERGENCE=_F(
                                RESI_GLOB_RELA=RESI_GLOB_RELA,
                                ITER_GLOB_MAXI=ITER_GLOB_MAXI,),
                            
               
               );
       
#*************************************************************
# IMPRESSIONS
#*************************************************************       
        
PRE1_MIL= POST_RELEVE_T ( ACTION=_F( INTITULE   = 'DEPL'  ,
            RESULTAT   =  U0   ,
             LIST_INST=LISPOST,          
            GROUP_NO   = 'MILIEU'  ,
            NOM_CHAM   = 'DEPL'  ,
            NOM_CMP    = ( 'PRE1',) ,
            OPERATION  = 'EXTRACTION',),);

     
IMPR_TABLE(TABLE=PRE1_MIL,
       FORMAT   = 'TABLEAU_CROISE'    ,
       NOM_PARA=('INST','COOR_X','PRE1'),
       TRI   = (_F( NOM_PARA = ('COOR_X' ,),
       ORDRE    = 'CROISSANT',),),);
   
PRE2_MIL= POST_RELEVE_T ( ACTION=_F( INTITULE   = 'DEPL'  ,
            RESULTAT   =  U0   ,
             LIST_INST=LISPOST,          
            GROUP_NO   = 'MILIEU'  ,
            NOM_CHAM   = 'DEPL'  ,
            NOM_CMP    = ( 'PRE2',) ,
            OPERATION  = 'EXTRACTION',),);

     
IMPR_TABLE(TABLE=PRE2_MIL,
       FORMAT   = 'TABLEAU_CROISE'    ,
       NOM_PARA=('INST','COOR_X','PRE2'),
       TRI   = (_F( NOM_PARA = ('COOR_X' ,),
       ORDRE    = 'CROISSANT',),),); 
 
ISO_P=IMPR_RESU(MODELE=MODELE,
         FORMAT='IDEAS',
         RESU=_F(
           RESULTAT=U0,
           LIST_INST = LISPOST,
           NOM_CHAM    = ('VARI_ELGA',),
           NOM_CMP =('V6',),
           MAILLAGE=MAIL,),);
         
#===================== T=31536000S====================                    
                      
TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH4',
               NOM_CMP='PRE1',
               VALE_CALC=-9.98946725E+05,
               VALE_REFE=-9.98947E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH4',
               NOM_CMP='PRE2',
               VALE_CALC= 1.19595486E+03,
               VALE_REFE=1195.95,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH195',
               NOM_CMP='PRE1',
               VALE_CALC=-9.99999030E+05,
               VALE_REFE=-9.99999E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH195',
               NOM_CMP='PRE2',
               VALE_CALC= 4.95840169E-11,
               VALE_REFE=4.9584E-11,
               CRITERE='ABSOLU',
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH1',
               NOM_CMP='PRE1',
               VALE_CALC=-9.98946725E+05,
               VALE_REFE=-9.98947E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000E7,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH1',
               NOM_CMP='PRE2',
               VALE_CALC= 1.19595486E+03,
               VALE_REFE=1195.95,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

#===================== T=3.15360E+10S==================== 
TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH4',
               NOM_CMP='PRE1',
               VALE_CALC=-7.46537441E+05,
               VALE_REFE=-7.46537E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH4',
               NOM_CMP='PRE2',
               VALE_CALC= 2.55284303E+05,
               VALE_REFE=2.552843E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH195',
               NOM_CMP='PRE1',
               VALE_CALC=-1.00098383E+06,
               VALE_REFE=-1.000980E6,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH195',
               NOM_CMP='PRE2',
               VALE_CALC= 9.40096931E-06,
               VALE_REFE=9.400969E-06,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH1',
               NOM_CMP='PRE1',
               VALE_CALC=-7.46537441E+05,
               VALE_REFE=-7.46537E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

TEST_RESU(RESU=_F(INST=3.1536000000E10,
               REFERENCE='NON_DEFINI',
               RESULTAT=U0,
               NOM_CHAM='DEPL',
               NOEUD='NH1',
               NOM_CMP='PRE2',
               VALE_CALC= 2.55284303E+05,
               VALE_REFE=2.55284E5,
               CRITERE='RELATIF',
               PRECISION=1.E-2,
               ),
       )

FIN();
