# MODIF  DATE 13/01/2011   AUTEUR PELLET J.PELLET 
# TITRE VALIDATION LIRE_RESU AU FORMAT MED
# zzzz162a.para = tps_job 60 mem_job 100Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='ZZZZ162A', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))
#......................................................................
# CECI EST UN TEST DE L ECRITURE ET LA RELECTURE DES CHAMPS
# AU FORMAT MED - C EST LA RECOPIE DE HSNV100A
#......................................................................


MAIL=LIRE_MAILLAGE();
#
# DONNEES DE MODELISATION
#
#


FCT1=DEFI_FONCTION(NOM_PARA='EPSI',
                   VALE=(0.002,400.0,0.004,500.0,),
                   PROL_DROITE='LINEAIRE',
                   PROL_GAUCHE='LINEAIRE',);
#
#


FCT2=DEFI_FONCTION(NOM_PARA='EPSI',
                   VALE=(0.001,200.0,0.003,300.0,),
                   PROL_DROITE='LINEAIRE',
                   PROL_GAUCHE='LINEAIRE',);
#
#


CTRACB=DEFI_NAPPE(NOM_PARA='TEMP',
                  PARA=(0.0,50.0,),
                  FONCTION=(FCT1,FCT2,),
                  PROL_DROITE='LINEAIRE',
                  PROL_GAUCHE='LINEAIRE',);
#
# MATERIAU ISOTROPE
#
#


MAT=DEFI_MATERIAU(ELAS=_F(E=200000.0,
                          NU=0.3,
                          ALPHA=1e-05,),
                  TRACTION=_F(SIGM=CTRACB,),
                  THER=_F(LAMBDA=0.001,
                          RHO_CP=0.0,),);
#
# MATERIAU ORTHOTROPE EN FAIT ISOTROPE
#
#


MATO=DEFI_MATERIAU(ELAS_ORTH=_F(E_L=200000.0,
                                E_T=200000.0,
                                E_N=200000.0,
                                NU_LT=0.3,
                                NU_LN=0.3,
                                NU_TN=0.3,
                                G_LT=75000.0,
                                G_LN=75000.0,
                                G_TN=75000.0,
                                ALPHA_L=1e-05,
                                ALPHA_T=1e-05,
                                ALPHA_N=1e-05,),
                   TRACTION=_F(SIGM=CTRACB,),
                   THER=_F(LAMBDA=0.001,
                           RHO_CP=0.0,),);
#
#


CM=AFFE_MATERIAU(MAILLAGE=MAIL, AFFE=_F(TOUT='OUI', MATER=MAT, ),)
#
#


CMO=AFFE_MATERIAU(MAILLAGE=MAIL,
                  AFFE=_F(TOUT='OUI',
                          MATER=MATO),);
#
#


T0=CREA_CHAMP(TYPE_CHAM='NOEU_TEMP_R',
              OPERATION='AFFE',
              MAILLAGE=MAIL,
              AFFE=_F(TOUT='OUI',
                      NOM_CMP='TEMP',
                      VALE=0.0,),);

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=(_F(JUSQU_A=66.666,
                                     NOMBRE=1,),
                                  _F(JUSQU_A=80.0,
                                     NOMBRE=2,),
                                  _F(JUSQU_A=90.0,
                                     NOMBRE=2,),),);
#
#


TIMPVAR=DEFI_FONCTION(NOM_PARA='INST',
                      NOM_RESU='TEMP',
                      VALE=(0.0,0.0,100.0,100.0,),);
#
#


MOTHER=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='THERMIQUE',
                           MODELISATION='AXIS',),);
#
#


MOMECA=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='AXIS',),);
#
#


CHTHER=AFFE_CHAR_THER_F(MODELE=MOTHER,
                        TEMP_IMPO=(_F(GROUP_NO='GRNO1',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO2',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO3',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO4',
                                      TEMP=TIMPVAR,),),);
#
#


TEMPE1=THER_LINEAIRE(MODELE=MOTHER,
                     CHAM_MATER=CM,
                     EXCIT=_F(CHARGE=CHTHER,),
                     INCREMENT=_F(LIST_INST=L_INST,),
                     ETAT_INIT=_F(CHAM_NO=T0,),);

DEFI_FICHIER(FICHIER='MED_70', UNITE=70, TYPE='LIBRE')

IMPR_RESU(FORMAT='MED', UNITE=70, RESU=_F( RESULTAT=TEMPE1,),);

TEMPE=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                TOUT_ORDRE='OUI',);

CM1=AFFE_MATERIAU(MAILLAGE=MAIL, AFFE=_F(TOUT='OUI', MATER=MAT, ),
                  AFFE_VARC=_F(NOM_VARC='TEMP',EVOL=TEMPE,VALE_REF=0.),
             )

# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR
# IMPR_RESU LORSQU'UN NOEUD EST PRESENT DANS PLUSIEURS FILTRES

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,
                  MAILLE='M5',NUME_ORDRE=5,
                  GROUP_MA='GRMA1',),);

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,
                  NOEUD='N1',NUME_ORDRE=5,
                  GROUP_MA='GRMA1',),);

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,NUME_ORDRE=5,
                  GROUP_NO=('GRNO1','GRNM1',),),);

DEFI_FICHIER(UNITE=88, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.88',
             REFERENCE='NON_REGRESSION',
             # date a ignorer : ...15/09/2005 A 08:48:30
             # version a ignorer: ASTER  8.01.14
             EXPR_IGNORE=('[0-9]{2}/[0-9]{2}/[0-9]{4} A [0-9]{2}:'\
             +'[0-9]{2}:[0-9]{2}','ASTER  [0:9].[0:9]{2}.[0:9]{2}',),
             NB_VALE=24,
             VALE=8.44e+02,
             VERSION='9.1.21')


# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR
# IMPR_RESU AU FORMAT 'MED' (1/2)


IMPR_RESU(FORMAT='MED', UNITE=81,
          RESU=_F( RESULTAT=TEMPE1,
                   NUME_ORDRE=(1,5),
                   NOEUD='N1',
                   GROUP_MA='GRMA1',
                   ),);

TEMPE2=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=81,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                TOUT_ORDRE='OUI',);

IMPR_RESU(UNITE=82, FORMAT='GMSH',
          RESU=_F(RESULTAT=TEMPE2, NOM_CHAM='TEMP',NOM_CMP='TEMP'),)

DEFI_FICHIER(UNITE=82, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.82',
             REFERENCE='NON_REGRESSION',
             NB_VALE=95,
             VALE=1.156862e+03,
             VERSION='9.1.21')

# ----------------------------------------------------------------------------
# VALIDATION DE LIRE_RESU FORMAT 'MED' POUR UNE LISTE D'INSTANTS
# ET/OU NUMEROS D'ORDRE: (1/2)


TEMP0=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                NUME_ORDRE=(1,4,2),);


TEST_RESU ( RESU=(
                     _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 1,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 6.66660E+01       ),
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 4,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 8.50000E+01       ),
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 2,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 7.33330E+01       ),
                    ),)


DETRUIRE(CONCEPT=_F(NOM=TEMP0))

TEMP0=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                PRECISION=1.E-3,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                INST=(85.,73.33,),);


TEST_RESU ( RESU=(
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         INST       = 8.50000E+01,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 8.50000E+01       ),
                   _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         INST       = 7.332999999E+01,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 7.3333333E+01       ),
                    ),)
#-----------------------------------------------
# VALIDATION DE CREA_TABLE/RESU (1/2) : CHAM_NO

TB01=CREA_TABLE(
   RESU=_F(RESULTAT=TEMP0, TOUT='OUI', TOUT_CMP='OUI', NOM_CHAM='TEMP',),
)

NORM = FORMULE(VALE='(COOR_X*COOR_X+COOR_Y*COOR_Y)**0.5',
               NOM_PARA=('COOR_X','COOR_Y',),);

TB01=CALC_TABLE(reuse=TB01,
                TABLE=TB01,
                ACTION=(_F(OPERATION='OPER',
                           FORMULE=NORM,
                           NOM_PARA='NORM',),),);

PourTest = [
   [ 1, 'N1', 1.0, 0.0, 85.0],
   [ 1, 'N2', 2.0, 0.0, 85.0],
   [ 1, 'N3', 2.0, 4.0, 85.0],
   [ 1, 'N4', 1.0, 4.0, 85.0],
   [ 2, 'N1', 1.0, 0.0, 73.333],
   [ 2, 'N2', 2.0, 0.0, 73.333],
   [ 2, 'N3', 2.0, 4.0, 73.333],
   [ 2, 'N4', 1.0, 4.0, 73.333],
]
for numordre,noeud,X,Y,VTEMP in PourTest:
   TEST_TABLE(
      TABLE=TB01,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='TEMP', VALE=VTEMP,
   )
   TEST_TABLE(
      TABLE=TB01,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='COOR_X', VALE=X,
   )
   TEST_TABLE(
      TABLE=TB01,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='COOR_Y', VALE=Y,
   )


CH01=CREA_CHAMP(TYPE_CHAM='NOEU_TEMP_R',
               OPERATION='EXTR',
               RESULTAT=TEMP0,
               INST=73.33,
               NOM_CHAM='TEMP')

TB02=CREA_TABLE(
   RESU=_F(CHAM_GD=CH01, NOEUD='N1', NOM_CMP='TEMP',),
)

TEST_TABLE(
   TABLE=TB02,
   NOM_PARA='TEMP',
   VALE=73.33
)

DETRUIRE(CONCEPT=_F(NOM=TEMP0))

#---------------------------------------------------------------------------------

CHMECA=AFFE_CHAR_MECA(MODELE=MOMECA,
                      DDL_IMPO=(_F(GROUP_NO='GRNO1',
                                   DY=0.0,),
                                _F(GROUP_NO='GRNO3',
                                   DY=0.0,),),);

U=STAT_NON_LINE(MODELE=MOMECA,
                CHAM_MATER=CM1,
                EXCIT=_F(CHARGE=CHMECA,),
                COMP_INCR=_F(RELATION='VMIS_ISOT_TRAC',),
                INCREMENT=_F(LIST_INST=L_INST,),
                CONVERGENCE=_F(RESI_GLOB_RELA=1.E-8,
                               ITER_GLOB_MAXI=10,),);

U=CALC_ELEM(reuse =U,
            RESULTAT=U,
            OPTION=('SIEF_ELNO','VARI_ELNO_ELGA',),);


U=CALC_NO(reuse =U,
            RESULTAT=U,
            OPTION=('SIEF_NOEU','VARI_NOEU_ELGA',),);


IMPR_RESU(FORMAT='MED', UNITE=71, RESU=_F(RESULTAT=U,),);

UUU=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
              FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(_F( NOM_RESU='U',
                              NOM_CHAM    ='DEPL' ),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='SIEF_ELNO'),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='VARI_ELNO_ELGA'),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='SIEF_ELGA'),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='VARI_ELGA'),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='SIEF_NOEU'),
                          _F( NOM_RESU='U',
                              NOM_CHAM    ='VARI_NOEU_ELGA'),
                         ) ,
              UNITE=71,
              TOUT_ORDRE='OUI',);

IMPR_RESU(UNITE=74,RESU=_F(RESULTAT=UUU),);


TEST_RESU ( RESU=(
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'SIEF_ELGA',
                         INST       = 9.00000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'NON_REGRESSION',
                         POINT      =  1,
                         NOM_CMP    = 'SIYY',
                         CRITERE    = 'RELATIF',
                         PRECISION  = 1.E-6,
                         VALE       = -7.5E+01  ),
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'SIEF_ELGA',
                         INST       = 9.00000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'NON_REGRESSION',
                         POINT      =  1,
                         NOM_CMP    = 'SIXX',
                         CRITERE    = 'ABSOLU',
                         PRECISION  = 1.E-6,
                         VALE       = 0.  ),
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'VARI_ELGA',
                         INST       = 9.00000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'NON_REGRESSION',
                         POINT      =  1,
                         NOM_CMP    = 'V1',
                         VALE       =  5.25001E-04 ),
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'VARI_NOEU_ELGA',
                         INST       = 9.00000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'NON_REGRESSION',
                         NOEUD      =  'N3',
                         NOM_CMP    = 'V1',
                         VALE       =  5.25001E-04 ),

                    ),)

# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR
# IMPR_RESU AU FORMAT 'MED' (2/2)

IMPR_RESU(FORMAT='MED', UNITE=83,
          RESU=(_F(RESULTAT=U,NOM_CHAM=('SIEF_ELNO','VARI_ELNO_ELGA'),NUME_ORDRE=1,MAILLE='M1',),
                _F(RESULTAT=U,NOM_CHAM='DEPL',NUME_ORDRE=1,GROUP_NO='GRNO3'),
                   ),);

UUU2=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
               FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(
                          _F( NOM_CHAM_MED='U_______DEPL____________________',
                              NOM_CHAM    ='DEPL' ),
                          _F( NOM_CHAM_MED='U_______SIEF_ELNO_______________',
                              NOM_CHAM    ='SIEF_ELNO'),
                          _F( NOM_CHAM_MED='U_______VARI_ELNO_ELGA__________',
                             NOM_CMP=('V1','V2',),
                              NOM_CMP_MED=('V1','V2',),
                              NOM_CHAM    ='VARI_ELNO'),
                         ) ,
              UNITE=83,
              TOUT_ORDRE='OUI',);

IMPR_RESU(UNITE=84, FORMAT='GMSH',
          RESU=(_F(RESULTAT=UUU2,
                   NOM_CHAM='DEPL',NOM_CMP=('DX','DY'),),
                _F(RESULTAT=UUU2,
                   NOM_CHAM='SIEF_ELNO',NOM_CMP=('SIXX','SIYY','SIZZ','SIXY'),),
                _F(RESULTAT=UUU2,
                   NOM_CHAM='VARI_ELNO',NOM_CMP=('V1','V2'),),),)

DEFI_FICHIER(UNITE=84, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.84',
             REFERENCE='NON_REGRESSION',
             NB_VALE=445,
             VALE=2.202078e+02,
             VERSION='9.1.21')

# ----------------------------------------------------------------------------
# ----------------------------------------------------------------------------
# VALIDATION DE LIRE_RESU FORMAT 'MED' POUR UNE LISTE D'INSTANTS
# ET/OU NUMEROS D'ORDRE: (2/2)




UUU0=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
              FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(
                          _F( NOM_CHAM_MED='U_______VARI_ELNO_ELGA__________',
                              NOM_CMP=('V1','V2',),
                              NOM_CMP_MED=('V1','V2',),
                              NOM_CHAM    ='VARI_ELNO'),
                         ) ,
              UNITE=71,
              NUME_ORDRE=4,);


TEST_RESU ( RESU=(
                    _F(  RESULTAT   = UUU0,
                         NOM_CHAM   = 'VARI_ELNO',
                         INST       = 8.50000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     =  'N1',
                         NOM_CMP    = 'V1',
                         VALE       = 4.12500E-04       ),
                    ),)

#------------------------------------------------
# VALIDATION DE CREA_TABLE/RESU (2/2) : CHAM_ELEM

TB11=CREA_TABLE(
   RESU=_F(RESULTAT=UUU, NOM_CHAM='SIEF_ELNO', NOM_CMP=('SIYY','SIZZ'),MAILLE='M1',),
)

PourTest = [
   [ 1, 'N1', 1.0, 0.0 , -133.332],
   [ 2, 'N4', 1.0, 4.0,  -116.66750118],
   [ 5, 'N3', 2.0, 4.0,   -75.0000013627]
]
for numordre,noeud,X,Y, SIYY in PourTest:
   TEST_TABLE(
      TABLE=TB11,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='COOR_X', VALE=X,
   )
   TEST_TABLE(
      TABLE=TB11,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='COOR_Y', VALE=Y,
   )
   TEST_TABLE(
      TABLE=TB11,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'NOEUD',      VALE_K = noeud),
      ),
      NOM_PARA='SIYY', VALE=SIYY,
   )


CH11=CREA_CHAMP(TYPE_CHAM='ELGA_SIEF_R',
                OPERATION='EXTR',
                RESULTAT=UUU,
                NUME_ORDRE=2,
                NOM_CHAM='SIEF_ELGA')

TB12=CREA_TABLE(
   RESU=_F(CHAM_GD=CH11, NOM_CMP=('SIYY','SIZZ'), MAILLE='M1',),
)

PourTest = [
   [ 1, 1.21132486541 , 0.845299461621 , -116.66750118 ],
   [ 2, 1.78867513459 , 0.845299461621 , -116.66750118 ],
   [ 3, 1.78867513459 , 3.15470053838  , -116.66750118 ],
   [ 4, 1.21132486541 , 3.15470053838  , -116.66750118 ],
]
for point,X,Y,SIYY in PourTest:
   TEST_TABLE(TABLE=TB12,
      FILTRE=_F(NOM_PARA = 'POINT', VALE_I = point),
      NOM_PARA='SIYY', VALE=SIYY,
   )
   TEST_TABLE(TABLE=TB12,
      FILTRE=_F(NOM_PARA = 'POINT', VALE_I = point),
      NOM_PARA='COOR_X', VALE=X,
   )
   TEST_TABLE(TABLE=TB12,
      FILTRE=_F(NOM_PARA = 'POINT', VALE_I = point),
      NOM_PARA='COOR_Y', VALE=Y,
   )

TB13=CREA_TABLE(
   RESU=_F(RESULTAT=UUU, NOM_CHAM='VARI_ELGA', NOM_CMP='V1', NUME_ORDRE=5, TOUT='OUI',),
)

PourTest = [
 [ 5, 'M1', 1, 1.21132486541, 0.845299461621, 0.000525000000018 ],
 [ 5, 'M1', 2, 1.78867513459, 0.845299461621, 0.000524999999886 ],
 [ 5, 'M1', 3, 1.78867513459, 3.15470053838 , 0.000524999999017 ],
 [ 5, 'M1', 4, 1.21132486541, 3.15470053838 , 0.000525000000993 ],
]
for numordre,maille,point,X,Y,V1 in PourTest:
   TEST_TABLE(
      TABLE=TB13,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'MAILLE', VALE_K = maille),
         _F(NOM_PARA = 'POINT',  VALE_I = point),
      ),
      NOM_PARA='V1', VALE=V1,
   )
   TEST_TABLE(
      TABLE=TB13,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'MAILLE', VALE_K = maille),
         _F(NOM_PARA = 'POINT',  VALE_I = point),
      ),
      NOM_PARA='COOR_X', VALE=X,
   )
   TEST_TABLE(
      TABLE=TB13,
      FILTRE=(
         _F(NOM_PARA = 'NUME_ORDRE', VALE_I = numordre),
         _F(NOM_PARA = 'MAILLE', VALE_K = maille),
         _F(NOM_PARA = 'POINT',  VALE_I = point),
      ),
      NOM_PARA='COOR_Y', VALE=Y,
   )


DETRUIRE(CONCEPT=_F(NOM=UUU0))

# ----------------------------------------------------------------------------



TEST_RESU ( RESU=(  _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'SIEF_ELNO',
                         NUME_ORDRE = 4,
                         REFERENCE  = 'AUTRE_ASTER',
                         MAILLE     = 'M1',
                         POINT      = 1,
                         NOM_CMP    = 'SIYY',
                         VALE       = -87.5       ),
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'DEPL',
                         NUME_ORDRE = 5,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD      = 'N1',
                         NOM_CMP    = 'DX',
                         VALE       = 1.275E-03  ),),  )

IMPR_RESU(FORMAT='RESULTAT',RESU=_F(RESULTAT=UUU,),);

MAIL2=LIRE_MAILLAGE(FORMAT='MED',
                    UNITE =71     );

MOMECA2=AFFE_MODELE(MAILLAGE=MAIL2,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='AXIS',),);

SIGMRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                MODELE=MOMECA2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______SIEF_ELNO_______________',
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='ELNO_SIEF_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=SIGMRELU, ) ) ;

VARIRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                MODELE=MOMECA2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______VARI_ELNO_ELGA__________',
                NOM_CMP=('V1','V2',),
                NOM_CMP_MED=('V1','V2',),
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='ELNO_VARI_R',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=VARIRELU, ) ) ;

DEPLRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______DEPL____________________',
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='NOEU_DEPL_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=DEPLRELU, ) )



# ##################################################################################################
# VALIDATION DE IMPR_RESU ET LIRE_RESU AU FORMAT MED POUR UN EVOL_VARC

# Definition des champs d'irradiation
IRRA_0=CREA_CHAMP(
   TYPE_CHAM='NOEU_IRRA_R', OPERATION='AFFE', MAILLAGE=MAIL,
   AFFE=_F(TOUT='OUI', NOM_CMP='IRRA', VALE=5.0,),
)
IRRA_1=CREA_CHAMP(
   TYPE_CHAM='NOEU_IRRA_R', OPERATION='AFFE', MAILLAGE=MAIL,
   AFFE=(
      _F(TOUT='OUI',   NOM_CMP='IRRA', VALE=15.0,),
   ),
)
# Definition de EVOL_VARC
IRRAD=CREA_RESU(
   OPERATION='AFFE', TYPE_RESU='EVOL_VARC', NOM_CHAM='IRRA',
   AFFE=(
      _F(CHAM_GD=IRRA_0, INST=   0.0,),
      _F(CHAM_GD=IRRA_1, INST=  10.0,),
   ),
)

# Ecriture de l'EVOL_VRAC
lefic_m = './REPE_OUT/IRRAD.med'
unit_m = DEFI_FICHIER(ACTION='ASSOCIER',FICHIER=lefic_m,TYPE='LIBRE')
IMPR_RESU(
   UNITE=unit_m, FORMAT= 'MED',
   RESU=(
      _F(RESULTAT=IRRAD, NOM_CHAM=('IRRA'),),
   ),
)

# Lecture du maillage
maillu=LIRE_MAILLAGE(UNITE=unit_m, FORMAT='MED',)
# Lecture de l'EVOL_VARC
chirra=LIRE_RESU(
   TYPE_RESU='EVOL_VARC', FORMAT='MED',
   MAILLAGE=maillu,
   UNITE=unit_m,
   FORMAT_MED=_F(
      NOM_CHAM    ='IRRA',
      NOM_CHAM_MED='IRRAD___IRRA____________________',
   ),
   TOUT_ORDRE = 'OUI',
)
DETRUIRE(CONCEPT=(_F(NOM=unit_m),), INFO=1, ALARME='NON')

TEST_RESU(
   RESU=(
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=0.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N1',VALE=5.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=0.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N2',VALE=5.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=0.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N3',VALE=5.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=0.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N4',VALE=5.0),

      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=10.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N1',VALE=15.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=10.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N2',VALE=15.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=10.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N3',VALE=15.0),
      _F(RESULTAT=chirra,NOM_CHAM='IRRA',INST=10.0,NOM_CMP='IRRA',
         MAILLE='M1',REFERENCE='ANALYTIQUE',NOEUD='N4',VALE=15.0),
   ),
)
HELNO0=CREA_CHAMP(TYPE_CHAM='ELNO_HYDR_R',
                  OPERATION='AFFE',
                  MODELE=MOTHER,
                  AFFE=_F(MAILLE='M1',
                          NOM_CMP='HYDR',
                          VALE=0.0,),);

HELNO1=CREA_CHAMP(TYPE_CHAM='ELNO_HYDR_R',
                  OPERATION='AFFE',
                  MODELE=MOTHER,
                  AFFE=_F(MAILLE='M1',
                          NOM_CMP='HYDR',
                          VALE=1.0,),);

RESHYD=CREA_RESU(OPERATION='AFFE',
                 TYPE_RESU='EVOL_THER',
                 NOM_CHAM='HYDR_ELNO',
                 AFFE=(
                 _F(CHAM_GD=HELNO0,
                    INST=0.0,),
                 _F(CHAM_GD=HELNO1,
                    INST=90,),),);

RESHYD=CALC_NO(reuse =RESHYD,
               RESULTAT=RESHYD,
               OPTION='HYDR_NOEU',);

IMPR_RESU(FORMAT='MED',
          UNITE=72,
          RESU=_F(RESULTAT=RESHYD,),);

LUHYD=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MODELE=MOTHER,
                UNITE=72,
                FORMAT_MED=(
                _F(NOM_CHAM='HYDR_ELNO',
                   NOM_RESU='RESHYD',),
                _F(NOM_CHAM='HYDR_NOEU',
                   NOM_RESU='RESHYD',),),
                TOUT_ORDRE='OUI',);

TEST_RESU(RESU=(_F(RESULTAT=LUHYD,
                   NUME_ORDRE=1,
                   NOM_CHAM='HYDR_ELNO',
                   NOM_CMP='HYDR',
                   MAILLE='M1',
                   NOEUD='N1',
                   VALE=0,),
                _F(RESULTAT=LUHYD,
                   NUME_ORDRE=1,
                   NOM_CHAM='HYDR_NOEU',
                   NOM_CMP='HYDR',
                   NOEUD='N1',
                   VALE=0,),
                _F(RESULTAT=LUHYD,
                   INST=90,
                   NOM_CHAM='HYDR_ELNO',
                   NOM_CMP='HYDR',
                   MAILLE='M1',
                   NOEUD='N1',
                   VALE=1.0,),
                _F(RESULTAT=LUHYD,
                   INST=90,
                   NOM_CHAM='HYDR_NOEU',
                   NOM_CMP='HYDR',
                   NOEUD='N1',
                   VALE=1.0,),),);

FIN();


