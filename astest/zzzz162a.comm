# MODIF  DATE 22/05/2006   AUTEUR MCOURTOI M.COURTOIS 
# TITRE VALIDATION LIRE_RESU AU FORMAT MED
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2003  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F( NOM = 'ZZZZ162A',NIV_PUB_WEB='INTERNET'));
#......................................................................
# CECI EST UN TEST DE L ECRITURE ET LA RELECTURE DES CHAMPS
# AU FORMAT MED - C EST LA RECOPIE DE HSNV100A
#......................................................................


MAIL=LIRE_MAILLAGE();
#
# DONNEES DE MODELISATION
#
#


FCT1=DEFI_FONCTION(NOM_PARA='EPSI',
                   VALE=(0.002,400.0,0.004,500.0,),
                   PROL_DROITE='LINEAIRE',
                   PROL_GAUCHE='LINEAIRE',);
#
#


FCT2=DEFI_FONCTION(NOM_PARA='EPSI',
                   VALE=(0.001,200.0,0.003,300.0,),
                   PROL_DROITE='LINEAIRE',
                   PROL_GAUCHE='LINEAIRE',);
#
#


CTRACB=DEFI_NAPPE(NOM_PARA='TEMP',
                  PARA=(0.0,50.0,),
                  FONCTION=(FCT1,FCT2,),
                  PROL_DROITE='LINEAIRE',
                  PROL_GAUCHE='LINEAIRE',);
#
# MATERIAU ISOTROPE
#
#


MAT=DEFI_MATERIAU(ELAS=_F(E=200000.0,
                          NU=0.3,
                          ALPHA=1e-05,),
                  TRACTION=_F(SIGM=CTRACB,),
                  THER=_F(LAMBDA=0.001,
                          RHO_CP=0.0,),);
#
# MATERIAU ORTHOTROPE EN FAIT ISOTROPE
#
#


MATO=DEFI_MATERIAU(ELAS_ORTH=_F(E_L=200000.0,
                                E_T=200000.0,
                                E_N=200000.0,
                                NU_LT=0.3,
                                NU_LN=0.3,
                                NU_TN=0.3,
                                G_LT=75000.0,
                                G_LN=75000.0,
                                G_TN=75000.0,
                                ALPHA_L=1e-05,
                                ALPHA_T=1e-05,
                                ALPHA_N=1e-05,),
                   TRACTION=_F(SIGM=CTRACB,),
                   THER=_F(LAMBDA=0.001,
                           RHO_CP=0.0,),);
#
#


CM=AFFE_MATERIAU(MAILLAGE=MAIL,
                 AFFE=_F(TOUT='OUI',
                         MATER=MAT,
                         TEMP_REF=0.0,),);
#
#


CMO=AFFE_MATERIAU(MAILLAGE=MAIL,
                  AFFE=_F(TOUT='OUI',
                          MATER=MATO,
                          TEMP_REF=0.0,),);
#
#


T0=CREA_CHAMP(TYPE_CHAM='NOEU_TEMP_R',
              OPERATION='AFFE',
              MAILLAGE=MAIL,
              AFFE=_F(TOUT='OUI',
                      NOM_CMP='TEMP',
                      VALE=0.0,),);

L_INST=DEFI_LIST_REEL(DEBUT=0.0,
                      INTERVALLE=(_F(JUSQU_A=66.666,
                                     NOMBRE=1,),
                                  _F(JUSQU_A=80.0,
                                     NOMBRE=2,),
                                  _F(JUSQU_A=90.0,
                                     NOMBRE=2,),),);
#
#


TIMPVAR=DEFI_FONCTION(NOM_PARA='INST',
                      NOM_RESU='TEMP',
                      VALE=(0.0,0.0,100.0,100.0,),);
#
#


MOTHER=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='THERMIQUE',
                           MODELISATION='AXIS',),);
#
#


MOMECA=AFFE_MODELE(MAILLAGE=MAIL,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='AXIS',),);
#
#


CHTHER=AFFE_CHAR_THER_F(MODELE=MOTHER,
                        TEMP_IMPO=(_F(GROUP_NO='GRNO1',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO2',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO3',
                                      TEMP=TIMPVAR,),
                                   _F(GROUP_NO='GRNO4',
                                      TEMP=TIMPVAR,),),);
#
#


TEMPE1=THER_LINEAIRE(MODELE=MOTHER,
                     CHAM_MATER=CM,
                     EXCIT=_F(CHARGE=CHTHER,),
                     INCREMENT=_F(LIST_INST=L_INST,),
                     TEMP_INIT=_F(CHAM_NO=T0,),);

DEFI_FICHIER(FICHIER='MED_70', UNITE=70, TYPE='LIBRE')

IMPR_RESU(FORMAT='MED', UNITE=70, RESU=_F( RESULTAT=TEMPE1,),);

TEMPE=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                TOUT_ORDRE='OUI',);

# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR 
# IMPR_RESU LORSQU'UN NOEUD EST PRESENT DANS PLUSIEURS FILTRES

DEFI_FICHIER(UNITE=88)

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,
                  MAILLE='M5',NUME_ORDRE=5,
                  GROUP_MA='GRMA1',),);

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,
                  NOEUD='N1',NUME_ORDRE=5,
                  GROUP_MA='GRMA1',),);

IMPR_RESU(UNITE=88,RESU=_F(RESULTAT=TEMPE1,NUME_ORDRE=5,
                  GROUP_NO=('GRNO1','GRNM1',),),);

DEFI_FICHIER(UNITE=88, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.88',
             VALE_K='b18b319496f7b8ff7494bf8f491f3664',
             REFERENCE='NON_REGRESSION',
             # date a ignorer : ...15/09/2005 A 08:48:30
             # version a ignorer: ASTER  8.01.14
             EXPR_IGNORE=('[0-9]{2}/[0-9]{2}/[0-9]{4} A [0-9]{2}:'\
             +'[0-9]{2}:[0-9]{2}','ASTER  [0:9].[0:9]{2}.[0:9]{2}',),
             NB_CHIFFRE=4,
             EPSILON=1.E-6,
             VERSION='8.1.13')


# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR 
# IMPR_RESU AU FORMAT 'MED' (1/2)

DEFI_FICHIER(UNITE=81)

IMPR_RESU(FORMAT='MED', UNITE=81,
          RESU=_F( RESULTAT=TEMPE1,
                   NUME_ORDRE=(1,5),
                   NOEUD='N1',
                   GROUP_MA='GRMA1',
                   ),);

TEMPE2=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=81,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                TOUT_ORDRE='OUI',);

DEFI_FICHIER(UNITE=82)

IMPR_RESU(UNITE=82, FORMAT='GMSH',
          RESU=_F(RESULTAT=TEMPE2, NOM_CHAM='TEMP',NOM_CMP='TEMP'),)

DEFI_FICHIER(UNITE=82, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.82',
             VALE_K='06316ba52f604a212be8e39c8c4219e7',
             REFERENCE='NON_REGRESSION',
             NB_CHIFFRE=4,
             EPSILON=1.E-6,
             VERSION='8.1.13')

# ----------------------------------------------------------------------------
# VALIDATION DE LIRE_RESU FORMAT 'MED' POUR UNE LISTE D'INSTANTS
# ET/OU NUMEROS D'ORDRE: (1/2)


TEMP0=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                NUME_ORDRE=(1,4,2),);


TEST_RESU ( RESU=(  
                     _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 1,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 6.66660E+01       ),
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 4,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 8.50000E+01       ), 
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         NUME_ORDRE = 2,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 7.33330E+01       ), 
                    ),)


DETRUIRE(CONCEPT=_F(NOM=TEMP0))

TEMP0=LIRE_RESU(TYPE_RESU='EVOL_THER',
                FORMAT='MED',
                MAILLAGE=MAIL,
                UNITE=70,
                FORMAT_MED=_F(   NOM_CHAM_MED='TEMPE1__TEMP____________________',
                                 NOM_CHAM    ='TEMP',),
                INST=(85.,73.33,),);


TEST_RESU ( RESU=(  
                    _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         INST       = 8.50000E+01,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 8.50000E+01       ), 
                   _F(  RESULTAT   = TEMP0,
                         NOM_CHAM   = 'TEMP',
                         INST       = 7.33330E+01,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     = 'N1',
                         NOM_CMP    = 'TEMP',
                         VALE       = 7.33330E+01       ), 
                    ),)


DETRUIRE(CONCEPT=_F(NOM=TEMP0))

#---------------------------------------------------------------------------------

CHMECA=AFFE_CHAR_MECA(MODELE=MOMECA,
                      TEMP_CALCULEE=TEMPE,
                      DDL_IMPO=(_F(GROUP_NO='GRNO1',
                                   DY=0.0,),
                                _F(GROUP_NO='GRNO3',
                                   DY=0.0,),),);

U=STAT_NON_LINE(MODELE=MOMECA,
                CHAM_MATER=CM,
                EXCIT=_F(CHARGE=CHMECA,),
                COMP_INCR=_F(RELATION='VMIS_ISOT_TRAC',),
                INCREMENT=_F(LIST_INST=L_INST,),
                CONVERGENCE=_F(RESI_GLOB_RELA=0.0001,
                               ITER_GLOB_MAXI=10,),);

U=CALC_ELEM(reuse =U,
            RESULTAT=U,
            OPTION=('SIEF_ELNO_ELGA','VARI_ELNO_ELGA',),);

DEFI_FICHIER(FICHIER='MED_71', UNITE=71, TYPE='LIBRE')

IMPR_RESU(FORMAT='MED', UNITE=71, RESU=_F(RESULTAT=U,),);

UUU=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
              FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(_F( NOM_CHAM_MED='U_______DEPL____________________',
                              NOM_CHAM    ='DEPL' ),
                          _F( NOM_CHAM_MED='U_______SIEF_ELNO_ELGA__________',
                              NOM_CHAM    ='SIEF_ELNO'),
                          _F( NOM_CHAM_MED='U_______VARI_ELNO_ELGA__________',
                              NOM_CMP=('V1','V2',),
                              NOM_CMP_MED=('V1','V2',),
                              NOM_CHAM    ='VARI_ELNO'),
                         ) ,
              UNITE=71,
              TOUT_ORDRE='OUI',);

# ----------------------------------------------------------------------------
# VALIDATION DE GROUP_NO, GROUP_MA, NOEUD, MAILLE DE L'OPERATEUR 
# IMPR_RESU AU FORMAT 'MED' (2/2)

DEFI_FICHIER(UNITE=83)

IMPR_RESU(FORMAT='MED', UNITE=83,
          RESU=(_F(RESULTAT=U,NOM_CHAM=('SIEF_ELNO_ELGA','VARI_ELNO_ELGA'),NUME_ORDRE=1,MAILLE='M1',),
                _F(RESULTAT=U,NOM_CHAM='DEPL',NUME_ORDRE=1,GROUP_NO='GRNO3'),
                   ),);

UUU2=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
               FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(
                          _F( NOM_CHAM_MED='U_______DEPL____________________',
                              NOM_CHAM    ='DEPL' ),
                          _F( NOM_CHAM_MED='U_______SIEF_ELNO_ELGA__________',
                              NOM_CHAM    ='SIEF_ELNO'),
                          _F( NOM_CHAM_MED='U_______VARI_ELNO_ELGA__________',
                             NOM_CMP=('V1','V2',),
                              NOM_CMP_MED=('V1','V2',),
                              NOM_CHAM    ='VARI_ELNO'),
                         ) ,
              UNITE=83,
              TOUT_ORDRE='OUI',);

DEFI_FICHIER(UNITE=84)

IMPR_RESU(UNITE=84, FORMAT='GMSH',
          RESU=(_F(RESULTAT=UUU2,
                   NOM_CHAM='DEPL',NOM_CMP=('DX','DY'),),
                _F(RESULTAT=UUU2,
                   NOM_CHAM='SIEF_ELNO',NOM_CMP=('SIXX','SIYY','SIZZ','SIXY'),),
                _F(RESULTAT=UUU2,
                   NOM_CHAM='VARI_ELNO',NOM_CMP=('V1','V2'),),),)

DEFI_FICHIER(UNITE=84, ACTION='LIBERER')

TEST_FICHIER(FICHIER='./fort.84',
             VALE_K='a4bfdc206535743d586491e27d27a0e6',
             REFERENCE='NON_REGRESSION',
             NB_CHIFFRE=4,
             EPSILON=1.E-6,
             VERSION='8.1.13')

# ----------------------------------------------------------------------------
# ----------------------------------------------------------------------------
# VALIDATION DE LIRE_RESU FORMAT 'MED' POUR UNE LISTE D'INSTANTS
# ET/OU NUMEROS D'ORDRE: (2/2)




UUU0=LIRE_RESU(TYPE_RESU='EVOL_NOLI',
              FORMAT='MED',
              MODELE=MOMECA,
              FORMAT_MED=(
                          _F( NOM_CHAM_MED='U_______VARI_ELNO_ELGA__________',
                              NOM_CMP=('V1','V2',),
                              NOM_CMP_MED=('V1','V2',),
                              NOM_CHAM    ='VARI_ELNO'),
                         ) ,
              UNITE=71,
              NUME_ORDRE=4,);


TEST_RESU ( RESU=(  
                    _F(  RESULTAT   = UUU0,
                         NOM_CHAM   = 'VARI_ELNO',
                         INST       = 8.50000E+01,
                         MAILLE     = 'M1',
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD     =  'N1',
                         NOM_CMP    = 'V1',
                         VALE       = 4.12500E-04       ), 
                    ),)


DETRUIRE(CONCEPT=_F(NOM=UUU0))

# ----------------------------------------------------------------------------



TEST_RESU ( RESU=(  _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'SIEF_ELNO',
                         NUME_ORDRE = 4,
                         REFERENCE  = 'AUTRE_ASTER',
                         MAILLE     = 'M1',
                         POINT      = 1,
                         NOM_CMP    = 'SIYY',
                         VALE       = -87.5       ),
                    _F(  RESULTAT   = UUU,
                         NOM_CHAM   = 'DEPL',
                         NUME_ORDRE = 5,
                         REFERENCE  = 'AUTRE_ASTER',
                         NOEUD      = 'N1',
                         NOM_CMP    = 'DX',
                         VALE       = 1.275E-03  ),),  )

IMPR_RESU(FORMAT='RESULTAT',RESU=_F(RESULTAT=UUU,),);

MAIL2=LIRE_MAILLAGE(FORMAT='MED',
                    UNITE =71     );

MOMECA2=AFFE_MODELE(MAILLAGE=MAIL2,
                   AFFE=_F(TOUT='OUI',
                           PHENOMENE='MECANIQUE',
                           MODELISATION='AXIS',),);

SIGMRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                MODELE=MOMECA2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______SIEF_ELNO_ELGA__________',
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='ELNO_SIEF_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=SIGMRELU, ) ) ;

VARIRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                MODELE=MOMECA2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______VARI_ELNO_ELGA__________',
                NOM_CMP=('V1','V2',),
                NOM_CMP_MED=('V1','V2',),
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='ELNO_VARI_R',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=VARIRELU, ) ) ;

DEPLRELU=LIRE_CHAMP(MAILLAGE=MAIL2,
                FORMAT='MED',
                UNITE=71,
                NOM_MED='U_______DEPL____________________',
                NUME_ORDRE=2,NUME_PT=2,
                TYPE_CHAM='NOEU_DEPL_R',
                NOM_CMP_IDEM='OUI',
                INFO=2
               ) ;
IMPR_RESU ( RESU=_F( CHAM_GD=DEPLRELU, ) )

FIN();
