# person_in_charge: jean-luc.flejou at edf.fr
# ======================================================================
# COPYRIGHT (C) 1991 - 2016  EDF R2017  EDF R&DD                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NIV_PUB_WEB='INTRANET'), DEBUG=_F(SDVERI='OUI'),)

# LIGNE VVP CPY INTERIEUR BR VVP 002
# EXPANSION THERMIQUE + DEPL. ANCRAGES GV
# T = 287 DEG. C
# UX = 55 UY = -8 UZ = 76 (REPERE LOCAL)
# MAILLAGE POUTRES
# UNITES : MM, N, MPA

YOUNG=1.8604E+5

C_ALPHA=12.81E-6

RTUB=406.4

EPTUB=32.

RCOU=406.4

EPCOU=34.

RGV=410.

EPGV=38.

RBR=444.4

EPBR=70.

C_FLEX=6.032

DX_GV=46.466

DY_GV=-30.494

DZ_GV=76.

T22=287.

TREF=20.

import aster_core

def include_maillage(MAILLAGE):
    """Fonction une macro qui indique que le chemin pour chercher le maillage confidentiel"""
    fname  = MAILLAGE
    repdex = aster_core.get_option('repdex')
    fname  = osp.join(repdex, fname)
    return fname

maillage=include_maillage('ssll501a.mail.datg')
nom_maillage = '%s' % maillage
unite=DEFI_FICHIER(ACTION='ASSOCIER', FICHIER=nom_maillage,ACCES='NEW',UNITE=20)

#print "nom_restitue",maillage

#INCLUDE(DONNEE='ssll501a.mail.datg')
#maillage=INCLUDE(DONNEE='ssnv212.mater.datg')

MAILL=LIRE_MAILLAGE(VERI_MAIL=_F(VERIF='OUI'),FORMAT='ASTER',UNITE=unite,  )

DEFI_FICHIER(ACTION='LIBERER', UNITE=20)

#PRE_GIBI(UNITE_GIBI = 16)
#MAILL=LIRE_MAILLAGE(FORMAT="ASTER",VERI_MAIL=_F(VERIF='OUI'),)
#IMPR_RESU(UNITE = 45, FORMAT = 'MED', RESU=_F(MAILLAGE=MAILL))

# CREATION DES GROUPES DE NOEUDS **************************

DEFI_GROUP( reuse=MAILL,  MAILLAGE=MAILL,
                       CREA_GROUP_NO=_F( GROUP_MA = 'TUYAU')
                     )

# DEFINITION DU TYPE D'ETUDE *****************************

MODELE=AFFE_MODELE(     MAILLAGE=MAILL,AFFE=(
                         _F( GROUP_MA = 'TUYAU',
                               PHENOMENE = 'MECANIQUE',
                               MODELISATION = 'POU_D_T'),
                         _F( GROUP_MA = ('L2', 'L6', 'L18', 'L21', 'L26', 'L30',
                                         'L35', 'L39', 'L44', 'L46',),
                               PHENOMENE = 'MECANIQUE',
                               MODELISATION = 'POU_D_T'))
                              )

# DEFINITION DES CARACTERISTIQUES ELASTIQUES DU MATERIAU***
# VALEURS A 287 DEG. C

MAT_A48=DEFI_MATERIAU(   ELAS=_F( E = YOUNG, NU = 0.3,
                                  ALPHA = C_ALPHA))


# CARACTERISTIQUES DES POUTRES *************************

CARA_POU=AFFE_CARA_ELEM(
    MODELE=MODELE, INFO=2,
    POUTRE=(
        _F(SECTION = 'CERCLE', CARA = ('R', 'EP',), VALE = (RTUB, EPTUB,), GROUP_MA = 'TUYAU'),
        _F(SECTION = 'CERCLE', CARA = ('R', 'EP',), VALE = (RGV,  EPGV,), MAILLE = 'M1'),
        _F(SECTION = 'CERCLE', CARA = ('R', 'EP',), VALE = (RBR, EPBR,), MAILLE = 'M49'),
        _F(SECTION = 'CERCLE', CARA = ('R', 'EP',), VALE = (RCOU, EPCOU,),
           GROUP_MA = ('L2', 'L6', 'L18', 'L21', 'L26', 'L30', 'L35', 'L39', 'L44', 'L46',),),
        # Poutre coud√©es
        _F(GROUP_MA = ('L2', 'L6', 'L18', 'L21', 'L26', 'L30', 'L35', 'L39', 'L44', 'L46',),
           SECTION='COUDE',
           COEF_FLEX = C_FLEX),
    ),
)

# DEFINITION DES CONDITIONS AUX LIMITES ***

BLOQU=AFFE_CHAR_MECA(    MODELE=MODELE,DDL_IMPO=(
               _F( GROUP_NO = 'N1190',  DX = DX_GV,
                                      DY = DY_GV,
                                      DZ = DZ_GV,
                                      DRX = 0., DRY = 0., DRZ = 0.),
               _F( GROUP_NO = 'N200',   DX = 0., DY = 0., DZ = 0.,
                                      DRX = 0., DRY = 0., DRZ = 0.))
                      )

# DEFINITION DES CHARGEMENTS **********

TEMP_NO=CREA_CHAMP(     MAILLAGE=MAILL,
                          TYPE_CHAM='NOEU_TEMP_R',
                        OPERATION='AFFE',
                          AFFE=_F( TOUT = 'OUI',
                                NOM_CMP = 'TEMP',
                                VALE = T22)
                        )

TEMP=CREA_RESU(   OPERATION='AFFE', TYPE_RESU='EVOL_THER',
                    NOM_CHAM='TEMP',
                    AFFE=_F( CHAM_GD = TEMP_NO,
                             INST = 0.))

CHMTM=AFFE_MATERIAU(   MAILLAGE=MAILL,
                    AFFE=_F( GROUP_MA = 'TUYAU',
                          MATER = MAT_A48,),
                    AFFE_VARC=_F( TOUT='OUI',
                                  EVOL=TEMP,
                                  NOM_VARC='TEMP',
                                  NOM_CHAM='TEMP',
                                  VALE_REF=TREF),
)

# RESOLUTION EN STATIQUE LINEAIRE ***************************


RESU=MECA_STATIQUE(   MODELE=MODELE,
                         CHAM_MATER=CHMTM,
                         CARA_ELEM=CARA_POU,EXCIT=(
                         _F(  CHARGE = BLOQU),),
                         )

RESU=CALC_CHAMP(reuse= RESU,
                RESULTAT=RESU,
                CONTRAINTE=('SIPM_ELNO','EFGE_ELNO','EFGE_NOEU',),);

# IMPRESSION DES EFFORTS GENERALISES ****
# AUX NOEUDS NON MOYENNES - REPERE LOCAL

EFF_GEN=POST_RELEVE_T(
                      ACTION=_F( RESULTAT = RESU,
                       INTITULE = 'EFFORTS_GENERALISES',
                       GROUP_NO = 'TUYAU',
                       NOM_CHAM = 'EFGE_NOEU',
                       TOUT_CMP = 'OUI',
                       MOYE_NOEUD = 'NON',
                       OPERATION = 'EXTRACTION')
            )

TEST_RESU( RESU = _F(
           RESULTAT = RESU,
           REFERENCE='SOURCE_EXTERNE',
           PRECISION = 0.0015,
           VALE_CALC=-41034518.6847,
           VALE_REFE=-4.1084000E7,
           NOM_CHAM = 'EFGE_NOEU',
           NOM_CMP='MT',
           GROUP_NO = 'N1190',
           INST = 0.,
           ))

TEST_RESU( RESU = _F(
           RESULTAT = RESU,
           REFERENCE='SOURCE_EXTERNE',
           PRECISION = 0.0015,
           VALE_CALC=-91157145.8272,
           VALE_REFE=-9.1024000E7,
           NOM_CHAM = 'EFGE_NOEU',
           NOM_CMP='MT',
           GROUP_NO = 'N5',
           INST = 0.,
           ))


TEST_RESU( RESU = _F(
           RESULTAT = RESU,
           REFERENCE='SOURCE_EXTERNE',
           PRECISION = 0.065,
           VALE_CALC=-12739799.1472,
           VALE_REFE=-1.1992000E7,
           NOM_CHAM = 'EFGE_NOEU',
           NOM_CMP='MT',
           GROUP_NO = 'N25',
           INST = 0.,
           ))


TEST_RESU( RESU = _F(
           RESULTAT = RESU,
           REFERENCE='SOURCE_EXTERNE',
           PRECISION = 0.03,
           VALE_CALC=-364953.18753,
           VALE_REFE=-3.55000E5,
           NOM_CHAM = 'EFGE_NOEU',
           NOM_CMP='MT',
           GROUP_NO = 'N135',
           INST = 0.,
           ))


TEST_RESU( RESU = _F(
           RESULTAT = RESU,
           REFERENCE='SOURCE_EXTERNE',
           VALE_CALC= 6108453.08885,
           VALE_REFE=6.114000E6,
           NOM_CHAM = 'EFGE_NOEU',
           NOM_CMP='MT',
           GROUP_NO = 'N197',
           INST = 0.,
           ))




IMPR_TABLE(   TABLE=EFF_GEN,
       NOM_PARA=('ABSC_CURV', 'N', 'VY', 'VZ', 'MT', 'MFY', 'MFZ',
                 'NOEUD', 'MAILLE',),
               TRI=_F( NOM_PARA = ('ABSC_CURV', 'MAILLE',),
                    ORDRE = 'DECROISSANT',)
           )

# IMPRESSION DES DEPLACEMENTS DES NOEUDS ****

DEPLNO=POST_RELEVE_T(
                      ACTION=_F( RESULTAT = RESU,
                       INTITULE = 'DEPLACEMENTS_DES NOEUDS',
                       GROUP_NO = 'TUYAU',
                       NOM_CHAM = 'DEPL',
                       NOM_CMP = ('DX', 'DY', 'DZ',),
                       OPERATION = 'EXTRACTION')
            )

IMPR_TABLE(   TABLE=DEPLNO,
               NOM_PARA=('ABSC_CURV', 'COOR_X', 'COOR_Y',
                         'COOR_Z', 'DX', 'DY', 'DZ', 'NOEUD',),
               TRI=_F( NOM_PARA = 'ABSC_CURV',
                    ORDRE = 'DECROISSANT')
             )

# REFERENCE SYPIPE ABS(MT)
MTSYS=DEFI_FONCTION(    NOM_PARA='ABSC',
    VALE=(
0. , 41.084 ,
842. , 41.084 ,
842.001 , 41.085 ,
2567.3 , 91.025 ,
2567.301 , 91.024 ,
2717.3 , 91.024 ,
2717.301 , 91.027 ,
5847.3 , 91.027 ,
5847.301 , 91.026 ,
5975.3 , 91.026 ,
5975.301 , 91.025 ,
7700.7 , 11.992 ,
7700.701 , 11.992 ,
7950.7 , 11.992 ,
7950.701 , 11.992 ,
8950.7 , 11.992 ,
8950.701 , 11.992 ,
10465.7 , 11.992 ,
10465.701 , 11.991 ,
10470.7 , 11.991 ,
10470.701 , 11.993 ,
10475.7 , 11.993 ,
10475.701 , 11.992 ,
11890.7 , 11.992 ,
11890.701 , 11.992 ,
13770.7 , 11.992 ,
13770.701 , 11.992 ,
15650.7 , 11.992 ,
15650.701 , 11.992 ,
16450.7 , 11.992 ,
16450.701 , 11.992 ,
17955.7 , 11.992 ,
17955.701 , 11.992 ,
18940.7 , 11.992 ,
18940.701 , 11.991 ,
20666. , 40.955 ,
20666.001 , 40.953 ,
21453.1 , 40.953 ,
21453.101 , 40.954 ,
22112.9 , 40.954 ,
22112.901 , 40.953 ,
22536.7 , 28.097 ,
22536.701 , 28.097 ,
23314.5 , 28.097 ,
23314.501 , 28.129 ,
23316.5 , 28.129 ,
23316.501 , 28.099 ,
24919.5 , 28.099 ,
24919.501 , 28.099 ,
27871.3 , 28.099 ,
27871.301 , 28.099 ,
28295. , 13.751 ,
28295.001 , 13.751 ,
29243.8 , 13.751 ,
29243.801 , 13.752 ,
32680.9 , 13.752 ,
32680.901 , 13.751 ,
33629.8 , 13.751 ,
33629.801 , 13.751 ,
34053.4 , 0.354 ,
34053.401 , 0.354 ,
35002.3 , 0.354 ,
35002.301 , 0.356 ,
37576.3 , 0.356 ,
37576.301 , 0.343 ,
37578.2 , 0.343 ,
37578.201 , 0.356 ,
39388.1 , 0.356 ,
39388.101 , 0.355 ,
39811.9 , 12.528 ,
39811.901 , 12.528 ,
40645.9 , 12.528 ,
40645.901 , 12.524 ,
42195. , 12.524 ,
42195.001 , 12.525 ,
45174.2 , 12.525 ,
45174.201 , 12.525 ,
45545.4 , 20.313 ,
45545.401 , 20.312 ,
46371.6 , 20.312 ,
46371.601 , 20.32 ,
46373.6 , 20.32 ,
46373.601 , 20.312 ,
49543.65 , 20.312 ,
49543.651 , 20.312 ,
51058.56 , 20.312 ,
51058.561 , 20.312 ,
51873.2 , 6.734 ,
51873.201 , 6.734 ,
53509.76 , 6.734 ,
53509.761 , 6.734 ,
55235.09 , 6.114 ,
55235.091 , 6.114 ,
56456.1 , 6.114 ,
56456.101 , 6.114 ,
57596.096 , 6.114 ,
57596.097 , 6.114 ,
57766.1 , 6.114 ,
     ),
   PROL_DROITE='CONSTANT',
   PROL_GAUCHE='CONSTANT', )

MTAS=RECU_FONCTION(        TABLE=EFF_GEN,
                         PARA_X='ABSC_CURV',
                         PARA_Y='MT'
                       )
MTAST=CALC_FONCTION(    COMB=_F(  FONCTION = MTAS,
                                COEF = 1.E-6),
                          INTERPOL='LIN',
                          NOM_PARA='ABSC' )
FIN()
