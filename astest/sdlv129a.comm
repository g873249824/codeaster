# MODIF  DATE 11/09/2012   AUTEUR DELMAS J.DELMAS 
# TITRE FATIGUE VIBRATOIRE D'UNE AUBE DE VENTILATEUR
# sdlv129a.para = tps_job 100 mem_job 512Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SDLV129A',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'))

M=LIRE_MAILLAGE(FORMAT='MED',)
#
# MAILLAGE, MODELE ET MATERIAU
#
M=MODI_MAILLAGE(reuse =M, MAILLAGE=M,INFO=2,
                       ORIE_PEAU_3D=(_F(GROUP_MA='SLAT2',),),
                       );

MO=AFFE_MODELE(    MAILLAGE=M,    VERIF='MAILLE',
       AFFE=_F( TOUT = 'OUI',PHENOMENE = 'MECANIQUE',MODELISATION = '3D') )

MAT=DEFI_MATERIAU(
        ELAS=_F(  E = 210000.,  NU = 0.3,  RHO = 7.8E-6) )

CM=AFFE_MATERIAU(    MAILLAGE=M,
       AFFE=_F(  TOUT = 'OUI', MATER = MAT),);

#
# CONDITIONS AUX LIMITES ET CHARGEMENTS
#
CH=AFFE_CHAR_MECA(    MODELE=MO,
       DDL_IMPO=(_F(  GROUP_NO = 'CINT2',  DY = 0.),
                _F(  GROUP_NO = 'NHAUT',  DY = 0.),
                _F(  GROUP_MA = 'SLAT1',  DZ = 0.),),
       FACE_IMPO = _F(  GROUP_MA = 'SLAT2',  DNOR = 0.),
                );

ROTA=AFFE_CHAR_MECA(MODELE=MO,
                    ROTATION= _F(VITESSE=0.5,
                                 AXE=(0.0,1.0,0.0,),),);
#
# CALCUL DES CONTRAINTES STATIQUES
#
RES_STAT=MECA_STATIQUE(MODELE=MO,
               CHAM_MATER=CM,
                  EXCIT=(_F(CHARGE = CH,),
                         _F(CHARGE = ROTA, ) ),
                        );

RES_STAT=CALC_CHAMP(reuse=RES_STAT,CRITERES=('SIEQ_ELGA','SIEQ_ELNO'),CONTRAINTE=('SIGM_ELNO'),RESULTAT=RES_STAT)



TEST_RESU(RESU=_F(RESULTAT=RES_STAT,
                  NUME_ORDRE=1,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS_SG',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=307.712514,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=RES_STAT,
                  NUME_ORDRE=1,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=307.712514,
                  REFERENCE='NON_REGRESSION',),);

#
# CALCUL DES CONTRAINTES MODALES
#
MER=CALC_MATR_ELEM(  OPTION='RIGI_MECA',
      MODELE=MO,  CHARGE=CH,  CHAM_MATER=CM )

MEM=CALC_MATR_ELEM(  OPTION='MASS_MECA',
      MODELE=MO,  CHARGE=CH,  CHAM_MATER=CM )

NU=NUME_DDL(    MATR_RIGI=MER,  )

A=ASSE_MATRICE(MATR_ELEM=MER,NUME_DDL=NU)

B=ASSE_MATRICE(MATR_ELEM=MEM,NUME_DDL=NU)

MODE=MODE_ITER_SIMULT(    MATR_A=A,     MATR_B=B,
             CALC_FREQ=_F( NMAX_FREQ = 5) ,
             VERI_MODE=_F( SEUIL=1E-05),)

MODE=CALC_CHAMP(reuse=MODE,CRITERES=('SIEQ_ELGA','SIEQ_ELNO'),CONTRAINTE=('SIEF_ELGA','SIGM_ELNO'),RESULTAT=MODE)


TEST_RESU(RESU=_F(RESULTAT=MODE,
                  NUME_MODE=1,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS_SG',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=9.800254,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=MODE,
                  NUME_MODE=2,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS_SG',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=-31.150885,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=MODE,
                  NUME_MODE=1,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=9.800254,
                  REFERENCE='NON_REGRESSION',),);

TEST_RESU(RESU=_F(RESULTAT=MODE,
                  NUME_MODE=2,
                  NOM_CHAM='SIEQ_ELNO',
                  NOM_CMP='VMIS',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=31.150885,
                  REFERENCE='NON_REGRESSION',),);
#
#
# CALCUL EN FATIGUE
#
F_WOHLER=DEFI_FONCTION(      NOM_PARA='SIGM',
                              PROL_DROITE='LINEAIRE',
                             PROL_GAUCHE='LINEAIRE',
                                    VALE=(500.,  1.E6,
                                          1000.,     0.,
                                         ),
                                   TITRE='FONCTION DE WOHLER')
MATE=DEFI_MATERIAU(
          FATIGUE=_F(   WOHLER = F_WOHLER) ,
          RCCM=_F(  SU = 1000),
                     )
# MODE 1 SEUL (AUX NOEUDS, GOODMAN)
D_MOD1=CALC_FATIGUE( TYPE_CALCUL = 'FATIGUE_VIBR',
                       OPTION      = 'DOMA_ELNO_SIGM',
                       HISTOIRE    = _F( EQUI_GD  = 'VMIS_SG',
                                         RESULTAT = RES_STAT,
                                         MODE_MECA = MODE,
                                         NUME_MODE=1,
                                         FACT_PARTICI = 1),
                       DOMMAGE     = 'WOHLER',
                       CORR_SIGM_MOYE = 'GOODMAN',
                       MATER       = MATE,
                       INFO        = 1
                     )

TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD1,
                  NOM_CMP='DOMA',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=35.32,
                  REFERENCE='ANALYTIQUE',),);

TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD1,
                  NOM_CMP='DOMA',
                  TYPE_TEST='MIN',
                  VALE=21.138430,
                  REFERENCE='NON_REGRESSION',),);

# MODE 1 SEUL (AUX NOEUDS, GERBER)
D_MOD1b=CALC_FATIGUE( TYPE_CALCUL = 'FATIGUE_VIBR',
                       OPTION      = 'DOMA_ELNO_SIGM',
                       HISTOIRE    = _F( EQUI_GD  = 'VMIS_SG',
                                         RESULTAT = RES_STAT,
                                         MODE_MECA = MODE,
                                         NUME_MODE=1,
                                         FACT_PARTICI = 1),
                       DOMMAGE     = 'WOHLER',
                       CORR_SIGM_MOYE = 'GERBER',
                       MATER       = MATE,
                       INFO        = 1
                     )

TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD1b,
                  NOM_CMP='DOMA',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=46.18,
                  REFERENCE='ANALYTIQUE',),);

TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD1b,
                  NOM_CMP='DOMA',
                  TYPE_TEST='MIN',
                  VALE=27.712900,
                  REFERENCE='NON_REGRESSION',),);

# MODE 1 SEUL (AUX PTS DE GAUSS, GERBER)
D_MOD1G=CALC_FATIGUE( TYPE_CALCUL = 'FATIGUE_VIBR',
                       OPTION      = 'DOMA_ELGA_SIGM',
                       HISTOIRE    = _F( EQUI_GD  = 'VMIS_SG',
                                         RESULTAT = RES_STAT,
                                         MODE_MECA = MODE,
                                         NUME_MODE=1,
                                         FACT_PARTICI = 1),
                       DOMMAGE     = 'WOHLER',
                       CORR_SIGM_MOYE = 'GERBER',
                       MATER       = MATE,
                       INFO        = 1
                     )



# (MODE 1) + 0,5 * (MODE 2) (AUX NOEUDS, GOODMAN)
D_MOD12=CALC_FATIGUE( TYPE_CALCUL = 'FATIGUE_VIBR',
                       OPTION      = 'DOMA_ELNO_SIGM',
                       HISTOIRE    = _F( EQUI_GD  = 'VMIS_SG',
                                         RESULTAT = RES_STAT,
                                         MODE_MECA = MODE,
                                         NUME_MODE=(1,2),
                                         FACT_PARTICI = (1,0.5),),
                       DOMMAGE     = 'WOHLER',
                       CORR_SIGM_MOYE = 'GOODMAN',
                       MATER       = MATE,
                       INFO        = 1
                     )


TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD12,
                  NOM_CMP='DOMA',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=13.64,
                  REFERENCE='ANALYTIQUE',),);


TDMG12=POST_RELEVE_T(ACTION=_F(     INTITULE='(MODE 1) + 0,5 * (MODE 2)',
                                    CHAM_GD=D_MOD12,
                                    TOUT_CMP='OUI',
                                    OPERATION='EXTREMA',) ,) ;

TEST_TABLE(TABLE=TDMG12,
           FILTRE=( _F(NOM_PARA='EXTREMA',
                       VALE_K='MIN'),),
           REFERENCE='NON_REGRESSION',
           NOM_PARA='VALE',
           VALE=6.66335850,);

# (MODE 1) + 0,5 * (MODE 2) (AUX NOEUDS, GERBER)
D_MOD12b=CALC_FATIGUE( TYPE_CALCUL = 'FATIGUE_VIBR',
                       OPTION      = 'DOMA_ELNO_SIGM',
                       HISTOIRE    = _F( EQUI_GD  = 'VMIS_SG',
                                         RESULTAT = RES_STAT,
                                         MODE_MECA = MODE,
                                         NUME_MODE=(1,2),
                                         FACT_PARTICI = (1,0.5),),
                       DOMMAGE     = 'WOHLER',
                       CORR_SIGM_MOYE = 'GERBER',
                       MATER       = MATE,
                       INFO        = 1
                     )


TEST_RESU(CHAM_ELEM=_F(CHAM_GD=D_MOD12b,
                  NOM_CMP='DOMA',
                  MAILLE='M294',
                  NOEUD = 'N111',
                  VALE=17.83,
                  REFERENCE='ANALYTIQUE',),);


TDMG12b=POST_RELEVE_T(ACTION=_F(    INTITULE='(MODE 1) + 0,5 * (MODE 2)',
                                    CHAM_GD=D_MOD12b,
                                    TOUT_CMP='OUI',
                                    OPERATION='EXTREMA',) ,) ;

TEST_TABLE(TABLE=TDMG12b,
           FILTRE=(_F(NOM_PARA='EXTREMA',
                      VALE_K='MIN',),),
           REFERENCE='NON_REGRESSION',
           NOM_PARA='VALE',
           VALE=8.735795,);
FIN();
