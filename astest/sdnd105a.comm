# TITRE CHOC D'UNE MASSE SUR UNE PAROI AU COMPORTEMENT FLAMBAGE
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
# PLASTIQUE
# ----------------------------------------------------------------------
#

DEBUT(CODE=_F(NOM='SDND105A',NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='NON'))

MAILLAGE=LIRE_MAILLAGE( )

MODELE=AFFE_MODELE(  MAILLAGE=MAILLAGE,AFFE=(
                  _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_TR',
                         GROUP_MA = 'STRUC'),
                       _F(  PHENOMENE = 'MECANIQUE', MODELISATION = 'DIS_TR',
                         GROUP_NO = 'AUTRE'))                    )

CON_LIM=AFFE_CHAR_MECA( MODELE=MODELE,DDL_IMPO=(
                              _F(  GROUP_NO = 'ENCASTRE',
                                         DX = 0., DY = 0., DZ = 0.,
                                         DRX = 0., DRY = 0., DRZ = 0.),
                                       _F(  GROUP_NO = 'AUTRE',
                                                  DY = 0., DZ = 0.,
                                         DRX = 0., DRY = 0., DRZ = 0.))
                           )

CARA_ELE=AFFE_CARA_ELEM(  MODELE=MODELE,DISCRET=(
                       _F(  NOEUD = 'N02',
                                 CARA = 'M_TR_N',
                                 VALE = ( 1., 0., 1., 0., 0., 1., 0.,
                                         0., 0., 0., 0., 0., 0., 0.,
                                         0., 0., 0., 0., 0., 0., 0.,)),
                       _F(  NOEUD = 'N02',
                                 CARA = 'K_TR_N',
                                 VALE = ( 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                          0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                                          0.,)),
                               _F(  GROUP_MA = 'STRUC',  CARA = 'K_TR_D_L',
                                 VALE = ( 0.0000001, 0., 0., 0., 0., 0., ),
                                 REPERE = 'GLOBAL'))                )

#

RIGI_ELE=CALC_MATR_ELEM(  MODELE=MODELE,  OPTION='RIGI_MECA',
                              CARA_ELEM=CARA_ELE,  CHARGE=CON_LIM   )

MASS_ELE=CALC_MATR_ELEM( MODELE=MODELE,  OPTION='MASS_MECA_DIAG',
                              CARA_ELEM=CARA_ELE,  CHARGE=CON_LIM   )

#

NUMEDDL=NUME_DDL(  MATR_RIGI=RIGI_ELE,   METHODE='LDLT',
                        RENUM='SANS')

#

RIGIDITE=ASSE_MATRICE(  MATR_ELEM=RIGI_ELE,  NUME_DDL=NUMEDDL  )

MASSE=ASSE_MATRICE(  MATR_ELEM=MASS_ELE,  NUME_DDL=NUMEDDL  )

#

MODE_MEC=MODE_ITER_SIMULT(  MATR_RIGI=RIGIDITE,  MATR_MASS=MASSE,
              CALC_FREQ=_F(  OPTION = 'PLUS_PETITE',  NMAX_FREQ = 1)    )


#
#-----------------------------------------------------------------------
#

PROJ_BASE(  BASE=MODE_MEC,
            STOCKAGE='DIAG',
            MATR_ASSE_GENE=(
               _F(  MATRICE = CO("MASS_GEN"),
                                MATR_ASSE = MASSE),
               _F(  MATRICE = CO("RIGI_GEN"),
                                MATR_ASSE = RIGIDITE))
                                    )

#

V0=2.

VIT_INIT=CREA_CHAMP( OPERATION='AFFE', PROL_ZERO='OUI', TYPE_CHAM='NOEU_DEPL_R',
MAILLAGE=MAILLAGE,
                             NUME_DDL=NUMEDDL,
                            AFFE=_F(  TOUT = 'OUI',
                                   NOM_CMP = 'DX',
                                   VALE = V0)
                         )

#
NUMEGE=NUME_DDL_GENE(   BASE=MODE_MEC,
                          STOCKAGE='DIAG' )

#


VIT_GENE=PROJ_VECT_BASE(  BASE=MODE_MEC,
                              VECT_ASSE=VIT_INIT,
                              TYPE_VECT='VITE',
                             NUME_DDL_GENE=NUMEGE)

#

PLANY=DEFI_OBSTACLE(TYPE='PLAN_Y')

#


TRAN_GEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                            MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                            SCHEMA_TEMPS=_F(SCHEMA='EULER',),
                      ETAT_INIT=_F(  VITE = VIT_GENE),

                      FLAMBAGE=_F(  NOEUD_1 = 'N02',
                                 OBSTACLE = PLANY,
                                 NORM_OBST = (0., 1., 0.,),
                                 ORIG_OBST = (0., 0., 0.,),
                                 JEU = 1.,
                                 RIGI_NOR = 1.,
                                 FNOR_CRIT = 1.,
                                 FNOR_POST_FL = 0.5,
                                 RIGI_NOR_POST_FL = 0.5),

                      INCREMENT=_F(
                                  INST_INIT = 0.,   INST_FIN = 0.5,
                                  PAS = 0.0002)
                            )

TRAN_GEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                      reuse=TRAN_GEN,  MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                      SCHEMA_TEMPS=_F(SCHEMA='ADAPT_ORDRE2',),
                      ETAT_INIT=_F(  RESULTAT = TRAN_GEN,
                                  INST_INIT = 0.5),

                      FLAMBAGE=_F(  NOEUD_1 = 'N02',
                                 OBSTACLE = PLANY,
                                 NORM_OBST = (0., 1., 0.,),
                                 ORIG_OBST = (0., 0., 0.,),
                                 JEU = 1.,
                                 RIGI_NOR = 1.,
                                 FNOR_CRIT = 1.,
                                 FNOR_POST_FL = 0.5,
                                 RIGI_NOR_POST_FL = 0.5),

                      INCREMENT=_F(
                                 INST_FIN = 1.,  PAS = 0.0002,PAS_MAXI = 0.001,
                                 PAS_MINI = 2.E-8,)
                            )

TRAN_GEN=DYNA_VIBRA(TYPE_CALCUL='TRAN',BASE_CALCUL='GENE',
                      reuse=TRAN_GEN,  MATR_MASS=MASS_GEN,   MATR_RIGI=RIGI_GEN,
                      SCHEMA_TEMPS=_F(SCHEMA='DEVOGE',),
                      ETAT_INIT=_F(  RESULTAT = TRAN_GEN),


                      FLAMBAGE=_F(  NOEUD_1 = 'N02',
                                 OBSTACLE = PLANY,
                                 NORM_OBST = (0., 1., 0.,),
                                 ORIG_OBST = (0., 0., 0.,),
                                 JEU = 1.,
                                 RIGI_NOR = 1.,
                                 FNOR_CRIT = 1.,
                                 FNOR_POST_FL = 0.5,
                                 RIGI_NOR_POST_FL = 0.5),
                      INCREMENT=_F(
                                 INST_FIN = 12.,  PAS = 0.001)
                            )

TRAN=REST_GENE_PHYS(   RESU_GENE=TRAN_GEN,
                           NOM_CHAM='DEPL',
                       )

TABLE=POST_DYNA_MODA_T(   RESU_GENE=TRAN_GEN,
                              CHOC=_F(  OPTION = 'IMPACT')
                          )

# references
tfl = pi/6
dp = 3.
t0 = pi/6 +2*sqrt(3.) +(pi+6)/sqrt(2.)

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=1.E-3,
           VALE_CALC=2.998584194,
           VALE_REFE=3.0,
           NOM_PARA='ECRAS_RESI',
           TABLE=TABLE,
           FILTRE=(_F(NOM_PARA='CALCUL',
                      VALE_K='FLAMBAGE',),
                   _F(NOM_PARA='NOEUD',
                      VALE_K='N02',),
                   ),
           )

TEST_TABLE(REFERENCE='ANALYTIQUE',
           PRECISION=1.E-3,
           VALE_CALC=0.524108941,
           VALE_REFE=0.52359877559829882,
           NOM_PARA='INST_FLAMB',
           TABLE=TABLE,
           FILTRE=(_F(NOM_PARA='CALCUL',
                      VALE_K='FLAMBAGE',),
                   _F(NOM_PARA='NOEUD',
                      VALE_K='N02',),
                   ),
           )

TEST_RESU(RESU=_F(INST=10.45178254693452,
                  REFERENCE='ANALYTIQUE',
                  RESULTAT=TRAN,
                  NOM_CHAM='DEPL',
                  NOEUD='N02',
                  NOM_CMP='DX',
                  VALE_CALC=-2.15416813E-03,
                  VALE_REFE=0.0,
                  CRITERE=('ABSOLU', 'RELATIF'),
                  PRECISION=3.0E-3, TOLE_MACHINE=(3.0E-3, 5.0E-05),),
          )

FIN()
#
