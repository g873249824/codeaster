# MODIF  DATE 06/02/2013   AUTEUR COURTOIS M.COURTOIS 
# TITRE  POUTRE EULER_BERNOULLI MULTIFIBRES (STATIQUE LINEAIRE)
# sdll122a.para = tps_job 60 mem_job 512Mo ncpus 1 liste_test R
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SDLL122A', NIV_PUB_WEB='INTERNET'), DEBUG=_F(SDVERI='OUI'))

# lecture maillage lineique
MAPOU=LIRE_MAILLAGE(UNITE=20,);

# lecture maillage section1
MASEC1=LIRE_MAILLAGE(UNITE=18,);


MOPOU=AFFE_MODELE(MAILLAGE=MAPOU,
                  AFFE=_F(TOUT='OUI', PHENOMENE='MECANIQUE', MODELISATION='POU_D_EM',),
                  #AFFE=(
                        #_F(MAILLE='M1', PHENOMENE='MECANIQUE', MODELISATION='POU_D_E',),
                        #_F(MAILLE='M2', PHENOMENE='MECANIQUE', MODELISATION='POU_D_EM',),
                        #)
                  );

GF=DEFI_GEOM_FIBRE(
           # on s'arrange pour utiliser plusieurs occurrences de SECTION :
           SECTION = (_F ( GROUP_FIBRE='SEC1',
                            MAILLAGE_SECT = MASEC1 , TOUT_SECT = 'OUI',
                            COOR_AXE_POUTRE = (0., 1.38889E-02,)),
                        _F ( GROUP_FIBRE = 'SEC2',
                            MAILLAGE_SECT = MASEC1 , TOUT_SECT = 'OUI',
                            COOR_AXE_POUTRE = (0., 1.38889E-02,)),),

           FIBRE =_F ( GROUP_FIBRE = 'SACI', CARA = 'SURFACE',
                            COOR_AXE_POUTRE = (0.,0.,),
                            VALE =( 0.08 ,-0.15, 2.E-4,
                                  -0.08, -0.15, 2.E-4,
                                  0.1, 0.11, 1.5E-4,
                                  -0.1, 0.11, 1.5E-4, ),  ),
            )

POUCA=AFFE_CARA_ELEM(MODELE=MOPOU,    INFO=2,
# caracteristiques des sections, orientations et rigidite de torsion
           POUTRE=_F(GROUP_MA=('POUTRE'),
                     SECTION='GENERALE',
                     CARA=('A','IY','IZ','JX'),
                     VALE=(4.57e-2,4.657e-4,1.6806e-4,9.77e-5),),
           ORIENTATION=_F(GROUP_MA=('POUTRE'),
                          CARA='ANGL_VRIL', VALE=0.0,),

           GEOM_FIBRE=GF,
           MULTIFIBRE = (_F ( MAILLE = 'M1',GROUP_FIBRE=('SEC1','SACI')),
                        _F ( MAILLE = 'M2',GROUP_FIBRE=('SEC2','SACI')),
                        )
                  )
#IMPR_CO(CONCEPT=_F(NOM=POUCA))

# LES MATERIAUX
BETON=DEFI_MATERIAU(ELAS=_F(E=2.E10,
                            NU=0.25,),);

ACIER=DEFI_MATERIAU(ELAS=_F(E=2.10000000000E11,
                            NU=0.3,),);
# relation ELAS par defaut
COMP1=DEFI_COMPOR(GEOM_FIBRE=GF,MATER_SECT=BETON,
                  MULTIFIBRE=(_F(GROUP_FIBRE='SEC1',MATER=BETON),
                              _F(GROUP_FIBRE='SEC2',MATER=BETON),
                              _F(GROUP_FIBRE='SACI',MATER=ACIER),))

#
# LES CHAMPS DE MATERIAUX
CHMAT=AFFE_MATERIAU(MAILLAGE=MAPOU,
                    AFFE=_F(TOUT='OUI', MATER=(BETON,ACIER)),
                    AFFE_COMPOR=_F(GROUP_MA='POUTRE',COMPOR=COMP1),
                         );

BLOQUAGE=AFFE_CHAR_MECA(MODELE=MOPOU,
                        DDL_IMPO=(_F(GROUP_NO='A',  DX=0.0, DY=0.0, DZ=0.0,  DRX=0.0,  DRZ=0.0,),
                                  _F(GROUP_NO='B', DZ=0.0,),
                                  ),)

CHARGT=AFFE_CHAR_MECA(MODELE=MOPOU,
                      FORCE_NODALE=_F(GROUP_NO='C', FZ=1.E4,),);



#
# RESOLUTION DU PROBLEME ELASTIQUE
U1=MECA_STATIQUE(MODELE=MOPOU, CHAM_MATER=CHMAT, CARA_ELEM=POUCA,
             #    SOLVEUR=_F(METHODE='LDLT',RENUM='RCMK',STOP_SINGULIER='OUI',),
                  EXCIT=(_F(CHARGE=BLOQUAGE,),  _F(CHARGE=CHARGT,),),);
#
# CALCUL DES EFFORTS GENERALISES
U1=CALC_CHAMP(reuse=U1,RESULTAT=U1,CONTRAINTE=('EFGE_ELNO'))


U1=CALC_CHAMP(reuse =U1, RESULTAT=U1, CONTRAINTE='EFGE_NOEU')

TEST_RESU(RESU=(_F(NUME_ORDRE=1,
                   GROUP_NO='C',
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DZ',
                   VALE_CALC=2.2280400000000001E-3,
                   
                   ),
                _F(NUME_ORDRE=1,
                   GROUP_NO='A',
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOM_CMP='DRY',
                   VALE_CALC=-1.3377E-3,
                   TOLE_MACHINE=1.9999999999999999E-06,
                   ),
                _F(NUME_ORDRE=1,
                   GROUP_NO='A',
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_NOEU',
                   NOM_CMP='VZ',
                   VALE_CALC=5000.0,
                   
                   ),
                _F(NUME_ORDRE=1,
                   GROUP_NO='C',
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_NOEU',
                   NOM_CMP='MFY',
                   VALE_CALC=1.2500E4,
                   
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DRY',
                   VALE_CALC=-1.3377015259746999E-3,
                   
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DX',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DY',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DZ',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DRX',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N1',
                   NOM_CMP='DRZ',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='DEPL',
                   NOEUD='N2',
                   NOM_CMP='DZ',
                   VALE_CALC=2.2280411471271E-3,
                   
                   ),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='N',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='VZ',
                   VALE_CALC=5000.0,
                   
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='MFY',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='VY',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='MT',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                _F(NUME_ORDRE=1,
                   RESULTAT=U1,
                   NOM_CHAM='EFGE_ELNO',
                   NOEUD='N1',
                   NOM_CMP='MFZ',
                   VALE_CALC=0.0,
                   
                   CRITERE='ABSOLU',
                   MAILLE='M1',),
                ),
          )

# Test de CREA_TABLE/RESU sur des elements a sous-points
TU1_1 = CREA_TABLE(RESU=_F(RESULTAT=U1,TOUT='OUI',NOM_CHAM='EFGE_NOEU',TOUT_CMP='OUI'))

PourTest = [
   [ 1, 'N3', 'COOR_X',      5.0 ],
   [ 1, 'N3', 'VZ',      -5000.0 ],
   [ 1, 'N2', 'COOR_X',      2.5 ],
   [ 1, 'N2', 'MFY',     12500.0 ],
]
for numordre,noeud,npara,lavale in PourTest:
   TEST_TABLE(
      TABLE=TU1_1,
      FILTRE=(
         _F(NOM_PARA='NUME_ORDRE', CRIT_COMP='EQ', VALE_I= numordre),
         _F(NOM_PARA='NOEUD',      CRIT_COMP='EQ', VALE_K= noeud),
      ),
      NOM_PARA=npara,
      VALE_CALC=lavale,
   )


linst=DEFI_LIST_REEL(VALE=(0.0,1.0))
U2=STAT_NON_LINE(
   MODELE=MOPOU, CHAM_MATER=CHMAT, CARA_ELEM=POUCA,
   INCREMENT=_F(LIST_INST=linst),
   COMP_INCR=_F(TOUT='OUI',RELATION='MULTIFIBRE',),
   EXCIT=(_F(CHARGE=BLOQUAGE,),  _F(CHARGE=CHARGT,),),
)

TU2_1 = CREA_TABLE(RESU=_F(RESULTAT=U2,TOUT='OUI',NOM_CHAM='SIEF_ELGA',TOUT_CMP='OUI'))

PourTest = [
   [ 1, 'M1', 1,   1, 'COOR_X',   1.97168783649 ],
   [ 1, 'M1', 1,   1, 'SIXX',     617514.30936  ],
   [ 1, 'M1', 1,  66, 'COOR_X',   1.97168783649 ],
   [ 1, 'M1', 1,  66, 'SIXX',    -83555.8906972 ],
   [ 1, 'M2', 2,  23, 'COOR_X',   3.02831216351 ],
   [ 1, 'M2', 2,  23, 'SIXX',     527053.638562 ],
   [ 1, 'M2', 2, 138, 'COOR_X',   3.02831216351 ],
   [ 1, 'M2', 2, 138, 'SIXX',    -603704.741154 ],
]
for numordre,maille,point,spoint,npara,lavale in PourTest:
   TEST_TABLE(
      TABLE=TU2_1,
      FILTRE=(
         _F(NOM_PARA='NUME_ORDRE', CRIT_COMP='EQ', VALE_I=  numordre),
         _F(NOM_PARA='MAILLE',     CRIT_COMP='EQ', VALE_K=  maille),
         _F(NOM_PARA='POINT',      CRIT_COMP='EQ', VALE_I=  point),
         _F(NOM_PARA='SOUS_POINT', CRIT_COMP='EQ', VALE_I=  spoint),
      ),
      NOM_PARA=npara,
      VALE_CALC=lavale,
   )

IMPR_TABLE(TABLE=TU2_1)


# Test du maillage des sections de poutres multifibres
DEFI_FICHIER(UNITE=82, FICHIER='./fort.82')

# IMPRESSION DU MAILLE GLOBAL SECTION
MAGF=CREA_MAILLAGE(GEOM_FIBRE=GF)
IMPR_RESU(UNITE=82,RESU=_F(MAILLAGE=MAGF))

DEFI_FICHIER(UNITE=82, ACTION='LIBERER')


TEST_FICHIER(FICHIER='./fort.82',
             NB_VALE=3025,
             VALE_CALC=4.220584199956E+05,
             TOLE_MACHINE=1.e-3,
             )


FIN();

