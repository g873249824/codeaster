# TITRE PILOTAGE DU CHARGEMENT EN NON LINEAIRE
# ======================================================================
# COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

DEBUT(CODE=_F(NOM='SSNX101A',
              NIV_PUB_WEB='INTERNET',),
      DEBUG=_F(SDVERI='OUI',),);

# AFFECTATION DE LA GEOMETRIE

MA=LIRE_MAILLAGE(FORMAT='MED',);

MA=DEFI_GROUP(reuse =MA,
              MAILLAGE=MA,
              CREA_GROUP_NO=_F(TOUT_GROUP_MA='OUI',),);

# DEFINITION DU COMPORTEMENT DES MATERIAUX

MAT=DEFI_MATERIAU(ELAS=_F(E=200000.,
                          NU=0.3,
                          RHO=1.E-6,),);

CHMAT=AFFE_MATERIAU(MAILLAGE=MA,
                    AFFE=_F(TOUT='OUI',
                            MATER=MAT,),);

# CHOIX DU TYPE D'ELEMENTS FINIS

MO=AFFE_MODELE(MAILLAGE=MA,
               AFFE=_F(TOUT='OUI',
                       PHENOMENE='MECANIQUE',
                       MODELISATION='C_PLAN',),);

# DEFINITION DU CHARGEMENT

LIAISON=AFFE_CHAR_MECA(MODELE=MO,
                       DDL_IMPO=_F(GROUP_NO='ANCRAGE',
                                   DX=0.,
                                   DY=0.,),);

POIDS=AFFE_CHAR_MECA(MODELE=MO,
                     PESANTEUR=_F(GRAVITE=9810.,
                                  DIRECTION=(0.,-1.,0.,),),);

COMPRESS=AFFE_CHAR_MECA(MODELE=MO,
                        FORCE_CONTOUR=_F(GROUP_MA='LIBRE',
                                         FX=-1.,),);

# DISCRETISATION

INSTANTS=DEFI_LIST_REEL(DEBUT=0.,
                        INTERVALLE=(_F(JUSQU_A=1.,
                                       NOMBRE=10,),
                                    _F(JUSQU_A=2.,
                                       NOMBRE=50,),),);

# ON LAISSE LE POIDS PROPRE S'ETABLIR PAR PILOTAGE

PHASE_1=STAT_NON_LINE(MODELE=MO,
                      CHAM_MATER=CHMAT,
                      EXCIT=(_F(CHARGE=LIAISON,),
                             _F(CHARGE=POIDS,
                                TYPE_CHARGE='FIXE_PILO',),),
                      COMP_ELAS=_F(RELATION='ELAS',
                                   DEFORMATION='GROT_GDEP',),
                      INCREMENT=_F(LIST_INST=INSTANTS,),
                      NEWTON=_F(MATRICE='TANGENTE',
                                REAC_ITER=1,),
                      PILOTAGE=_F(TYPE='DDL_IMPO',
                                  COEF_MULT=-0.1,
                                  ETA_PILO_MAX=1.,
                                  GROUP_NO='A',
                                  NOM_CMP='DY',),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-11,),);

# ON ETABLIT LA COMPRESSION PAR PILOTAGE

PHASE_2=STAT_NON_LINE(MODELE=MO,
                      CHAM_MATER=CHMAT,
                      EXCIT=(_F(CHARGE=LIAISON,),
                             _F(CHARGE=POIDS,),
                             _F(CHARGE=COMPRESS,
                                TYPE_CHARGE='FIXE_PILO',),),
                      COMP_ELAS=_F(RELATION='ELAS',
                                   DEFORMATION='GROT_GDEP',),
                      ETAT_INIT=_F(EVOL_NOLI=PHASE_1,),
                      INCREMENT=_F(LIST_INST=INSTANTS,
                                   INST_INIT=1.,),
                      NEWTON=_F(MATRICE='TANGENTE',
                                REAC_ITER=1,),
                      PILOTAGE=_F(TYPE='LONG_ARC',
                                  COEF_MULT=2.E-3,
                                  ETA_PILO_MAX=407.,
                                  SELECTION='ANGL_INCR_DEPL',
                                  GROUP_NO='POUTRE',
                                  NOM_CMP=('DX','DY',),),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-11,),);

# VERIFICATION DES ETATS FINALS

VERIF_1=STAT_NON_LINE(MODELE=MO,
                      CHAM_MATER=CHMAT,
                      EXCIT=(_F(CHARGE=LIAISON,),
                             _F(CHARGE=POIDS,),),
                      COMP_ELAS=_F(RELATION='ELAS',
                                   DEFORMATION='GROT_GDEP',),
                      ETAT_INIT=_F(EVOL_NOLI=PHASE_1,),
                      INCREMENT=_F(LIST_INST=INSTANTS,
                                   INST_INIT=0.,
                                   INST_FIN=0.1,),
                      NEWTON=_F(MATRICE='TANGENTE',
                                REAC_ITER=1,),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-11,),);

DEPPHA_1=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=PHASE_1,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=8,);

DEPVER_1=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=VERIF_1,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=1,);

DEPDIF_1=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPTION='DEPL',
                    OPERATION='ASSE',
                    MODELE=MO,
                    ASSE=(
                    _F(TOUT='OUI',
                       CHAM_GD=DEPPHA_1,
                       CUMUL='OUI',
                       COEF_R=1.,),
                    _F(TOUT='OUI',
                       CHAM_GD=DEPVER_1,
                       CUMUL='OUI',
                       COEF_R=-1.,),),);

NORDIF_1=POST_ELEM(ENER_POT=_F(TOUT='OUI',),
                   MODELE=MO,
                   CHAM_MATER=CHMAT,
                   CHAM_GD=DEPDIF_1,);

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='AUTRE_ASTER',
           PRECISION=1.E-10,
           VALE_CALC= 1.4052813314E-23,
           VALE_REFE=0.0,
           TOLE_MACHINE=1.E-10,
           NOM_PARA='TOTALE',
           TABLE=NORDIF_1,
           FILTRE=_F(NOM_PARA='LIEU',
                     VALE_K='MA',),
           )

COMPR407=AFFE_CHAR_MECA(MODELE=MO,
                        FORCE_CONTOUR=_F(GROUP_MA='LIBRE',
                                         FX=-407.,),);

VERIF_2=STAT_NON_LINE(MODELE=MO,
                      CHAM_MATER=CHMAT,
                      EXCIT=(_F(CHARGE=LIAISON,),
                             _F(CHARGE=POIDS,),
                             _F(CHARGE=COMPR407,),),
                      COMP_ELAS=_F(RELATION='ELAS',
                                   DEFORMATION='GROT_GDEP',),
                      ETAT_INIT=_F(EVOL_NOLI=PHASE_2,),
                      INCREMENT=_F(LIST_INST=INSTANTS,
                                   NUME_INST_INIT=0,
                                   NUME_INST_FIN=1,),
                      NEWTON=_F(MATRICE='TANGENTE',
                                REAC_ITER=1,),
                      CONVERGENCE=_F(RESI_GLOB_RELA=1.E-11,),);

DEPPHA_2=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=PHASE_2,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=13,);

DEPVER_2=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=VERIF_2,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=1,);

DEPDIF_2=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPTION='DEPL',
                    OPERATION='ASSE',
                    MODELE=MO,
                    ASSE=(
                    _F(TOUT='OUI',
                       CHAM_GD=DEPPHA_2,
                       CUMUL='OUI',
                       COEF_R=1.,),
                    _F(TOUT='OUI',
                       CHAM_GD=DEPVER_2,
                       CUMUL='OUI',
                       COEF_R=-1.,),),);

NORDIF_2=POST_ELEM(ENER_POT=_F(TOUT='OUI',),
                   MODELE=MO,
                   CHAM_MATER=CHMAT,
                   CHAM_GD=DEPDIF_2,);

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='AUTRE_ASTER',
           PRECISION=1.E-10,
           VALE_CALC= 1.1695340590E-15,
           VALE_REFE=0.0,
           TOLE_MACHINE=1.E-10,
           NOM_PARA='TOTALE',
           TABLE=NORDIF_2,
           FILTRE=_F(NOM_PARA='LIEU',
                     VALE_K='MA',),
           )

# VERIFICATION DE LA CONDITION CINEMATIQUE EN PHASE 1

DEP_MOIN=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=PHASE_1,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=2,);

DEP_PLUS=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=PHASE_1,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=3,);

DEP_DELT=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPTION='DEPL',
                    OPERATION='ASSE',
                    MODELE=MO,
                    ASSE=(
                    _F(TOUT='OUI',
                       CHAM_GD=DEP_PLUS,
                       CUMUL='OUI',
                       COEF_R=1.,),
                    _F(TOUT='OUI',
                       CHAM_GD=DEP_MOIN,
                       CUMUL='OUI',
                       COEF_R=-1.,),),);

TEST_RESU(CHAM_NO=_F(REFERENCE='ANALYTIQUE',
                     NOM_CMP='DY',
                     GROUP_NO='A',
                     PRECISION=1.E-08,
                     CHAM_GD=DEP_DELT,
                     VALE_CALC=-1.000000000,
                     VALE_REFE=-1.0,),
          )

# VERIFICATION DE LA POSSIBILITE DE COMBINER RECH_LINEAIRE ET PILOTAGE
# (NE CONVIENT PAS POUR LA PESANTEUR)
# ON ETABLIT LA COMPRESSION PAR PILOTAGE COMBINE AVEC LA RECHERCHE LINEAIRE

PHASE_2B=STAT_NON_LINE(MODELE=MO,
                       CHAM_MATER=CHMAT,
                       EXCIT=(_F(CHARGE=LIAISON,),
                              _F(CHARGE=POIDS,),
                              _F(CHARGE=COMPRESS,
                                 TYPE_CHARGE='FIXE_PILO',),),
                       COMP_ELAS=_F(RELATION='ELAS',
                                    DEFORMATION='GROT_GDEP',),
                       ETAT_INIT=_F(EVOL_NOLI=PHASE_1,),
                       INCREMENT=_F(LIST_INST=INSTANTS,
                                    INST_INIT=1.,),
                       NEWTON=_F(MATRICE='TANGENTE',
                                 REAC_ITER=1,),
                       RECH_LINEAIRE=_F(METHODE = 'PILOTAGE',ITER_LINE_MAXI=5,),
                       PILOTAGE=_F(TYPE='LONG_ARC',
                                   COEF_MULT=2.E-3,
                                   ETA_PILO_MAX=407.,
                                   SELECTION='ANGL_INCR_DEPL',
                                   GROUP_NO='POUTRE',
                                   NOM_CMP=('DX','DY',),),
                       CONVERGENCE=_F(RESI_GLOB_RELA=1.E-11,),);

DEPPHA2B=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPERATION='EXTR',
                    RESULTAT=PHASE_2B,
                    NOM_CHAM='DEPL',
                    NUME_ORDRE=13,);

DEPDIF2B=CREA_CHAMP(TYPE_CHAM='NOEU_DEPL_R',
                    OPTION='DEPL',
                    OPERATION='ASSE',
                    MODELE=MO,
                    ASSE=(
                    _F(TOUT='OUI',
                       CHAM_GD=DEPPHA2B,
                       CUMUL='OUI',
                       COEF_R=1.,),
                    _F(TOUT='OUI',
                       CHAM_GD=DEPVER_2,
                       CUMUL='OUI',
                       COEF_R=-1.,),),);

NORDIF2B=POST_ELEM(ENER_POT=_F(TOUT='OUI',),
                   MODELE=MO,
                   CHAM_MATER=CHMAT,
                   CHAM_GD=DEPDIF2B,);

TEST_TABLE(CRITERE='ABSOLU',
           REFERENCE='AUTRE_ASTER',
           PRECISION=1.E-10,
           VALE_CALC= 1.8791496167E-15,
           VALE_REFE=0.0,
           TOLE_MACHINE=1.E-10,
           NOM_PARA='TOTALE',
           TABLE=NORDIF2B,
           FILTRE=_F(NOM_PARA='LIEU',
                     VALE_K='MA',),
           )

FIN();

#
