# MODIF  DATE 05/03/2013   AUTEUR BRIE N.BRIE 
# TITRE CALCUL MODAL D'UNE PLAQUE RECTANGULAIRE SIMPLEMENT APPUYEE SUR TOUS SES BORDS
#
#            CONFIGURATION MANAGEMENT OF EDF VERSION
# ======================================================================
# COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================

########################################################################

#           SOUS-STRUCTURATION CLASSIQUE

#           PLAQUE DECOUPEE EN 2 PARTIES

#           AVEC INTERFACES DE TYPE CRAIG-BAMPTON

#           MAILLAGES INCOMPATIBLES ET MODES DE COUPLAGE

#           RACCORDEMENT AVEC ELIMINATION DES CONTRAINTES

########################################################################

#
#123678901234567890123456789012345678901234567890123456789012345678901
#
DEBUT(CODE=_F(NOM='SDLS106B', NIV_PUB_WEB='INTERNET'),
      DEBUG=_F(SDVERI='OUI'))

#

PRE_IDEAS(UNITE_MAILLAGE=20,
          UNITE_IDEAS=19,
          );

PRE_IDEAS(UNITE_MAILLAGE=30,
          UNITE_IDEAS=29,
          );

MAILLA1=LIRE_MAILLAGE(UNITE=20,FORMAT='ASTER',)
MAILLA2=LIRE_MAILLAGE(UNITE=30,FORMAT='ASTER',)


MODELE1=AFFE_MODELE(MAILLAGE=MAILLA1,
                    AFFE=_F( GROUP_MA = 'CALCUL',
                             PHENOMENE = 'MECANIQUE',
                             MODELISATION = 'DKT'),);

MODELE2=AFFE_MODELE(MAILLAGE=MAILLA2,
                    AFFE=_F( GROUP_MA = 'CALCUL',
                             PHENOMENE = 'MECANIQUE',
                             MODELISATION = 'DKT'),);


#
MATER=DEFI_MATERIAU(  ELAS=_F( E = 2.1E11,  NU = 0.30,  RHO = 7800.0))

#
CHAMAT1=AFFE_MATERIAU(  MAILLAGE=MAILLA1,
                       AFFE=_F( GROUP_MA = 'CALCUL',
                                    MATER = MATER))
CHAMAT2=AFFE_MATERIAU(  MAILLAGE=MAILLA2,
                       AFFE=_F( GROUP_MA = 'CALCUL',
                                    MATER = MATER))
#
PARAM1=AFFE_CARA_ELEM(  MODELE=MODELE1,
                            COQUE=_F( EPAIS = 0.01,
                                   GROUP_MA = 'CALCUL'))
PARAM2=AFFE_CARA_ELEM(  MODELE=MODELE2,
                            COQUE=_F( EPAIS = 0.01,
                                   GROUP_MA = 'CALCUL'))
#


########################################################################
#
#        PLAQUE APPUYEE-APPUYEE DECOUPEE EN 2 PARTIES
#   SOUS-STRUCTURATION CLASSIQUE - INTERFACES TYPE CRAIG-BAMPTON
#
########################################################################
#
#
# SOUS-STRUCTURE 1 APPUYEE-ENCASTREE - INTERFACE TYPE CRAIG-BAMPTON
#
CHARGE_1=AFFE_CHAR_MECA(  MODELE=MODELE1,DDL_IMPO=(
               _F( GROUP_NO = 'BLOQUE', DX = 0.0, DY = 0.0, DZ = 0.0),
               _F( GROUP_NO = 'GAUCHE', DX = 0.0, DY = 0.0, DZ = 0.0,
                         DRX = 0.0, DRY = 0.0, DRZ = 0.0),
               _F( GROUP_NO = 'BAS', DX = 0.0, DY = 0.0, DZ = 0.0),
               _F( GROUP_NO = 'HAUT', DX = 0.0, DY = 0.0, DZ = 0.0)))

#
MERIME_1=CALC_MATR_ELEM(      MODELE=MODELE1,
                                CHARGE=CHARGE_1,
                            CHAM_MATER=CHAMAT1,
                             CARA_ELEM=PARAM1,
                               OPTION='RIGI_MECA')

#
MEMAME_1=CALC_MATR_ELEM(      MODELE=MODELE1,
                                CHARGE=CHARGE_1,
                            CHAM_MATER=CHAMAT1,
                             CARA_ELEM=PARAM1,
                               OPTION='MASS_MECA')

#
NUMDDL_1=NUME_DDL(  MATR_RIGI=MERIME_1)

#
RAID_1=ASSE_MATRICE(  MATR_ELEM=MERIME_1,
                           NUME_DDL=NUMDDL_1)

#
MASS_1=ASSE_MATRICE(  MATR_ELEM=MEMAME_1,
                           NUME_DDL=NUMDDL_1)

#
MODES_1=MODE_ITER_SIMULT(     MATR_RIGI=RAID_1,
                                 MATR_MASS=MASS_1,
                             CALC_FREQ=_F( OPTION = 'PLUS_PETITE',
                              NMAX_FREQ = 6))


#


# SOUS-STRUCTURE 2 ENCASTREE-APPUYEE - INTERFACE TYPE CRAIG-BAMPTON
#

CHARGE_2=AFFE_CHAR_MECA(  MODELE=MODELE2,DDL_IMPO=(
               _F( GROUP_NO = 'BLOQUE', DX = 0.0, DY = 0.0, DZ = 0.0,
                         DRX = 0.0, DRY = 0.0, DRZ = 0.0),
               _F( GROUP_NO = 'GAUCHE', DX = 0.0, DY = 0.0, DZ = 0.0),
               _F( GROUP_NO = 'BAS', DX = 0.0, DY = 0.0, DZ = 0.0),
               _F( GROUP_NO = 'HAUT', DX = 0.0, DY = 0.0, DZ = 0.0)))

#
MERIME_2=CALC_MATR_ELEM(      MODELE=MODELE2,
                                CHARGE=CHARGE_2,
                            CHAM_MATER=CHAMAT2,
                             CARA_ELEM=PARAM2,
                               OPTION='RIGI_MECA')
#
MEMAME_2=CALC_MATR_ELEM(      MODELE=MODELE2,
                                CHARGE=CHARGE_2,
                            CHAM_MATER=CHAMAT2,
                             CARA_ELEM=PARAM2,
                               OPTION='MASS_MECA')
#
NUMDDL_2=NUME_DDL(  MATR_RIGI=MERIME_2)

#
RAID_2=ASSE_MATRICE(  MATR_ELEM=MERIME_2,
                           NUME_DDL=NUMDDL_2)

#
MASS_2=ASSE_MATRICE(  MATR_ELEM=MEMAME_2,
                           NUME_DDL=NUMDDL_2)

#
MODES_2=MODE_ITER_SIMULT(     MATR_RIGI=RAID_2,
                                 MATR_MASS=MASS_2,
                             CALC_FREQ=_F( OPTION = 'PLUS_PETITE',
                              NMAX_FREQ = 6))

#
#  DEFINITION DES INTERFACES
#
LINT1_CL=DEFI_INTERF_DYNA(   NUME_DDL=NUMDDL_1,
                         INTERFACE=_F( NOM = 'GAUCHE',
                                        TYPE = 'CRAIGB',
                                        GROUP_NO = 'GAUCHE'))

#
LINT2_CL=DEFI_INTERF_DYNA(   NUME_DDL=NUMDDL_2,
                          INTERFACE=_F( NOM = 'BLOQUE',
                                        TYPE = 'CRAIGB',
                                        GROUP_NO = 'BLOQUE'))
#   CALCUL DES MODES DE COUPLAGE
MODESTA1=MODE_STATIQUE(MATR_RIGI=RAID_1,
                        MATR_MASS=MASS_1,
                        MODE_INTERF=_F(GROUP_NO = 'GAUCHE',
                                     TOUT_CMP='OUI',
                                     NBMOD=20,
                                     SHIFT=1.,),);

MODESTA2=MODE_STATIQUE(MATR_RIGI=RAID_2,
                        MATR_MASS=MASS_2,
                        MODE_INTERF=_F(GROUP_NO = 'BLOQUE',
                                     TOUT_CMP='OUI',
                                     NBMOD=20,
                                     SHIFT=1.,),);
#
#  CALCUL DE LA BASE MODALE DES SOUS-STRUCTURES
BAMO1_CL=DEFI_BASE_MODALE( RITZ=( _F( MODE_MECA = MODES_1),
                                  _F( MODE_INTF = MODESTA1,
                                      NMAX_MODE = 999)),
                           ORTHO='OUI',
                           MATRICE=MASS_1,
                           INTERF_DYNA=LINT1_CL,
                           NUME_REF=NUMDDL_1)

#
BAMO2_CL=DEFI_BASE_MODALE( RITZ=( _F( MODE_MECA = MODES_2),
                                  _F( MODE_INTF = MODESTA2,
                                      NMAX_MODE = 999)),
                           INTERF_DYNA=LINT2_CL,
                           NUME_REF=NUMDDL_2)
#
#  CALCUL DES MACRO-ELEMENTS
#

MACEL1=MACR_ELEM_DYNA( BASE_MODALE=BAMO1_CL,
                       MATR_MASS=MASS_1,
                       MATR_RIGI=RAID_1,)

#
MACEL2=MACR_ELEM_DYNA( BASE_MODALE=BAMO2_CL,
                       MATR_MASS=MASS_2,
                       MATR_RIGI=RAID_2)
#
#   CALCUL SUR MODELE GENERALISE
#
MODEGE=DEFI_MODELE_GENE(SOUS_STRUC=( _F( NOM = 'CARRE1',
                                         MACR_ELEM_DYNA = MACEL1,
                                         ANGL_NAUT = (0., 0., 0.,),
                                         TRANS=(0.,0.,0.),),
                                     _F( NOM = 'CARRE2',
                                         MACR_ELEM_DYNA = MACEL2,
                                         ANGL_NAUT=(-90.,0.,0.),
                                         TRANS=(0.,0.5,0.),),),
                             LIAISON=_F( SOUS_STRUC_1 = 'CARRE1',
                                      SOUS_STRUC_2 = 'CARRE2',
                                      INTERFACE_1 = 'GAUCHE',
                                      INTERFACE_2 = 'BLOQUE',
                                      OPTION='REDUIT',
                                      GROUP_MA_MAIT_1='CALCUL',
                                      ),
                               VERIF=_F( STOP_ERREUR = 'OUI',
                                      PRECISION = 1.E-6,
                                      CRITERE = 'RELATIF'))
#
#  NUMEROTATION DU PROBLEME GENERALISE AVEC ELIMINATION
#
NUMEGE=NUME_DDL_GENE(  MODELE_GENE=MODEGE,
                       METHODE='ELIMINE',
                       )
#
#  ASSEMBLAGE DES MATRICES RAIDEUR ET MASSE
#
MASGEN=ASSE_MATR_GENE(  NUME_DDL_GENE=NUMEGE,
                                  OPTION='MASS_GENE',);

#
RIGGEN=ASSE_MATR_GENE(  NUME_DDL_GENE=NUMEGE,
                                  OPTION='RIGI_GENE',);
#
#   CALCUL DES MODES PROPRES DE LA STRUCTURE GLOBALE
#
RESGEN=MODE_ITER_SIMULT( MATR_RIGI=RIGGEN,
                         MATR_MASS=MASGEN,
                         METHODE='SORENSEN',
                         CALC_FREQ=_F( OPTION = 'PLUS_PETITE',
                                       NMAX_FREQ=10,),
                         VERI_MODE=_F(PREC_SHIFT=5.0000000000000001E-3,
                                      STOP_ERREUR='NON',
                                      STURM='NON',
                                      SEUIL=9.9999999999999995E-01),
                         STOP_BANDE_VIDE='NON',
                        )

#
#   CREATION DU MAILLAGE SQUELETTE DE LA STRUCTURE GLOBALE
#

SQUEL=DEFI_SQUELETTE(  MODELE_GENE=MODEGE,SOUS_STRUC=(
                            _F( NOM = 'CARRE1',
                                GROUP_MA = 'CALCUL',
                              ),
                            _F( NOM = 'CARRE2',
                                GROUP_MA = 'CALCUL',
                                ))
                                )
#
#   RESTITUTION SUR MAILLAGE SQUELETTE
#
MODGLO=REST_SOUS_STRUC(RESU_GENE=RESGEN,
                       SQUELETTE=SQUEL,

                       TOUT_CHAM='OUI')

#
#  RESTITUTION SUR UNE SOUS STRUCTURE
#

MODGLSS=REST_SOUS_STRUC(   RESU_GENE=RESGEN,
                           SOUS_STRUC='CARRE2',
                           )

#
#  TEST DE CALC_CHAMP SUR UN RESULTAT RESTITUE
#

MODGLSS=CALC_CHAMP(RESULTAT=MODGLSS,reuse=MODGLSS,CONTRAINTE=('SIEF_ELGA'))



TEST_RESU(RESU=(_F(PARA='FREQ',
                   NUME_MODE=1,
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODGLO,
                   VALE_CALC=17.130729485,
                   VALE_REFE=17.120000000000001,
                   CRITERE='RELATIF',
                   TOLE_MACHINE=1.E-4,      #TODO variabilite
                   PRECISION=0.012500000000000001,),
                _F(PARA='FREQ',
                   NUME_MODE=2,
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODGLO,
                   VALE_CALC=35.949976144,
                   VALE_REFE=35.609999999999999,
                   CRITERE='RELATIF',
                   TOLE_MACHINE=1.E-4,      #TODO variabilite
                   PRECISION=0.012500000000000001,),
                _F(PARA='FREQ',
                   NUME_MODE=3,
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODGLO,
                   VALE_CALC=50.149926023,
                   VALE_REFE=49.990000000000002,
                   CRITERE='RELATIF',
                   TOLE_MACHINE=1.E-3,      #TODO variabilite
                   PRECISION=0.012500000000000001,),
                _F(PARA='FREQ',
                   NUME_MODE=4,
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODGLO,
                   VALE_CALC=66.556106995,
                   VALE_REFE=66.420000000000002,
                   CRITERE='RELATIF',
                   TOLE_MACHINE=1.E-4,      #TODO variabilite
                   PRECISION=0.012500000000000001,),
                _F(PARA='FREQ',
                   NUME_MODE=5,
                   REFERENCE='ANALYTIQUE',
                   RESULTAT=MODGLO,
                   VALE_CALC=68.900395429,
                   VALE_REFE=68.480000000000004,
                   CRITERE='RELATIF',
                   TOLE_MACHINE=1.E-4,      #TODO variabilite
                   PRECISION=0.012500000000000001,),
                ),
          )

FIN()
