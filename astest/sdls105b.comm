# ======================================================================
# COPYRIGHT (C) 1991 - 2017  EDF R&D                  WWW.CODE-ASTER.ORG
# THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
# IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
# THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
# (AT YOUR OPTION) ANY LATER VERSION.
#
# THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
# WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
# MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
# GENERAL PUBLIC LICENSE FOR MORE DETAILS.
#
# YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
# ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
#    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
# ======================================================================
#
#      CALCUL DES MODES PROPRES ET DE LA MASSE AJOUTEE
#        POUR UN DEPLACEMENT MODAL DE LA STRUCTURE
#     LA TURBULENCE EST HOMOGENE SUR TOUTE LA SURFACE IMMERGEE
#   ACCEPTANCE CALCULEE AVEC UNE FONCTION DE CORRELATION CORCOS
#
#
DEBUT( CODE=_F(NIV_PUB_WEB='INTERNET'),DEBUG=_F(SDVERI='OUI'),
      IGNORE_ALARM=('MODELE1_63','MODELE1_64'))

# <MODELE1_63> : DANS UN MODELE, IL EXISTE DES ELEMENTS DE TYPE "BORD" QUI N'ONT PAS DE VOISIN AVEC RIGIDITE
# <MODELE1_64> : DANS UN MODELE, IL N'Y A AUCUN ELEMENT AVEC AVEC RIGIDITE
#  LE MODELE PROVOQUANT CES ALARMES EST UN MODELE D'INTERFACE

PRE_IDEAS( )

MAYA=LIRE_MAILLAGE(FORMAT="ASTER",  )

#

MAYA=DEFI_GROUP(reuse=MAYA,   MAILLAGE=MAYA,
                      CREA_GROUP_NO=_F( GROUP_MA = 'PLANCHE')  )

#CARACTERISTIQUES FLUIDES ET SOLIDES


EAU=DEFI_MATERIAU( THER=_F( LAMBDA = 1., RHO_CP = 30000.))

ACIER=DEFI_MATERIAU( ELAS=_F( RHO = 2.34E5,  NU = 0.3, E = 2.E11))

CHAMMAT1=AFFE_MATERIAU(  MAILLAGE=MAYA,AFFE=(
                       _F( GROUP_MA = 'FLUIDE', MATER = EAU),
                       _F( GROUP_MA = 'INTERFAC', MATER = EAU))
                            )

CHAMMAT2=AFFE_MATERIAU(  MAILLAGE=MAYA,
                       AFFE=_F( GROUP_MA = 'PLANCHE', MATER = ACIER)

                            )

#

FLUIDE=AFFE_MODELE( MAILLAGE=MAYA,AFFE=(
                     _F( GROUP_MA = 'FLUIDE',
                MODELISATION = '3D',  PHENOMENE = 'THERMIQUE'),
                     _F( GROUP_MA = 'INTERFAC',
                MODELISATION = '3D',  PHENOMENE = 'THERMIQUE'))

                          )

INTERF=AFFE_MODELE( MAILLAGE=MAYA,
                     AFFE=_F( GROUP_MA = 'INTERFAC',
                MODELISATION = '3D',  PHENOMENE = 'THERMIQUE')
                          )

STRUCT=AFFE_MODELE( MAILLAGE=MAYA,

                     AFFE=_F( GROUP_MA = 'PLANCHE',
                MODELISATION = 'DKT',  PHENOMENE = 'MECANIQUE')

                              )

#

CHARGE=AFFE_CHAR_THER( MODELE=FLUIDE,
                           TEMP_IMPO=_F( GROUP_NO = 'PRESSNUL', TEMP = 0.) )

#

CARA=AFFE_CARA_ELEM(  MODELE=STRUCT,
                        COQUE=_F( GROUP_MA = 'PLANCHE', EPAIS = 5.E-1) )

#

CHARGS=AFFE_CHAR_MECA( MODELE=STRUCT,DDL_IMPO=(
                          _F(  GROUP_NO = 'PLANCHE',
                                     DRY = 0.),
                          _F(  GROUP_NO = 'CLIM',
                                     DX = 0., DY = 0., DZ = 0.))
                         )

MASSE=POST_ELEM(  MODELE=STRUCT,
                      CHAM_MATER=CHAMMAT2,
                       CARA_ELEM=CARA,
                       MASS_INER=_F( GROUP_MA = 'PLANCHE'),
                         TITRE='MASSE DE LA PLANCHE')

MEL_KSTR=CALC_MATR_ELEM( MODELE=STRUCT,
                               CARA_ELEM=CARA,
            CHAM_MATER=CHAMMAT2,  OPTION='RIGI_MECA',
                               CHARGE=(CHARGS, )
                               )

MEL_MSTR=CALC_MATR_ELEM( MODELE=STRUCT,
                               CARA_ELEM=CARA,
            CHAM_MATER=CHAMMAT2,  OPTION='MASS_MECA',
                              CHARGE=(CHARGS, )
                              )

NUSTR=NUME_DDL(MATR_RIGI=MEL_KSTR)

MATASKS=ASSE_MATRICE( MATR_ELEM=MEL_KSTR,  NUME_DDL=NUSTR)

MATASMS=ASSE_MATRICE( MATR_ELEM=MEL_MSTR,  NUME_DDL=NUSTR)

#

# MODE EN AIR DE LA PLAQUE


MODES=CALC_MODES(MATR_RIGI=MATASKS,
                 OPTION='BANDE',
                 CALC_FREQ=_F(FREQ=(0.01,0.1,),
                              ),
                 MATR_MASS=MATASMS,
                 )


#CALCUL DES CARACTERISTIQUES MODALES EN EAU
# AVEC MASSE AJOUTEE SIMPLEMENT


NUMGEN=NUME_DDL_GENE(   BASE=MODES,
                             STOCKAGE='PLEIN'   )

MATRAJ=CALC_MATR_AJOU( MODELE_FLUIDE=FLUIDE,
                         MODELE_INTERFACE=INTERF,
                        OPTION='MASS_AJOU',
                         NUME_DDL_GENE=NUMGEN,
                        CHARGE=CHARGE,
                        CHAM_MATER=CHAMMAT1,
                        MODE_MECA=MODES
                      )

MGENE=PROJ_MATR_BASE(  BASE=MODES,
                            NUME_DDL_GENE=NUMGEN,
                            MATR_ASSE=MATASMS    )

RIGGEN=PROJ_MATR_BASE( BASE=MODES,
                            NUME_DDL_GENE=NUMGEN,
                            MATR_ASSE=MATASKS    )

MASTOT=COMB_MATR_ASSE( COMB_R=(  _F( MATR_ASSE = MGENE,
                                     COEF_R = 1.),
                                     _F( MATR_ASSE = MATRAJ,
                                      COEF_R = 1.)))

MODHUMI=CALC_MODES(MATR_RIGI=RIGGEN,
                   OPTION='BANDE',
                   CALC_FREQ=_F(FREQ=(0.01,0.1,),
                                ),
                   MATR_MASS=MASTOT,
                   )


#RESTIT DES MODES EN EAU = F(MODE_EN_AIR) SUR BASE PHYSIQUE

MODEAU=REST_GENE_PHYS(RESU_GENE=MODHUMI,
                      MODE_MECA=MODES,
                      NOM_CHAM='DEPL')

#
# DEFINITION D'UN SPECTRE DE TURBULENCE DE COUCHE LIMITE
# A 4 M /S

SPECTRE=DEFI_SPEC_TURB(
                   SPEC_CORR_CONV_1=_F(  LONG_COR_1 = 1.,
                                      LONG_COR_2 = 2.,
                                      VITE_FLUI = 4.,
                                      FREQ_COUP = 30.,
                                      RHO_FLUI = 1000.,
                                      D_FLUI = 1.5,
                                      METHODE = 'CORCOS')
                            )

# PROJECTION DE CE SPECTRE SUR LA BASE MODALE EN
# EAU DE LA PLANCHE ET CALCUL DE LA FONCTION ACCEPTANCE


SPPROJ=PROJ_SPEC_BASE( SPEC_TURB=SPECTRE,
                       MODE_MECA=MODEAU,
                       MODELE_INTERFACE=INTERF,
                       VECT_X=(0., 1., 0.,),
                       VECT_Y=(0., 0., 1.,),
                       FREQ_INIT=1.59154E-8,
                       FREQ_FIN=6.36619E-1,
                       TOUT='OUI',
                       NB_POIN=256
                           )

#EXTRACTION DE L AUTOSPECTRE D EFFORT MODAL TURBULENT

AUTOSPEC=RECU_FONCTION(     INTE_SPEC=SPPROJ,
                            NUME_ORDRE_I=1
                         )

#VALEURS DE REFERENCE DE LA DSP D EFFORT TURBULENT MODALE
# CALCULEES AVEC MAPLE

I1=7.28848E8,

I2=7.53237E6,

IALPHA1=.22212E8,

IALPHA2=.15083E7,

TEST_FONCTION(VALEUR=(_F(VALE_CALC=727432735.934,
                         VALE_REFE=7.28848000E8,
                         VALE_PARA=1.59155E-3,
                         REFERENCE='NON_DEFINI',
                         PRECISION=2.E-3,
                         FONCTION=AUTOSPEC,
                         ),
                      _F(VALE_CALC=7591579.84052,
                         VALE_REFE=7.532370E6,
                         VALE_PARA=0.15915499999999999,
                         REFERENCE='NON_DEFINI',
                         PRECISION=8.0999999999999996E-3,
                         FONCTION=AUTOSPEC,
                         ),
                      _F(VALE_CALC=22263406.3099,
                         VALE_REFE=2.2212000E7,
                         VALE_PARA=0.082750000000000004,
                         REFERENCE='NON_DEFINI',
                         PRECISION=2.5000000000000001E-3,
                         FONCTION=AUTOSPEC,
                         ),
                      _F(VALE_CALC=1601385.85954,
                         VALE_REFE=1.508300E6,
                         VALE_PARA=0.45325700000000002,
                         REFERENCE='NON_DEFINI',
                         PRECISION=0.065000000000000002,
                         FONCTION=AUTOSPEC,
                         ),
                      ),
              )

# REPONSE SPECTRALE DU SYSTEME A L EXCITATION TURBULENTE


DYNALEA1=DYNA_ALEA_MODAL(BASE_MODALE=_F( MODE_MECA = MODEAU,
                                        NUME_ORDRE = 1,
                                        AMOR_REDUIT = 0.01),
                          EXCIT=_F(  MODAL = 'OUI',
                                  GRANDEUR = 'EFFO',
                                  INTE_SPEC = SPPROJ,
                                  NUME_ORDRE_I = 1,
                                  NUME_ORDRE_J = 1),
                          REPONSE=_F()  )

REPINTSP=REST_SPEC_PHYS(         MODE_MECA=MODEAU,
                                    NUME_ORDRE=1,
                                INTE_SPEC_GENE=DYNALEA1,
                                      NOM_CHAM='DEPL',
                                          NOEUD='N2',
                                       NOM_CMP='DX',
                                        OPTION='TOUT_TOUT'  )

REPONSE=RECU_FONCTION(    INTE_SPEC=REPINTSP,
                          NOEUD_I = 'N2',
                          NOM_CMP_I='DX',
                      )



I3=1.1777E-3,

I4=.6091E-5,

I5=1.0985E-5,

TEST_FONCTION(VALEUR=(_F(VALE_CALC=0.00118018019165,
                         VALE_REFE=1.1777E-3,
                         VALE_PARA=0.08275,
                         REFERENCE='NON_DEFINI',
                         PRECISION=2.5E-3,
                         FONCTION=REPONSE,
                         ),
                      _F(VALE_CALC=6.092552E-06,
                         VALE_PARA=0.05,
                         FONCTION=REPONSE,
                         ),
                      _F(VALE_CALC=1.097994E-05,
                         VALE_PARA=0.025,
                         FONCTION=REPONSE,
                         ),
                      ),
              )

FIN( )
#
