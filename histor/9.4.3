

-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR desoza       DE SOZA Thomas         DATE 12/01/2009 - 17:10:11

--------------------------------------------------------------------------------
RESTITUTION FICHE 012998 DU 2008-12-19 12:06:13
TYPE aide utilisation concernant Code_Aster (VERSION 9.4)
TITRE
   Contact methode continue + hexa27 : erreur point intxc3xa9gration (dvlp)
FONCTIONNALITE
   AOM
   ===
   
   Une étude existante de robinet qui passe avec une méthode de contact discrète (éléments
   quadratiques HEXA27) ne passe pas avec la méthode 'CONTINUE'.
   
   Analyse
   =======
   
   1/ Les HEXA27 (faces en contact QUAD9) ne sont pas supportées par la méthode 'CONTINUE'
   pour l'instant. Le besoin de complétude des types d'éléments supportés est déjà tracé dans
   la fiche 11803.
   Pour pallier ce manque on peut utiliser des HEXA20 (rappel : les HEXA27 sont conseillés
   avec du contact).
   
   2/ Les HEXA20 conduisent à une matrice singulière (pivot presque nul) et ce après avoir
   déjà fait une itération.
   
   Ceci fait donc penser à un problème avec les relations de contact imposées et qui sont
   liées à l'appariement. Un coup d'oeil au maillage montre que les surfaces de contact
   esclaves et maîtres se chevauchent : aucune n'est plus grande que l'autre.
   La partie supérieure de la bague (au niveau de l'épaulement) est plus raffinée, c'est la
   surface esclave. Elle dépasse de son vis-à-vis maître qui est maillé grossièrement. Il y a
   donc des chances pour que plusieurs noeuds esclaves soient appariés à la même maille
   maître. Les relations de contact ont des chances d'être incompatibles.
   
   ==> c'est pourquoi on conseille d'utiliser le paramètre TOLE_PROJ_EXT pour exclure
   certains noeuds du contact. Ici TOLE_PROJ_EXT=0.001 permet de passer le calcul.
   
   3/ Un post-traitement du calcul montre une surface de contact cohérente mais on s'aperçoit
   que les noeuds sommets ne participent pas au contact dans la zone. Il semblerait que le
   fait que le maillage soit compatible dans la circonférence pose problème. Je conseille
   donc d'essayer de tourner la tige de 10° sur son axe et de réessayer.
   
   4/ Une autre interrogation est liée à la transformation LINE_QUAD. Cette transformation ne
   produit pas de vrais maillages quadratiques (des noeuds milieux sont simplement ajoutés au
   milieu des arêtes) or c'est ce dont on a vraiment besoin pour modéliser un contact aussi
   difficile (contact cylindre-cylindre). S'il est possible de produire un vrai maillage
   quadratique, il faudrait essayer avec.
   
   Conclusion
   ==========
   
   Je joins une archive contenant les fichiers modifiés.
   
   * j'ai modifié la phase de conversion en quadratique car au début j'avais peur d'un truc
   avec les surfaces s'appuyant sur la tige. Dans mon fichier : tout est quadratique (volumes
   et surfaces) sauf la boite.
   * j'ai réorienté toutes les surfaces
   * j'ai affecté le modèle entité par entité
   * il manquait le CARA_ELEM dans le LIAISON_ELEM (mais ça marchait)
   * j'ai mis TOLE_PROJ_EXT=0.001
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   xc3xa9tude
NB_JOURS_TRAV  : 1.0
--------------------------------------------------------------------------------
RESTITUTION FICHE 013039 DU 2009-01-08 17:16:36
TYPE express concernant Code_Aster (VERSION 7.0)
TITRE
   MN10 - CONTACT - Bug dans routine d'impression du contact
FONCTIONNALITE
   Express
   =======
   
   INFO=2 dans STAT_NON_LINE affiche parfois du binaire avec du CONTACT au moment de
   l'appariement.
   
   Correction
   ==========
   
   Bug dans CFIMP4. On accède au tableau PDDLCO avec le mauvais pointeur (maille au lieu de
   noeud).
   
   Validation
   ==========
   
   Perso sur zzzz231b
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   zzzz231b
NB_JOURS_TRAV  : 0.2
--------------------------------------------------------------------------------



-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR pellet       PELLET Jacques         DATE 12/01/2009 - 13:23:51

--------------------------------------------------------------------------------
RESTITUTION FICHE 010844 DU 2007-05-09 16:35:13
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   STAT_NON_LINE/OPTI_LIST_INST xc3xa0 rxc3xa9xc3xa9crire ?
FONCTIONNALITE
   Problème:
   ---------
   La fonctionnalité OPTI_LIST_INST des commandes XXXX_NON_LINE a été "cassée" suite à
   l'introduction des nouvelles variables de commande (Mai 2007 en NEW9).
                                                                                            
                           
   Il a été décidé de la résorber en attendant qu'un nouveau besoin se fasse connaitre.
                                                                                            
                           
   Correction:
   -----------
   Comme j'ai oublié de m'occuper de cette fiche pendant un an, Mickael a fait le travail à
   ma place en 9.3.22.
                                                                                            
                           
   Je l'en remercie et je ne restitue rien. 
   
   Impact documentaire :
   ----------------------
   Supprimer toute référence à OPTI_LIST_INST dans les documents: U4.01.02  U4.51.03 
   U4.53.01  U4.53.03  U4.cb.20  V7.22.125
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : U4.01.02  U4.51.03  U4.53.01  U4.53.03  U4.cb.20  V7.22.125
VALIDATION
   rien de particulier
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------
RESTITUTION FICHE 011137 DU 2007-07-24 15:33:01
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   Enrichir COPISD pour manipuler des 'MATR_ELEM_DEPL_R' et des 'VECT_ELEM_DEPL_R'
FONCTIONNALITE
   Problème:
   ---------
   Nicolas Tardieu souhaitait pouvoir dupliquer un sd_vect_elem (ou sd_matr_elem) de façon
   plus économique que pas un "CALL JEDUPC".
                                                                                            
                
   Solution:
   ---------
   L'évolution souhaitée de la routine copisd.f a eu lieu à l'occasion de la fiche 11191 :
   "sd produites par les commandes CALCUL et EXTR_TABLE incorrectes (SDVERI)".
                                                                                            
                
   Cette fiche peut donc etre fermée.
                                                                                            
                
   Néanmoins, cette fiche me donne l'occasion d'enrichir la réflexion concernant les SD
   partagées (fiche 11259)
                                                                                            
                
   Etat des lieux au 4/12/2008 :
   -----------------------------
                                                                                            
                
   Il y a (au moins) 4 SD "container" qui pourraient "partager" des contenus :
     - sd_resultat (objet .TACH)
     - sd_vect_elem/sd_matr_elem (objet .RELR)
     - sd_table_container
     - sd_table_fonction
                                                                                            
                
   Oublions les table_fonction. On peut établir le tableau suivant :
                                                                                            
                
                     |          |               | utilise  |  utilise    |
     type_sd         | DETRSD   |  COPISD       | DETRSD   |  COPISD     |
   -----------------------------------------------------------------------
   resultat          |léger     | profond       | aucun    |  regres.f   |
   vect_elem         |profond   | léger         | beaucoup |  op0173.f   |
   table_container   |profond   | non programmé | op0026.f |  aucun      |
                                                                                            
                
   On constate que la question "Faut-il faire une copie "profonde" ou "légère" (idem pour la
   destruction) ?" n'est pas encore tranchée et que les réponses actuelles sont incohérentes :
      * Rien n'est programmé concernant la copie des table_container
      * La destruction des resultat est "légère" alors que sa copie est "profonde"
      * pour les vect_elem, c'est l'inverse : la copie est légère et la destruction profonde !
                                                                                            
                
   J'ai essayé de mettre un peu d'uniformité là-dedans en essayant de programmer la copie
   "profonde" des vect_elem mais je n'y suis pas arrivé :
   Quel nom donner aux nouveaux resuelem contenus dans SD2.RELR ?
   On est maintenant coincé par le fait que le nom d'un vect_elem est un K19 comme celui d'un
   resuelem. On ne peut donc pas créer des resuelem de nom vect_elem//'.00i'. Pour cela, il
   aurait fallu limiter les nom des vect_elem à K14.
                                                                                            
                
                                                                                            
                
   Commande DETRUIRE :
   -------------------
   Actuellement, la commande DETRUIRE n'utilise pas DETRSD. Elle fait "CALL JEDETC".
   C'est pourquoi on a longtemps essayé de respecter la règle :
   Une commande RESU1=XXXXX() doit produire des objets jeveux dont le nom commence par "RESU1".
   Lorsqu'une commande ne respecte pas cette règle, l'utilisateur ne peut pas détruire
   complètement le concept qu'elle a créé.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   rien de particulier
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------
RESTITUTION FICHE 012574 DU 2008-10-01 13:34:47
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   message pas clair quand on oublie d'affecter le matxc3xa9riau sur une maille
FONCTIONNALITE
   Problème:
   ---------
   Quand on oublie d'affecter un matériau sur un élément qui en a besoin, on est arreté en
   général par le message pas super-facile à comprendre :
                                                                                            
                      
                                                                                            
                      
    ERREUR JEVECH ZL :PMATERC  F
                                                                                            
                      
   !----------------------------------------------------------------------------------------!
   !.<E>.<CALCULEL2_73>.....................................................................!
   !........................................................................................!
   !..on.n'a.pas.pu.extraire.toutes.les.cmps.voulues.du.champ.associé.au.paramètre:.PMATERC.!
   !..-.option:.RIGI_THER...................................................................!
   !..-.type_element:.THPLQU8.).............................................................!
   !........................................................................................!
   !.Cette.erreur.sera.suivie.d'une.erreur.fatale...........................................!
   !----------------------------------------------------------------------------------------!
                                                                                            
                      
    MAILLE: M1
    1ERE COMPOSANTE ABSENTE: A FAIRE ???
                                                                                            
                      
    MAILLE : M1
                                                                                            
                      
    ELEMENTS DE CONTEXTE :
                                                                                            
                      
     - OPTION DE CALCUL ELEMENTAIRE: RIGI_THER
       PAS DE COMMENTAIRES !
                                                                                            
                      
     - PARAMETRE "IN" : PMATERC
       PAS DE COMMENTAIRES !
                                                                                            
                      
     - GRANDEUR : ADRSJEVE
       <<  ADRSJEVE : I1 : ADRESSE JEVEUX (DANS ZI) D UN MATERIAU CODE  >>
                                                                                            
                      
                                                                                            
                      
   Correction :
   ------------
   On particularise le message pour le paramètre 'PMATERC' :
   !-----------------------------------------------------------------------------------------------!
   !.<F>.<CALCULEL2_74>............................................................................!
   !...............................................................................................!
   !.Erreur.utilisateur.dans.un.calcul.élémentaire.:...............................................!
   !...Le.matériau.est.nécessaire.sur.la.maille.:.M1...............................................!
   !...-.option.de.calcul.élémentaire.:.RIGI_THER..................................................!
   !...-.type_element.................:.THPLQU8....................................................!
   !...............................................................................................!
   !.Conseils.:....................................................................................!
   !...*.Peut-etre.avez-vous.oublié.de.renseigner.le.mot.clé.CHAM_MATER.dans.la.commande.courante..!
   !...*.Dans.la.commande.AFFE_MATERIAU,.avez-vous.affecté.un.matériau.sur.la.maille.incriminée.?..!
   !...............................................................................................!
   !.Cette.erreur.est.fatale..Le.code.s'arrete.....................................................!
   !-----------------------------------------------------------------------------------------------!
                                                                                            
                      
                                                                                            
                      
   Remarques :
   -----------
   1) Dans la demande initiale, pour pouvoir émettre un message d'erreur pertinent dès la
   commande AFFE_MATERIAU, j'avais proposé d'ajouter un attribut BESOIN_MATER='OUI' dans le
   catalogue des éléments qui en ont besoin.
                                                                                            
                      
   A la réflexion, ce n'est pas une bonne idée car le besoin de matériau n'est pas facile à
   prévoir. Par exemple :
     * un élément discret aura besoin de matériau pou un calcul non-linéaire mais pas pour un
   calcul linéaire.
     * un élément de bord n'a pas besoin en général de matériau mais pour le calcul de "G",
   il le faut.
                                                                                            
                      
   2) Je particularise également le message CALCULEL2_73 pour les 3 cas particuliers :
     * paramètre PCACOQU des éléments de coque    (CALCULEL2_75)
     * paramètre PCAGNPO des éléments de poutre   (CALCULEL2_76)
     * paramètre PCAORIE pour les repères locaux  (CALCULEL2_77)
                                                                                            
                      
    
    
   Liste des fichiers impactés par la correction de la fiche:  12574
     jevech.f
     calculel2.py
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.25
--------------------------------------------------------------------------------
RESTITUTION FICHE 012718 DU 2008-10-24 09:58:46
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   MACR_ECLA_PG : xc3xa9tendre la liste des champs
FONCTIONNALITE
   Problème:
   ---------
   Patrick Le Delliou se plaint du fait que la fontionnalité MACR_ECLA_PG n'est accessible
   que pour quelques champs.
   Peut-on la rendre plus générale ?
                                                                                            
                           
                                                                                            
                           
   Réponse
   -------
   1) Il est toujours possible de visualiser les champs aux points de Gauss avec Salomé
   (petites boules).
                                                                                            
                           
   2) L'évolution demandée a déjà été réalisée en 9.0.2 (fiche 10221). La doc U (NEW9) est à
   jour.
                                                                                            
                           
   3) J'ai fait des essais pour vérifier que l'on peut "éclater" des champs autres de SIEF_ELGA :
       - SOUR_ELGA_ELEC
       - EQUI_ELGA_SIGM
       - EQUI_ELGA_EPME
      La fonctionnalité n'est pas bridée.
    
   4) Je corrige 2 bugs découverts lors de mes essais:
     4.1 : on ne peut pas éclater 2 NOM_CHAM dans le meme appel à MACR_ECLA_PG (bug dans
   eclpgm.f)
     4.2 : on émet une nouvelle alarme (CALCULEL2_14) lorsque pour 1 NOM_CHAM, on ne réussit
   à éclater aucun numéro d'ordre (c'est ce qui se passe si on fait une faute de frappe dans
   NOM_CHAM).
                                                                                            
                           
   Impact_documentaire :  U4.44.14
   --------------------------------
   Une erreur au paragraphe 4.1 (Exemple) : MODELE_INIT (et non MODELE).
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : U4.44.14
VALIDATION
   essais perso
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------
RESTITUTION FICHE 012721 DU 2008-10-24 13:23:11
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   IMPR_RESU format MED RESTREINT pour plusieurs resultats
FONCTIONNALITE
   Suite à une question embarassante de F. Curtit (par mail), je fais une nouvelle
   proposition ci-dessous. Si F. Curtit veut la tester, les fichiers sources sont déposés
   dans le fichier tout.tar.gz. En particulier, le fichier TEST/zzzz240a.comm donne un exemple.
   
   
   Demande d'évolution :
   -----------------------
   La commande IMPR_RESU au format MED avec l'option RESTREINT n'autorise pas l'écriture de
   plusieurs résultats.
                                                                                            
                           
   Cette fonctionalité serait intéressante par exemple dans le cas de calculs
   thermo-mécaniques où
   les champs de température participent au chargement (et souvent également au comportement)
   et pour
   lesquels on souhaiterait disposer de l'ensemble des champs (mécaniques et thermiques).
                                                                                            
                           
                                                                                            
                           
   Proposition d'évolution:
   ------------------------
   On propose de modifier la syntaxe pour pouvoir écrire :
                                                                                            
                           
   IMPR_RESU(FORMAT='MED', UNITE=80,
           RESTREINT=_F(GROUP_MA=('CARRE1','G1'), MAILLE=('M1','M16')),
           RESU=(
             _F(RESULTAT=TEMP1, NOM_CHAM=('TEMP','FLUX_ELGA_TEMP'),  NUME_ORDRE=(0,3)),
             _F(RESULTAT=U1,                                         NUME_ORDRE=(1,2),),
           ))
                                                                                            
                           
   C'est à dire :
     - On utilise le mot clé facteur RESTREINT (une seule fois) pour indiquer les mailles sur
   lesquelles il faut "restreindre"
     - On utilise le mot clé facteur RESU/RESULTAT pour indiquer les sd_resultat à "restreindre".
       * Pour chaque occurence de RESU, le mot clé RESULTAT est obligatoire.
       * Pour chaque occurence de RESU, on peut utiliser NOM_CHAM et INST/NUME_ORDRE/... pour
   limiter ce que l'on veut imprimer.
                                                                                            
                           
   Limitations :
     - on n'accepte d'imprimer que des sd_resultat (9 au plus) qui s'appuient sur un meme
   maillage
     - on se limite au format MED
     - on ne traite pas la sensibilité.
                                                                                            
                           
   Validation:
   -----------
   Modification du test zzzz240a pour tester la possibilité de post-traiter un calcul
   thermo-mécanique sur un sous-ensemble des mailles.
                                                                                            
                           
   Impact documentaire :
   ---------------------
   U4.05.21 : IMPR_RESU / MED :
     - Si RESTREINT       => format MED
                          => le mot clé MODELE est interdit
                          => RESU/RESULTAT obligatoire et que tous les RESULTAT doivent
   s'appuyer sur le meme maillage
                          => on imprime :
                             - le maillage réduit  (nommé "&&OP0039")
                             - les différentes sd_resultat réduites (nommées "&RESUR1",
   "&RESUR2", ..., "&RESUR9")
    
    
   Liste des fichiers impactés par la correction de la fiche:  12721
     exlima.f  gnoms2.f  op0039.f  rdtres.f
     calculel4.py
     impr_resu.capy
     zzzz240a.comm
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : U4.05.21
VALIDATION
   zzzz240a
NB_JOURS_TRAV  : 3.0
--------------------------------------------------------------------------------
RESTITUTION FICHE 012734 DU 2008-10-27 15:47:38
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   Pb en NEW9 sur les calculs avec contact sur un modele avec des elements discrets
FONCTIONNALITE
   Problème:
   ----------
   Si on crée un modèle avec des éléments discrets "nodaux" affectés directement sur des
   noeuds (et non pas sur des mailles POI1)
                                                                                            
                    
   MO=AFFE_MODELE(MAILLAGE=MA, AFFE=(
                  _F(NOEUD='N1', PHENOMENE='MECANIQUE',MODELISATION='DIS_TR',),
                  ));
                                                                                            
                    
   Et si on essaye de se servir de ce modèle dans STAT_NON_LINE (ou DYNA_NON_LINE), on est
   arreté par un message pas forcément très clair :
                                                                                            
                    
   !----------------------------------------------------------------------------------------!
   !.<E>.<CALCULEL2_73>.....................................................................!
   !........................................................................................!
   !..on.n'a.pas.pu.extraire.toutes.les.cmps.voulues.du.champ.associé.au.paramètre:.PCOMPOR.!
   !..-.option:.FULL_MECA...................................................................!
   !..-.type_element:.MECA_DIS_TR_N.).......................................................!
   !........................................................................................!
   !.Cette.erreur.sera.suivie.d'une.erreur.fatale...........................................!
   !----------------------------------------------------------------------------------------!
                                                                                            
                    
                                                                                            
                    
   Solution:
   ---------
   Il est en effet interdit d'utiliser de tels modèles (AFFE_MODELE/NOEUD=...) dans les
   commandes non-linéaires. Ceci est expliqué dans la documentation.
   L'utilisateur doit créer au préalable dans son maillage les mailles POI1 nécessaires.
                                                                                            
                    
   On ajoute une petite vérification dans la routine nmdome.f.
   Le message d'erreur est maintenant plus clair :
                                                                                            
                    
   !---------------------------------------------------------------------------!
   !.<F>.<CALCULEL3_51>........................................................!
   !...........................................................................!
   !...Erreur.Utilisateur.:....................................................!
   !.....On.essaie.d'utiliser.dans.la.commande.STAT_NON_LINE...................!
   !.....un.modèle.pour.lequel.des.éléments.finis.ont.été.affectés.directement.!
   !.....sur.des.noeuds.(AFFE_MODELE./.AFFE./.GROUP_NO)........................!
   !.....Ceci.est.interdit.....................................................!
   !...........................................................................!
   !...Conseils.:..............................................................!
   !.....Il.faut.définir.le.modèle.avec.les.mots.clé.GROUP_MA.et.MAILLE........!
   !.....Pour.cela,.il.faut.créer.dans.le.maillage.des.mailles.de.type.POI1....!
   !.....C'est.possible.avec.la.commande.CREA_MAILLAGE./.CREA_POI1.............!
   !...........................................................................!
   !.Cette.erreur.est.fatale..Le.code.s'arrete.................................!
   !---------------------------------------------------------------------------!
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.2
--------------------------------------------------------------------------------
RESTITUTION FICHE 012743 DU 2008-10-29 09:32:34
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   Performance de AFFE_CHAR_THER
FONCTIONNALITE
   Problème:
   ---------
   Pour appliquer le principe de surcharge entre les différentes occurences des mots clés
   DDL_IMPO (ou FACE_IMPO) des commandes AFFE_CHAR_XXX, il faut détecter les éventuels
   doublons des relations linéaires engendrées par ces mots clés.
                                                                                            
                           
   Pour cela, la routine ordlrl.f ordonne les termes de chaque relation linéaire, puis
   compare ces relations 2 à 2. Ce qui conduit à un algorithme en nbrela**2.
                                                                                            
                           
   Dans l'étude fournie, le nombre de relations est très important (plusieurs centaines de
   milliers), ce qui conduit à un temps de détection des doublons énorme : 8000s
                                                                                            
                           
                                                                                            
                           
   Correction:
   -----------
   Dans la routine ordlrl.f on distingue maintenant 2 cas de figure :
     1) Les relations linéaires ayant plusieurs termes :
        On fait comme avant.
     2) Les relations linéaires ayant 1 seul terme que l'on peut identifier par le couple
   (NOEUD,DDL) :
        Dans ce cas (ultra-majoritaire en général), il est beaucoup plus facile de détecter
   les doublons.
        On n'est pas obligé de faire une boucle en nbrela**2.
                                                                                            
                           
   Validation:
   -----------
   Pour l'étude fournie, le gain CPU est très important :
      avant : 8000s
      après :   95s
                                                                                            
                           
   Encore une illustration de la "HPC attitude" qui nous anime tous ! (joke)
                                                                                            
                           
                                                                                            
                           
   Remarque :
   ----------
   Pour ce genre de calcul avec énormément de ddls imposés, il est beaucoup plus efficace
   d'utiliser AFFE_CHAR_CINE.
   
   Temps passé :
   -------------
   Josselin : 0.3 pour identifier le problème ordlrl.f (profiling)
   Jacques  : 0.4 pour modifier ordlrl.f
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   xc3xa9tude fournie
NB_JOURS_TRAV  : 0.7
--------------------------------------------------------------------------------
RESTITUTION FICHE 012804 DU 2008-11-13 08:17:00
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   Message de RCVARC
FONCTIONNALITE
   Problème:
   ---------
   Jean-Luc Fléjou fait semblant de ne pas savoir ce que sont les variables de commande.
   Il souhaite qu'on lui explique le message suivant :
                                                                                            
                           
   !-----------------------------------------------------------------------!
   !.<F>.<CALCULEL4_69>....................................................!
   !.......................................................................!
   .On.ne.trouve.pas.la.variable.de.commande.:..TEMP..pour.la.maille:..M1..!
   !-----------------------------------------------------------------------!
                                                                                            
                           
                                                                                            
                           
   Solution:
   ---------
   J'améliore le message comme le souhaite Jean-Luc :
                                                                                            
                           
   !----------------------------------------------------------------------------------------------------!
   !.<F>.<CALCULEL4_69>.................................................................................!
   !....................................................................................................!
   !..Erreur.utilisateur.:..............................................................................!
   !.....On.ne.trouve.pas.la.variable.de.commande.:..TEMP...............................................!
   !.....pour.la.maille................:.M1.............................................................!
   !.....pour.l'instant.de.calcul......:.'+'............................................................!
   !.....valeur.de.l'instant.de.calcul.:.0.8..(sans.signification.pour.l'instant.'REF').................!
   !....................................................................................................!
   !..Conseils.:........................................................................................!
   !.....Les.variables.de.commande.sont.des.variables.connues.a.priori.qui.influencent..................!
   !.....le.calcul.du.comportement.mécanique.(exemple.:.la.température).................................!
   !....................................................................................................!
   !.....Lorsque.le.comportement.mécanique.dépend.d'une.variable.de.commande,.il.faut.que.l'utilisateur.!
   !.....la.fournisse.au.calcul.mécanique...............................................................!
   !.....Cela.se.fait.via.la.commande.AFFE_MATERIAU./.AFFE_VARC.........................................!
   !....................................................................................................!
   !.....Les.variables.de.commande.les.plus.utilisées.sont.:............................................!
   !.......'TEMP'..:.la.température.....................................................................!
   !.......'HYDR'..:.l'hydratation......................................................................!
   !.......'SECH'..:.le.séchage.........................................................................!
   !.......'CORR'..:.la.corrosion.......................................................................!
   !.......'IRRA'..:.l'irradiation......................................................................!
   !....................................................................................................!
   !.....Attention.au.fait.que.les.variables.de.commandes.doivent.pouvoir.etre.calculées.pour.TOUS......!
   !.....les.instants.du.calcul..Pour.cela,.si.on.utilise.une.structure.de.données.evol_xxx.pour........!
   !.....renseigner.une.variable.de.commande.(AFFE_MATERIAU/AFFE_VARC/EVOL),.il.faut.faire.attention....!
   !.....à.utiliser.éventuellement.les.mots.clés.PROL_GAUCHE.et.PROL_DROIT..............................!
   !----------------------------------------------------------------------------------------------------!
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.2
--------------------------------------------------------------------------------
RESTITUTION FICHE 012826 DU 2008-11-18 08:08:01
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   Limite xc3xa0 10000 pas archivxc3xa9s
FONCTIONNALITE
   Problème:
   ---------
   Mickael a été arreté par le message peu clair MODELISA4_69 émis par la routine gnomsd.f :
                                                                                            
                           
   !-------------------------------------------!
   !.<F>.<MODELISA4_69>........................!
   !.on.ne.sait.plus.trouver.de.noms...........!
   !-------------------------------------------!
                                                                                            
                           
                                                                                            
                           
   Corrections :
   -------------
                                                                                            
                           
   1) on améliore d'abord (un petit peu) le message d'erreur :
                                                                                            
                           
   !---------------------------------------------------------------------------!
   !.<F>.<MODELISA4_69>........................................................!
   !...........................................................................!
   !..Erreur.d'utilisation.:...................................................!
   !....On.cherche.à.nommer.un.objet.en.y.insérant.un.numéro...................!
   !....Le.numéro.99999.est.trop.grand.vis.à.vis.de.la.chaine.de.caractère.....!
   !...........................................................................!
   !..Risque.et.Conseil.:......................................................!
   !....Vous.avez.atteint.la.limite.de.ce.que.sait.faire.le.code...............!
   !....(trop.de.poursuites,.de.pas.de.temps,.de.pas.d'archivage,....).........!
   !...........................................................................!
   !.Cette.erreur.est.fatale..Le.code.s'arrete.................................!
   !---------------------------------------------------------------------------!
                                                                                            
                           
   2) Mais le vrai problème est que l'on utilise la routine gnomsd.f pour chaque pas de temps.
      C'est une routine a priori couteuse qu'il ne faut utiliser que dans les cas où on ne peut
      pas faire autrement.
      Je corrige donc nmarch.f (archivage du contact) pour que le nom de PRFCHN ne soit
      plus calculé par gnomsd.f.
                                                                                            
                           
   3) Dans la suite du cas test que j'avais choisi pour valider mon développement (ssnv506b),
   je me suis aperçu que la commande CALC_NO faisait également un usage abusif de la routine
   gnomsd pour le calcul de REAC_NODA :
      - à chaque numéro d'ordre, on créait un nouveau NUME_EQUA (appel à la routine numecn.f)
      Je modifie donc numecn.f pour que, pour les numéros d'ordre qui se suivent et qui
   correspondent à une meme numérotation des ddls, on ne crée qu'un seul NUME_EQUA. On gagne
   ainsi en performances (CPU et espace disque).
                                                                                            
                           
      Par exemple, pour un petit test calculant REAC_NODA, j'ai observé :
                                                                                            
                           
                                                                                            
                           
       Nom       Type                 Taille (Mo)         Nombre      Nombre de
                                                        d'objets       segments
       Avant :
       REMS       EVOL_ELAS                  0.14            148            207
       Après :
       REMS       EVOL_ELAS                  0.11            112            126
                                                                                            
                           
       Encore un exemple de "HPC attitude" !
   
     
   Remarque :
   ------------                                                                             
                                     
   Concernant la question implicitement posée dans le titre de cette fiche : Combien
   d'instants peuvent être archivés dans un evol_noli ?
   La réponse est 10**6 mais ce n'est pas gnomsd.f qui limite ce nombre : c'est la règle de
   construction des noms de champs (rsexch.f).
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   ssnv506b
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------
RESTITUTION FICHE 012886 DU 2008-11-25 12:37:32
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   une routine pour imprimer une matrice assemblxc3xa9e de faxc3xa7on lisible
FONCTIONNALITE
   Demande d'évolution:
   --------------------
   En vue de déboguage, il serait agréable de pouvoir imprimer de façon lisible le contenu
   d'une matrice assemblée.
                                                                                            
                           
   Réalisation:
   ------------
   J'ai enrichi la routine imprsd.f pour qu'elle imprime les objets de type 'MATRICE'.
                                                                                            
                           
   Validation:
   -----------
   Un essai perso + validation par Anne-Lise Guilmin
                                                                                            
                           
   Impact documentaire :
   ---------------------
   D6.00.01 : imprsd.f pour matrices
                                                                                            
                           
   Détails:
   ---------
   1) j'en profite pour ajouter le type 'TABLE' dans imprsd.f
   2) le format d'impression pour la matrice est le suivant :
                                                                                            
                           
   2.1) impression des valeurs non-nulles de la matrices :
         DIMENSION DE LA MATRICE :          52
         NOMBRE DE TERMES NON NULS :         502
         MATRICE A COEEFICIENTS REELS : T
         MATRICE SYMETRIQUE : T
                                                                                            
                           
               KTERM        ILIG        JCOL         VALEUR
                   1           1           1   1.401709401709401E+03
                   2           1           2   3.273145643412079E-13
                   3           2           2   2.598290598290594E+03
                   4           3           3  -2.000000000000000E+00
                   5           1           4  -2.521367521367512E+02
                   6           2           4   2.777777777777771E+02
                   7           3           4  -1.000000000000000E+00
                   8           4           4   1.999999999999986E+03
                   9           1           5   1.495726495726491E+02
                  10           2           5  -1.170940170940168E+03
                  ...
                 502          52          52   2.000000000000000E+03
                                                                                            
                           
     2.2) description des équations :
                                                                                            
                           
         DESCRIPTION DES EQUATIONS :
                                                                                            
                           
            NUM_EQUA NOEUD    CMP
                   1 N1       DX
                   2 N1       DY
                   3                    LAGR1 RELATION LINEAIRE
                   4 N2       DX
                   ...
                  15 N7       DY
                  16                    LAGR2 RELATION LINEAIRE
                  17 N8       DX
                  18 N8       DY
                  ...
                  26 N12      DY
                  27 N13      DY        LAGR1 BLOCAGE
                  28 N13      DX        LAGR1 BLOCAGE
                  29 N13      DX
                  30 N13      DY
                  31 N13      DY        LAGR2 BLOCAGE
                  32 N13      DX        LAGR2 BLOCAGE
                  33 N14      DX
                  ...
                  52 N21      DY
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : D6.00.01
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.7
--------------------------------------------------------------------------------
RESTITUTION FICHE 012910 DU 2008-11-30 22:43:12
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   erreur affichage message dans vrcomp (erreur calculel6_53)
FONCTIONNALITE
   Problème:
   ---------
   P. Badel a remarqué que pour le message CALCULEL6_53, les 2 nombres entiers imprimés
   étaient permutés.  :
                                                                                            
                           
    Erreur utilisateur :
      On cherche à "poursuivre" un calcul non linéaire mais les variables internes de l'état
      initial ne sont pas compatibles avec le comportement choisi pour la suite du calcul.
      Pour la maille  : %(k1)s
        Nombre de variables pour l'état initial         :  %(i1)d
        Nombre de variables attendu par le comportement :  %(i2)d
                                                                                            
                           
    Risques & conseils :
      Vérifier que vous n'avez pas changé de relation de comportement (mot clé RELATION).
                                                                                            
                           
                                                                                            
                                                                                            
                                                                                            
                                                                        
   Correction :
   ------------
   Il a raison !
   Je modifie la routine vrcomp.f pour rétablir les bons nombres.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   rien de particulier
NB_JOURS_TRAV  : 0.05
--------------------------------------------------------------------------------
RESTITUTION FICHE 012912 DU 2008-11-30 23:00:32
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   CREA_CHAMP xc3xa0 partir d'une table
FONCTIONNALITE
   Problème:
   ---------
   Pierre Badel a détecté un bug dans la fonctionnalité CREA_CHAMP/'EXTR' + TABLE (routine
   TABCHS).
                                                                                            
                           
   Correction:
   -----------
   On fait comme Pierre a dit :
                                                                                            
                           
   352c347,348
   <       ZI(JPG+J-1)=NBPT
   ---
   >       IMA = ZI(IGREL+J-1)
   >       ZI(JPG-1+IMA)=NBPT
                                                                                            
                           
   Validation:
   -----------
   Comme suggéré par Pierre, j'ai un peu compliqué le maillage du test zzzz126a pour
   remplacer 1 QUAD4 par 2 TRIA3.
   On a maintenant un modèle avec 2 GRELS qui révèle bien le bug.
                                                                                            
                           
   Conséquences du bug :
   ---------------------
   Le bug ne concernait que les champs ELGA.
                                                                                            
                           
   Le cham_elem_s créé pour recueillir les valeurs lues dans la table était incorrect le plus
   souvent (sous-dimensionné sur certaines mailles).
   Mais cela n'a pu générer de résultats faux car si la table à convertir contient une valeur
   sur le point KPG, et si sur cette maille, le nombre de points est insuffisant, l'appel à
   CESEXI de la ligne 413 de TABCHS :
                                                                                            
                           
            CALL CESEXI('S',JCESD,JCESL,NUMA,ZI(JOBJP+ILI-1),
        &              ZI(JOBJS+ILI-1),ICMP,IAD)
                                                                                            
                           
   doit se terminer par une erreur fatale : <F> CALCULEL_69
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   zzzz126a
NB_JOURS_TRAV  : 0.4
--------------------------------------------------------------------------------
RESTITUTION FICHE 012918 DU 2008-12-01 15:00:32
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   mxc3xa9moire requise calcul MODE_ITER_SIMULT
FONCTIONNALITE
   Problème:
   ---------
   Alexei a essayé d'utiliser MODE_ITER_SIMULT + SENSIBILITE.
   Il est arreté par un message lui indiquant une mémoire insuffisante.
                                                                                            
                           
   Analyse:
   --------
   J'ai localisé le moment où la mémoire est insuffisante.
   Il s'agit de la routine semore.f à la ligne 373 :
             CALL WKVECT(MATA,'V V R',NEQ*NEQ,JA)
                                                                                            
                           
   Ici, le nombre d'équations (NEQ) vaut 478958. Cela conduit à vouloir allouer un objet
   jeveux de 1835 Go ! ce que la machine Aster ne peut évidemment pas accepter.
                                                                                            
                           
   La programmation de semore.f sur ce point n'a jamais bougé. Elle a été introduite comme
   cela en 7.3.15 par Hari.
   Elle n'est pas adaptée à de grosses matrices.
                                                                                            
                           
   Hari a confirmé que la modification de la programmation de semore.f (pour ne pas allouer
   un gros objet de taille NEQ*NEQ) est assez conséquente. Il estime le temps de travail à 15
   jours.
                                                                                            
                           
   C. Durand est d'accord avec moi pour dire que ce développement n'est pas prioritaire.
                                                                                            
                           
   Je conseille donc à Alexei de faire ses calculs de sensibilité par "différences finies".
                                                                                            
                           
   Restitution :
   -------------
   Je modifie la routine semore.f pour qu'elle émette une nouvelle alarme (SENSIBILITE_56)
   signalant que le calcul de MODE_ITER_SIMULT avec sensibilité est déconseillé pour les
   grosses matrices (si NEQ*NEQ > 3 Go).
                                                                                            
                           
    
   Liste des fichiers impactés par la correction de la fiche:  12918
     semore.f
     sensibilite.py
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   xc3xa9tude fournie
NB_JOURS_TRAV  : 0.6
--------------------------------------------------------------------------------
RESTITUTION FICHE 012923 DU 2008-12-02 13:17:57
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   ECLA_PG ne construit pas un maillage correct
FONCTIONNALITE
   Problème:
   ---------
   On ne peut pas créer un modèle sur le maillage produit par MACR_ECLA_PG.
                                                                                            
                           
   Solution:
   ---------
   Il y a effectivement un petit oubli dans la routine eclpgm.f :
   Le champ de géométrie du maillage "éclaté" continuait de "pointer" sur la maillage initial.
                                                                                            
                           
   Il faut corriger eclpgm.f :
   50c50
   <       INTEGER IRET,ICH
   ---
   >       INTEGER IRET,ICH,JREFE
   359a360,361
   >       CALL JEVEUO(MA2//'.COORDO    .REFE','E',JREFE)
   >       ZK24(JREFE-1+1)=MA2
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso basxc3xa9 sur tpll01b
NB_JOURS_TRAV  : 0.2
--------------------------------------------------------------------------------
RESTITUTION FICHE 012926 DU 2008-12-03 08:36:45
TYPE evolution concernant Code_Aster (VERSION )
TITRE
   Erreurs Jeveux 'S' -> 'F'
FONCTIONNALITE
   Problème:
   ---------
   Lorsque Jeveux n'arrive plus à allouer de mémoire, il émet (via la routine jjalls.f) l'un
   des 2 messages d'erreur JEVEUX_60 ou JEVEUX_62.
   Mais ces messages sont des messages 'S' qui n'arretent pas brutalement l'exécution pour
   que l'utilisateur puisse récupérer dans sa base globale les concepts précédemment validés.
                                                                                            
                 
   Ce système a un inconvénient pour les développeurs : on ne sait pas à quel instruction du
   programme, la mémoire a manqué (abscence de "traceback").
                                                                                            
                 
   Evolution:
   ----------
   Je remplace ces 2 erreurs 'S' (ce sont les 2 seules de jeveux) par des erreurs 'F'.
                                                                                            
                 
   Du coup, pour l'utilisateur "ordinaire" (celui qui n'utilise pas le mot cle DEBUT/CODE),
   cela ne change rien car depuis quelques temps (merci Mathieu), on "récupère" toutes les
   erreurs 'F' et on ferme la base avec les concepts qui sont valides.
                                                                                            
                 
   En revanche, le développeur (qui utilise le mot clé DEBUT/CODE et qui se fiche de sa base)
   a maintenant une "traceback" qui peut l'aider dans son diagnostic (sans avoir besoin de
   surcharger jjalls.f).
                                                                                            
                 
   Validation:
   -----------
   J'ai vérifié sur un petit exemple, que les 2 comportements observés (avec ou sans
   DEBUT/CODE) sont bien ceux attendus.
                                                                                            
                 
   Conclusion:
   -----------
   Comme quoi, je peux aussi etre "developper friend" !
    
    
   Liste des fichiers impactés par la correction de la fiche:  12926
     jjalls.f
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------
RESTITUTION FICHE 012937 DU 2008-12-04 12:00:58
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   STAT_NON_LINE / nouveau modxc3xa8le en poursuite
FONCTIONNALITE
   Problème:
   ---------
   Une "poursuite" STAT_NON_LINE sur un modèle ayant "perdu" quelques éléments (simulation de
   la propagation d'une entaille), s'arrete brutalement avec le message :
                                                                                            
                           
   <F> CALCULEL5_40 : le champ de variables internes initiales n'a pas le bon nombre de
   sous-points.
                                                                                            
                           
   Analyse :
   ---------
   Il s'agit d'une erreur introduite en traitant la fiche 12480. J'avais oublié de prévoir le
   cas d'une maille qui disparait au cours du calcul.
                                                                                            
                           
   Correction:
   -----------
   Comme le suggère Erwan, je modifie la routine vrcom2.f pour qu'elle n'émette plus ce
   message d'erreur sur les mailles qui ne font plus partie du modèle.
                                                                                            
                           
   validation:
   -----------
   L'étude fournie va jusqu'au bout.
    
    
   Liste des fichiers impactés par la correction de la fiche:  12937
     vrcom2.f
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   xc3xa9tude fournie
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------
RESTITUTION FICHE 012968 DU 2008-12-10 12:50:22
TYPE express concernant Code_Aster (VERSION 7.0)
TITRE
   Amxc3xa9lioration des performances de la routine cescar.f
FONCTIONNALITE
   Problème:
   ---------
   En 9.0.2, dans le cadre d'une évolution de Luc Davenne pour F. Vodoire (poutres
   multi-fibres), j'ai
   du introduire une routine de transformation : cham_elem_s -> carte (cescar.f). (fiche
   express 10331).
    
   A l'époque, j'avais noté dans un commentaire de l'entête de la routine :
   "routine peu performante à réécrire"
    
   Depuis, 2 nouvelles routines (en plus de nmdpmf.f) appellent cette routine (nmdofu.f et
   rdtchp.f).
    
   Je souhaite maintenant améliorer les performances de cescar.f.
                                                                                            
              
                                                                                            
              
   Evolution:
   ------------
   La structure de donnée "carte" est un champ constant par maille. Ce n'est pas un
   cham_elem. Elle n'a donc pas les contraintes liées aux catalogues des éléments finis : on
   peut affecter n'importe quelle composante sur n'importe quelle maille.
                                                                                            
              
   Normalement, la sd_carte est de petite taille car les mailles qui sont affectées par les
   memes valeurs sont stockées ensemble.
                                                                                            
              
   Quand on transforme un cham_elem_s en carte, si on veut produire une structure de données
   "compacte", il faut reconnaitre les "paquets" de mailles identiques. C'est ce que je
   n'avais pas fait dans la première version de la routine. Chaque maille était donc supposée
   différente des autres, ce qui fait perdre tout l'intéret de la sd_carte qui devient alors
   beaucoup plus volumineuse que le cham_elem_s équivalent.
                                                                                            
              
   C'est ce défaut qu'il faut corriger.
                                                                                            
              
   Dans l'absolu, si on veut regrouper ensemble les mailles "identiques", il faut toutes les
   comparer 2 à 2, ce qui peut etre très long à faire sur les gros maillages.
   C'est pour cela que j'ai adopté une démarche moins efficace en espace mais plus économique
   en CPU :
   Je ne rassemble dans un meme paquet de mailles identiques que des mailles dont les numéros
   se suivent (dans l'odre du pointeur de noms MA.NOMMAI)
                                                                                            
              
   Cette stratégie sera catastrophique pour une carte "échiquier" telle que :
      MA1 -> NOIR
      MA2 -> BLANC
      MA3 -> NOIR
      MA4 -> BLANC
      MA5 -> NOIR
      MA6 -> BLANC
      ...
      Car les paquets n'auront jamais plus d'une maille.
                                                                                            
              
   En revanche, si un utilisateur crée une carte comme :
   SIG=CREA_CHAMP(MAILLAGE=MAGIBI, OPERATION='AFFE', TYPE_CHAM='CART_SIEF_R',
                  AFFE=(
                      _F(TOUT='OUI',       NOM_CMP= 'SIXX', VALE= 0.0,),
                      _F(GROUP_MA='CARR1', NOM_CMP= 'SIXX', VALE= 1.0,),
                      _F(GROUP_MA='CARR2', NOM_CMP= 'SIXX', VALE= 2.0,),
                      _F(GROUP_MA='CARR3', NOM_CMP= 'SIXX', VALE= 3.0,),
                                           ));
   et si le maillage est "normalement" constitué, (c'est à dire si les mailles des GROUP_MA
   (CARR1, CARR2, CARR3) se suivent dans le maillage), alors la carte sera alors "compacte".
                                                                                            
              
   Je fais le pari que les cartes "échiquier" seront rares. Si ce cas devait se produire
   régulièrement, je devrais me remettre à l'ouvrage !
                                                                                            
              
                                                                                            
              
   Validation :
   ------------
   J'ai modifié (temporairement) la commande CREA_CHAMP lorsqu'elle crée une carte :
   A la fin de la commande, je transforme la carte produite en cham_elem_s (carces.f), puis
   je fais la transfomation inverse (cescar.f) pour produire la carte finale.
                                                                                            
              
                                                                                            
              
   1) Justesse et robustesse :
     Avec ce code modifié, j'ai fait passer 50 tests qui créaient des cartes avec CREA_CHAMP.
   Ils sont tous restés OK.
                                                                                            
              
   2) Performances :
     J'ai fait un  essai basé sur un maillage de 120 000 QUAD4 sur lequel j'ai créé la carte :
     SIG=CREA_CHAMP(MAILLAGE=MAGIBI, OPERATION='AFFE', TYPE_CHAM='CART_SIEF_R',
                    AFFE=(
                      _F(TOUT='OUI',       NOM_CMP= 'SIXX', VALE= 0.0,),
                      _F(GROUP_MA='CARR1', NOM_CMP= 'SIXX', VALE= 1.0,),
                      _F(GROUP_MA='CARR2', NOM_CMP= 'SIXX', VALE= 2.0,),
                      _F(GROUP_MA='CARR3', NOM_CMP= 'SIXX', VALE= 3.0,),
                                           ));
                                                                                            
              
                                     Avant          Après
       Taille du concept SIG1  :     170Mo          0.62Mo
       Temps CPU de CREA_CHAMP :     13.8s          1.7s
   
   Si ça, c'est pas HPC !
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essais perso
NB_JOURS_TRAV  : 1.0
--------------------------------------------------------------------------------
RESTITUTION FICHE 012992 DU 2008-12-18 08:01:19
TYPE anomalie concernant Code_Aster (VERSION 9.3)
TITRE
   CREA_MAILLAGE / QUAD_LINE
FONCTIONNALITE
   Problème:
   ---------
   Lorsque l'on veut créer un maillage linéaire à partir d'un maillage quadratique
   (CREA_MAILLAGE/QUAD_LINE) et que le maillage linéaire ne contient que des mailles
   quadratiques, il y a 0 maille à transformer et on est arreté par un message peu clair :
                                                                                            
               
    
   !-------------------------------------------------------!
   !.<F>.<JEVEUX_57>.......................................!
   !.......................................................!
   !..Longueur.du.segment.de.valeurs.à.allouer.invalide.0..!
   !.......................................................!
   !.Cette.erreur.est.fatale..Le.code.s'arrete.............!
   !-------------------------------------------------------!
                                                                                            
               
   Solution :
   ----------
   On "blinde" le code pour émettre un nouveau message d'alarme :
                                                                                            
               
   !----------------------------------------------------------------------------------!
   !.<A>.<MODELISA3_8>................................................................!
   !..................................................................................!
   !..Erreur.utilisateur.dans.CREA_MAILLAGE./.QUAD_LINE.:.............................!
   !...Vous.avez.demandé.de.transformer.des.mailles.quadratiques.en.mailles.linéaires.!
   !...mais.il.n'y.a.aucune.maille.quadratique.à.transformer..........................!
   !..................................................................................!
   !.Ceci.est.une.alarme..Si.vous.ne.comprenez.pas.le.sens.de.cette...................!
   !.alarme,.vous.pouvez.obtenir.des.résultats.inattendus.!...........................!
   !----------------------------------------------------------------------------------!
                                                                                            
               
                                                                                            
               
   Concernant le problème "inverse" : LINE_QUAD avec 0 maille linéaire :
   Jusqu'à présent, le code ne s'arretait pas : il produisait un maillage identique au
   maillage d'entrée et il n'émettait aucune alarme.
   Je modifie la routine cmlqna.f pour qu'elle émette un message d'alarme équivalent :
   !-----------------------------------------------------------------------------------!
   !.<A>.<MODELISA3_44>................................................................!
   !...................................................................................!
   !..Erreur.utilisateur.dans.CREA_MAILLAGE./.LINE_QUAD.:..............................!
   !...Vous.avez.demandé.de.transformer.des.mailles.linéaires.en.mailles.quadratiques..!
   !...Mais.il.n'y.a.aucune.maille.linéaire.à.transformer..............................!
   !...................................................................................!
   !.Ceci.est.une.alarme..Si.vous.ne.comprenez.pas.le.sens.de.cette....................!
   !.alarme,.vous.pouvez.obtenir.des.résultats.inattendus.!............................!
   !-----------------------------------------------------------------------------------!
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   essai perso
NB_JOURS_TRAV  : 0.15
--------------------------------------------------------------------------------
RESTITUTION FICHE 008510 DU 2005-03-22 00:00:00
TYPE evolution concernant Code_Aster (VERSION 8.0)
TITRE
   MN00 - Redondances conditions aux limites
FONCTIONNALITE
   Problème :
   ----------
   Mickael aurait bien aimé que certains problèmes rencontrés lors de la factorisation
   de la matrice de rigidité (matrice singulière due aux conditions aux limites surabondantes)
   soient détectés plus tot (par exemple au début de STAT_NON_LINE).
                                                                                            
                           
   Abscence de solution :
   ----------------------
   Je ne sais pas quoi faire pour résoudre ce problème.
   J'ai fait deux essais pour provoquer volontairement cette erreur.
   A chaque fois, le message est assez clair.
   A la demande Mickael, je complète toutefois les messages FACTOR_30/_31 :
                                                                                            
                           
   30: _("""
   Matrice non factorisable :
     pivot presque nul à la ligne : %(i1)d
     nombre de décimales perdues  : %(i2)d
     Il s'agit sans doute d'une relation linéaire entre ddls surabondante.
     La liste des noeuds concernés par cette relation est imprimée ci-dessus dans le fichier
   MESSAGE.
                                                                                            
                           
   Risques & conseils :
     Il faut vérifier de plus près les conditions aux limites cinématiques.
     En particulier, il se peut que la relation linéaire surabondante provienne des
   conditions de contact.
     Peut-etre devriez vous exclure certains noeuds des conditions de contact (mots clés
   SANS_NOEUD et SANS_GROUP_NO)
   """),
                                                                                            
                           
    
   Liste des fichiers impactés par la correction de la fiche:  8510
     factor.py
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   rien de particulier
NB_JOURS_TRAV  : 0.2
--------------------------------------------------------------------------------



-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR sellenet     SELLENET Nicolas       DATE 12/01/2009 - 13:29:44

--------------------------------------------------------------------------------
RESTITUTION FICHE 013026 DU 2009-01-07 08:35:57
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   Suppression subroutines et fonctions
FONCTIONNALITE
   Problème :
   ----------
   Routines et fonctions non appelées.
   
   Solution :
   ----------
   Suppression des fichiers :
   invalm.f
   prjshb.f
   resneq.f
   shasks.f
   shb8ps.f
   shbsfc.f
   shutau.f
   shutav.f
   sigelp.f
   te0530.f
   vnms12.f
   vonmis.f
   
   dinit.f
   exnoco.f
   exnocp.f
   exnoel.f
   nbnoco.f
   nbnocp.f
   nbnoel.f
   nbnomi.f
   ndcoef.f
   nmaggl.f
   nmvcom.f
   
   rldlgb.f
   wpgskp.f
   vpgskc.f
   
   Ainsi que l'appel à te0530 et les appels commentés à wpgskp et vpgskc.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   liste_ct.vali
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------



-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR sfayolle     FAYOLLE Sebastien      DATE 12/01/2009 - 14:02:25

--------------------------------------------------------------------------------
RESTITUTION FICHE 012988 DU 2008-12-16 10:34:44
TYPE anomalie concernant Code_Aster (VERSION 7.0)
TITRE
   GLRC_DM + VMIS_CINE_LINE (KIT_DDI) problxc3xa8me en dynamique
FONCTIONNALITE
   PROBLÈME :
   
   Le problème apparait dans l'initialisation de la matrice TAN3D dans la routine lgdmvm.f.
   
   La matrice tangente (TAN3D) n'est pas toujours initialisée dans NMCINE. Ce n'est le cas 
   que lorsque OPTION='FULL_MECA' ou 'RIGI_MECA_'. Or, pour la boucle interne on en a 
   besoin aussi pour les autres, càd 'RAPH_MECA'.
   
   
   SOLUTION :
   
   La correction a consisté à remplacer OPTION dans l'appel à NMCINE par 'FULL_MECA   '
   (comme pour l'appel à NMISOT).
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
   ssns106f
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------



========================================================================
=== Recapitulation des operations demandees pour toutes les restitutions
========================================================================


    TYPE Action    unite                      user      Auteur         nblg  ajout suppr.

 CASTEST MODIF ssls105c                     sellenet N.SELLENET          88      1      1
 CASTEST MODIF ssls108c                     sellenet N.SELLENET         115      1      1
 CASTEST MODIF ssls108d                     sellenet N.SELLENET         115      1      1
 CASTEST MODIF ssls123a                     sellenet N.SELLENET          87      1      1
 CASTEST MODIF ssls124a                     sellenet N.SELLENET         412      1      1
 CASTEST MODIF ssls124b                     sellenet N.SELLENET         355      1      1
 CASTEST MODIF ssns101a                     sellenet N.SELLENET         335      1      1
 CASTEST MODIF ssns101b                     sellenet N.SELLENET         246      1      1
 CASTEST MODIF ssns101c                     sellenet N.SELLENET         296      1      1
 CASTEST MODIF ssns106f                     sfayolle S.FAYOLLE          737      2      2
 CASTEST MODIF zzzz126a                       pellet J.PELLET           444     14     16
 CASTEST MODIF zzzz240a                       pellet J.PELLET           161     82     32
CATALOPY MODIF commande/impr_resu             pellet J.PELLET           180      4      4
 FORTRAN AJOUT calculel/matimp                pellet J.PELLET           200    200      0
 FORTRAN AJOUT modelisa/gnoms2                pellet J.PELLET            61     61      0
 FORTRAN MODIF algeline/vpqzla              sellenet N.SELLENET        1099      1      8
 FORTRAN MODIF algeline/vpsorc              sellenet N.SELLENET         333      1      8
 FORTRAN MODIF algeline/wpsorc              sellenet N.SELLENET         375      1     10
 FORTRAN MODIF algeline/wpsorn              sellenet N.SELLENET         411      1      7
 FORTRAN MODIF algorith/cfimp4                desoza T.DESOZA           556      2      2
 FORTRAN MODIF algorith/nmarch                pellet J.PELLET           286      5      3
 FORTRAN MODIF algorith/nmdome                pellet J.PELLET           812     10      1
 FORTRAN MODIF algorith/numecn                pellet J.PELLET           140     57     16
 FORTRAN MODIF algorith/semore                pellet J.PELLET           470      3      1
 FORTRAN MODIF calculel/cescar                pellet J.PELLET           305    205     29
 FORTRAN MODIF calculel/eclpgm                pellet J.PELLET           387     22     24
 FORTRAN MODIF calculel/eclpgr                pellet J.PELLET           352      9      6
 FORTRAN MODIF calculel/jevech                pellet J.PELLET           197     23     12
 FORTRAN MODIF calculel/rcvarc                pellet J.PELLET           268     11      3
 FORTRAN MODIF calculel/rdtres                pellet J.PELLET           246     20     14
 FORTRAN MODIF calculel/vrcom2                pellet J.PELLET           225      4      2
 FORTRAN MODIF calculel/vrcomp                pellet J.PELLET           246      3      3
 FORTRAN MODIF elements/lgdmvm              sfayolle S.FAYOLLE          465      2      2
 FORTRAN MODIF jeveux/jjalls                  pellet J.PELLET           518      3      3
 FORTRAN MODIF modelisa/exlima                pellet J.PELLET           132     13      5
 FORTRAN MODIF modelisa/gnomsd                pellet J.PELLET            64      2      3
 FORTRAN MODIF modelisa/ordlrl                pellet J.PELLET           375     59     57
 FORTRAN MODIF modelisa/tabchs                pellet J.PELLET           468      9     13
 FORTRAN MODIF prepost/cmlqna                 pellet J.PELLET           138      3      1
 FORTRAN MODIF prepost/cmqlnm                 pellet J.PELLET           238     10      1
 FORTRAN MODIF prepost/op0039                 pellet J.PELLET           967     95     64
 FORTRAN MODIF prepost/op0106                 pellet J.PELLET           908      4      6
 FORTRAN MODIF utilitai/copisd                pellet J.PELLET           416     21     12
 FORTRAN MODIF utilitai/detrsd                pellet J.PELLET           619      9      6
 FORTRAN MODIF utilitai/imprsd                pellet J.PELLET           145     34     14
 FORTRAN SUPPR algeline/nbnomi              sellenet N.SELLENET          67      0     67
 FORTRAN SUPPR algeline/rldlgb              sellenet N.SELLENET         113      0    113
 FORTRAN SUPPR algeline/vpgskc              sellenet N.SELLENET         207      0    207
 FORTRAN SUPPR algeline/wpgskp              sellenet N.SELLENET         263      0    263
 FORTRAN SUPPR algorith/dinit               sellenet N.SELLENET         364      0    364
 FORTRAN SUPPR algorith/nmaggl              sellenet N.SELLENET          66      0     66
 FORTRAN SUPPR algorith/nmvcom              sellenet N.SELLENET          98      0     98
 FORTRAN SUPPR elements/invalm              sellenet N.SELLENET          51      0     51
 FORTRAN SUPPR elements/prjshb              sellenet N.SELLENET         152      0    152
 FORTRAN SUPPR elements/resneq              sellenet N.SELLENET          33      0     33
 FORTRAN SUPPR elements/shasks              sellenet N.SELLENET          47      0     47
 FORTRAN SUPPR elements/shb8ps              sellenet N.SELLENET        1425      0   1425
 FORTRAN SUPPR elements/shbsfc              sellenet N.SELLENET          46      0     46
 FORTRAN SUPPR elements/shutau              sellenet N.SELLENET          37      0     37
 FORTRAN SUPPR elements/shutav              sellenet N.SELLENET          41      0     41
 FORTRAN SUPPR elements/sigelp              sellenet N.SELLENET         144      0    144
 FORTRAN SUPPR elements/te0530              sellenet N.SELLENET         552      0    552
 FORTRAN SUPPR elements/vnms12              sellenet N.SELLENET          39      0     39
 FORTRAN SUPPR elements/vonmis              sellenet N.SELLENET          36      0     36
 FORTRAN SUPPR modelisa/exnoco              sellenet N.SELLENET         125      0    125
 FORTRAN SUPPR modelisa/exnocp              sellenet N.SELLENET         162      0    162
 FORTRAN SUPPR modelisa/exnoel              sellenet N.SELLENET         153      0    153
 FORTRAN SUPPR modelisa/nbnoco              sellenet N.SELLENET         127      0    127
 FORTRAN SUPPR modelisa/nbnocp              sellenet N.SELLENET         116      0    116
 FORTRAN SUPPR modelisa/nbnoel              sellenet N.SELLENET         138      0    138
 FORTRAN SUPPR utilitai/ndcoef              sellenet N.SELLENET         147      0    147
  PYTHON MODIF Messages/calculel2             pellet J.PELLET           368     64      4
  PYTHON MODIF Messages/calculel3             pellet J.PELLET           386     14      1
  PYTHON MODIF Messages/calculel4             pellet J.PELLET           319     41      2
  PYTHON MODIF Messages/elements2           sellenet N.SELLENET         232      1      5
  PYTHON MODIF Messages/elements4           sellenet N.SELLENET         286      1      5
  PYTHON MODIF Messages/factor                pellet J.PELLET           317     11      1
  PYTHON MODIF Messages/modelisa3             pellet J.PELLET           374     12      7
  PYTHON MODIF Messages/modelisa4             pellet J.PELLET           441      8      2
  PYTHON MODIF Messages/prepost6              pellet J.PELLET           157      3      6
  PYTHON MODIF Messages/sensibilite           pellet J.PELLET           208     16      1


        nb unites  nb lignes  ajouts  suppr.  difference
 AJOUT :    2         261       261              +261
 MODIF :   53       18820       924     433      +491
 SUPPR :   26        4749              4749     -4749
 DEPLA :    0           0 
         ----      ------     ------  ------   ------
 TOTAL :   81       23830      1185    5182     -3997 
