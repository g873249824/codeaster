

-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR flejou       FLEJOU Jean Luc        DATE 11/24/2010 - 01:21:54

--------------------------------------------------------------------------------
RESTITUTION FICHE 015921 DU 2010-11-17 09:34:05
TYPE anomalie concernant Code_Aster (VERSION 10.3)
TITRE
    En NEW10.2.25, le cas-test sdnl130a s'arrete en erreur fatale sur Bull.
FONCTIONNALITE
   Analyse :
   On va chercher ALPHA dans le matériaux par 
   ...CALL RCVALB(...,'ALPHA',ALPHA,CODRES,RETOUR)
   on fait le test 
   ...IF(CODRES(1).EQ.'OK') DEPSTH = ALPHA*(TEMPP-TREF)
   
   Le problème est que si la température n'existe pas sur l'élément alors les appels précédents
   ...CALL RCVARC(' ','TEMP','REF',FAMI,1,1,TREF,IRET1)
   ...CALL MOYTEM(FAMI,NPG,NSPG,'+',TEMPP,IRET2)
   ...CALL MOYTEM(FAMI,NPG,NSPG,'-',TEMPM,IRET3)
   retournent des Nan pour TREF, TEMPP, TEMPM
   
   C     S'IL N'Y A PAS DE TEMPERATURE
         IF ( IRET1.EQ.1 ) THEN
            TREF = 0.0D0
         ENDIF
         IF ( IRET2.EQ.1 ) THEN
            TEMPP = TREF
         ENDIF
         IF ( IRET3.EQ.1 ) THEN
            TEMPM = TREF
         ENDIF
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    passage sdnl130a
DEJA RESTITUE DANS : 10.2.26
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------
RESTITUTION FICHE 015907 DU 2010-11-15 14:45:52
TYPE anomalie concernant Code_Aster (VERSION 9.8)
TITRE
    Anomalie pour les elements discrets non symetriques
FONCTIONNALITE
   Analyse :
   entre la version NEW9 et NEW10 les appels du type 
         CALL JEVECH('PCINFDI','L',INFOD)
         INFODI = NINT(ZR(INFOD+ ???))
   ont été remplacés par des appels du type
         CALL INFDIS('SYMK',INFODI,R8BID)
   Il ne faut pas en tenir compte.
   
   L'analyse faite dans la fiche 15846 est excellente. Il faut simplement la reporter dans la
   version NEW9. Cela impacte MAPVEC, TE0041, TE0042 :
   MAPVEC : inverser les boucles I,J
   TE0042 : suppression des tests autour de INFODI, en début de la subroutine
   TE0041 : créer un ZR(JTMP) de dimension N et l'utiliser pour stocker les différentes
   opérations, puis tout à la fin faire ZR(JDM+(I-1)*NNO*NC+J-1) = ZR(JTMP +(J-1)*NNO*NC+I-1)
   
   Il existe un seul cas test pour les discrets non-symétriques en version 9 : sdll123c il
   est ok.
   J'ai également passé le cas test qui m'a servi à faire l'analyse pour la fiche 15846, il
   est ok.
   
   Les cas tests de la version 10 ne peuvent pas être utilisés car la commande
   CALC_MODE_ROTATION n'existe pas en version 9.
RESU_FAUX_VERSION_EXPLOITATION    :  OUI   DEPUIS : 9.3.18
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  NON
IMPACT_DOCUMENTAIRE : 
VALIDATION
    test perso
NB_JOURS_TRAV  : 1.0
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR desoza       DE SOZA Thomas         DATE 11/24/2010 - 01:21:54

--------------------------------------------------------------------------------
RESTITUTION FICHE 015930 DU 2010-11-17 17:37:19
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    Affichage de TEST_RESU xc3xa9trange
FONCTIONNALITE
   Anomalie
   ========
   
   Dans le fichier .resu du cas-test SSNP121N (sur Bull par exemple), on trouve ceci : 
   
   --------------------------------------------------------------------------------
    ---- RESULTAT         NUME_ORDRE       NOM_CHAM         NOM_CMP          GROUP_NO
         RESU             1                DEPL             LAGS_C           B
         REFERENCE        LEGENDE          VALE_REF         VALE_CAL         ERREUR         
    TOLE            
    OK   ANALYTIQUE       XXXX             0.0E+00          0.0E+00          1000.0%        
    1.0%            
   
   
   1000% d'erreur alors que le test est OK. De plus ce test n'est pas réalisé en absolu et
   pourtant ça marche :
   
   TEST_RESU(   RESU=_F( RESULTAT = RESU,
                         NUME_ORDRE = 1,
                         GROUP_NO = 'B',
                         NOM_CHAM = 'DEPL',
                         CRITERE = 'RELATIF',
                         REFERENCE = 'ANALYTIQUE',
                         PRECISION = 1.E-2,
                         NOM_CMP = 'LAGS_C',
                         VALE = 0.),
               );
   
   
   Une petite erreur d'affichage ?
   
   Correction
   ==========
   
   C'est en fait un souhait délibéré (ça a toujours été comme ça). Lorsque l'on compare en
   relatif 2 valeurs (réelles, entières ou complexes), on fait en réalité le test suivant :
   
               LOK = ( ABS(VALR-REFR(IMIN)) .LE. EPSI * ABS(REFR(IMIN)) )
               IF ( REFR(IMIN) .NE. ZERO ) THEN
                  ERR = (VALR - REFR(IMIN)) / REFR(IMIN) *CENT
               ELSE
                  ERR = 999.999999D0
               ENDIF
   
   Dans le cas particulier où le test est OK et que la référence est nulle, on renseigne
   désormais une erreur de 0.D0
   
   Impact : utites.f
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    visuelle
DEJA RESTITUE DANS : 10.2.26
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------
RESTITUTION FICHE 015801 DU 2010-10-22 14:38:10
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    En NEW10.2.21, les cas-test petsc01d, petsc01e, petsc01f  s'arretent en erreur _<F> sur Aster4_mpi
FONCTIONNALITE
   Anomalie
   ========
   
   Sur Aster4 MPI, les cas-tests petsc01d, petsc01e et petsc01f s'arrêtent en erreur <F>
   (erreur de programmation).
   
   Analyse
   =======
   
   Ces cas-tests utilisent le nouveau préconditionneur LDLT_SP qui appelle MUMPS.
   
   On corrige plusieurs choses :
   
   - dans l'interface PETSc pour LDLT_SP, on utilise un COMMON pour transmettre des
   informations. Dans ce COMMON, les variables ne sont pas bien alignées nous dit le
   compilateur car les entiers sont déclarées après les caractères. Comme un caractère a un
   alignement de 1, cela n'est pas bon : il faut toujours avancer dans le COMMON avec des
   alignements de taille décroissante (d'abord les complexes, puis les réels, puis les
   entiers puis les caractères)
   
   - dans AMUMPT, on n'initialise pas toujours le vecteur KMONIT qui contient le nom des
   objets de monitoring. Cela conduit à un écrasement en série lorsque l'on fait un JEEXIN
   sur ces chaînes non initialisées.
   
   Correction
   ==========
   
   Impact : amumpm.F  amumpt.F  apets1.F  apets2.F  apets3.F  apets4.F  apetsc.F  apetsr.F 
   ldsp1.F  ldsp2.F
   
   La correction sur MUMPS est à faire en V9.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    petsc01def
DEJA RESTITUE DANS : 10.2.26
NB_JOURS_TRAV  : 0.3
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR assire       ASSIRE Aimery          DATE 11/24/2010 - 01:21:55

--------------------------------------------------------------------------------
RESTITUTION FICHE 015761 DU 2010-10-19 07:24:20
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    DEFI_PART_FETI + KMETIS : plantage dans kmetis
FONCTIONNALITE
   La commande DEFI_PART_FETI plantait avec METIS (pmetis ou kmetis) pour des maillages dont
   une maille au moins avait plus de 25 voisins.
   
   En fait, METIS s'arrêtait proprement en indiquant une incompatibilité entre le nombre de
   lien du graphe et ce qu'il a pu lire dans le fichier.
   
   Dans l'écriture du fichier d'entrée de METIS, il y avait une valeur fixée à 50 dans le
   format Fortran, ce qui faisait que le fichier n'était pas valable avec le maillage
   incriminé (merci jacques!).
   
   Pour corriger, on supprime cette valeur en dur et on ajuste le format au nombre exact de
   valeurs a rentrer sur chaque ligne.
   
   A noter que le probleme ne se posait pas avec SCOTCH car on l'utilise en librairie
   directement et non par un fichier d'échange.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    astout "defi_part_feti"
DEJA RESTITUE DANS : 10.2.26
NB_JOURS_TRAV  : 2.0
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR fernandes    FERNANDES Roméo       DATE 11/24/2010 - 01:21:55

--------------------------------------------------------------------------------
RESTITUTION FICHE 014547 DU 2010-02-02 13:30:27
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    Cas-test MAC3C01A : contact ?
FONCTIONNALITE
   Rappel des faits :
   Un chargement DEFI_CONTACT est défini dans le fichier mac3c01.25
   et n'est pas appelé dans le STAT_NON_LINE. Il ne sert donc à rien.
   
   Solution :
   Suppression de DEFI_CONTACT dans mac3c01.25 pour avoir un fichier bien propre.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    mac3c01a
DEJA RESTITUE DANS : 10.2.26
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR courtois     COURTOIS Mathieu       DATE 11/24/2010 - 01:21:55

--------------------------------------------------------------------------------
RESTITUTION FICHE 015862 DU 2010-11-03 18:35:32
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    IMPR_RESU('MED') impossible dans une boucle
FONCTIONNALITE
   Problème
   ========
   
   Dans une boucle, on souhaite produire à chaque itération un fichier 
   MED de résultats de calcul.
   On fait :
   
   ma = LIRE_MAILLAGE()
   
   for i in range(3):
   . . fname = "./REPE_OUT/file.%d" % i
   . . # récupérer l'unité par DEFI_FICHIER
   . . cunit = DEFI_FICHIER(FICHIER=fname,
   . . . . . . . . . . . . .TYPE="BINARY",
   . . . . . . . . . . . . .ACCES="NEW")
   . . unit = cunit.valeur
   
   . . IMPR_RESU(FORMAT='MED',
   . . . . . . . UNITE=unit,
   . . . . . . . RESU=_F(MAILLAGE=ma),)
   
   . . DEFI_FICHIER(ACTION="LIBERER",
   . . . . . . . . .UNITE=unit)
   
   
   On tombe sur l'erreur UTILITAI5_7 : "redefinition de l'unite logique  
   99  non autorisee"
   
   
   Correction
   ==========
   
   Deux corrections sont nécessaires :
    1. il faut autoriser la redéfinition d'une unité logique qui a été 
   libérée
    2. dans le test fait pour retrouver l'unité logique déjà utilisée, 
   on ne peut tenir compte du DDNAME ('MESSAGE', 'RESULTAT'...) 
   uniquement s'il est non vide (' ').
   
   
   Routine impactée pour la correction en version 9 : uldefi.f
   
   
   En version 10, on fait un peu de nettoyage de choses qui ne sont plus 
   utilisées : fichier VIGILE, arguments non utilisés, IMPLICIT NONE.
   
   
   
   D'autre part, on améliore le message dans le cas où l'utilisateur 
   essaie d'imprimer dans son fichier med un champ qui existe déjà.
   Le message est maintenant :
   
    !-------------------------------------------------------------------
   --!
    ! <F> <MED2_4> . . . . . . . . . . . . . . . . . . . . . . . . . . . 
   .!
    ! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
   . !
    ! Le champ 'DEPLA___DEPL____________________' est déjà présent . . . 
   .!
    ! dans le fichier med pour l'instant 0. . . . . . . . . . . . . . . 
   . !
    ! . -> Conseil : . . . . . . . . . . . . . . . . . . . . . . . . . . 
   .!
    ! . . .Vous pouvez soit imprimer le champ dans un autre fichier, 
   soit !
    ! . . .changer nommer le champ différemment. . . . . . . . . . . . . 
   .!
    ! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
   . !
    ! . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
   . !
    ! Cette erreur est fatale. Le code s'arrete. . . . . . . . . . . . . 
   .!
    !-------------------------------------------------------------------
   --!
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  OUI
IMPACT_DOCUMENTAIRE : 
VALIDATION
    impression dans une boucle
NB_JOURS_TRAV  : 1.0
--------------------------------------------------------------------------------
RESTITUTION FICHE 015941 DU 2010-11-19 08:13:19
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    En NEW9.7.7, le cas-test mtlp103a s'arretent par manque de temps CPU sur Bull
FONCTIONNALITE
   Problème
   ========
   
   Le cas-test mtlp103a s'arrête par manque de temps.
   
   
   Correction
   ==========
   
   On lui plus de marge en passant le temps limite dans le .para de 240 à 
   300 s.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  NON
IMPACT_DOCUMENTAIRE : 
VALIDATION
    mtlp103a
NB_JOURS_TRAV  : 0.5
--------------------------------------------------------------------------------



-----------------------------------------------------------------------

--------------------------------------------------------------------------------
--- AUTEUR tardieu      TARDIEU Nicolas        DATE 11/24/2010 - 04:03:12

--------------------------------------------------------------------------------
RESTITUTION FICHE 015912 DU 2010-11-16 09:38:32
TYPE anomalie concernant Code_Aster (VERSION 9.1)
TITRE
    En NEW9.7.6, le cas-test hsna120a s'arrete en erreur fatale sur aster 4.
FONCTIONNALITE
   Ce cas test a déjà été supprimé en v10 et, dans un soucis de capitalisation, a été versé
   dans la base de données Etudes.
   Vus les problèmes qu'il nous pose en v9, on propose de le supprimer aussi dans cette version.
RESU_FAUX_VERSION_EXPLOITATION    :  NON
RESU_FAUX_VERSION_DEVELOPPEMENT   :  NON
RESTITUTION_VERSION_EXPLOITATION  :  OUI
RESTITUTION_VERSION_DEVELOPPEMENT :  NON
IMPACT_DOCUMENTAIRE : 
VALIDATION
    Sans objet
NB_JOURS_TRAV  : 0.1
--------------------------------------------------------------------------------



========================================================================
=== Recapitulation des operations demandees pour toutes les restitutions
========================================================================


    TYPE Action    unite                      user      Auteur         nblg  ajout suppr.

 CASTEST AJOUT zzzz274a                      macocco K.MACOCCO          188    188      0
 CASTEST AJOUT zzzz274b                      macocco K.MACOCCO          189    189      0
 CASTEST AJOUT zzzz274c                      macocco K.MACOCCO          223    223      0
 CASTEST AJOUT zzzz274d                      macocco K.MACOCCO          223    223      0
 CASTEST MODIF mac3c01a                      macocco K.MACOCCO          420      2      1
 CASTEST MODIF mtlp103a                      macocco K.MACOCCO          863      2      1
 CASTEST SUPPR hsna120a.comm                 tardieu N.TARDIEU          760      0    760
FORTRAN90 MODIF mumps/amumpm                  macocco K.MACOCCO          390      2      1
 FORTRAN MODIF elements/pmfcom               macocco K.MACOCCO          313     28     30
 FORTRAN MODIF elements/te0041               macocco K.MACOCCO          550     18     11
 FORTRAN MODIF elements/te0042               macocco K.MACOCCO          284      1      3
 FORTRAN MODIF utilitai/fetskp               macocco K.MACOCCO          499      7      4
 FORTRAN MODIF utilitai/mapvec               macocco K.MACOCCO           39      3      3
 FORTRAN MODIF utilitai/uldefi               macocco K.MACOCCO          153      5      4
 FORTRAN MODIF utilitai/utites               macocco K.MACOCCO          277     13      1


        nb unites  nb lignes  ajouts  suppr.  difference
 AJOUT :    4         823       823              +823
 MODIF :   10        3788        81      59       +22
 SUPPR :    1         760               760      -760
 DEPLA :    0           0 
         ----      ------     ------  ------   ------
 TOTAL :   15        5371       904     819       +85 
