      SUBROUTINE EXNODE(NOMA,MOTFAC,NBOCC,
     &                  NONBNO,NOPONO,NBTOT,
     &                  NOLINO)
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF MODELISA  DATE 14/03/2006   AUTEUR MABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2006  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C
      IMPLICIT      NONE
      CHARACTER*8   NOMA
      CHARACTER*16  MOTFAC
      INTEGER       NBOCC
      CHARACTER*24  NONBNO
      CHARACTER*24  NOPONO            
      INTEGER       NBTOT
      CHARACTER*24  NOLINO      
C
C ----------------------------------------------------------------------
C ROUTINE UTILITAIRE
C ----------------------------------------------------------------------
C
C EXTRAIT LES NOEUDS :
C   - D'UN GROUP_NO OU D'UNE LISTE DE GROUP_NO
C   - D'UN GROUP_MA OU D'UNE LISTE DE GROUP_MA
C   - D'UNE MAILLE OU D'UNE LISTE DE MAILLES
C   - D'UN NOEUD OU D'UNE LISTE DE NOEUDS (SE CONTENTE DE TRASNFORMER
C        NOM DU NOEUD EN NUMERO DU NOEUD)
C EN SORTIE, ON RECUPERE UNE LISTE
C   LA LISTE EST UN OBJET JEVEUX DE NOM <NOMOBJ> CONTENANT <NBOBJ>
C   ENTIERS CORRESPONDANT AUX NUMEROS DES NOEUDS. 
C /!\ LISTE NON TRIEE ET POUVANT CONTENIR DES DOUBLES /!\
C
C
C IN  NOMA   : NOM DU MAILLAGE
C IN  MOTFAC : MOT_CLEF FACTEUR POUR LIAISON UNILATERALE
C IN  NBOCC  : NOMBRE D'OCCURRENCES MOT-CLEF FACTEUR
C IN  NONBNO : NOM DE L'OBJET JEVEUX CONTENANT NOMBRE DE NOEUDS
C               POUR CHAQUE OCCURRENCE
C IN  NOPONO : NOM DE L'OBJET JEVEUX CONTENANT LE VECTEUR D'INDIRECTION
C IN  NBTOT  : NOMBRE DE TOTAL DE NOEUDS POUR TOUTES LES OCCURRENCES
C IN  NOLINO : NOM DE L'OBJET JEVEUX CONTENANT LA LISTE DES NOEUDS
C
C -------------- DEBUT DECLARATIONS NORMALISEES JEVEUX -----------------
C
      CHARACTER*32 JEXNOM,JEXNUM
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C
C ---------------- FIN DECLARATIONS NORMALISEES JEVEUX -----------------
C
      CHARACTER*1   K1BID
      CHARACTER*8   ENTITE,K8BID
      CHARACTER*24  MAILMA,NOEUMA,GRMAMA,GRNONO,CONNEX
      INTEGER       N1,JDECAL,IBID
      INTEGER       IMA,INO,IGR,IOCC
      INTEGER       JGRMA,JGRNO,JCONX,JNN,JNL,NBNO,NBENT,JNP
      INTEGER       NUMAIL,NUNOEU,NUGRMA,NBMAIL,NUGRNO
      CHARACTER*24  NTRAV
      INTEGER       JTRAV
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C ======================================================================
C
C --- INITIALISATIONS
C
      NOEUMA = NOMA//'.NOMNOE'
      MAILMA = NOMA//'.NOMMAI'
      GRMAMA = NOMA//'.GROUPEMA'
      GRNONO = NOMA//'.GROUPENO'
      CONNEX = NOMA//'.CONNEX'
      NTRAV  = '&&EXNODE.TRAV'
      
      CALL JEVEUO(NOPONO,'L',JNP)
      CALL JEVEUO(NONBNO,'L',JNN)
      CALL JEVEUO(NOLINO,'E',JNL)
      JDECAL =1      
 
      DO 1000 IOCC=1,NBOCC
C
        NBNO = ZI(JNN-1+4*(IOCC-1)+2)
        IF (NBNO.GT.0) THEN
          CALL GETVEM(NOMA,'MAILLE',MOTFAC,'MAILLE',
     &                IOCC,1,0,K8BID,NBENT)
          NBENT = -NBENT    
          CALL JEDETR(NTRAV)
          CALL WKVECT(NTRAV,'V V K8',NBENT,JTRAV)
        
          CALL GETVEM(NOMA,'MAILLE',MOTFAC,'MAILLE',
     &                IOCC,1,NBENT,ZK8(JTRAV),IBID)        

          DO 11 IMA = 1, NBENT
            ENTITE = ZK8(JTRAV-1+IMA)
            CALL JENONU(JEXNOM(MAILMA,ENTITE),NUMAIL)
            CALL JEVEUO(JEXNUM(CONNEX,NUMAIL),'L',JCONX)
            CALL JELIRA(JEXNUM(CONNEX,NUMAIL),'LONMAX',N1,K1BID)
            DO 12 INO = 1,N1
              ZI(JNL-1+JDECAL) = ZI(JCONX-1+INO)
              JDECAL = JDECAL +1
  12        CONTINUE      
  11      CONTINUE
        ENDIF     
C       
        NBNO = ZI(JNN-1+4*(IOCC-1)+1)
        IF (NBNO.GT.0) THEN
          CALL GETVEM(NOMA,'GROUP_MA',MOTFAC,'GROUP_MA',
     &                IOCC,1,0,K8BID,NBENT)
          NBENT = -NBENT    
          CALL JEDETR(NTRAV)
          CALL WKVECT(NTRAV,'V V K8',NBENT,JTRAV)
        
          CALL GETVEM(NOMA,'GROUP_MA',MOTFAC,'GROUP_MA',
     &                IOCC,1,NBENT,ZK8(JTRAV),IBID)        

          DO 30 IGR = 1, NBENT
            ENTITE = ZK8(JTRAV-1+IGR)

            CALL JENONU(JEXNOM(GRMAMA,ENTITE),NUGRMA)
            CALL JELIRA(JEXNUM(GRMAMA,NUGRMA),'LONMAX',NBMAIL,K1BID)
            CALL JEVEUO(JEXNOM(GRMAMA,ENTITE),'L',JGRMA)

            DO 31 IMA = 1, NBMAIL
              NUMAIL = ZI(JGRMA-1+IMA)
              CALL JEVEUO(JEXNUM(CONNEX,NUMAIL),'L',JCONX)
              CALL JELIRA(JEXNUM(CONNEX,NUMAIL),'LONMAX',N1,K1BID)
              DO 32 INO = 1,N1
                ZI(JNL-1+JDECAL) = ZI(JCONX-1+INO)
                JDECAL = JDECAL +1
  32          CONTINUE      
  31        CONTINUE
  30      CONTINUE
        ENDIF
C         
        NBNO = ZI(JNN-1+4*(IOCC-1)+3)
        IF (NBNO.GT.0) THEN
          CALL GETVEM(NOMA,'GROUP_NO',MOTFAC,'GROUP_NO',
     &                IOCC,1,0,K8BID,NBENT)
          NBENT = -NBENT    
          CALL JEDETR(NTRAV)
          CALL WKVECT(NTRAV,'V V K8',NBENT,JTRAV)
        
          CALL GETVEM(NOMA,'GROUP_NO',MOTFAC,'GROUP_NO',
     &                IOCC,1,NBENT,ZK8(JTRAV),IBID)        

          DO 50 IGR = 1, NBENT
            ENTITE = ZK8(JTRAV-1+IGR)
            CALL JENONU(JEXNOM(GRNONO,ENTITE),NUGRNO)
            CALL JELIRA(JEXNUM(GRNONO,NUGRNO),'LONMAX',N1,K1BID)
            CALL JEVEUO(JEXNOM(GRNONO,ENTITE),'L',JGRNO)
            DO 51 INO = 1,N1
              ZI(JNL-1+JDECAL) = ZI(JGRNO-1+INO)
              JDECAL = JDECAL +1
  51        CONTINUE      
  50      CONTINUE
        ENDIF

        NBNO = ZI(JNN-1+4*(IOCC-1)+4)
         
        IF (NBNO.GT.0) THEN      
          NBENT = NBNO    
          CALL JEDETR(NTRAV)
          CALL WKVECT(NTRAV,'V V K8',NBENT,JTRAV)
        
          CALL GETVEM(NOMA,'NOEUD',MOTFAC,'NOEUD',
     &                IOCC,1,NBENT,ZK8(JTRAV),IBID)        

          DO 60 INO = 1, NBENT
            ENTITE = ZK8(JTRAV-1+INO)
            
            CALL JENONU(JEXNOM(NOEUMA,ENTITE),NUNOEU)
            ZI(JNL-1+JDECAL) = NUNOEU
            JDECAL = JDECAL +1
  60      CONTINUE
        ENDIF
 1000 CONTINUE
     
C ======================================================================
      CALL JEDETR(NTRAV)
      CALL JEDEMA()
C
      END
