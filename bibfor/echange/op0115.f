      SUBROUTINE OP0115()
      IMPLICIT NONE
      INCLUDE 'jeveux.h'
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ECHANGE  DATE 24/07/2012   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C     ------------------------------------------------------------------
C     DEFINITION D'UNE MATRICE INTERSPECTRALE (DEFI_INTE_SPEC)
C     ------------------------------------------------------------------
      INTEGER       IOCPF,IOCKT,IOCCS,IARG
      INTEGER       IPF,IFONC,INUM,IFREQ,IKT,ICS,ISPEC
      INTEGER       MXVAL,IBID,NBABS,NBFREQ,NBVAL
      INTEGER       LNUMI,LNUMJ,LFONC,LVALE,LPROL,LFREQ,LREFE,NBVALR
      INTEGER      LNOEI,LNOEJ,LCMPI,LCMPJ,N2,N3,NUMI,N4,N5,N6,N7

      REAL*8 VALR,FMOY,ARED,FMIN,FMAX,PAS,FREQ,R8DEPI,DEPI,NUM,DEN,RBID

      COMPLEX*16    VALC

      CHARACTER*8   NOMU,FONC,K8BID,TFONC,NOMREF,NOEI
      CHARACTER*16  CONCEP,NOMCMD,MOTFAC(3)
      CHARACTER*19  CHFONC
      CHARACTER*24  CHNUMI,CHNUMJ,CHFREQ,CHVALE
      CHARACTER*24  CHNOEI,CHNOEJ,CHCMPI,CHCMPJ
C
C     ------------------------------------------------------------------
C
      CALL JEMARQ()
C
      CALL GETRES ( NOMU, CONCEP, NOMCMD )

      NOMREF=NOMU(1:8)

      MOTFAC(1) = 'PAR_FONCTION'
      MOTFAC(2) = 'KANAI_TAJIMI'
      MOTFAC(3) = 'CONSTANT'

      CALL GETFAC(MOTFAC(1),IOCPF)
      CALL GETFAC(MOTFAC(2),IOCKT)
      CALL GETFAC(MOTFAC(3),IOCCS)

      MXVAL = IOCPF+IOCKT+IOCCS

      CALL WKVECT(NOMREF//'.REFE','G V K16',2,LREFE)
      ZK16(LREFE) = 'DSP'
      ZK16(LREFE+1) = 'TOUT'

      CALL WKVECT('&&FONC','V V K8',MXVAL,LFONC)
      CHVALE = NOMREF//'.VALE'
      CALL JECREC(CHVALE,'G V R','NU','DISPERSE','VARIABLE',MXVAL)
      CHFREQ = NOMREF//'.FREQ'

      K8BID = 'BIDON'
      DO 10 IPF = 1,IOCPF
        IF (IPF .EQ. 1) THEN
          CALL GETVTX(MOTFAC(1),'NOEUD_I',IPF,IARG,0,NOEI,N2)
          CALL GETVIS(MOTFAC(1),'NUME_ORDRE_I',IPF,IARG,0,NUMI,N3)

          IF (N2 .LT. 0) THEN
            CHNOEI = NOMREF//'.NOEI'
            CHNOEJ = NOMREF//'.NOEJ'
            CHCMPI = NOMREF//'.CMPI'
            CHCMPJ = NOMREF//'.CMPJ'
            CALL WKVECT(CHNOEI,'G V K8',MXVAL,LNOEI)
            CALL WKVECT(CHNOEJ,'G V K8',MXVAL,LNOEJ)
            CALL WKVECT(CHCMPI,'G V K8',MXVAL,LCMPI)
            CALL WKVECT(CHCMPJ,'G V K8',MXVAL,LCMPJ)
          ELSEIF (N3 .LT. 0) THEN
            CHNUMI = NOMREF//'.NUMI'
            CHNUMJ = NOMREF//'.NUMJ'
            CALL WKVECT(CHNUMI,'G V I',MXVAL,LNUMI)
            CALL WKVECT(CHNUMJ,'G V I',MXVAL,LNUMJ)
          ENDIF
        ENDIF

        IF (N2 .LT. 0) THEN
          CALL GETVTX(MOTFAC(1),'NOEUD_I',IPF,IARG,
     &              1,ZK8(LNOEI-1+IPF),NBVAL)
          CALL GETVTX(MOTFAC(1),'NOEUD_J',IPF,IARG,
     &              1,ZK8(LNOEJ-1+IPF),NBVAL)
          CALL GETVTX(MOTFAC(1),'NOM_CMP_I',IPF,IARG,
     &              1,ZK8(LCMPI-1+IPF),NBVAL)
          CALL GETVTX(MOTFAC(1),'NOM_CMP_J',IPF,IARG,
     &              1,ZK8(LCMPJ-1+IPF),NBVAL)
        ELSEIF (N3 .LT. 0) THEN
          CALL GETVIS(MOTFAC(1),'NUME_ORDRE_I',IPF,IARG,
     &              1,ZI(LNUMI-1+IPF),NBVAL)
          CALL GETVIS(MOTFAC(1),'NUME_ORDRE_J',IPF,IARG,
     &              1,ZI(LNUMJ-1+IPF),NBVAL)
        ENDIF

        CALL GETVID(MOTFAC(1),'FONCTION',IPF,IARG,
     &              1,ZK8(LFONC-1+IPF),NBVAL)
10    CONTINUE

      DO 110 IFONC = 1,IOCPF
        FONC = ZK8(LFONC-1+IFONC)
        CHFONC = FONC//'           '
        CALL JEVEUO(CHFONC//'.VALE','L',LVALE)
        CALL JELIRA(CHFONC//'.VALE','LONMAX',NBVAL,K8BID)
        CALL JEVEUO(CHFONC//'.PROL','L',LPROL)
        TFONC = ZK24(LPROL)(1:8)
        IF (TFONC .EQ. 'FONCTION') NBFREQ = NBVAL/2
        IF (TFONC .EQ. 'FONCT_C') NBFREQ = NBVAL/3
        IF (N2 .LT. 0) THEN
         IF ((ZK8(LNOEI-1+IFONC) .EQ. ZK8(LNOEI-1+IFONC)) .AND.
     &       (ZK8(LCMPI-1+IFONC) .EQ. ZK8(LCMPI-1+IFONC))) THEN
          NBABS = NBFREQ
         ELSE
          NBABS = NBFREQ*2
         ENDIF
        ELSEIF (N3 .LT. 0) THEN
         IF (ZI(LNUMI-1+IFONC) .EQ. ZI(LNUMJ-1+IFONC)) THEN
           NBABS = NBFREQ
         ELSE
           NBABS = 2*NBFREQ
         ENDIF
        ENDIF
        CALL JECROC(JEXNUM(CHVALE,IFONC))
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONMAX',NBABS,' ')
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONUTI',NBABS,' ')
        CALL JEVEUO(JEXNUM(CHVALE,IFONC),'E',ISPEC)
        IF (N2 .LT. 0) THEN
         IF ((ZK8(LNOEI-1+IFONC) .EQ. ZK8(LNOEI-1+IFONC)) .AND.
     &       (ZK8(LCMPI-1+IFONC) .EQ. ZK8(LCMPI-1+IFONC))
     &         .AND. (TFONC .EQ. 'FONCT_C')) THEN
          DO 107 INUM = 1,NBABS
            ZR(ISPEC-1+INUM) = ZR(LVALE-1+NBFREQ+2*(INUM-1)+1)
107       CONTINUE
         ELSE
          NBABS = NBVAL - NBFREQ
          DO 109 INUM = 1,NBABS
            ZR(ISPEC-1+INUM) = ZR(LVALE-1+NBFREQ+INUM)
109       CONTINUE
         ENDIF
        ELSEIF (N3 .LT. 0) THEN
         IF ((ZI(LNUMI-1+IFONC) .EQ. ZI(LNUMJ-1+IFONC))
     &         .AND. (TFONC .EQ. 'FONCT_C')) THEN
          DO 103 INUM = 1,NBABS
            ZR(ISPEC-1+INUM) = ZR(LVALE-1+NBFREQ+2*(INUM-1)+1)
103       CONTINUE
         ELSE
          NBABS = NBVAL - NBFREQ
          DO 105 INUM = 1,NBABS
            ZR(ISPEC-1+INUM) = ZR(LVALE-1+NBFREQ+INUM)
105       CONTINUE
         ENDIF
        ENDIF
110   CONTINUE
      IF (IOCPF .GT. 0) THEN
        CALL JEEXIN(CHFREQ,IBID)
        IF (IBID .EQ. 0) THEN
          CALL WKVECT(CHFREQ,'G V R',NBFREQ,LFREQ)
          DO 104 IFREQ = 1,NBFREQ
            ZR(LFREQ-1+IFREQ) = ZR(LVALE-1+IFREQ)
104       CONTINUE
        ENDIF
      ENDIF

      DEPI = R8DEPI()

      DO 20 IKT = 1,IOCKT
        IF (IKT .EQ. 1) THEN
          CALL GETVTX(MOTFAC(2),'NOEUD_I',IKT,IARG,0,NOEI,N4)
          CALL GETVIS(MOTFAC(2),'NUME_ORDRE_I',IKT,IARG,0,NUMI,N5)

          IF (N4 .LT. 0) THEN
            CHNOEI = NOMREF//'.NOEI'
            CHNOEJ = NOMREF//'.NOEJ'
            CHCMPI = NOMREF//'.CMPI'
            CHCMPJ = NOMREF//'.CMPJ'
            CALL JEEXIN(CHNOEI,N6)
            IF (N6 .EQ. 0) THEN
              CALL WKVECT(CHNOEI,'G V K8',MXVAL,LNOEI)
              CALL WKVECT(CHNOEJ,'G V K8',MXVAL,LNOEJ)
              CALL WKVECT(CHCMPI,'G V K8',MXVAL,LCMPI)
              CALL WKVECT(CHCMPJ,'G V K8',MXVAL,LCMPJ)
            ENDIF
          ELSEIF (N5 .LT. 0) THEN
            CHNUMI = NOMREF//'.NUMI'
            CHNUMJ = NOMREF//'.NUMJ'
            CALL JEEXIN(CHNUMI,N7)
            IF (N7 .EQ. 0) THEN
              CALL WKVECT(CHNUMI,'G V I',MXVAL,LNUMI)
              CALL WKVECT(CHNUMJ,'G V I',MXVAL,LNUMJ)
            ENDIF
          ENDIF
        ENDIF

        IF (N4 .LT. 0) THEN
          CALL GETVTX(MOTFAC(2),'NOEUD_I',IKT,IARG,
     &              1,ZK8(LNOEI-1+IOCPF+IKT),NBVAL)
          CALL GETVTX(MOTFAC(2),'NOEUD_J',IKT,IARG,
     &              1,ZK8(LNOEJ-1+IOCPF+IKT),NBVAL)
          CALL GETVTX(MOTFAC(2),'NOM_CMP_I',IKT,IARG,
     &              1,ZK8(LCMPI-1+IOCPF+IKT),NBVAL)
          CALL GETVTX(MOTFAC(2),'NOM_CMP_J',IKT,IARG,
     &              1,ZK8(LCMPJ-1+IOCPF+IKT),NBVAL)
        ELSEIF (N5 .LT. 0) THEN
          CALL GETVIS(MOTFAC(2),'NUME_ORDRE_I',IKT,IARG,
     &              1,ZI(LNUMI-1+IOCPF+IKT),NBVAL)
          CALL GETVIS(MOTFAC(2),'NUME_ORDRE_J',IKT,IARG,
     &              1,ZI(LNUMJ-1+IOCPF+IKT),NBVAL)
        ENDIF
        NBVALR = 0
        CALL GETVR8(MOTFAC(2),'VALE_R',IKT,IARG,0,VALR,NBVALR)
        IF (NBVALR .LT. 0) THEN
          CALL GETVR8(MOTFAC(2),'VALE_R',IKT,IARG,1,VALR,NBVAL)
        ELSE
          CALL GETVC8(MOTFAC(2),'VALE_C',IKT,IARG,1,VALC,NBVAL)
C ON NE RETIENT QUE LA PARTIE REELLE
          VALR = DBLE(VALC)
        ENDIF
        CALL GETVR8(MOTFAC(2),'FREQ_MOY',IKT,IARG,1,FMOY,NBVAL)
        CALL GETVR8(MOTFAC(2),'AMOR_REDUIT',IKT,IARG,1,ARED,NBVAL)
        CALL GETVR8(MOTFAC(2),'FREQ_MIN',IKT,IARG,1,FMIN,NBVAL)
        CALL GETVR8(MOTFAC(2),'FREQ_MAX',IKT,IARG,1,FMAX,NBVAL)
        CALL GETVR8(MOTFAC(2),'PAS',IKT,IARG,1,PAS,NBVAL)
        IF (FMAX .LT. FMIN) CALL U2MESK('F','SPECTRAL0_2',1,MOTFAC(2))
        NBFREQ=INT((FMAX-FMIN)/PAS) + 1
        IFONC = IOCPF + IKT
        CALL JECROC(JEXNUM(CHVALE,IFONC))
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONMAX',NBFREQ,' ')
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONUTI',NBFREQ,' ')
        CALL JEVEUO(JEXNUM(CHVALE,IFONC),'E',ISPEC)
        DO 210 IFREQ = 1,NBFREQ
          FREQ = FMIN + PAS*(IFREQ-1)
          IF (IFREQ .EQ. NBFREQ) FREQ = FMAX
          RBID = 4.0D0*ARED*ARED*FMOY*FMOY*FREQ*FREQ
          NUM = RBID+FMOY*FMOY*FMOY*FMOY
          DEN = FMOY*FMOY-FREQ*FREQ
          DEN = DEN*DEN+RBID
          ZR(ISPEC-1+IFREQ) = DEPI*VALR*NUM/DEN
210     CONTINUE
20    CONTINUE

      DO 30 ICS = 1,IOCCS
        IF (ICS .EQ. 1) THEN
          CALL GETVTX(MOTFAC(3),'NOEUD_I',ICS,IARG,0,NOEI,N6)
          CALL GETVIS(MOTFAC(3),'NUME_ORDRE_I',ICS,IARG,0,NUMI,N7)

          IF (N6 .LT. 0) THEN
            CHNOEI = NOMREF//'.NOEI'
            CHNOEJ = NOMREF//'.NOEJ'
            CHCMPI = NOMREF//'.CMPI'
            CHCMPJ = NOMREF//'.CMPJ'
            CALL JEEXIN(CHNOEI,N4)
            IF (N4 .EQ. 0) THEN
              CALL WKVECT(CHNOEI,'G V K8',MXVAL,LNOEI)
              CALL WKVECT(CHNOEJ,'G V K8',MXVAL,LNOEJ)
              CALL WKVECT(CHCMPI,'G V K8',MXVAL,LCMPI)
              CALL WKVECT(CHCMPJ,'G V K8',MXVAL,LCMPJ)
            ENDIF
          ELSEIF (N7 .LT. 0) THEN
            CHNUMI = NOMREF//'.NUMI'
            CHNUMJ = NOMREF//'.NUMJ'
            CALL JEEXIN(CHNUMI,N5)
            IF (N5 .EQ. 0) THEN
              CALL WKVECT(CHNUMI,'G V I',MXVAL,LNUMI)
              CALL WKVECT(CHNUMJ,'G V I',MXVAL,LNUMJ)
            ENDIF
          ENDIF
        ENDIF

        IF (N6 .LT. 0) THEN
          CALL GETVTX(MOTFAC(3),'NOEUD_I',ICS,IARG,
     &              1,ZK8(LNOEI-1+IOCPF+IOCKT+ICS),NBVAL)
          CALL GETVTX(MOTFAC(3),'NOEUD_J',ICS,IARG,
     &              1,ZK8(LNOEJ-1+IOCPF+IOCKT+ICS),NBVAL)
          CALL GETVTX(MOTFAC(3),'NOM_CMP_I',ICS,IARG,
     &              1,ZK8(LCMPI-1+IOCPF+IOCKT+ICS),NBVAL)
          CALL GETVTX(MOTFAC(3),'NOM_CMP_J',ICS,IARG,
     &              1,ZK8(LCMPJ-1+IOCPF+IOCKT+ICS),NBVAL)
        ELSEIF (N7 .LT. 0) THEN
          CALL GETVIS(MOTFAC(3),'NUME_ORDRE_I',ICS,IARG,
     &              1,ZI(LNUMI-1+IOCPF+IOCKT+ICS),NBVAL)
          CALL GETVIS(MOTFAC(3),'NUME_ORDRE_J',ICS,IARG,
     &              1,ZI(LNUMJ-1+IOCPF+IOCKT+ICS),NBVAL)
        ENDIF
        IFONC = IOCPF + IOCKT +ICS
        NBVALR = 0
        CALL GETVR8(MOTFAC(3),'VALE_R',ICS,IARG,0,VALR,NBVALR)
        IF (NBVALR .LT. 0) THEN
          CALL GETVR8(MOTFAC(3),'VALE_R',ICS,IARG,1,VALR,NBVAL)
        ELSE
          CALL GETVC8(MOTFAC(3),'VALE_C',ICS,IARG,1,VALC,NBVAL)
        ENDIF
        CALL GETVR8(MOTFAC(3),'FREQ_MIN',ICS,IARG,1,FMIN,NBVAL)
        CALL GETVR8(MOTFAC(3),'FREQ_MAX',ICS,IARG,1,FMAX,NBVAL)
        CALL GETVR8(MOTFAC(3),'PAS',ICS,IARG,1,PAS,NBVAL)
        IF (FMAX .LT. FMIN) CALL U2MESK('F','SPECTRAL0_2',1,MOTFAC(3))
        NBFREQ=INT((FMAX-FMIN)/PAS) + 1
        IF (N6 .LT. 0) THEN
         IF ((ZK8(LNOEI-1+IFONC) .EQ. ZK8(LNOEI-1+IFONC)) .AND.
     &       (ZK8(LCMPI-1+IFONC) .EQ. ZK8(LCMPI-1+IFONC))) THEN
          NBABS = NBFREQ
         ELSE
          NBABS = NBFREQ*2
         ENDIF
        ELSEIF (N7 .LT. 0) THEN
         IF (ZI(LNUMI-1+IFONC) .EQ. ZI(LNUMJ-1+IFONC)) THEN
          NBABS = NBFREQ
         ELSE
          NBABS = NBFREQ*2
         ENDIF
        ENDIF
        CALL JECROC(JEXNUM(CHVALE,IFONC))
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONMAX',NBABS,' ')
        CALL JEECRA(JEXNUM(CHVALE,IFONC),'LONUTI',NBABS,' ')
        CALL JEVEUO(JEXNUM(CHVALE,IFONC),'E',ISPEC)
        DO 310 IFREQ = 1,NBFREQ
          IF (ZI(LNUMI-1+IFONC) .EQ. ZI(LNUMJ-1+IFONC)) THEN
            IF (NBVALR .LT. 0) THEN
              ZR(ISPEC-1+IFREQ) = VALR
            ELSE
              ZR(ISPEC-1+IFREQ) = DBLE(VALC)
            ENDIF
          ELSE
            IF (NBVALR .LT. 0) THEN
              ZR(ISPEC-1+2*IFREQ-1) = VALR
              ZR(ISPEC-1+2*IFREQ) = 0.D0
            ELSE
              ZR(ISPEC-1+2*IFREQ-1) = DBLE(VALC)
              ZR(ISPEC-1+2*IFREQ) = DIMAG(VALC)
            ENDIF
          ENDIF
310     CONTINUE
30    CONTINUE

      IF ((IOCKT .GT. 0) .OR. (IOCCS .GT. 0)) THEN
        CALL JEEXIN(CHFREQ,IBID)
        IF (IBID .EQ. 0) THEN
          CALL WKVECT(CHFREQ,'G V R',NBFREQ,LFREQ)
          DO 204 IFREQ = 1,NBFREQ
            FREQ = FMIN + PAS*(IFREQ-1)
            IF (IFREQ .EQ. NBFREQ) FREQ = FMAX
            ZR(LFREQ-1+IFREQ) = FREQ
204       CONTINUE
        ENDIF
      ENDIF

      CALL TITRE

      CALL JEDEMA()
      END
