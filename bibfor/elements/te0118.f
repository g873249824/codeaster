      SUBROUTINE TE0118(OPTION,NOMTE)
      

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ELEMENTS  DATE 09/05/2006   AUTEUR MASSIN P.MASSIN 
C ======================================================================
C COPYRIGHT (C) 1991 - 2006  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C ----------------------------------------------------------------------
C      OPTION  :  'CFL_XFEM'  
C
C  FONCTION REALISEE:  
C      DANS LE CADRE X-FEM, POUR CHAQUE ELEMENT, CALCUL DE LA LONGUEUR
C      D'ARETE MINIMALE ET DE LA CONDITION CFL POUR LA PROPAGATION DES
C      LEVELSETS, ET POUR CHAQUE NOEUD, DE L'ARETE DE LONGUEUR MAXIMALE
C      DONT IL EST SOMMET
C
C    - ARGUMENTS:
C        DONNEES:      OPTION       -->  OPTION DE CALCUL
C                      NOMTE        -->  NOM DU TYPE ELEMENT
C
C --------- DEBUT DECLARATIONS NORMALISEES  JEVEUX ---------------------

      IMPLICIT NONE
      CHARACTER*16 OPTION,NOMTE
      CHARACTER*32 JEXNUM,JEXNOM,JEXR8,JEXATR
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C --------- FIN  DECLARATIONS  NORMALISEES  JEVEUX ---------------------

      INTEGER I,J,IBID,ILC,ICFL,IGEOM,IVTNO,NDIM,NNOS
      REAL*8  DMIN,DISTIJ,XI,YI,ZII,XJ,YJ,ZJ,VTI,VTMAX

C DEBUT ----------------------------------------------------------------
      CALL JEMARQ()
    
C     RECUPERATION DES COORDONNEES DES NOEUDS
      CALL JEVECH('PGEOMER','L',IGEOM)
      CALL ELREF4(' ','RIGI',NDIM,IBID,NNOS,IBID,IBID,IBID,IBID,IBID)

C     RECUPERATION DU CHAMP VT AUX NOEUDS
      CALL JEVECH('PVTNO','L',IVTNO)
      CALL JEVECH('PLONCAR','E',ILC)
      CALL JEVECH('PCFLVT','E',ICFL)

C     CALCUL DE LA PLUS PETITE DISTANCE ENTRE LES NOEUDS SOMMETS
      DMIN = SQRT((ZR(IGEOM-1+NDIM*(2-1)+1)-ZR(IGEOM-1+1))**2
     &           +(ZR(IGEOM-1+NDIM*(2-1)+2)-ZR(IGEOM-1+2))**2
     &           +(ZR(IGEOM-1+NDIM*(2-1)+3)-ZR(IGEOM-1+3))**2)
      
      VTMAX = 0.D0
      
C     BOUCLE SUR LES NOEUDS SOMMETS
      DO 10 I=1,NNOS
         XI = ZR(IGEOM-1+NDIM*(I-1)+1)
         YI = ZR(IGEOM-1+NDIM*(I-1)+2)
         ZII = ZR(IGEOM-1+NDIM*(I-1)+3)
         
C     ON CHERCHE LE NOEUDS SOMMET LE PLUS PROCHE
        DO 20 J=I+1,NNOS
         XJ = ZR(IGEOM-1+NDIM*(J-1)+1)
         YJ = ZR(IGEOM-1+NDIM*(J-1)+2)
         ZJ = ZR(IGEOM-1+NDIM*(J-1)+3)
         
         DISTIJ = SQRT((XJ-XI)**2+(YJ-YI)**2+(ZJ-ZII)**2)
         IF ((DISTIJ.LE.DMIN).AND.(DISTIJ.NE.0))  DMIN = DISTIJ
            
 20     CONTINUE

C     ON CHERCHE LE NOEUDS SOMMET OU VT EST MAXIMALE
         VTI = ZR(IVTNO+I-1)
         VTMAX = MAX(VTI,VTMAX)

 10   CONTINUE
 
      ZR(ILC) = DMIN
      ZR(ICFL) = DMIN / VTMAX

C FIN ------------------------------------------------------------------
      CALL JEDEMA()
      END
