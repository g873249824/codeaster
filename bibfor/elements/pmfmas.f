      SUBROUTINE PMFMAS(NOMTE,ICDMAT,KANL,MLV)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ELEMENTS  DATE 26/03/2013   AUTEUR CHEIGNON E.CHEIGNON 
C ======================================================================
C COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
      IMPLICIT NONE
      INCLUDE 'jeveux.h'
      CHARACTER*(*) NOMTE
      REAL*8 MLV(*)
      INTEGER KANL,ICDMAT
C     ------------------------------------------------------------------
C     CALCULE LA MATRICE DE MASSE DES ELEMENTS DE POUTRE MULTIFIBRES

C IN  NOMTE : NOM DU TYPE ELEMENT
C             'MECA_POU_D_EM'
C             'MECA_POU_D_TGM'
C     ------------------------------------------------------------------

      CHARACTER*8  NOMAIL
      CHARACTER*16 CH16
      INTEGER LX,IADZI,IAZK24,ITYPE,I,ISTRUC
      INTEGER INBFIB,NBFIB,JACF,LSECT
      REAL*8 CASRHO(6),XL,RBID,R8PREM,CARS1(6)
      REAL*8 MATP1(105),A,XIY,XIZ,RHO,CASECE(6),G,E
      REAL*8 ALFAY,ALFAZ,EY,EZ
C     ------------------------------------------------------------------


C        --- POUTRE DROITE D'EULER A 6 DDL ---
      IF ((NOMTE .NE. 'MECA_POU_D_EM').AND.
     &    (NOMTE .NE. 'MECA_POU_D_TGM')) THEN
        CH16 = NOMTE
        CALL U2MESK('F','ELEMENTS2_42',1,CH16)
      END IF

C     --- RECUPERATION DES COORDONNEES DES NOEUDS ---
      CALL JEVECH('PGEOMER','L',LX)
      LX = LX - 1
      XL = SQRT((ZR(LX+4)-ZR(LX+1))**2+ (ZR(LX+5)-ZR(LX+2))**2+
     &     (ZR(LX+6)-ZR(LX+3))**2)
      IF (XL.LE.R8PREM()) THEN
        CALL TECAEL(IADZI,IAZK24)
        NOMAIL = ZK24(IAZK24-1+3)(1:8)
        CALL U2MESK('F','ELEMENTS2_43',1,NOMAIL)
      END IF

C     --- APPEL INTEGRATION SUR SECTION
      CALL PMFITX(ICDMAT,2,CASRHO,RBID)

      IF (NOMTE .EQ.'MECA_POU_D_EM') THEN

C       --- CALCUL DE LA MATRICE DE MASSE LOCALE
        CALL PMFM01(KANL,XL,CASRHO,MLV)

      ELSEIF (NOMTE .EQ.'MECA_POU_D_TGM') THEN

        CALL JEVECH('PNBSP_I','L',INBFIB)
        NBFIB = ZI(INBFIB)
        CALL JEVECH('PFIBRES','L',JACF)
        CALL JEVECH('PCAGNPO','L',LSECT)
        LSECT = LSECT - 1
        ALFAY = ZR(LSECT+4)
        ALFAZ = ZR(LSECT+5)
        EY = -ZR(LSECT+6)
        EZ = -ZR(LSECT+7)


        CALL PMFITG(NBFIB,3,ZR(JACF),CARS1)
        A = CARS1(1)
        XIY = CARS1(5)
        XIZ = CARS1(4)

        RHO = CASRHO(1)/A

        ITYPE  = 0
        ISTRUC = 1

C    --- APPEL INTEGRATION SUR SECTION
         CALL PMFITX(ICDMAT,1,CASECE,G)

         E = CASECE(1)/A

        DO 20 I = 1 , 105
            MATP1(I) = 0.0D0
20       CONTINUE
        CALL PTMA01(KANL,ITYPE,MATP1,ISTRUC,RHO,E,A,A,XL,XIY,XIY,XIZ,
     &                XIZ,G,ALFAY,ALFAY,ALFAZ,ALFAZ,EY,EZ )

        CALL MASSTG(MATP1,MLV)

      ENDIF



      END
