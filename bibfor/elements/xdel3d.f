      SUBROUTINE  XDEL3D(ELREFP,DDLH,INO,NNOP,PINTT,DEPL,DEPR,IGEOM,HE,
     &                   DEPLA)

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ELEMENTS  DATE 13/10/2005   AUTEUR GENIAUT S.GENIAUT 
C ======================================================================
C COPYRIGHT (C) 1991 - 2005  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE GENIAUT S.GENIAUT
C
      IMPLICIT NONE
C     ----- DEBUT COMMUNS NORMALISES  JEVEUX  --------------------------
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
      CHARACTER*32 JEXNUM,JEXNOM
C
C.......................................................................
C
C     BUT:  CALCUL DES DEPLACEMENTs AUX NOEUDS DES TETRAEDRES 
C           (SOUS-ELEMENTS)
C.......................................................................
C IN  ELREFP  : ÉLÉMENT DE RÉFÉRENCE PARENT
C IN  DDLH    : NOMBRE DE DDL HEAVYSIDE (PAR NOEUD)
C IN  INO     : NUMERO DU NOEUD
C IN  NNOP    : NOMBRE DE NOEUDS DE L'ELEMENT PARENT
C IN  PINTT   : COORDONNÉES DES POINTS D'INTERSECTION
C IN  DEPL    : DEPLACEMENTS 
C IN  IGEOM   : COORDONNÉES DES NOEUDS DE L'ÉLÉMENT PARENT
C IN  HE      : VALEUR DE LA FONCTION HEAVYSIDE CSTE LE SS-ÉLT

C OUT DEPLA   : VALEUR DES DEPLACEMENTS AU NOEUD DU SOUS-ELEMENTS
C..............................................................
C
      INTEGER INO, NNOP, HE, DDLH, IN, IGEOM, ID,IADZI,IAZK24,NDIM
      INTEGER IBI
      REAL*8  PINTT(3*11),GRAD(3,3)
      REAL*8  DEPR(3),DEPLA(3)
      REAL*8 F(3,3),EPS(6),XN(3),FF(NNOP),DEPL(9*NNOP)
      REAL*8 DFDI(NNOP,3),XE(3),R0(9,NNOP),R1,R2(4),R3(4,3)
      CHARACTER*8 ELREFP
      PARAMETER (NDIM=3)
C
      CALL JEMARQ()
C
      CALL LCINVN(3,0.D0,DEPR)
      CALL TECAEL(IADZI,IAZK24)
C
      IF(INO.LT.1000) THEN
         ID = 9*(INO-1)
         DEPR(1) = DEPL(1+ID) + HE * DEPL(4+ID)
         DEPR(2) = DEPL(2+ID) + HE * DEPL(5+ID)
         DEPR(3) = DEPL(3+ID) + HE * DEPL(6+ID)
      ELSE
C NOEUD D'INTERSECTION
         XN(1) = PINTT(3*(INO-1000-1)+1)
         XN(2) = PINTT(3*(INO-1000-1)+2)
         XN(3) = PINTT(3*(INO-1000-1)+3)   
     
         CALL REEREF(ELREFP,NNOP,IGEOM,XN,R0,.FALSE.,NDIM,R1,IBI,IBI,
     &               IBI,R2,R3,'NON',XE,FF,DFDI,F,EPS,GRAD)

         DO 10 IN=1,NNOP
            ID = 9*(IN-1)
            DEPR(1) =  DEPR(1) + 
     &           FF(IN)*(DEPL(1+ID) + HE*DEPL(4+ID))
            DEPR(2) =  DEPR(2) + 
     &           FF(IN)*(DEPL(2+ID) + HE*DEPL(5+ID))
            DEPR(3) =  DEPR(3) + 
     &           FF(IN)*(DEPL(3+ID) + HE*DEPL(6+ID))
 10      CONTINUE
      ENDIF
C
      DEPLA(1)= DEPR(1)
      DEPLA(2)= DEPR(2)
      DEPLA(3)= DEPR(3)
C
      CALL JEDEMA()

      END
