      SUBROUTINE VERIS3(LOBJAV,LOBJAP)
      IMPLICIT NONE
      CHARACTER*(*) LOBJAV,LOBJAP
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF UTILITAI  DATE 13/12/2006   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2006  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C     ----- DEBUT COMMUNS NORMALISES  JEVEUX  --------------------------
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
      CHARACTER*32 JEXNUM,JEXNOM,JEXATR,JEXR8
C     ----- FIN COMMUNS NORMALISES  JEVEUX  ----------------------------

C     COMMON VERIJK : POUR ETABLIR LE CATALOGUE A PARTIR DE LA REALITE
C                     DES TESTS.
C     PRCATA : 'OUI' : IL FAUT IMPRIMER LES CARACTERISTIQUES DES
C                      OBJETS TROUVES.
C              'NON' : ON N'IMPRIME RIEN
C     DERNSD : TYPE DE LA SD DE PLUS BAS NIVEAU (PARCOURS DE L'ARBRE)
      CHARACTER*16 DERNSD,PRCATA
      COMMON /VERIJK/DERNSD,PRCATA

      INTEGER          ISDVER
      COMMON /DEBUI1/  ISDVER
      INTEGER NBOBJ,IOBJ

      CHARACTER*16 SDP, SDU,NOMCMD
      CHARACTER*8 NOMSD ,KBID,NOMS2
      CHARACTER*19 CH19
      CHARACTER*24 NOMOBJ,LISTON,LISTOV,MEMO80,VALK(2)
      INTEGER NAV,NAP,N1,J1,J2,NVU,K,K2,IEXI,J3,N3,NTROU,NOBJ
      LOGICAL LSENSI,LNOMI
C ----------------------------------------------------------------------
C    POUR VERIFIER LA SD PRODUITE PAR LA COMMANDE COURANTE
C ----------------------------------------------------------------------
C     IF (ISDVER.NE.1) GO TO 9999
      NOMSD=' '
      SDU=' '
      NOMCMD=' '
      CALL GETRES(NOMSD,SDU,NOMCMD)
C     AJACOT :
C     PRCATA='OUI'/'NON' : pour imprimer les caracteristiques des objets
C                          jeveux rencontres et permettre de produire
C                          un catalogue de SD a partir de l'existant
      PRCATA='OUI'
      PRCATA='NON'

C     -- SI LA COMMANDE PRODUIT UN RESULTAT :
      IF (NOMSD.NE.' ') THEN


C        1- QUEL EST LE TYPE DE SD_PROGRAMMEUR ?
         CALL VERIJC(SDU,SDP)



C        2- VERIFICATION DE LA SD_PROGRAMMEUR :
C        -----------------------------------------------------
         MEMO80='&&VERIS3.MEMO80'
         CALL WKVECT(MEMO80,'V V K80',200,J2)

C        -- LA SENSIBILITE POSE DES PROBLEMES PARTICULIERS :
         CALL JEEXIN('&NOSENSI.MEMO.CORR',IEXI)
         LSENSI=IEXI.GT.0

         LNOMI=.TRUE.
         IF (LSENSI.AND.NOMCMD.EQ.'POST_RELEVE_T') THEN
C            SI POST_RELEVE_T ET SENSIBILITE, ON NE CREE PAS TOUJOURS
C            LE CONCEPT NOMINAL :
             CH19=NOMSD
             CALL JEEXIN(CH19//'.TBBA',IEXI)
             IF (IEXI.EQ.0) LNOMI=.FALSE.
         ENDIF

C        -- VERIFICATION DU CONCEPT NOMINAL :
         IF (LNOMI) THEN
           CALL VERISD(SDP,NOMSD)
         ENDIF

C        -- SI SENSIBILITE, CA M'ENERVE, JE LAISSE TOMBER LE CONTROLE
C           DES CONCEPTS DERIVES ...
         IF (.FALSE.) THEN
           CALL JEVEUO('&NOSENSI.MEMO.CORR','L',J3)
           CALL JELIRA('&NOSENSI.MEMO.CORR','LONMAX',N3,KBID)
           DO 71, K=1,N3/2
             IF (ZK80(J3-1+2*(K-1)+1)(1:8).NE.NOMSD) GOTO 71
             NOMS2=ZK80(J3-1+2*(K-1)+1)(17:24)
             IF (NOMS2.EQ.' ') GOTO 71
             CALL VERISD(SDP,NOMS2)
 71        CONTINUE
         ENDIF



C        3- VERIFICATION QU'ON N'A PAS CREE D'OBJET INCONNU :
C        -----------------------------------------------------

C        3.1 ON CREE 2 OBJETS : LISTON ET LISTOV
C          *LISTON : POINTEUR DES NOMS DES OBJETS JEVEUX CREES PAR
C             LA COMMANDE SUR LA BASE GLOBALE : LISTOBJ(NOMOBJ)=0
C          *LISTOV : V I :  /0 -> L'OBJET N'A PAS ETE VU
C                           /1 -> L'OBJET A ETE VU
         LISTON='&&VERIS3.LISTON'
         LISTOV='&&VERIS3.LISTOV'
         CALL JELIRA(LOBJAV,'NOMMAX',NAV,KBID)
         CALL JELIRA(LOBJAP,'NOMMAX',NAP,KBID)
         N1=0
         DO 2, K=1,NAP
            CALL JENUNO(JEXNUM(LOBJAP,K),NOMOBJ)
            CALL JENONU(JEXNOM(LOBJAV,NOMOBJ),K2)
            IF (K2.EQ.0)  N1=N1+1
  2      CONTINUE
         CALL ASSERT(N1.GT.0)

         CALL JECREO(LISTON,'V N K24')
         CALL JEECRA(LISTON,'NOMMAX',N1,KBID)
         CALL WKVECT(LISTOV,'V V I',N1,J1)
         NVU=0
         DO 3, K=1,NAP
            CALL JENUNO(JEXNUM(LOBJAP,K),NOMOBJ)
            CALL JENONU(JEXNOM(LOBJAV,NOMOBJ),K2)
            IF (K2.EQ.0) CALL JECROC(JEXNOM(LISTON,NOMOBJ))
  3      CONTINUE


C        3.2 ON VA PARCOURIR LA SD ET METTRE LISTOB(NOMOBJ)=1
C            POUR LES OBJETS PREVUS DANS LA SD

         DERNSD=SDP
         NTROU=0
         CALL VERIJB('C',SDP,NOMSD,LISTON,ZI(J1),MEMO80,NVU,NTROU)

C        -- SI SENSIBILITE, IL FAUT BOUCLER SUR LES EVENTUELS
C           CONCEPTS DERIVES (DE MEME TYPE):
         IF (LSENSI) THEN
           CALL JEVEUO('&NOSENSI.MEMO.CORR','L',J3)
           CALL JELIRA('&NOSENSI.MEMO.CORR','LONMAX',N3,KBID)
           DO 7, K=1,N3/2
             IF (ZK80(J3-1+2*(K-1)+1)(1:8).NE.NOMSD) GOTO 7
             NOMS2=ZK80(J3-1+2*(K-1)+1)(17:24)
             IF (NOMS2.EQ.' ') GOTO 7
             NTROU=0
             CALL VERIJB('C',SDP,NOMS2,LISTON,ZI(J1),MEMO80,NVU,NTROU)
 7         CONTINUE
         ENDIF

C        -- ON VERIFIE QUE TOUS LES OBJETS ONT ETE VUS :
         DO 1, K=1,N1
            IF (ZI(J1-1+K).EQ.0) THEN
              CALL JENUNO(JEXNUM(LISTON,K),NOMOBJ)

C             -- QUELQUES EXCEPTIONS :
              IF (NOMOBJ.EQ.'&&_NUM_CONCEPT_UNIQUE') GOTO 1
              IF (NOMOBJ.EQ.LOBJAV) GOTO 1

C             * NUM_CONCEPT_UNIQUE EST UN OBJET "GLOBAL" CREE
C               PAR GCNCON.F POUR GENERER DES NOMS _00000IJ
C             * ON A ETE OBLIGE DE CREER LOBJAV
C               SUR LA BASE GLOBALE, SINON IL EST DETRUIT PAR
C               LES JEDETC('V','&&',...) QUI TRAINENT PARTOUT


              VALK(1)=NOMOBJ
              VALK(2)=SDP
              CALL U2MESK('E','SDVERI_23',2,VALK)
              CALL JEDETR(NOMOBJ)
            ENDIF
1        CONTINUE

         CALL JEDETR(LISTON)
         CALL JEDETR(LISTOV)
         CALL JEDETR(MEMO80)
      ENDIF

9999  CONTINUE
      END
