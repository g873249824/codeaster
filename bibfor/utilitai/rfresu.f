      SUBROUTINE RFRESU()
      IMPLICIT NONE
C     ------------------------------------------------------------------
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF UTILITAI  DATE 05/03/2013   AUTEUR BRIE N.BRIE 
C ======================================================================
C COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C     OPERATEUR "RECU_FONCTION"
C     ------------------------------------------------------------------
      INCLUDE 'jeveux.h'
      INTEGER NBTROU,NUMER1,L,N1,IRET,IVARI
      INTEGER NM,NGM,NPOINT,NP,NN,NPR,NGN,IBID,IE
      INTEGER NRES,IFM,NIV,NUSP,IARG
      REAL*8 EPSI
      CHARACTER*8 K8B,CRIT,MAILLE,NOMA,INTRES
      CHARACTER*8 NOEUD,CMP,NOMGD
      CHARACTER*16 NOMCMD,TYPCON,NOMCHA,NPRESU
      CHARACTER*19 NOMFON,CHAM19,RESU
      CHARACTER*24 VALK(3),NOGMA,NOGNO

C     ------------------------------------------------------------------
      CALL JEMARQ()
C
      CALL GETRES(NOMFON,TYPCON,NOMCMD)

C --- RECUPERATION DU NIVEAU D'IMPRESSION
      CALL INFMAJ
      CALL INFNIV(IFM,NIV)
C
      CALL GETVTX(' ','CRITERE',0,IARG,1,CRIT,N1)
      CALL GETVR8(' ','PRECISION',0,IARG,1,EPSI,N1)
      INTRES = 'NON     '
      CALL GETVTX(' ','INTERP_NUME',0,IARG,1,INTRES,N1)

      NPOINT = 0
      CMP = ' '
      NOEUD = ' '
      MAILLE = ' '
      NOGMA = ' '
      NOGNO = ' '
      CALL GETVTX(' ','MAILLE',0,IARG,1,MAILLE,NM)
      CALL GETVTX(' ','GROUP_MA',0,IARG,1,NOGMA,NGM)
      CALL GETVIS(' ','SOUS_POINT',0,IARG,1,NUSP,NP)
      IF (NP.EQ.0) NUSP = 0
      CALL GETVIS(' ','POINT',0,IARG,1,NPOINT,NP)
      CALL GETVTX(' ','NOEUD',0,IARG,1,NOEUD,NN)
      CALL GETVTX(' ','GROUP_NO',0,IARG,1,NOGNO,NGN)

C     -----------------------------------------------------------------
C                       --- CAS D'UN RESULTAT ---
C     -----------------------------------------------------------------
C


      CALL GETVID(' ','RESULTAT ',0,IARG,1,RESU,NRES)

      IF (NRES.NE.0) THEN
        CALL GETVTX(' ','NOM_PARA_RESU',0,IARG,1,NPRESU,NPR)
        IF (NPR.NE.0) THEN
          IF (INTRES(1:3).NE.'NON') CALL U2MESS('F','UTILITAI4_21')
          CALL FOCRR3(NOMFON,RESU,NPRESU,'G',IRET)
          GO TO 10
        END IF

        CALL GETVTX(' ','NOM_CHAM',0,IARG,1,NOMCHA,L)
        CALL RSUTNC(RESU,NOMCHA,1,CHAM19,NUMER1,NBTROU)
        IF (NBTROU.EQ.0) CALL U2MESK('F','UTILITAI4_22',1,NOMCHA)
        CALL DISMOI('F','NOM_MAILLA',CHAM19,'CHAMP',IBID,NOMA,IE)
        CALL DISMOI('F','NOM_GD',CHAM19,'CHAMP',IBID,NOMGD,IE)
        IF (NGN.NE.0) THEN
          CALL UTNONO(' ',NOMA,'NOEUD',NOGNO,NOEUD,IRET)
          IF (IRET.EQ.10) THEN
            CALL U2MESK('F','ELEMENTS_67',1,NOGNO)
          ELSE IF (IRET.EQ.1) THEN
            VALK(1) = NOGNO
            VALK(2) = NOEUD
            CALL U2MESK('A', 'SOUSTRUC_87',2,VALK)
          END IF
        END IF
        IF (NGM.NE.0) THEN
          CALL UTNONO(' ',NOMA,'MAILLE',NOGMA,MAILLE,IRET)
          IF (IRET.EQ.10) THEN
            CALL U2MESK('F','ELEMENTS_73',1,NOGMA)
          ELSE IF (IRET.EQ.1) THEN
            VALK(1) = MAILLE
            CALL U2MESK('A', 'UTILITAI6_72',1,VALK)
          END IF
        END IF
        CALL UTCMP1(NOMGD,' ',1,CMP,IVARI)
        IF (INTRES(1:3).EQ.'NON') THEN
          CALL FOCRRS(NOMFON,RESU,'G',NOMCHA,MAILLE,NOEUD,CMP,NPOINT,
     &                 NUSP,IVARI,IRET)
        ELSE
          CALL FOCRR2(NOMFON,RESU,'G',NOMCHA,MAILLE,NOEUD,CMP,
     &                 NPOINT,NUSP,IVARI,IRET)
        END IF
        GOTO 10
      END IF
  10  CONTINUE
      CALL FOATTR(' ',1,NOMFON)
C     --- VERIFICATION QU'ON A BIEN CREER UNE FONCTION ---
C         ET REMISE DES ABSCISSES EN ORDRE CROISSANT
      CALL ORDONN(NOMFON,0)
C
      CALL TITRE
      IF (NIV.GT.1) CALL FOIMPR(NOMFON,NIV,IFM,0,K8B)

      CALL JEDEMA()
      END
