      SUBROUTINE  PRASMP (OPTION,NUGENE,TMINBL,NOMPRN,MODGEN,
     &TMNOBL,TMADBL,KNOMBL,INUMBL,SSMAX)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 13/06/2012   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
      IMPLICIT REAL*8 (A-H,O-Z)
C
C***********************************************************************
C    P. RICHARD     DATE 13/10/92
C-----------------------------------------------------------------------
C  BUT:      < PREPARATION ASSEMBLAGE MATRICE PROJETEE >
C
C  PREPARER L'ASSEMBLAGE POUR UN LIGREL CORRESPONDANT AUX MATRICES
C   PROJETEES DES SOUS-STRUCTURE
C   ON CONSIDERE POUR L'ASSEMBLAGE UN LISTE GENERALE DES BLOC
C   ELEMENTAIRES A ASSEMBLER DANS UNE MATRICE STOCKEE PROFIL BLOC
C   (EN GENERAL MATRICE PROJETEE=1BLOC,MATRICE DE LIAISON=NBLOCS)
C   NOEUD TARDIF = NOEUD FICTIF SUPPORTANT UNE SOUS-STRUCTURE
C
C   ON REMPLIT TMNOBL TMADBL KNOMBL INUMBL
C
C-----------------------------------------------------------------------
C
C NOM----- / /:
C
C OPTION   /I/: NOM K11 DE L'OPTION D'ASSEMBLAGE
C NUGENE   /I/: NOM K14 DE LA NUMEROTATION GENERALISEE
C NOMPRN   /I/: NOM K8 DU LIGREL COURANT A TRAITER
C TMINBL   /I/: NOM K24 DE LA FAMILLE NOMMEE AU NOM DES LIGRELS
C               ET DONNANT POUR CHAQUE NOEUD TARDIF DU LIGREL
C               LE NUMERO DE SON 1 BLOC DANS LA LISTE GENERALE ET
C               LE NOMBRE DE BLOC
C MODGEN   /I/: NOM K8 MODELE_GENERALISE AMONT
C TMNOBL   /I/: NOM K24 DE LA FAMILLE NUMEROTE DONNANT POUR CHAQUE
C               TERME D'UN BLOC ELEMENTAIRE LE NUMERO DU BLOC ASSEMBLE
C               D'ARRIVE
C TMADBL   /I/: NOM K24 DE LA FAMILLE NUMEROTE DONNANT POUR CHAQUE
C               TERME D'UN BLOC ELEMENTAIRE LE RANG D'ARRIVEE
C               DANS LE  BLOC ASSEMBLE
C KNOMBL   /M/: VECTEUR DES NOM K24 DES OBJETS OU FAMILLE CONTENANT
C               LES BLOCS ELEMENTAIRES
C INUMBL   /M/: VECTEUR NUMERO  BLOCS ELEMNTAIRE DANS LEUR FAMILLE OU 0
C               LES BLOCS ELEMENTAIRES
C SSMAX    /M/: MAXIMUM DE LA VALEURS ABSOLUE DES TERMES TRAITES
C
C
C
      INCLUDE 'jeveux.h'
C
C
      CHARACTER*8 MODGEN,NOMPRN,NOMMCL,KBID
      CHARACTER*14 NUGENE
      CHARACTER*19 PRGENE,STOLCI
      CHARACTER*9  RIGOPT,MASOPT,AMOOPT,KSST
      CHARACTER*11 OPTION,RICOPT
      CHARACTER*24 TMADBL,TMNOBL,TMINBL,KNOMBL(*)
      CHARACTER*24 VALK
      CHARACTER*10 ADNOM
      INTEGER      INUMBL(*)
      CHARACTER*1 K1BID
C
C-----------------------------------------------------------------------
      DATA RIGOPT,RICOPT,MASOPT,AMOOPT/'RIGI_GENE','RIGI_GENE_C',
     &                                 'MASS_GENE','AMOR_GENE'/
      DATA KSST /'&SOUSSTR'/
C-----------------------------------------------------------------------
C
      CALL JEMARQ()
        IF(NOMPRN.NE.KSST) GOTO 9999
C
C------------------RECUPERATION DU NOMBRE DE SOUS-STRUCTURE-------------
      PRGENE=NUGENE//'.NUME'
      STOLCI=NUGENE//'.SLCS'
      CALL JENONU(JEXNOM(PRGENE//'.LILI',KSST),IBID)
      CALL JELIRA(JEXNUM(PRGENE//'.PRNO',IBID),'LONMAX',NBSST,K1BID)
      NBSST=NBSST/2
C
C--------------------RECUPERATION DES CARACTERISTIQUES BLOCS------------
C
C
C------------------CREATION DU NOM A CONCATENER-------------------------
C   POUR RECUPERER LE NOM DES MATRICES PROJETEES
C
      IF((OPTION.EQ.RIGOPT).OR.(OPTION.EQ.RICOPT))THEN
        ADNOM='.MAEL_RAID'
      ELSE IF(OPTION.EQ.MASOPT) THEN
        ADNOM='.MAEL_MASS'
      ELSE IF (OPTION.EQ.AMOOPT) THEN
        ADNOM='.MAEL_AMOR'
      ENDIF
C
C---------------------REMPLISSAGE DES OBJETS DE TRAVAIL-----------------
C
C
      CALL JEVEUO(PRGENE//'.NUEQ','L',LLNUEQ)
      CALL JEVEUO(STOLCI//'.SCDI','L',LLSCDI)
      CALL JEVEUO(STOLCI//'.SCIB','L',LLSCIB)
C
      CALL JENONU(JEXNOM('&&ASSGEN.REP.NOM.PROF',NOMPRN),IBID)
      CALL JEVEUO(JEXNUM(TMINBL,IBID),'L',LTINBL)
      CALL JELIRA(JEXNUM(TMINBL,IBID),'LONMAX',NTPRNO,K1BID)
      NTPRNO=NTPRNO/2
C
      CALL JENONU(JEXNOM(PRGENE//'.LILI',NOMPRN),IBID)
      CALL JEVEUO(JEXNUM(PRGENE//'.ORIG',IBID),'L',LLORS)
      CALL JENONU(JEXNOM(PRGENE//'.LILI',NOMPRN),IBID)
      CALL JEVEUO(JEXNUM(PRGENE//'.PRNO',IBID),'L',LLPRS)
C
C   BOUCLE SUR LES ELEMENTS DU LIGREL
C
      DO 10 J=1,NTPRNO
C
C  RECUPERATION NUMERO SOUS-STRUCTURE
        NUSST=ZI(LLORS+J-1)
C RECUPERATION DU PROFIL BLOC ELEMENTAIRE
        IBL1=ZI(LTINBL+(J-1)*2)
C
C POUR UNE MATRICE ELEMENTAIRE BLOC IL FAUDRA FAIRE UNE BOUCLE
C SUR LES BLOC A ASSEMBLER (DO IBLOC=1,NBBL)
C
C RECUPERATION DU NOM DU MACR_ELEM AMONT
        KBID='   '
        CALL MGUTDM(MODGEN,KBID,NUSST,'NOM_MACR_ELEM',IBID,NOMMCL)
        KNOMBL(IBL1)=NOMMCL//ADNOM//'_VALE         '
C
C VERIFICATION DE L'EXISTENCE DE LA MATRICE D'AMORTISSEMENT ASSOCIEE
C AU MACRO-ELEMENT
C
        IF (OPTION.EQ.AMOOPT) THEN
            CALL JEEXIN(KNOMBL(IBL1),IRET)
            IF (IRET.EQ.0) THEN
                VALK = NOMMCL
                CALL U2MESG('F', 'ALGORITH13_99',1,VALK,0,0,0,0.D0)
            ENDIF
        ENDIF
C
        INUMBL(IBL1)=0
C TYPE DE LA MATRICE DU MACRO ELEMENT (IE REELLE OU COMPLEXE)
        IF (OPTION.EQ.RICOPT) THEN
          CALL MAXBLC(NOMMCL//ADNOM//'_VALE           ',SSMAX)
        ELSE
          CALL MAXBLO(NOMMCL//ADNOM//'_VALE           ',SSMAX)
        ENDIF
C  RECUPERATION DIMENSIONS ET NUMERO PREMIERE EQUATION DANS NUEQ
        NBLIG=ZI(LLPRS+(J-1)*2+1)
        NBCOL=NBLIG
        INUL=ZI(LLPRS+(J-1)*2)
        INUC=INUL
C
C TAILLE BLOC MATRICE PROJETEE (STOCKAGE TRAINGLE SUPERIEUR)
C
        NTAIL=NBCOL*(NBCOL+1)/2
C
        CALL JECROC(JEXNUM(TMNOBL,IBL1))
        CALL JEECRA(JEXNUM(TMNOBL,IBL1),'LONMAX',NTAIL,' ')
        CALL JEVEUO(JEXNUM(TMNOBL,IBL1),'E',LTNOBL)
        CALL JECROC(JEXNUM(TMADBL,IBL1))
        CALL JEECRA(JEXNUM(TMADBL,IBL1),'LONMAX',NTAIL,' ')
        CALL JEVEUO(JEXNUM(TMADBL,IBL1),'E',LTADBL)
C
C     BOUCLES SUR LES TERMES DU BLOC ELEMENTAIRE
C    (TRIANGLE SUPERIEUR SEULEMENT)
        DO 20 LL=1,NBLIG
          DO 30 LC=LL,NBCOL
C    ADRESSE DANS BLOC ELEMENTAIRE
            IAD=(LC-1)*LC/2+LL
C    NUMERO D'EQUATION DU TERME COURANT
            IEQC=ZI(LLNUEQ+(INUC-1)+(LC-1))
C
            ZI(LTNOBL+IAD-1)=ZI(LLSCIB+IEQC-1)
            ZI(LTADBL+IAD-1)=ZI(LLSCDI+IEQC-1)-(LC-LL)
30        CONTINUE
20      CONTINUE
        CALL JELIBE(JEXNUM(TMNOBL,IBL1))
        CALL JELIBE(JEXNUM(TMADBL,IBL1))
10    CONTINUE
C
 9999 CONTINUE
      CALL JEDEMA()
      END
