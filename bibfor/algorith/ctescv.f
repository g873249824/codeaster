      SUBROUTINE CTESCV(CVEC1,CVEC0,NDIM,XER)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 09/06/98   AUTEUR BIBERON G.ROUSSEAU 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
C (AT YOUR OPTION) ANY LATER VERSION.                                 
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
C ======================================================================
      IMPLICIT REAL*8 (A-H,O-Z)
C
C***********************************************************************
C    P. RICHARD                                 DATE 31/07/91
C-----------------------------------------------------------------------
C  BUT: < COMPLEXE TEST DE CONVERGENCE >
C
C TESTER LA CONVERGENCE PAR ESTIMATION DE LA COLINEARITE
C      DU VECTEUR COURANT AVEC CELUI DE L'ITERATION PRECEDANTE
C      RENVOIE L'ERREUR DE COLINEARITE RELATIVE
C     ET COPIE DU MODE DE L'ITERATION COURANTE DANS L'ANCIEN
C
C-----------------------------------------------------------------------
C
C CVEC1    /I/: VECTEUR ITERATION COURANTE
C CVEC0    /M/: VECTEUR ITERATION PRECEDENTE
C NDIM     /I/: DIMENSION DES VECTEURS
C XER      /O/: ERREUR RELATIVE DE COLINEARITE
C
C-----------------------------------------------------------------------
C
      COMPLEX*16 CVEC1(NDIM),CVEC0(NDIM)
      COMPLEX*16 CPROD,CERRE,CCONJ
C
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
C
C   PRODUIT SCALAIRE
C
      CPROD=DCMPLX(0.D0,0.D0)
      DO 10 I=1,NDIM
        CALL ZCONJU(CVEC1(I),PREA,PIMA)
        CCONJ=DCMPLX(PREA,-PIMA)
        CPROD=CPROD+(CCONJ*CVEC0(I))
 10   CONTINUE
C
      CNORM=DCMPLX(0.D0,0.D0)
      DO 15 I=1,NDIM
        CALL ZCONJU(CVEC0(I),PREA,PIMA)
        CCONJ=DCMPLX(PREA,-PIMA)
        CNORM=CNORM+(CCONJ*CVEC0(I))
 15   CONTINUE
C
      CNORM2=DCMPLX(0.D0,0.D0)
      DO 16 I=1,NDIM
        CALL ZCONJU(CVEC1(I),PREA,PIMA)
        CCONJ2=DCMPLX(PREA,-PIMA)
        CNORM2=CNORM2+(CCONJ2*CVEC1(I))
 16   CONTINUE
C
C   CALCUL ERREUR ORTHOGONALITE
C
      XER=0.D0
      DO 20 I=1,NDIM
        CERRE=CVEC1(I)-(CNORM2*CVEC0(I)/CNORM)
        CALL ZCONJU(CERRE,PREA,PIMA)
        XMODU=(PREA**2)+(PIMA**2)
        XER=XER+XMODU
 20   CONTINUE
C
      XER=(XER/(DBLE(CNORM2)))**0.5D0
C
C
C  RECOPIE DU VECTEUR COURANT DANS LE PRECEDENT
C
      DO 30 I=1,NDIM
        CVEC0(I)=CVEC1(I)
 30   CONTINUE
C
 9999 CONTINUE
      END
