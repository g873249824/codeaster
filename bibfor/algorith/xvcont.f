      SUBROUTINE XVCONT(ALGOCR,COHES ,COEFCP,COEFCR,DDLM  ,
     &                  DDLS  ,FFC   ,FFP   ,IDEPL ,
     &                  IDEPM ,IFA   ,IFISS ,IMATE ,INDCO ,
     &                  IPGF  ,JAC   ,JFISNO,JHEAFA,
     &                  LACT  ,NCOMPH,ND    ,NDDL  ,NDIM  ,NFH,
     &                  NFISS ,NNO   ,NNOL  ,NNOS  ,
     &                  NVIT  ,PLA   ,RELA  ,REAC  ,RR    ,SINGU,
     &                  TAU1  ,TAU2  ,VTMP)
      IMPLICIT NONE
      INCLUDE 'jeveux.h'
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 19/12/2012   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C TOLE CRP_21
C IN ALGOCR : ALGO CONTACT (1:LAG, 2:PENA, 3:COHESIF)
C IN CFACE  : CONNECTIVITE FACETTES DE CONTACT
C IN COEFCR : COEF AUGMENTATION CONTACT
C IN COEFCP : COEF PENALISATION CONTACT
C IN COHES  : VARIABLE INTERNE COHESIVE
C IN DDLM   : NOMBRE DE DDLS A CHAQUE NOEUD MILIEU
C IN DDLS   : NOMBRE DE DDLS A CHAQUE NOEUD SOMMET
C IN FFC    : FONCTIONS DE FORME DE CONTACT
C IN FFP    : FONCTIONS DE FORME ELEMENT PARENT
C IN IDEPL  : ADRESSE DEPLACEMENT COURANT
C IN IDEPM  : ADRESSE DEPLACEMENT INSTANT -
C IN IFA    : NUMERO FACETTE DE CONTACT
C IN IFISS  : NUMERO FISSURE
C IN IMATE  : ADRESSE MATERIAU
C IN INDCO  : ETAT DE CONTACT POINT DE GAUSS
C IN IPGF   : NUMERO POINT DE GAUSS DE CONTACT
C IN IVFF   : ADRESSE FONCTION DE FORME EL PARENT
C IN JAC    : PRODUIT JACOBIEN*POIDS
C IN JFISNO
C IN JHEAFA
C IN NCOMPH
C IN ND     : NORMALE A LA SURFACE DE CONTACT AU PG
C IN NDDL   : NOMBRE TOTAL DDL DE L ELEMENT
C IN NDIM   : DIMENSION DU MODELE
C IN NFH    : NOMBRE DE DDL HEAVISIDE
C IN NFISS  : NOMBRE DE FISSURES
C IN NOEUD  : FORMULATION AUX NOEUDS OU NON
C IN NVIT   : ARETE VITALE OU NON
C IN PLA    : PLACE DES DDLS DE LAGRANGE
C IN RELA   : LOI DE COMPORTEMENT COHESIVE
C IN REAC   : REACTION DE CONTACT (LAMBDA)
C IN RR     : RACINE RAYON A LA POINTE DE FISSURE
C IN SINGU  : ELEMENT ENRICHI CTIP OU ON
C IN TAU1   : 1ERE TANGENTE SURFACE DE CONTACT
C IN TAU2   : 2EME TANGENTE (3D)
C OUT VTMP  : VECTEUR DE TRAVAIL SECOND MEMBRE
      INTEGER ALGOCR
      INTEGER DDLM,DDLS
      INTEGER IDEPL,IDEPM,IFA,IFISS
      INTEGER IMATE,INDCO,IPGF
      INTEGER JFISNO,JHEAFA,LACT(8),NCOMPH
      INTEGER NDDL,NDIM,NFH,NFISS,NNO
      INTEGER NNOL,NNOS,NVEC,NVIT,PLA(27)
      INTEGER SINGU
      REAL*8  ALPHA(3),AM(3),DNOR(3),DSIDEP(6,6),COHES(3)
      REAL*8  DTANG(3),COEFCR,COEFCP,FFC(8),FFP(27),JAC
      REAL*8  ND(3),P(3,3),PP(3,3),REAC,RR,SAUT(3)
      REAL*8  SIGMA(6),TAU1(3),TAU2(3),VTMP(400),UN,RELA
      REAL*8  DELTA(6),LAMB(3),R
      CHARACTER*8 JOB
C
C --- CAS COHESIF
C          
      IF(ALGOCR.EQ.3) THEN
C
C --- SI LOI COHESIVE REGULARISEE CZM_XXX_REG
C
       IF(RELA.EQ.1.D0.OR.RELA.EQ.2.D0) THEN
C
           UN = 1.D0
           IF (NVIT.NE.0) THEN
              CALL XMVEC3(NNOL,PLA,
     &                    FFC,REAC,JAC,UN,
     &                    VTMP)
           ENDIF
C
C --- CALCUL DU SAUT DE DEPLACEMENT EQUIVALENT [[UEG]]
C
         NVEC=2
         CALL XMMSA3(NDIM,NNO,NNOS,FFP,NDDL,NVEC,ZR(IDEPL),
     &               ZR(IDEPM),ZR(IDEPM),NFH,SINGU,RR,DDLS,DDLM,
     &               JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &               SAUT)
C
         JOB='VECTEUR'
         CALL XMMSA2(NDIM ,IPGF  ,IMATE   ,SAUT ,ND  ,
     &               TAU1 ,TAU2  ,COHES       ,JOB  ,RELA,
     &               ALPHA,DSIDEP,SIGMA       ,PP   ,DNOR,
     &               DTANG,P     ,AM)
C
C --- CALCUL DES SECONDS MEMBRES DE COHESION
C
         CALL XMVCO1(NDIM,NNO,NNOL,
     &               SIGMA,PLA,LACT ,
     &               DTANG,NFH,DDLS,JAC,FFC,FFP,
     &               SINGU,RR,UN,ND,TAU1,TAU2,
     &               VTMP)
C
       ELSE IF(RELA.EQ.3.D0.OR.RELA.EQ.4.D0) THEN
C
C SI LOI COHESIVE MIXTE CZM_XXX_MIX
C ON COMMENCE PAR CALCULER LE SAUT DE DEPLACEMENT
C
         NVEC=2
         CALL XMMSA3(NDIM,NNO,NNOS,FFP,NDDL,NVEC,ZR(IDEPL),
     &               ZR(IDEPM),ZR(IDEPM),NFH,SINGU,RR,DDLS,DDLM,
     &               JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &               SAUT)
C
C --- ON CALCULE LA CONTRAINTE
C
         NVEC = 2
         CALL XXLAG2(FFC   ,IDEPL ,IDEPM ,LACT  ,NDIM  ,
     &               NNOL  ,PLA   ,LAMB  ,NVEC)

C
C --- ON CALCULE ENSUITE DELTA AVEC XMMSA5
C
         JOB = 'VECTEUR'
         CALL XMMSA5(NDIM ,IPGF  ,IMATE ,SAUT  ,LAMB ,
     &               ND   ,TAU1  ,TAU2  ,COHES ,JOB  ,
     &               RELA ,ALPHA ,DSIDEP,DELTA ,P    ,
     &               AM   ,R)
C
C --- CALCUL DES SECONDS MEMBRES
C
         CALL XMVCO2(NDIM  ,NNO   ,NNOL  ,NNOS  ,LAMB  ,
     &               AM    ,DELTA ,PLA   ,LACT  ,NFH   ,
     &               DDLS  ,DDLM  ,NFISS ,IFISS ,JHEAFA,
     &               IFA   ,NCOMPH,JFISNO,JAC   ,FFC   ,
     &               FFP   ,SINGU ,R     ,RR    ,VTMP  ,
     &               P)
       ENDIF
C
      ELSE IF(ALGOCR.EQ.1) THEN
C
C --- CAS LAGRANGIEN OU PENALISATION
C
         IF (INDCO.EQ.0) THEN
             IF (NVIT.NE.0) THEN
                CALL XMVEC3(NNOL,PLA,
     &                      FFC,REAC,JAC,COEFCR,
     &                      VTMP)
             ENDIF
C
         ELSE IF (INDCO.EQ.1) THEN
C
C --- CALCUL DU SAUT ET DE DN EN CE PG (DEPMOI + DEPDEL)
             NVEC=2
             CALL XMMSA3(NDIM,NNO,NNOS,FFP,NDDL,NVEC,ZR(IDEPL),
     &                   ZR(IDEPM),ZR(IDEPM),NFH,SINGU,RR,DDLS,DDLM,
     &                   JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &                   SAUT)
C
C --- CALCUL DU VECTEUR LN1 & LN2
C
              CALL XMVEC2(NDIM,NNO,NNOS,NNOL,PLA,
     &                    FFC,FFP,REAC,JAC,NFH,SAUT,
     &                    SINGU,ND,RR,COEFCR,DDLS,DDLM,
     &                    JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &                    VTMP)
          ENDIF
       ELSE IF(ALGOCR.EQ.2) THEN
          IF (INDCO.EQ.0) THEN
             IF (NVIT.NE.0) THEN
                CALL XMVEC3(NNOL,PLA,
     &                      FFC,REAC,JAC,COEFCP,
     &                      VTMP)
             ENDIF
C
          ELSE IF (INDCO.EQ.1) THEN
C
C --- CALCUL DU SAUT ET DE DN EN CE PG (DEPMOI + DEPDEL)
             NVEC=2
             CALL XMMSA3(NDIM,NNO,NNOS,FFP,NDDL,NVEC,ZR(IDEPL),
     &                   ZR(IDEPM),ZR(IDEPM),NFH,SINGU,RR,DDLS,DDLM,
     &                   JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &                   SAUT)       
             CALL XMVEP2(NDIM,NNO,NNOS,NNOL,PLA,
     &                   FFC,FFP,REAC,JAC,NFH,SAUT,
     &                   SINGU,ND,RR,COEFCP,DDLS,DDLM,
     &                   JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &                   VTMP) 
           ELSE
              CALL ASSERT(.FALSE.)            
           ENDIF
      ELSE
          CALL ASSERT(.FALSE.)
      ENDIF
      END
