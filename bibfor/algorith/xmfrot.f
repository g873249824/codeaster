      SUBROUTINE XMFROT(ALGOFR,COEFFR,COEFFP,DDLM  ,
     &                  DDLS  ,FFC   ,FFP   ,IDEPD ,IDEPM ,
     &                  INDCO ,JAC   ,
     &                  LACT  ,MMAT  ,MU    ,ND    ,NDIM  ,
     &                  NFH   ,NFISS ,NNO   ,NNOL  ,
     &                  NNOS  ,NVIT  ,PLA   ,RR    ,
     &                  SEUIL ,SINGU ,TAU1  ,TAU2)
       IMPLICIT NONE
      INCLUDE 'jeveux.h'
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 19/12/2012   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C TOLE CRP_21
C IN ALGOFR : ALGO FROTTEMENT (1:LAG, 2:PENA, 0:RIEN)
C IN CFACE  : CONNECTIVITE FACETTES DE CONTACT
C IN COEFFR : COEF AUGMENTATION FROT
C IN COEFFP : COEF PENALISATION FROT
C IN DDLM   : NOMBRE DE DDLS A CHAQUE NOEUD MILIEU
C IN DDLS   : NOMBRE DE DDLS A CHAQUE NOEUD SOMMET
C IN FFC    : FONCTIONS DE FORME DE CONTACT
C IN FFP    : FONCTIONS DE FORME ELEMENT PARENT
C IN IDEPD  : ADRESSE INCREMENT DEPLACEMENT COURANT
C IN IDEPM  : ADRESSE DEPLACEMENT INSTANT -
C IN IFA    : NUMERO FACETTE DE CONTACT
C IN INDCO  : ETAT DE CONTACT POINT DE GAUSS
C IN IPGF   : NUMERO POINT DE GAUSS DE CONTACT
C IN IVFF   : ADRESSE FONCTION DE FORME EL PARENT
C IN JAC    : PRODUIT JACOBIEN*POIDS
C IN LACT   : DDL DE LAGRANGE ACTIF OU NON
C OUT MMAT  : MATRICE ELEMENTAIRE DE CONTACT
C IN MU     : COEFFICIENT DE COULOMB
C IN ND     : NORMALE A LA SURFACE DE CONTACT AU PG
C IN NDIM   : DIMENSION DU MODELE
C IN NFH    : NOMBRE DE DDL HEAVISIDE
C IN NFISS  : NOMBRE DE FISSURES
C IN NNO    : NOMBRE DE NOEUDS TOTAL ELEMENT PARENT
C IN NNOL   : NOMBRE DE NOEUDS EL PARENT PORTEURS DE DDL LAGRANGE
C IN NNOS   : NOMBRE DE NOEUDS SOMMET ELEMENT PARENT
C IN NOEUD  : FORMULATION AUX NOEUDS
C IN NVIT   : ARETE VITALE OU NON
C IN PLA    : PLACE DES DDLS DE LAGRANGE
C IN RR     : RACINE RAYON A LA POINTE DE FISSURE
C IN SINGU  : ELEMENT ENRICHI CTIP OU ON
C IN TAU1   : 1ERE TANGENTE SURFACE DE CONTACT
C IN TAU2   : 2EME TANGENTE (3D)
      INTEGER ALGOFR,DDLM,DDLS
      INTEGER IDEPD,IDEPM,INDCO
      INTEGER LACT(8),NDIM
      INTEGER NFH,NFISS,NNO,NNOL,NNOS,NVIT
      INTEGER PLA(27),SINGU
      REAL*8  COEFFP,COEFFR,IK(3,3),JAC,KNP(3,3)
      REAL*8  MMAT(216,216),MU,ND(3),P(3,3),FFC(8),FFP(27)
      REAL*8  PTKNP(3,3),RR,SEUIL,TAU1(3),TAU2(3)
      LOGICAL ADHER
      
      IF (MU.EQ.0.D0.OR.SEUIL.EQ.0.D0) INDCO = 0
      IF (NFISS.GT.1) INDCO = 0
C
      IF (INDCO.EQ.0) THEN
         IF (NVIT.NE.0) THEN
C
C --- CALCUL DE LA MATRICE F - CAS SANS CONTACT
C
            CALL XMMAB6(NDIM,NNOL,PLA,FFC,JAC,
     &                  TAU1,TAU2,LACT,
     &                  MMAT)

          ENDIF
      ELSE IF (INDCO.EQ.1) THEN
C
C --- CALCUL DES INCREMENTS - DÉPLACEMENTS & 
C --- SEMI-MULTIPLICATEUR DE FROTTEMENT
C
          CALL XMMSA1(ALGOFR,NDIM,NNO,NNOS,NNOL,PLA,
     &                FFC,FFP,IDEPD,IDEPM,NFH,ND,
     &                TAU1,TAU2,SINGU,RR,LACT,
     &                DDLS,DDLM,COEFFR,COEFFP,
     &                P,ADHER,KNP,PTKNP,IK )
C
C --- CALCUL DE B, BT
C
          IF(ALGOFR.EQ.1) THEN
              CALL XMMAB3(NDIM,NNO,NNOS,NNOL,PLA,
     &                    FFC,FFP,JAC,KNP,NFH,SEUIL,
     &                    TAU1,TAU2,MU,SINGU,RR,
     &                    LACT,DDLS,DDLM,MMAT)
C
C --- CALCUL DE B_U
C
              CALL XMMAB4(NDIM,NNO,NNOS,FFP,JAC,PTKNP,
     &                    NFH ,SEUIL,MU,SINGU,
     &                    RR,COEFFR,DDLS,DDLM,
     &                    MMAT )
C
C --- CALCUL DE F (NULLE EN ADHERENCE)
C
             IF(.NOT.ADHER) THEN
             CALL XMMAB5(NDIM,NNOL,PLA,
     &                   FFC,JAC,COEFFR,
     &                   SEUIL,TAU1,TAU2,MU,IK,
     &                   LACT,MMAT )
             ENDIF
         ELSEIF(ALGOFR.EQ.2) THEN
              CALL XMMBP3(NDIM,NNO,NNOS,NNOL,PLA,
     &                    FFC,FFP,JAC,KNP,NFH,SEUIL,
     &                    TAU1,TAU2,MU,SINGU,RR,
     &                    LACT,DDLS,DDLM,MMAT)
C
C --- CALCUL DE B_U
C
              CALL XMMAB4(NDIM,NNO,NNOS,FFP,JAC,PTKNP,
     &                    NFH ,SEUIL,MU,SINGU,
     &                    RR,COEFFP,DDLS,DDLM,
     &                    MMAT )
C
C --- CALCUL DE F - CAS GLISSANT OU PENALISATION (NON SEULE)
C
              CALL XMMBP5(NDIM,NNOL,PLA,
     &                    FFC,JAC,COEFFP,
     &                    SEUIL,TAU1,TAU2,MU,
     &                    LACT,MMAT )         
         ELSE
           CALL ASSERT(ALGOFR.EQ.0)
         ENDIF
C
      ELSE
         CALL ASSERT(INDCO.EQ.0 .OR. INDCO.EQ.1)
      ENDIF
      END
