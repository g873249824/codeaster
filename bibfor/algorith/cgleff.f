      SUBROUTINE CGLEFF(TYPFIS,NOMFIS,FONOEU,CHFOND,BASFON,TAILLR,
     &                  CONF,LNOFF)
      IMPLICIT NONE
      INCLUDE 'jeveux.h'

      CHARACTER*8  TYPFIS,NOMFIS

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 07/01/2013   AUTEUR LADIER A.LADIER 
C ======================================================================
C COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE GENIAUT S.GENIAUT
C
C     SOUS-ROUTINE DE L'OPERATEUR CALC_G
C
C     BUT : LECTURE DE LA DESCRIPTION DU FOND DE FISSURE
C           -> CREATION DES OBJETS FONOEU, CHFOND ET BASFON
C           -> CALCUL DU NOMBRE DE NOEUDS (POINTS) DU FOND : LNOFF
C
C           X-FEM : TRAITEMENT DES MOTS-CLES NUME_FOND ET NB_POINT_FOND
C
C  IN :
C     TYPFIS : TYPE DE LA SD DECRIVANT LE FOND DE FISSURE
C            ('THETA' OU 'FONDIFSS' OU 'FISSURE')
C     NOMFIS : NOM DE LA SD DECRIVANT LE FOND DE FISSURE
C
C  OUT
C     FONOEU : NOMS DES NOEUDS DU FOND DE FISSURE
C     CHFOND : COORDONNES DES POINTS/NOEUDS DU FOND DE FISSURE
C     BASFON : BASE LOCALE AU FOND DE FISSURE
C     TAILLR : TAILLES DES MAILLES CONNECTEES AUX NOEUDS
C     CONF   : CONFIGURATION DE LA FISSURE EN FEM
C     LNOFF  : NOMBRE DE NOEUDS (OU POINTS) DU FOND DE FISSURE
C
C ======================================================================
C
      CHARACTER*8  CONF,K8B
      CHARACTER*24 FONOEU,CHFOND,BASFON,TAILLR
      CHARACTER*24 NOEUIN,FONDIN,BASEIN,TAILIN
      INTEGER      IER,IBID,LNOFF

      CALL JEMARQ()

C     INITIALISATION DES OBJETS PROPRES A CALC_G

C     1) FONOEU = NOM DES NOEUDS DU FOND DE FISSURE
      FONOEU = '&&0100.FONDNOEU'

C     2) CHFOND = COORDONNEES DES POINTS/NOEUDS DU FOND DE FISSURE
      CHFOND = '&&0100.FONDFISS'

C     3) BASFON = BASE LOCALE AU FOND DE FISSURE
      BASFON = '&&0100.BASEFOND'

C     4) TAILLR = TAILLES DES MAILLES CONNECTEES AUX NOEUDS
      TAILLR = '&&0100.TAILLR'

      CONF = '        '

      IF (TYPFIS.EQ.'THETA') THEN

C       SI THETA : ON NE PEUT RIEN REMPLIR

C       RAJOUTER LA REGLE CAPY EXCLUS THETA ET NUME_FOND
C       RAJOUTER LA REGLE CAPY EXCLUS FOND_FISS ET NUME_FOND

      ELSEIF (TYPFIS.EQ.'FONDFISS') THEN

C       1) FONOEU = NOM DES NOEUDS DU FOND DE FISSURE
        NOEUIN=NOMFIS//'.FOND.NOEU'

C       VERIF D'EXISTENCE (CET OBJET DOIT NORMALEMENT EXISTER CAR
C       LE CAS DES FONDS DOUBLES EST INTERDITS)
        CALL JEEXIN(NOEUIN,IER)
        CALL ASSERT(IER.NE.0)

        CALL JEDUPO(NOEUIN,'V',FONOEU,.FALSE.)

C       RECUP DE LNOFF
        CALL JELIRA(NOEUIN,'LONMAX',LNOFF,K8B)

C       2) CHFOND = COORDONNEES DES POINTS/NOEUDS DU FOND DE FISSURE
        FONDIN=NOMFIS//'.FONDFISS'

C       VERIF D'EXISTENCE (CET OBJET DOIT NORMALEMENT EXISTER)
        CALL JEEXIN(FONDIN,IER)
        CALL ASSERT(IER.NE.0)

        CALL JEDUPO(FONDIN,'V',CHFOND,.FALSE.)

C       3) BASFON = BASE LOCALE AU FOND DE FISSURE
        BASEIN=NOMFIS//'.BASEFOND'
C ======================================================================
C       CET OBJET N'EXISTE QUE SI CONFIG_INIT='COLLEE'
        CALL DISMOI('F','CONFIG_INIT',NOMFIS,'FOND_FISS',IBID,CONF,IER)
        IF (CONF.EQ.'COLLEE') THEN
          CALL JEEXIN(BASEIN,IER)
          CALL ASSERT(IER.NE.0)
          CALL JEDUPO(BASEIN,'V',BASFON,.FALSE.)
        ENDIF

C       4) TAILLR = TAILLES DES MAILLES CONNECTEES AUX NOEUDS
        TAILLR = NOMFIS//'.FOND.TAILLE_R'
C ======================================================================
C       CET OBJET N'EXISTE QUE SI CONFIG_INIT='COLLEE'
        IF (CONF.EQ.'COLLEE') THEN
          CALL JEEXIN(TAILLR,IER)
          CALL ASSERT(IER.NE.0)
        ENDIF

      ELSEIF (TYPFIS.EQ.'FISSURE') THEN

C       1) FONOEU N'EXISTE PAS EN X-FEM

C       2) ET 3) CREATION DE LA LISTE DES POINTS DU FOND A CALCULER
C       EN PRENANT EN COMPTE LES MOTS-CLES NUME_FOND ET NB_POINT_FOND
        CALL XRECFF(NOMFIS,CHFOND,BASFON,LNOFF)

C       4) TAILLR = TAILLES DES MAILLES CONNECTEES AUX NOEUDS
        TAILLR = NOMFIS//'.FOND.TAILLE_R'

      ENDIF

      CALL JEDEMA()

      END
