      SUBROUTINE NTETCR(NUMEDD,COMPOR,SDIETO,LNONL ,VHYDR ,
     &                  HYDR0 )
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 13/06/2012   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C
      IMPLICIT     NONE
      INCLUDE 'jeveux.h'
      CHARACTER*24 NUMEDD,SDIETO,COMPOR
      CHARACTER*24 VHYDR
      LOGICAL      LNONL
      CHARACTER*24 HYDR0
C
C ----------------------------------------------------------------------
C
C ROUTINE THER_* (GESTION IN ET OUT)
C
C CREATION DE LA SD IN ET OUT
C
C ----------------------------------------------------------------------
C
C
C IN  COMPOR : CARTE COMPORTEMENT
C IN  SDIETO : SD GESTION IN ET OUT
C
C
C
C
      INTEGER      ZIOCH,NBMAX
      PARAMETER    (ZIOCH = 10,NBMAX=3 )
      INTEGER      NBCHAM,NBCHIN,NBCHOU
      CHARACTER*24 IOINFO,IOLCHA
      INTEGER      JIOINF,JIOLCH
      INTEGER      ICHAM,ICH,NEQ
      LOGICAL      LHYDR
      CHARACTER*19 TEMP0
      CHARACTER*24 NOMCHA,NOMCHX,NOMCH0
      LOGICAL      CHAACT(NBMAX)
C
      CHARACTER*24 NOMCHS(NBMAX),MOTCOB(NBMAX)
      CHARACTER*24 NOMGD(NBMAX),MOTCEI(NBMAX),LOCCHA(NBMAX)
      LOGICAL      LARCH(NBMAX),LETIN(NBMAX)
C -- NOM DU CHAMP DANS LA SD RESULTAT
      DATA NOMCHS  /'TEMP'        ,'HYDR_ELNO'   ,'COMPORTHER'  /
C -- NOM DE LA GRANDEUR
      DATA NOMGD   /'TEMP_R','HYDR_R','COMPOR'/
C -- MOT-CLEF DANS ETAT_INIT, ' ' SI PAS DE MOT-CLEF
      DATA MOTCEI  /'CHAM_NO',' ',' '/
C -- LOCALISATION DU CHAMP
      DATA LOCCHA  /'NOEU','ELNO','ELGA'/ 
C -- .TRUE. SI CHAMP EST LU DANS ETAT_INIT
      DATA LETIN   /.TRUE. ,.TRUE. ,.FALSE./
C -- .TRUE. SI CHAMP EST ECRIT DANS ARCHIVAGE
      DATA LARCH   /.TRUE. ,.TRUE. ,.TRUE. /
C -- MOT-CLEF DANS OBSERVATION, ' ' SI PAS DE MOT-CLEF
      DATA MOTCOB  /'TEMP'        ,' '   ,' '/    
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- INITIALISATIONS
C
      NBCHAM = 0
      NBCHIN = 0
      NBCHOU = 0
      DO 1 ICHAM=1,NBMAX
        CHAACT(ICHAM) = .FALSE.
    1 CONTINUE
      TEMP0  = '&&NTETCR.TEMP0'
C
C --- FONCTIONNALITES ACTIVEES
C
      LHYDR = .FALSE.
      IF (LNONL) CALL NTHYDR(LHYDR)
C
C --- PREPARATION CHAMP NUL
C
      CALL VTCREB(TEMP0 ,NUMEDD,'V','R',NEQ)
C
C --- CHAMPS STANDARD
C
      CHAACT(1) = .TRUE.
C
C --- CARTE COMPORTEMENT
C
      IF (LNONL) THEN
        CHAACT(3) = .TRUE.
      ENDIF
C
C --- CHAMP HYDRATATION
C
      IF (LHYDR) THEN
        CHAACT(2) = .TRUE.
      ENDIF
C
C --- DECOMPTE DES CHAMPS
C
      DO 20 ICHAM = 1,NBMAX
        IF (CHAACT(ICHAM)) THEN
          NBCHAM = NBCHAM + 1
          IF (LETIN(ICHAM)) NBCHIN = NBCHIN + 1
          IF (LARCH(ICHAM)) NBCHOU = NBCHOU + 1
        ENDIF  
   20 CONTINUE        
C
C --- CREATION SD CHAMPS
C
      IOLCHA = SDIETO(1:19)//'.LCHA'
      CALL WKVECT(IOLCHA,'V V K24',NBCHAM*ZIOCH,JIOLCH)
C
C --- AJOUT DES CHAMPS
C
      ICH = 0
      DO 30 ICHAM = 1,NBMAX
        IF (CHAACT(ICHAM)) THEN
          ICH = ICH + 1
          CALL NMETCI(SDIETO,ZIOCH ,ICH   ,
     &                NOMCHS(ICHAM),NOMGD (ICHAM),
     &                MOTCEI(ICHAM),MOTCOB(ICHAM),
     &                LOCCHA(ICHAM),
     &                LETIN (ICHAM),LARCH (ICHAM))  
        ENDIF  
   30 CONTINUE
      CALL ASSERT(ICH.EQ.NBCHAM)  
C
C --- NOM DU CHAMP
C      
      DO 40 ICHAM = 1,NBCHAM
        NOMCHA = ZK24(JIOLCH+ZIOCH*(ICHAM-1)+1-1)
        IF (NOMCHA.EQ.'TEMP') THEN
          NOMCHX = 'CHAP#VALINC#TEMP'
        ELSEIF (NOMCHA.EQ.'HYDR_ELNO') THEN
          NOMCHX = VHYDR            
        ELSEIF (NOMCHA.EQ.'COMPORTHER') THEN
          NOMCHX = COMPOR         
        ELSE
          WRITE(6,*) 'NOMCHA: ',NOMCHA
          CALL ASSERT(.FALSE.)
        ENDIF                                    
        ZK24(JIOLCH+ZIOCH*(ICHAM-1)+6-1) = NOMCHX   
   40 CONTINUE
C
C --- NOM DU CHAMP NUL
C      
      DO 50 ICHAM = 1,NBCHAM
        NOMCHA = ZK24(JIOLCH+ZIOCH*(ICHAM-1)+1-1)    
        IF (NOMCHA.EQ.'TEMP') THEN
          NOMCH0 = TEMP0
        ELSEIF (NOMCHA.EQ.'HYDR_ELNO') THEN
          NOMCH0 = HYDR0         
        ELSEIF (NOMCHA.EQ.'COMPORTHER') THEN
          NOMCH0 = ' '        
        ELSE
          WRITE(6,*) 'NOMCHA: ',NOMCHA
          CALL ASSERT(.FALSE.)
        ENDIF                                    
        ZK24(JIOLCH+ZIOCH*(ICHAM-1)+2-1) = NOMCH0  
   50 CONTINUE
C
C --- CREATION SD INFOS
C
      IOINFO = SDIETO(1:19)//'.INFO'
      CALL WKVECT(IOINFO,'V V I',4,JIOINF)
      ZI(JIOINF+1-1) = NBCHAM
      ZI(JIOINF+2-1) = NBCHIN
      ZI(JIOINF+3-1) = NBCHOU 
      ZI(JIOINF+4-1) = ZIOCH 
C
      CALL JEDEMA()
      END
