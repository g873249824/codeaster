      SUBROUTINE MMTANR(NOMA  ,NDIM  ,NEQ   ,DEFICO,RESOCO,
     &                  IZONE ,LISSS ,VECPOU,LPIVAU,LFROTT,
     &                  LSSCON,LSSRAC,POSMAE,POSMAM,IPC   ,
     &                  KSI1  ,KSI2  ,NPEX  ,INI1  ,INI2  ,
     &                  TAU1  ,TAU2  ,EXNOEC,EXNOEF,EXNOER)
C     
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 24/09/2007   AUTEUR ABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C TOLE CRP_21
C
      IMPLICIT NONE
      LOGICAL      LISSS,VECPOU,LPIVAU,LFROTT,LSSCON,LSSRAC
      CHARACTER*8  NOMA
      INTEGER      NEQ,NDIM
      INTEGER      POSMAM,POSMAE,IZONE
      REAL*8       KSI1,KSI2
      CHARACTER*24 DEFICO,RESOCO
      REAL*8       TAU1(3),TAU2(3)
      INTEGER      IPC,INI1,INI2
      INTEGER      NPEX     
      LOGICAL      EXNOEC,EXNOEF,EXNOER
C
C ----------------------------------------------------------------------
C
C ROUTINE CONTACT (METHODE CONTINUE - APPARIEMENT)
C
C MODIFIE LES VECTEURS TANGENTS LOCAUX SUIVANT OPTIONS
C      
C ----------------------------------------------------------------------
C
C
C NB: CONFUSION NOEUD/POINT DE CONTACT CAR LES OPTIONS FONCTIONNENT
C QUE POUR INTEGRATIONs='NOEUD'
C
C IN  LPIVAU : SI MECANISME AUTO DETECTION DES REDONDANCES ACTIVE
C IN  LISSS  : LES TANGENTES SONT A LISSER
C IN  LFROTT : FROTTEMENT
C IN  LSSCON : IL Y A DES NOEUDS DANS SANS_GROUP_NO
C IN  LSSRAC : IL Y A DES NOEUDS DANS GROUP_RACC
C IN  VECPOU : UN REPERE LOCAL POUR L APOUTRE A ETE DEFINI
C IN  NOMA   : NOM DU MAILLAGE
C IN  DEFICO : SD POUR LA DEFINITION DE CONTACT 
C IN  RESOCO : SD POUR LA RESOLUTION DE CONTACT
C IN  NDIM   : DIMENSION DE L'ESPACE
C IN  NEQ    : NOMBRE D'EQUATIONS DU SYSTEME
C IN  IZONE  : ZONE DE CONTACT ACTIVE
C IN  POSMAM : MAILLE MAITRE QUI RECOIT LA PROJECTION
C IN  POSMAE : MAILLE ESCLAVE CONTENANT LE POINT DE CONTACT
C IN  IPC    : NUMERO DU NOEUD DE LA MAILLE MAITRE
C IN  NPEX   : NOMBRE DE NOEUDS EXCLUS SUR LA MAILLE
C IN  INI1   : NUMERO DU PREMIER NOEUD A EXCLURE
C IN  INI2   : NUMERO DU DEUXIEME NOEUD A EXCLURE
C IN  KSI1   : COORDONNEE X DU POINT ESCLAVE PROJETE
C IN  KSI2   : COORDONNEE Y DU POINT ESCLAVE PROJETE
C OUT EXNOEC : VAUT .TRUE. SI LE NOEUD DOIT ETRE EXCLU COMPLETEMENT
C OUT EXNOEF : VAUT .TRUE. SI LE NOEUD DOIT ETRE EXCLU DE 
C              LA SURFACE DE CONTACT SUIVANT UNE DIRECTION (FROTTEMENT)
C OUT EXNOER : VAUT .TRUE. SI LE NOEUD DOIT ETRE EXCLU DE 
C              LA SURFACE DE CONTACT A CAUSE D'UN RACCORD_LINE_QUAD
C OUT TAU1   : PREMIER VECTEUR TANGENT LOCAL AU POINT ESCLAVE PROJETE
C OUT TAU2   : SECOND VECTEUR TANGENT LOCAL AU POINT ESCLAVE PROJETE
C      
C ----------------------------------------------------------------------
C
      INTEGER      IBID,VALRET
      LOGICAL      LBID
      CHARACTER*24 K24BLA,K24BID
      REAL*8       NORME1,VNORM(3)
C
C ----------------------------------------------------------------------
C
C
C --- INITIALISATIONS
C
      EXNOEC = .FALSE.
      EXNOER = .FALSE.
      EXNOEF = .FALSE.     
      K24BLA = ' '
C          
C --- LISSAGE DES VECTEURS TANGENTS    
C          
      IF (LISSS) THEN
        CALL COPNOR(NOMA  ,DEFICO,POSMAM,KSI1  ,KSI2  ,
     &              TAU1  ,TAU2)
      END IF
C
C --- DEFINITION BASE TANGENTE LOCALE DANS LE CAS DES POUTRES
C 
      IF (VECPOU) THEN
        CALL MMINFP(IZONE ,DEFICO,K24BLA,'VECT_ORIE_POU',
     &              IBID  ,TAU2  ,K24BID,LBID)
        CALL NORMEV(TAU2,NORME1)
      END IF  
C
C --- ON TESTE SI NOEUD EST IMPLIQUE DANS DES RELATIONS
C --- DE TYPE LAGRANGE/LIAISON_DDL
C      
      IF (LPIVAU) THEN 
        CALL MMNORM(NDIM  ,TAU1  ,TAU2  ,VNORM)
        CALL REDCEX(NEQ   ,NOMA  ,DEFICO,RESOCO,VNORM ,
     &              IPC   ,POSMAE,EXNOEC)
      END IF
C
C --- ON TESTE SI NOEUD EST DANS SANS_GROUP_NO
C
      IF (LSSCON) THEN
        CALL MMNOEX(DEFICO,IZONE,POSMAE,IPC   ,EXNOEC)
      ENDIF
C
C --- ON TESTE SI NOEUD EST DANS GROUP_RACC
C      
      IF (LSSRAC) THEN      
        CALL MMRACC(DEFICO,IZONE,POSMAE,IPC   ,EXNOER)
      ENDIF  
C                 
C --- DEFINITION BASE TANGENTE LOCALE APRES EXCLUSION DES NOEUDS DE
C --- FROTTEMENT
C 
      IF (LFROTT) THEN         
        CALL MMTGEX(NOMA  ,NDIM  ,DEFICO,IZONE ,POSMAE,
     &              IPC   ,NPEX  ,INI1  ,INI2  ,EXNOEF,
     &              TAU1  ,TAU2  ,VALRET)
      ENDIF
C
      END
