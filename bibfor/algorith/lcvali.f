      SUBROUTINE LCVALI (FAMI,KPG,KSP,IMATE,COMPOR,NDIM,
     &                   EPSM,DEPS,INSTAM,INSTAP,CODRET)
C ----------------------------------------------------------------------
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 19/12/2012   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C
      IMPLICIT NONE
      INTEGER IMATE,KPG,KSP,IRET1,IRET2,IRET3,CODRET,ICODRE(4),IRET,NDIM
      INTEGER NDIMSI
      CHARACTER*(*) FAMI
      CHARACTER*8 NOMRES(4)
      CHARACTER*16  COMPOR(*)
      REAL*8 DEPS(6),EPSM(6),EPS(6),VALRES(4),EPSMAX,EPS2,VEPSM,VEPS(6)
      REAL*8 VEPS2,INSTAM,INSTAP,DT,TMAX,TMIN,TEMP,DDOT

C     EXAMEN DU DOMAINE DE VALIDITE
      IRET1=0
      IRET2=0
      IRET3=0
      NDIMSI=2*NDIM
      IF (COMPOR(3).EQ.'SIMO_MIEHE') GOTO 9999

      NOMRES(1)='EPSI_MAXI'
      NOMRES(2)='VEPS_MAXI'
      NOMRES(3)='TEMP_MINI'
      NOMRES(4)='TEMP_MAXI'
      CALL RCVALB(FAMI,KPG,KSP,'+',IMATE,' ','VERI_BORNE',
     &               0,' ',0.D0,4,NOMRES,VALRES,ICODRE,0)

C     TRAITEMENT DE EPSI_MAXI
      IF (ICODRE(1).EQ.0) THEN
         EPSMAX=VALRES(1)
         CALL DCOPY(NDIMSI,EPSM,1,EPS,1)
         CALL DAXPY(NDIMSI,1.D0,DEPS,1,EPS,1)
         EPS2=SQRT(DDOT(NDIMSI,EPS,1,EPS,1))
         IF (EPS2.GT.EPSMAX) THEN
            IRET1=4
         ENDIF
      ENDIF
C     TRAITEMENT DE VEPS_MAXI
      IF (ICODRE(2).EQ.0) THEN
         VEPSM=VALRES(2)
         DT=INSTAP-INSTAM
         CALL DAXPY(NDIMSI,1.D0/DT,DEPS,1,VEPS,1)
         VEPS2=SQRT(DDOT(NDIMSI,VEPS,1,VEPS,1))
         IF (VEPS2.GT.VEPSM) THEN
            IRET2=4
         ENDIF
      ENDIF
C     TRAITEMENT DE TEMP_MINI ET TEMP_MAXI
      IF (ICODRE(3).EQ.0) THEN
         TMIN=VALRES(3)
         TMAX=VALRES(4)
         CALL RCVARC(' ','TEMP','+',FAMI,KPG,KSP,TEMP,IRET)
         IF (IRET.EQ.0) THEN
            IF ((TEMP.LT.TMIN).OR.(TEMP.GT.TMAX)) THEN
               IRET3=4
            ENDIF
         ENDIF
      ENDIF
      
      CODRET=MAX(IRET1,IRET2)
      CODRET=MAX(CODRET,IRET3)
      
 9999 CONTINUE      
      END
