         SUBROUTINE  EPSTHM(NDDLS,NDDLM,NNO,NNOS,NNOM,
     &               DIMDEF,DIMUEL,NDIM,NPI,IPOIDS,IPOID2,IVF,IVF2,
     &               IDFDE,IDFDE2,GEOM,DEPLA,NMEC,MECANI,PRESS1,PRESS2,
     &               TEMPE,NP1,NP2,AXI,EPSM)

       IMPLICIT NONE
       INTEGER      CODRET,DIMUEL,NNO,NNOS,NNOM,NPI
       INTEGER      IPOIDS,IPOID2,IVF,IVF2,IDFDE,IDFDE2,DIMDEF
       INTEGER      NDDLS,NDDLM,NMEC,NP1,NP2,NDIM
       INTEGER      MECANI(5),PRESS1(7),PRESS2(7),TEMPE(5)
       REAL*8       GEOM(NDIM,NNO),EPSM(6,NPI),DEPLA(DIMUEL)
       REAL*8       DFDI(NNO,3),DFDI2(NNOS,3)
       LOGICAL      AXI
       INTEGER      YAMEC,YAP1,YAP2,YATE
       INTEGER      ADDEME,ADDEP1,ADDEP2,ADDETE
C ======================================================================
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 16/08/2005   AUTEUR ROMEO R.FERNANDES 
C ======================================================================
C COPYRIGHT (C) 1991 - 2005  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C TOLE  CRP_21
C ======================================================================
C     BUT:  CALCUL  DES DEFORMATIONS MECANIQUES AU POINT DE GAUSS 
C           EN MECANIQUE DES MILIEUX POREUX AVEC COUPLAGE THM 
C ======================================================================
C IN  NDDL    : NOMBRE DE DEGRES DE LIBERTES PAR NOEUD DE L'ELEMENT
C IN  NNO     : NOMBRE DE NOEUDS DE L'ELEMENT
C IN  NNOS    : NOMBRE DE NOEUDS SOMMET DE L'ELEMENT
C IN  DIMDEF  : DIMENSION DU TABLEAU DES DEFORMATIONS GENERALISEES 
C               AU POINT DE GAUSS
C IN  NDIM    : DIMENSION DU PROBLEME
C IN  NPG     : NOMBRE DE POINTS DE GAUSS
C IN  IPOIDS  : ADRESSE DANS ZR DU TABLEAU POIDS(IPG)
C IN  IVF     : ADRESSE DANS ZR DU TABLEAU FF(INO,IPG)
C IN  IDFDE   : ADRESSE DANS ZR DU TABLEAU DFF(IDIM,INO,IPG)
C IN  GEOM    : COORDONEES DES NOEUDS
C IN  DEPLA   : VALEURS DES DEPLACEMENTS AUX NOEUDS
C IN  NMEC    : VARIABLE CARACTERISANT LE MILIEU
C IN  MECANI  : VARIABLE CARACTERISANT LE MILIEU
C IN  PRESS1  : VARIABLE CARACTERISANT LE MILIEU
C IN  PRESS2  : VARIABLE CARACTERISANT LE MILIEU
C IN  TEMPE   : VARIABLE CARACTERISANT LE MILIEU
C IN  NP1     : VAUT 1 SI LA MODELISATION CONTIENT UNE PRESSION 
C               COMME VARIABLE
C IN  NP2     : VAUT 1 SI LA MODELISATION CONTIENT UNE DEUXIEME
C               PRESSION COMME VARIABLE
C IN  AXI     : VRAI SI ELEMENT APPELANT AXI
C OUT EPSM  : DEFORMATIONS AUX POINTS DE GAUSS SUR L ELEMENT COURANT
C ======================================================================
      INTEGER  KPI,I,N,J
      REAL*8   POIDS,POIDS2,B(DIMDEF,DIMUEL)   

      YAMEC  = MECANI(1)
      ADDEME = MECANI(2)
      YAP1   = PRESS1(1)
      ADDEP1 = PRESS1(3)
      YAP2   = PRESS2(1)
      ADDEP2 = PRESS2(3)
      YATE   = TEMPE(1)
      ADDETE = TEMPE(2)

      DO 10 KPI=1,NPI
C ======================================================================
C --- CALCUL DE LA MATRICE B AU POINT DE GAUSS -------------------------
C ======================================================================
         CALL CABTHM(NDDLS,NDDLM,NNO,NNOS,NNOM,DIMUEL,
     +               DIMDEF,NDIM,NPI,KPI,IPOIDS,IPOID2,IVF,IVF2,
     +               IDFDE,IDFDE2,DFDI,DFDI2,
     +               GEOM,POIDS,POIDS2,B,NMEC,YAMEC,ADDEME,YAP1,
     +               ADDEP1,YAP2,ADDEP2,YATE,ADDETE,NP1,NP2,AXI)
C ======================================================================
C --- CALCUL DES DEFORMATIONS ------------------------------------------
C ======================================================================
         DO 108 I=1,6
            EPSM(I,KPI)=0.D0
            DO 109 J=1,DIMUEL
               EPSM(I,KPI)=EPSM(I,KPI)+B(I+NDIM,J)*DEPLA(J)
 109        CONTINUE
 108     CONTINUE
 10   CONTINUE
C ======================================================================
      END
