      SUBROUTINE PREP1(G,NDIM,NPG,ETDPN1,JM,SIGM,FDA,
     &                  ETDPNV,SIGMM,TAU,FDAT,CONTM,SIGMAM)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 08/12/2009   AUTEUR PROIX J-M.PROIX 
C ======================================================================
C COPYRIGHT (C) 1991 - 2009  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
      IMPLICIT NONE
      INTEGER NDIM,I,NPG,J,G
      REAL*8 ETDPN1(3,3),SIGM(2*NDIM,NPG),FDA(3,3)
      REAL*8 ETDPNV(6)      
      REAL*8 WORK(9),RAC2,JM

C ---------------------------------
C   G       : NUMERO DU POINT DE GAUSS COURANT
C   NDIM    : DIMENSION DE L'ESPACE
C   NPG     : NOMBRE DE POINTS DE GAUSS
C   JM      : DETERMINANT DE FM
C   SIGM    : CONTRAINTES DE CAUCHY EN T-
C   FDA     :  TENSEUR DE DEFORMATION ENTRE CONFIGURATION T- ET 
C             CONFIGURATION INTERMEDIAIRE
C   ETDPN1  : 
C   TAU     : CONTRAINTYE DE CAUCHY



C   SORTIE:
C   SIGMM   : MATRICE CORRESPONDANT AU VECTEUR SIGM
C   FDAT    : TRANSPOSEE DU TENSEUR DE DEFORMATION ENTRE 
C             CONFIGURATION T- ET 
C             CONFIGURATION INTERMEDIAIRE
C   CONTM   : TENSEUR DES CONTRAINTES TRANSFORME POUR ENTREE DE NMCOMP
C   SIGMAM  : TENSEUR DE DEFORMATION TRANSFORME POUR ENTREE DE NMCOMP
C ----------------------------
C
C     CALCUL DES ENTREE DE NMCOMP CONTM ET SIGMAM POUR SIMO_HUGHES1
C
C ----------------------------
      REAL*8 SIGMM(3,3),TAU(3,3), FDAT(3,3)
      REAL*8 CONTM(3,3),SIGMAM(6)


      
      RAC2 = SQRT(2.D0)
C---------------------------------INITIALISATION---------
      CALL R8INIR(9,0.D0,SIGMM,1)
      CALL R8INIR(9,0.D0,TAU,1)
      CALL R8INIR(9,0.D0,FDAT,1)
      CALL R8INIR(9,0.D0,CONTM,1)
      CALL R8INIR(9,0.D0,SIGMAM,1)

C------TRANSFORMATION DES ARG D ENTRE SUBROUTINE NMCOMP--------------

C     TRANSFORMATION MATRICE EN VECTEUR DE e~_(n+ALPHA)
      CALL TNSVEC(3,NDIM,ETDPN1,ETDPNV,RAC2)
      
C     TRANSF MATRICE EN VECTEUR DES CONTRAINTES 
      CALL TNSVEC(6,NDIM,SIGMM,SIGM(1,G),RAC2)
      
C     TENSEUR DE KIRCHHOFF
      DO 3 I=1,3
         DO 31 J=1,3
          TAU(I,J)= JM*SIGMM(I,J)
 31      CONTINUE
 3    CONTINUE

      CALL LCTR2M(3,FDA,FDAT)

C     CALCUL DE CONTRAINTE: VARIABLE D ENTREE DE NMCOMP ET 
C     TRANSFORMATION EN VECTEUR
      CALL UTBTAB('ZERO',3,3,TAU,FDAT,WORK,CONTM)
      CALL TNSVEC(3,NDIM,CONTM,SIGMAM,RAC2)

      END
