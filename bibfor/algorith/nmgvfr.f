      SUBROUTINE NMGVFR(NDIM,NNO1,NNO2,NNO3,NPG,IW,VFF1,FORC,
     &  IDFDE1,COMPOR,GEOM,VECT)

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 15/05/2007   AUTEUR GENIAUT S.GENIAUT 
C ======================================================================
C COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================

       IMPLICIT NONE

       CHARACTER*16  COMPOR

       INTEGER NDIM,NNO1,NNO2,NNO3,NPG,IDFDE1,IW
       REAL*8  VFF1(NNO1,NPG)
       REAL*8  GEOM(NDIM,NNO1)
       REAL*8  VECT(*)
C ----------------------------------------------------------------------
C
C     FORC_NODA POUR GRAD_VARI (2D ET 3D)
C
C IN  NDIM    : DIMENSION DES ELEMENTS 
C IN  NNO1    : NOMBRE DE NOEUDS (FAMILLE U)
C IN  VFF1    : VALEUR DES FONCTIONS DE FORME (FAMILLE U)
C IN  IDFDE1  : DERIVEES DES FONCTIONS DE FORME DE REFERENCE (FAMILLE U)
C IN  NNO2    : NOMBRE DE NOEUDS (FAMILLE E)
C IN  VFF2    : VALEUR DES FONCTIONS DE FORME (FAMILLE E)
C IN  IDFDE2  : DERIVEES DES FONCTIONS DE FORME DE REFERENCE (FAMILLE E)
C IN  NPG     : NOMBRE DE POINTS DE GAUSS
C IN  IW      : POIDS DES POINTS DE GAUSS DE REFERENCE (INDICE)
C IN  GEOM    : COORDONNEES DES NOEUDS
C IN  TYPMOD  : TYPE DE MODEELISATION
C IN  SIGM    : CONTRAINTES A L'INSTANT PRECEDENT
C OUT VECT    : FORCES INTERIEURES    (RAPH_MECA   ET FULL_MECA_*)
C ----------------------------------------------------------------------
      
      LOGICAL AXI
      INTEGER IBID,NDDL,G,COD(27),N,I,M,J,KL,PQ,KK,OS
      INTEGER IU(3*27),IA(8),IL(8)
      REAL*8  DFDI1(27,3),D
      REAL*8  AV,MU,AG,BP,FORC(3)
      REAL*8  R,WG
      REAL*8  R8DOT,R8VIDE
C ----------------------------------------------------------------------



C - INITIALISATION

      AXI    = .FALSE.
      NDDL   = NNO1*NDIM + NNO2*2

      
      CALL R8INIR(NDDL,0.D0,VECT,1)
      CALL NMGVDD(NDIM,NNO1,NNO2,IU,IA,IL)
      
      DO 1000 G=1,NPG

        CALL DFDMIP(NDIM,NNO1,AXI,GEOM,G,IW,VFF1(1,G),IDFDE1,R,WG,DFDI1)

        DO 300 N=1,NNO1
          DO 310 I=1,NDIM
            KK = IU(NNO1*(I-1)+N)
            VECT(KK) = VECT(KK) + WG*VFF1(N,G)*FORC(I)
 310      CONTINUE
 300    CONTINUE


 1000 CONTINUE

      END
