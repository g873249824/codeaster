      SUBROUTINE XVFROT(ALGOFR,COEFFP,COEFFR,DDLM  ,DDLS  ,
     &                  FFC   ,FFP   ,IDEPL ,IDEPM ,IFA   ,
     &                  IFISS ,INDCO ,JAC   ,
     &                  JFISNO,JHEAFA,LACT  ,MU    ,NCOMPH,
     &                  ND    ,NDDL  ,NDIM  ,NFH   ,NFISS ,
     &                  NNO   ,NNOL  ,NNOS  ,
     &                  NVIT  ,PLA   ,REAC12,RR    ,SEUIL ,
     &                  SINGU ,TAU1  ,TAU2  ,VTMP)
      IMPLICIT NONE
      INCLUDE 'jeveux.h'
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 19/12/2012   AUTEUR PELLET J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C TOLE CRP_21
C IN ALGOFR : ALGO FROTTEMENT (1:LAG, 2:PENA, 0:RIEN)
C IN CFACE  : CONNECTIVITE FACETTES DE CONTACT
C IN COEFFR : COEF AUGMENTATION FROT
C IN COEFFP : COEF PENALISATION FROT
C IN DDLM   : NOMBRE DE DDLS A CHAQUE NOEUD MILIEU
C IN DDLS   : NOMBRE DE DDLS A CHAQUE NOEUD SOMMET
C IN FFC    : FONCTIONS DE FORME DE CONTACT
C IN FFP    : FONCTIONS DE FORME ELEMENT PARENT
C IN IDEPL  : ADRESSE DEPLACEMENT COURANT
C IN IDEPM  : ADRESSE DEPLACEMENT INSTANT -
C IN IFA    : NUMERO FACETTE DE CONTACT
C IN INDCO  : ETAT DE CONTACT POINT DE GAUSS
C IN IPGF   : NUMERO POINT DE GAUSS DE CONTACT
C IN IVFF   : ADRESSE FONCTION DE FORME EL PARENT
C IN JAC    : PRODUIT JACOBIEN*POIDS
C IN LACT   : DDL DE LAGRANGE ACTIF OU NON
C IN MU     : COEFFICIENT DE COULOMB
C IN ND     : NORMALE A LA SURFACE DE CONTACT AU PG
C IN NDIM   : DIMENSION DU MODELE
C IN NFH    : NOMBRE DE DDL HEAVISIDE
C IN NFISS  : NOMBRE DE FISSURES
C IN NNO    : NOMBRE DE NOEUDS TOTAL ELEMENT PARENT
C IN NNOF   : NOMBRE DE NOEUDS D UNE FACETTE DE CONTACT
C IN NNOL   : NOMBRE DE NOEUDS EL PARENT PORTEURS DE DDL LAGRANGE
C IN NNOS   : NOMBRE DE NOEUDS SOMMET ELEMENT PARENT
C IN NOEUD  : FORMULATION AUX NOEUDS
C IN NVIT   : ARETE VITALE OU NON
C IN PLA    : PLACE DES DDLS DE LAGRANGE
C IN RR     : RACINE RAYON A LA POINTE DE FISSURE
C IN SINGU  : ELEMENT ENRICHI CTIP OU ON
C IN TAU1   : 1ERE TANGENTE SURFACE DE CONTACT
C IN TAU2   : 2EME TANGENTE (3D)
C OUT VTMP  : VECTEUR DE TRAVAIL SECOND MEMBRE
      INTEGER ALGOFR,DDLM,DDLS
      INTEGER IDEPL,IDEPM,IFA,IFISS
      INTEGER INDCO,JFISNO
      INTEGER JHEAFA,LACT(8),NCOMPH
      INTEGER NDDL,NDIM,NFH,NFISS,NNO
      INTEGER NNOL,NNOS,NVEC,NVIT
      INTEGER PLA(27),SINGU
      REAL*8  COEFFP,COEFFR,FFC(8),FFP(27),JAC
      REAL*8  MU,ND(3),PB(3),REAC12(3),RR,SAUT(3),SEUIL
      REAL*8  TAU1(3),TAU2(3),VTMP(400)
C
      IF(MU.EQ.0.D0)    INDCO = 0
      IF(ALGOFR.NE.0.AND.SEUIL.EQ.0.D0) INDCO = 0
      IF(NFISS.GT.1)    INDCO = 0
C
      IF (INDCO.EQ.0) THEN
         IF (NVIT.NE.0) THEN
           NVEC=2
           CALL XMMSA3(NDIM,NNO,NNOS,FFP,NDDL,NVEC,ZR(IDEPL),
     &                 ZR(IDEPM),ZR(IDEPM),NFH,SINGU,RR,DDLS,DDLM,
     &                 JFISNO,NFISS,IFISS,JHEAFA,NCOMPH,IFA,
     &                 SAUT)
C
C --- CALCUL DU VECTEUR LN3
C
           CALL XMVEF4(NDIM,NNOL,PLA,
     &                 FFC,REAC12,JAC,
     &                 TAU1,TAU2,LACT,
     &                 VTMP)
C
C --- ACTIVATION DE LA LOI COHESIVE & RECUPERATION DES
C --- PARAMETRES MATERIAUX
C
         ENDIF

      ELSE IF (INDCO.EQ.1) THEN
C
C --- CALCUL DU VECTEUR LN1
C
          CALL XMVEF2(NDIM,NNO,NNOS,FFP,JAC,SEUIL,
     &                REAC12,SINGU,NFH,RR,COEFFP,COEFFR,
     &                MU,ALGOFR,ND,DDLS,DDLM,IDEPL,
     &                PB,VTMP )
C
C --- CAS LAGRANGIEN AUGMENTE
C
         IF(ALGOFR.EQ.1) THEN

C
C --- CALCUL DU VECTEUR LN3
C
          CALL XMVEF3(NDIM,NNOL,PLA,
     &                FFC,REAC12,PB,JAC,SEUIL,
     &                TAU1,TAU2,LACT,
     &                COEFFR,MU,VTMP )

         ELSE IF(ALGOFR.EQ.2) THEN

C
C --- CALCUL DU VECTEUR LN3
C
          CALL XMVEF3(NDIM,NNOL,PLA,
     &                FFC,REAC12,PB,JAC,SEUIL,
     &                TAU1,TAU2,LACT,
     &                COEFFP,MU,VTMP )         
         ENDIF

      ELSE
         CALL ASSERT(INDCO.EQ.0 .OR. INDCO.EQ.1)
      END IF
      END
