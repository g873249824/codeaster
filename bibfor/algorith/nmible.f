      subroutine NMIBLE(NIVEAU,PREMIE,MAILLA,DEFICO,OLDGEO,NEWGEO,
     &               DEPMOI,DEPGEO,MAXB,DEPLAM,COMGEO,CSEUIL,COBCA,
     &               NEQ,DEPDEL,DDEPLA,DEPPLU,LIGRCF,CARTCF,MODELE,
     &               LISCHA,SOLVEU,NUMEDD,MCONEL,SCONEL,MEMASS,MASSE,
     &               VITPLU,VITMOI,ACCPLU,ACCMOI,VITINI,ACCINI,CMD,
     &               INST,ICONTX)
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 06/09/2005   AUTEUR TORKHANI M.TORKHANI 
C ======================================================================
C COPYRIGHT (C) 1991 - 2003  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE PBADEL P.BADEL
C TOLE CRP_21
C
      implicit none
C
      logical PREMIE
      integer NIVEAU,MAXB(4),COMGEO,CSEUIL,COBCA,NEQ,ICONTX
      character*8 MAILLA,MCONEL,SCONEL
      character*16 CMD
      character*19 LIGRCF,CARTCF,LISCHA,SOLVEU
      character*24 DEFICO,OLDGEO,NEWGEO,DEPMOI,DEPGEO,DEPLAM
      character*24 DEPDEL,DDEPLA,DEPPLU,MODELE,NUMEDD
      character*24 MEMASS,MASSE,ACCPLU,VITPLU,ACCINI,VITINI
      character*24 ACCMOI,VITMOI
      real*8 INST(5)
C ----------------------------------------------------------------------
C
C   STAT_NON_LINE : ROUTINE D'AIGUILLAGE DES ITERATIONS SE SITUANT
C                   ENTRE LES PAS DE TEMPS ET L'EQUILIBRE
C
C                   POUR LE MOMENT, SERT A LA METHODE CONTINUE DE
C                   CONTACT
C
C                   SERVIRA DANS L'AVENIR POUR LES CALCULS DE
C                   SENSIBILITE
C
C                   LES ITERATIONS ONT LIEU ENTRE CETTE ROUTINE
C                   (NMIBLE) ET SA COUSINE (NMTBLE) QUI COMMUNIQUENT
C                   POUR LE MOMENT PAR LA VARIABLE NIVEAU
C
C   IN  NIVEAU : INDICATEUR D'UTILISATION DE LA BOUCLE 
C        -1     ON N'UTILISE PAS CETTE BOUCLE
C         4     BOUCLE CONTACT METHODE CONTINUE
C                 INITIALISATION 
C         3     BOUCLE CONTACT METHODE CONTINUE
C                 BOUCLE GEOMETRIE
C         2     BOUCLE CONTACT METHODE CONTINUE
C                 BOUCLE SEUILS DE FROTTEMENT
C         1     BOUCLE CONTACT METHODE CONTINUE
C                 BOUCLE CONTRAINTES ACTIVES
C
C   OUT
C -------------- DEBUT DECLARATIONS NORMALISEES  JEVEUX ----------------
C
      character*32 JEXNUM,JEXNOM,JEXATR
      integer ZI
      common /IVARJE/ ZI(1)
      real*8 ZR
      common /RVARJE/ ZR(1)
      complex*16 ZC
      common /CVARJE/ ZC(1)
      logical ZL
      common /LVARJE/ ZL(1)
      character*8 ZK8
      character*16 ZK16
      character*24 ZK24
      character*32 ZK32
      character*80 ZK80
      common /KVARJE/ ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C
C -------------- FIN  DECLARATIONS  NORMALISEES  JEVEUX ----------------
C
      if (NIVEAU .lt. 0) goto 9999
      goto (101,102,103,104) NIVEAU
C
C --- NIVEAU: 4   BOUCLE CONTACT METHODE CONTINUE
C ---             INITIALISATION
C
 104  continue
C -- VITINI, ACCINI Champs utiles pour la methode continue en dynamique
      if (CMD(1:4) .eq. 'DYNA') then
        call COPISD('CHAMP_GD','V',VITPLU,VITINI)
        call COPISD('CHAMP_GD','V',ACCPLU,ACCINI)
      end if
      call DONNCO(MAILLA,OLDGEO,NEWGEO,DEPMOI,DEFICO,DEPGEO,MAXB)
C MAXB(1): ITER_CONT_MAXI
C MAXB(2): ITER_FROT_MAXI
C MAXB(3): ITER_GEOM_MAXI
C MAXB(4): 1 FROTTEMENT = 'SANS'
C          3 FROTTEMENT = 'COULOMB'
      COMGEO = 0
C
C --- NIVEAU: 3   BOUCLE CONTACT METHODE CONTINUE
C ---             BOUCLE GEOMETRIE
C      
 103  continue
      NIVEAU = 3
      COMGEO = COMGEO + 1
      CALL NMIMPR('IMPR','BCL_GEOME',' ',0.D0,COMGEO)
C
C     APPARARIEMENT
      if (ICONTX .eq. 0) then
        call MAPPAR(PREMIE,MAILLA,DEFICO,OLDGEO,NEWGEO,COMGEO,DEPGEO)
      end if

      CSEUIL = 0
C
C --- SI PAS DE FROTTEMENT -> PAS DE BOUCLE SUR SEUIL DE FROTTEMENT
C      
      if (MAXB(4) .eq. 1) goto 666
      call COPISD('CHAMP_GD','V',DEPMOI,DEPLAM)
C
C --- NIVEAU: 2   BOUCLE CONTACT METHODE CONTINUE
C ---             BOUCLE SEUILS DE FROTTEMENT
C 
 102  continue
      NIVEAU = 2
      CSEUIL = CSEUIL + 1
      call NMIMPR('IMPR','BCL_SEUIL',' ',0.d0,CSEUIL)
C
C -- BOUCLE DE CONTRAINTES ACTIVES (CONTACT ECP)
C
 666  continue
      COBCA = 0
C
C --- NIVEAU: 1   BOUCLE CONTACT METHODE CONTINUE
C ---             BOUCLE CONTRAINTES ACTIVES
C      
 101  continue
      NIVEAU = 1
      COBCA  = COBCA + 1
      CALL NMIMPR('IMPR','BCL_CTACT',' ',0.D0,COBCA)
C
C --- AFIN QUE LE VECTEUR DES FORCES D'INERTIE NE SOIT PAS MODIFIE AU
C --- COURS DE LA BOUCLE DES CONTRAINTES ACTIVES PAR L'APPEL A OP0070
C --- ON LE DUPLIQUE ET ON UTILISE CETTE COPIE FIXE (VITINI,ACCINI)
C 
      if (CMD(1:4) .eq. 'DYNA') then
        call COPISD('CHAMP_GD','V',VITINI,VITPLU)
        call COPISD('CHAMP_GD','V',ACCINI,ACCPLU)
      end if

      if (ICONTX .eq. 0) then
        call CONLIG(NEQ,DEPDEL,DDEPLA,DEPMOI,DEPPLU,DEFICO,MAILLA,
     &              LIGRCF,CARTCF,MODELE,LISCHA,SOLVEU,NUMEDD,MCONEL,
     &              SCONEL,MEMASS,MASSE,PREMIE,CMD,INST,VITMOI,ACCMOI)
      else
C       CAS X-FEM
        call XCONLI(NEQ,DEPDEL,DDEPLA,DEPMOI,DEPPLU,PREMIE,MODELE(1:8),
     &              MAILLA,DEFICO,MCONEL,SCONEL)
      end if
C
C
 9999 continue
C
      end
