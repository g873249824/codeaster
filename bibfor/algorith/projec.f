      SUBROUTINE PROJEC(IZONE ,NDIM  ,NEWGEO,RESOCO,DEFICO,
     &                  POSESC,POSMA ,NORM  ,TANG  ,COEF  ,
     &                  COFX  ,COFY  ,JEU   ,NBNOM ,POSNO ,
     &                  NBDDLT,DDL   ,
     &                  NOMA  ,PROJ  ,JEUPM,PROYES)
C     
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 27/11/2007   AUTEUR ABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
C (AT YOUR OPTION) ANY LATER VERSION.                                 
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C TOLE CRP_21
C
      IMPLICIT     NONE
      INTEGER      IZONE
      INTEGER      NDIM
      CHARACTER*8  NOMA
      CHARACTER*24 NEWGEO
      CHARACTER*24 RESOCO
      CHARACTER*24 DEFICO
      INTEGER      PROJ
      INTEGER      POSESC
      INTEGER      POSMA
      REAL*8       NORM(3)
      REAL*8       TANG(6)
      REAL*8       COEF(30)
      REAL*8       COFX(30)
      REAL*8       COFY(30) 
      REAL*8       JEUPM
      REAL*8       JEU
      INTEGER      PROYES
      INTEGER      NBNOM
      INTEGER      POSNO(10)
      INTEGER      NBDDLT
      INTEGER      DDL(30)    
C      
C ----------------------------------------------------------------------
C
C ROUTINE CONTACT (METHODES DISCRETES - APPARIEMENT - MAIT/ESCL)
C
C RECHERCHE DE LA MAILLE LA PLUS PROCHE CONNAISSANT LE NOEUD LE PLUS
C PROCHE
C
C ----------------------------------------------------------------------
C
C
C "PROJECTION" D'UN NOEUD ESCLAVE SUR UNE MAILLE MAITRE.
C CALCUL DES COEFFICIENTS A UTILISER POUR REPRESENTER LE DEPLACEMENT
C DE LA PROJECTION EN FONCTION DES DEPLACEMENTS DES NOEUDS DE LA MAILLE.
C CALCUL DU JEU COURANT. MEMORISATION DES NUMEROS DES DDLS MAITRES.
C
C * ROUTINE APPELEE PAR CHMANO: LA PROJECTION EST UN PREALABLE A LA
C     RECHERCHE DE LA MAILLE LA PLUS PROCHE CONNAISSANT LE NOEUD LE
C     PLUS PROCHE. APAPRIEMENT MAITRE/ESCALVE
C * ROUTINE APPELE PAR PROJCO: LA PROJECTION PROPREMENT DITE
C                  APPARIEMENT NODAL
C
C
C IN  IZONE  : NUMERO DE LA ZONE DE CONTACT
C IN  NDIM   : DIMENSION DE L'ESPACE (2 OU 3)
C IN  NOMA   : NOM DU MAILLAGE
C IN  NEWGEO : GEOMETRIE ACTUALISEE EN TENANT COMPTE DU CHAMP DE
C              DEPLACEMENTS COURANT
C VAR RESOCO : SD DE TRAITEMENT NUMERIQUE DU CONTACT
C IN  DEFICO : SD DE DEFINITION DU CONTACT (ISSUE D'AFFE_CHAR_MECA)
C IN  PROJ   : 0 -> INTERDIT POUR L'INSTANT (SEUL JEU RECALCULE)
C              1 -> PROJECTION LINEAIRE
C              2 -> PROJECTION QUADRATIQUE
C IN  POSNOE : INDICE DU NOEUD ESCLAVE DANS CONTNO
C IN  POSMA  : INDICE DE LA MAILLE MAITRE (OU DU NOEUD MAITRE SI < 0)
C OUT NORM   : DIRECTION DE PROJECTION (DIRECTION PM NORMEE)
C I/O TANG   : LES DEUX VECTEURS TANGENTS
C OUT COEF   : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (DIRECTION NORMALE)
C OUT COEFX  : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (PROJECTION SUR LA PREMIERE TANGENTE)
C OUT COEFY  : COEFFICIENTS LIES AU NOEUD ESCLAVE ET AUX NOEUDS MAITRES
C              (PROJECTION SUR LA SECONDE TANGENTE)
C OUT JEUPM  : JEU DANS LA DIRECTION PM
C OUT JEU    : JEU DANS LA DIRECTION DE LA NORMALE CHOISIE (PM.NORM)
C OUT PROYES : TYPE DE PROJECTION 
C              -1000  PROJECTION EN DEHORS
C                   DE LA MAILLE MAITRE (TOLERANCE TOLEOU ET DEBORD) 
C              -30X   PROJECTION SUR
C                   ENTITE GEOMETRIQUE NOEUD
C                   DE LA MAILLE MAITRE (TOLERANCE TOLEIN ET NOEUD)
C                      X EST LE NUMERO DE NOEUD (1 A 4)
C              -20X   PROJECTION SUR
C                   ENTITE GEOMETRIQUE ARETE
C                   DE LA MAILLE MAITRE (TOLERANCE TOLEIN ET ARETE)
C                      X EST LE NUMERO D'ARETE (1 A 4)
C              -10X   PROJECTION SUR
C                   ENTITE GEOMETRIQUE DIAG (PSEUDO SUR QUADRANGLE)
C                   DE LA MAILLE MAITRE (TOLERANCE TOLEIN ET DIAG)
C                      X EST LE NUMERO DE DIAGONALE (1 A 2)
C               0     PROJECTION NORMALE
C OUT NBNOM  : NOMBRE DE NOEUDS MAITRES CONCERNES
C OUT POSNO  : INDICES DANS CONTNO DES NOEUDS ESCLAVE ET MAITRES
C OUT NBDDLT : NOMBRE DE DDL NOEUD ESCLAVE+NOEUDS MAITRES
C OUT DDL    : NUMEROS DES DDLS ESCLAVE ET MAITRES CONCERNES
C
C -------------- DEBUT DECLARATIONS NORMALISEES JEVEUX -----------------
C
      INTEGER            ZI
      COMMON  / IVARJE / ZI(1)
      REAL*8             ZR
      COMMON  / RVARJE / ZR(1)
      COMPLEX*16         ZC
      COMMON  / CVARJE / ZC(1)
      LOGICAL            ZL
      COMMON  / LVARJE / ZL(1)
      CHARACTER*8        ZK8
      CHARACTER*16                ZK16
      CHARACTER*24                          ZK24
      CHARACTER*32                                    ZK32
      CHARACTER*80                                              ZK80
      COMMON  / KVARJE / ZK8(1) , ZK16(1) , ZK24(1) , ZK32(1) , ZK80(1)
C
C ---------------- FIN DECLARATIONS NORMALISEES JEVEUX -----------------
C
      REAL*8       COORDP(3),COOR(27),COORDM(3)
      CHARACTER*19 NORMMA
      INTEGER      MOYEN,LISSA
      CHARACTER*4  MATYP     
      REAL*8       TOLEIN,TOLEOU
      INTEGER      NBDDLE,DIAGNO
      REAL*8       COEFNO(9),ENORM(3)   
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- CARACTERISTIQUES DU NOEUD ESCLAVE
C
      CALL CARANO(IZONE ,DEFICO,RESOCO,NEWGEO,NDIM  ,
     &            POSESC,COORDP,ENORM ,NBDDLE)   
C
C --- NOEUD ESCLAVE
C
      POSNO(1) = POSESC 
      DIAGNO   = 0  
C
C --- CARACTERISTIQUES DE LA MAILLE MAITRE
C
      CALL CARAMA(NOMA  ,DEFICO,RESOCO,NEWGEO,POSMA ,
     &            IZONE ,POSNO ,MATYP ,NBNOM ,COOR  ,
     &            MOYEN ,LISSA ,NORMMA,TOLEIN,TOLEOU)
C
C --- PROJECTION SUR LA MAILLE (COORDONNEES PROJECTION, JEU, NORMALES) 
C
      IF (POSMA.GT.0) THEN     
        CALL PROJMA(DEFICO,IZONE ,MATYP ,NDIM  ,COOR  ,
     &              COORDP,NORMMA,PROJ  ,MOYEN ,LISSA ,
     &              NBNOM ,DIAGNO,TOLEIN,TOLEOU,ENORM ,
     &              NORM  ,TANG  ,COORDM,COEFNO,JEUPM ,
     &              JEU   ,PROYES)    
      ELSE
        CALL ASSERT(.FALSE.)
      ENDIF 
C
C --- CALCULE LES COEFFICIENTS DES RELATIONS LINEAIRES ET DONNE LES 
C --- NUMEROS DES DDL ASSOCIES
C
      CALL CFCOEF(NDIM  ,DEFICO,NBDDLE,NBNOM,POSNO ,
     &            COEFNO,NORM  ,TANG  ,COEF  ,            
     &            COFX  ,COFY  ,NBDDLT,DDL)
C
      IF (LISSA.EQ.1) THEN
        CALL JEDETR(NORMMA)
      ENDIF  
      CALL JEDEMA()
   
      END
