      SUBROUTINE MERIMP(MODELE,CARELE,MATE  ,COMREF,
     &                  COMPOR,LISCHA,CARCRI,ITERAT,SDDYNA,
     &                  VALMOI,VALPLU,POUGD ,DEPALG,CACO3D,     
     &                  FONACT,NBIN  ,LPAIN ,LCHIN)
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 30/06/2008   AUTEUR FLEJOU J-L.FLEJOU 
C ======================================================================
C COPYRIGHT (C) 1991 - 2007  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C RESPONSABLE ABBAS M.ABBAS
C
      IMPLICIT NONE
      INTEGER       ITERAT
      CHARACTER*(*) MATE
      LOGICAL       FONACT(*)
      CHARACTER*19  LISCHA,SDDYNA
      CHARACTER*24  MODELE,CARELE,COMPOR,COMREF
      CHARACTER*24  CARCRI,CACO3D
      CHARACTER*24  VALMOI(8),VALPLU(8),POUGD (8),DEPALG(8) 
      INTEGER       NBIN
      CHARACTER*8   LPAIN(NBIN)
      CHARACTER*19  LCHIN(NBIN)          
C 
C ----------------------------------------------------------------------
C
C ROUTINE MECA_NON_LINE (UTILITAIRE)
C
C PREPARATION DES CHAMPS D'ENTREE POUR RIGIDITE TANGENTE (MERIMO)
C      
C ----------------------------------------------------------------------
C
C

C
C -------------- DEBUT DECLARATIONS NORMALISEES  JEVEUX ----------------
C
      INTEGER ZI
      COMMON /IVARJE/ ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C
C -------------- FIN  DECLARATIONS  NORMALISEES  JEVEUX ----------------
C
      INTEGER IBID
      INTEGER NCHAR,JCHAR,IRET,IER
      LOGICAL      EXIGEO,EXICAR
      COMPLEX*16   C16BID
      CHARACTER*8  K8BID,NOMCHA
      CHARACTER*24 CHGEOM,CHCARA(15),CHITER,CHPESA
      CHARACTER*24 DEPENT,VITENT    
      CHARACTER*24 DEPMOI,SIGMOI,VARMOI,COMMOI
      CHARACTER*24 DEPPLU,SIGPLU,VARPLU,COMPLU
      CHARACTER*24 INSMOI,VRCMOI
      CHARACTER*24 INSPLU,VRCPLU
      CHARACTER*24 VRCREF
      CHARACTER*24 VARMOJ
      CHARACTER*24 DEPKM1,VITKM1,ACCKM1
      CHARACTER*24 VITPLU,ACCPLU,ROMKM1,ROMK
      CHARACTER*24 K24BID,LIGRMO
      CHARACTER*24 DDEPLA,DEPDEL,K24BLA
      CHARACTER*19 PINTTO,CNSETO,HEAVTO,LONCHA,BASLOC,LSN,LST,STANO
      CHARACTER*24 STADYN
      CHARACTER*19 MATN
      CHARACTER*24 MUAP,NOSD     
      INTEGER      JMUAP,JNOSD  
      LOGICAL      NDYNLO     
      INTEGER      IFM,NIV   
      REAL*8       ITER   
C
      DATA VARMOJ/'&&MERIMO.VARMOJ'/
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
      CALL INFDBG('MECA_NON_LINE',IFM,NIV)  
C
C --- INITIALISATIONS
C
      LIGRMO = MODELE(1:8)//'.MODELE'  
      CHITER = '&&MERIMO.CH_ITERAT'
      CHPESA = ' ' 
      CALL ASSERT(MATE(9:18).EQ.'.MATE_CODE')
      MATN   = MATE(1:8)//'.MATN_CODE' 
      K24BLA = ' '      
C
C --- ACCES AUX CHARGEMENTS
C 
      CALL JEEXIN(LISCHA(1:19)//'.LCHA',IRET)
      IF (IRET.EQ.0) THEN
        NCHAR = 0
      ELSE
        CALL JELIRA(LISCHA(1:19)//'.LCHA','LONMAX',NCHAR,K8BID)
      END IF
      CALL JEVEUO(LISCHA(1:19)//'.LCHA','L',JCHAR)
      NOMCHA = ZK24(JCHAR) (1:8)             
C     
C --- DECOMPACTION VARIABLES CHAPEAUX
C
      CALL DESAGG(VALMOI,DEPMOI,SIGMOI,VARMOI,COMMOI,
     &            K24BID,K24BID,K24BID,K24BID)
      CALL DESAGG(VALPLU,DEPPLU,SIGPLU,VARPLU,COMPLU,
     &            VITPLU,ACCPLU,K24BID,K24BID)
      CALL DESAGG(POUGD ,DEPKM1,VITKM1,ACCKM1,ROMKM1,
     &            ROMK  ,K24BID,K24BID,K24BID)
      CALL DESAGG(DEPALG,DDEPLA,DEPDEL,K24BID,K24BID,
     &            K24BID,K24BID,K24BID,K24BID)   
C
C --- ACCES AUX OBJETS DE LA SD SDDYNA
C
      IF (NDYNLO(SDDYNA,'DYNAMIQUE'))THEN
        MUAP = SDDYNA(1:15)//'.MULT_APP'
        NOSD = SDDYNA(1:15)//'.NOM_SD'      
        CALL JEVEUO(MUAP,'L',JMUAP) 
        CALL JEVEUO(NOSD,'L',JNOSD)  
        DEPENT = ZK24(JMUAP+1-1)
        VITENT = ZK24(JMUAP+2-1) 
        STADYN = ZK24(JNOSD+4-1) 
      ELSE
        DEPENT = K24BLA
        VITENT = K24BLA 
        STADYN = K24BLA         
      ENDIF                 
C
C --- CADRE X-FEM
C
      CALL JEEXIN(MODELE(1:8)//'.FISS',IER)
      IF (IER.NE.0) THEN
        PINTTO = MODELE(1:8)//'.TOPOSE.PIN'
        CNSETO = MODELE(1:8)//'.TOPOSE.CNS'
        HEAVTO = MODELE(1:8)//'.TOPOSE.HEA'
        LONCHA = MODELE(1:8)//'.TOPOSE.LON'
        BASLOC = MODELE(1:8)//'.BASLOC'
        LSN    = MODELE(1:8)//'.LNNO'
        LST    = MODELE(1:8)//'.LTNO'
        STANO  = MODELE(1:8)//'.STNO'
      ELSE
        PINTTO = '&&MERIMO.PINTTO.BID'
        CNSETO = '&&MERIMO.CNSETO.BID'
        HEAVTO = '&&MERIMO.HEAVTO.BID'
        LONCHA = '&&MERIMO.LONCHA.BID'
        BASLOC = '&&MERIMO.BASLOC.BID'
        LSN    = '&&MERIMO.LNNO.BID'
        LST    = '&&MERIMO.LTNO.BID'
        STANO  = '&&MERIMO.STNO.BID'
      ENDIF
C
C --- LECTURE DES VARIABLES DE COMMANDE EN T- ET T+ ET VAL. DE REF
C
      CALL NMVCEX('TOUT',COMMOI,VRCMOI)
      CALL NMVCEX('INST',COMMOI,INSMOI)
      CALL NMVCEX('TOUT',COMPLU,VRCPLU)
      CALL NMVCEX('INST',COMPLU,INSPLU)
      CALL NMVCEX('TOUT',COMREF,VRCREF)
C
C --- VARIABLES INTERNES ISSUES DE L'ITERATION PRECEDENTE
C
      CALL EXISD('CHAMP_GD',VARPLU(1:19),IRET)
      IF (IRET.NE.0) THEN
        CALL COPISD('CHAMP_GD','V',VARPLU(1:19),VARMOJ(1:19))
      ELSE
        CALL COPISD('CHAMP_GD','V',VARMOI(1:19),VARMOJ(1:19))
      END IF
C
C --- CREATION DU CHAM_ELEM_S POUR ETENDRE LE CHAM_ELEM DE VARI_R
C    
      CALL EXISD('CHAM_ELEM_S',COMPOR,IRET)
      IF (IRET.EQ.0) CALL CESVAR(CARELE,COMPOR,LIGRMO,COMPOR)
      CALL COPISD('CHAM_ELEM_S','V',COMPOR,VARPLU)
      CALL COPISD('CHAM_ELEM_S','V',COMPOR,SIGPLU)
C
C --- CHAMP DE GEOMETRIE
C
      CALL MEGEOM(MODELE,NOMCHA,EXIGEO,CHGEOM)
C
C --- CHAMP DE CARACTERISTIQUES ELEMENTAIRES
C
      CALL MECARA(CARELE(1:8),EXICAR,CHCARA)
C
C --- CHAMP POUR NUMERO DE L'ITERATION
C
      ITER   = ITERAT
      CALL MECACT('V'   ,CHITER,'MODELE',LIGRMO,'NEUT_R',
     &            1     ,'X1'   ,IBID   ,ITER   ,C16BID ,
     &            K8BID)
C
C --- CHAMP DE PESANTEUR
C
      CALL MECHPE(NCHAR,ZK24(JCHAR),CHPESA)
C
C --- REMPLISSAGE DES CHAMPS D'ENTREE
C
      LPAIN(1)  = 'PGEOMER'
      LCHIN(1)  = CHGEOM
      LPAIN(2)  = 'PMATERC'
      LCHIN(2)  = MATE
      LPAIN(3)  = 'PCONTMR'
      LCHIN(3)  = SIGMOI
      LPAIN(4)  = 'PVARIMR'
      LCHIN(4)  = VARMOI
      LPAIN(5)  = 'PCOMPOR'
      LCHIN(5)  = COMPOR
      LPAIN(6)  = 'PDEPLMR'
      LCHIN(6)  = DEPMOI
      LPAIN(7)  = 'PDEPLPR'
      LCHIN(7)  = DEPDEL
      LPAIN(8)  = 'PCACABL'
      LCHIN(8)  = CHCARA(10)
      LPAIN(9)  = 'PINSTMR'
      LCHIN(9)  = INSMOI
      LPAIN(10) = 'PINSTPR'
      LCHIN(10) = INSPLU
      LPAIN(11) = 'PCARCRI'
      LCHIN(11) = CARCRI
      LPAIN(12) = ' '
      LCHIN(12) = ' '
      LPAIN(13) = ' '
      LCHIN(13) = ' '
      LPAIN(14) = 'PCAGNPO'
      LCHIN(14) = CHCARA(6)
      LPAIN(15) = 'PCAORIE'
      LCHIN(15) = CHCARA(1)
      LPAIN(16) = 'PCADISK'
      LCHIN(16) = CHCARA(2)
      LPAIN(17) = 'PCACOQU'
      LCHIN(17) = CHCARA(7)
      LPAIN(18) = 'PITERAT'
      LCHIN(18) = CHITER
      LPAIN(19) = 'PDDEPLA'
      LCHIN(19) = DDEPLA
      LPAIN(20) = 'PDEPKM1'
      LCHIN(20) = DEPKM1
      LPAIN(21) = 'PVITKM1'
      LCHIN(21) = VITKM1
      LPAIN(22) = 'PACCKM1'
      LCHIN(22) = ACCKM1
      LPAIN(23) = 'PVITPLU'
      LCHIN(23) = VITPLU
      LPAIN(24) = 'PACCPLU'
      LCHIN(24) = ACCPLU
      LPAIN(25) = 'PROMKM1'
      LCHIN(25) = ROMKM1
      LPAIN(26) = 'PROMK'
      LCHIN(26) = ROMK
      LPAIN(27) = 'PSTADYN'
      LCHIN(27) = STADYN
      LPAIN(28) = 'PVARIMP'
      LCHIN(28) = VARMOJ
      LPAIN(29) = 'PCAGNBA'
      LCHIN(29) = CHCARA(11)
      LPAIN(30) = 'PCAMASS'
      LCHIN(30) = CHCARA(12)
      LPAIN(31) = 'PCAGEPO'
      LCHIN(31) = CHCARA(5)
      LPAIN(32) = 'PDEPENT'
      LCHIN(32) = DEPENT
      LPAIN(33) = 'PVITENT'
      LCHIN(33) = VITENT
      LPAIN(34) = 'PVARCMR'
      LCHIN(34) = VRCMOI
      LPAIN(35) = 'PVARCPR'
      LCHIN(35) = VRCPLU
      LPAIN(36) = 'PNBSP_I'
      LCHIN(36) = CHCARA(1) (1:8)//'.CANBSP'
      LPAIN(37) = 'PFIBRES'
      LCHIN(37) = CHCARA(1) (1:8)//'.CAFIBR'
      LPAIN(38) = ' '
      LCHIN(38) = ' '
      LPAIN(39) = ' '
      LCHIN(39) = ' '
      LPAIN(40) = 'PVARCRR'
      LCHIN(40) = VRCREF
      LPAIN(41) = 'PPESANR'
      LCHIN(41) = CHPESA
      LPAIN(42) = 'PPINTTO'
      LCHIN(42) = PINTTO
      LPAIN(43) = 'PHEAVTO'
      LCHIN(43) = HEAVTO
      LPAIN(44) = 'PLONCHA'
      LCHIN(44) = LONCHA
      LPAIN(45) = 'PCNSETO'
      LCHIN(45) = CNSETO
      LPAIN(46) = 'PBASLOR'
      LCHIN(46) = BASLOC
      LPAIN(47) = 'PCACO3D'
      LCHIN(47) = CACO3D
      LPAIN(48) = 'PLSN'
      LCHIN(48) = LSN
      LPAIN(49) = 'PLST'
      LCHIN(49) = LST
      LPAIN(50) = 'PMATERN'
      LCHIN(50) = MATN
      LPAIN(51) = 'PSTANO'
      LCHIN(51) = STANO      
      LCHIN(52) = CHCARA(9)
      LPAIN(52) = 'PCAARPO'
C 
      CALL JEDEMA()
      END
