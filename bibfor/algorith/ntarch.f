      SUBROUTINE NTARCH(NUMINS,MODELE,MATE  ,CARELE,LNONL ,
     &                  PARA  ,SDDISC,SDCRIT,SDIETO,
     &                  LISCH2,FORCE )
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 23/04/2013   AUTEUR ABBAS M.ABBAS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2013  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C
      IMPLICIT NONE
      INCLUDE 'jeveux.h'
      CHARACTER*24  SDIETO
      INTEGER       NUMINS
      REAL*8        PARA(*)
      LOGICAL       LNONL,FORCE
      CHARACTER*19  SDDISC,SDCRIT
      CHARACTER*24  MODELE,MATE  ,CARELE
      CHARACTER*19  LISCH2
C
C ----------------------------------------------------------------------
C
C ROUTINE THER_* (ALGORITHME)
C
C ARCHIVAGE
C
C ----------------------------------------------------------------------
C
C
C ----------------------------------------------------------------------
C
      LOGICAL      DIDERN
      REAL*8       INSTAM,INSTAN
      REAL*8       DIINST
      INTEGER      IRET
      INTEGER      NUMARC
      INTEGER      JINST
      CHARACTER*19 K19BID
      CHARACTER*16 K16B1,K16B2
      CHARACTER*8  K8BID,RESULT
      INTEGER      IBID
      CHARACTER*24 K24BLA
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- IMPRESSION EVENTUELLE DES MESURES DE TEMPS
C
      CALL UTTCPG('IMPR','INCR')
      K24BLA = ' '
C
C --- DERNIER PAS : ON ARCHIVE TOUS LES CHAMPS
C
      IF (DIDERN(SDDISC,NUMINS)) THEN
        FORCE = .TRUE.
      ENDIF
C
C --- NUMERO D'ARCHIVAGE
C
      CALL DINUAR(SDDISC,NUMINS,FORCE ,NUMARC,IBID)
C
C --- INSTANT COURANT
C
      INSTAN = DIINST(SDDISC,NUMINS)
C
C ----------------------------------------------------------------------
C
      IF (NUMARC.GE.0) THEN
C
C ----- NOM SD RESULTAT
C
        CALL GETRES(RESULT,K16B1,K16B2)
C
C ----- INSTANT DEJA ARCHIVE ?
C
        IF (NUMARC.GE.2) THEN
          CALL RSADPA(RESULT,'L',1,'INST',NUMARC-1,0,JINST,K8BID)
          INSTAM = ZR(JINST)
          IF (INSTAN.LE.INSTAM) GOTO 999
        ENDIF
C
C ----- AFFICHAGE
C
        CALL U2MESS('I','ARCHIVAGE_5')
C
C ----- EXTENSION DE RESULT SI TROP PETIT (DOUBLEMENT)
C
        CALL RSEXCH(' ',RESULT,'TEMP',NUMARC,K19BID,IRET  )
        IF (IRET.EQ.110) THEN
          CALL RSAGSD(RESULT,0)
        ENDIF
C
C ----- ARCHIVAGE DES PARAMETRES
C
        CALL NTARC0(RESULT,MODELE,MATE  ,CARELE,SDCRIT,
     &              LISCH2,LNONL ,PARA  ,NUMARC,INSTAN)
C
C ----- ARCHIVAGE DES CHAMPS
C
        CALL NMARCE(SDIETO,RESULT,K24BLA,SDDISC,INSTAN,
     &              NUMARC,FORCE )
      ENDIF
C
  999 CONTINUE
C
      CALL JEDEMA()

      END
