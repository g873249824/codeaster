      SUBROUTINE NMIHHT(MODELE,NUMEDD,MATE  ,COMPOR,
     &                  CARELE,PARMET,LISCHA,SOLVEU,
     &                  CARCRI,
     &                  COMREF,ZFON,FONACT,
     &                  INSTAM,SDDYNA,SDSENS,
     &                  RESOCO,VALMOI,VALPLU,POUGD,
     &                  SECMBR,DEPALG,VEELEM,MEASSE,MEELEM,
     &                  CNFINT,CNDIRI)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 05/05/2008   AUTEUR GREFFET N.GREFFET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2006  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C TOLE CRP_21
C
      IMPLICIT NONE
      INTEGER      ZFON
      LOGICAL      FONACT(ZFON)
      REAL*8       INSTAM,PARMET(*)
      CHARACTER*19 SOLVEU
      CHARACTER*19 LISCHA,SDDYNA
      CHARACTER*24 MODELE,COMPOR,NUMEDD
      CHARACTER*24 DEFICO,RESOCO
      CHARACTER*24 CARCRI
      CHARACTER*24 MATE,CARELE,EVOL
      CHARACTER*24 VALMOI(8),VALPLU(8),POUGD(8),SECMBR(8),DEPALG(8)
      CHARACTER*19 VEELEM(30),MEELEM(8)
      CHARACTER*19 MEASSE(8)
      CHARACTER*24 COMREF,SDSENS
      CHARACTER*19 CNFINT,CNDIRI
C
C ----------------------------------------------------------------------
C
C ROUTINE MECA_NON_LINE (ALGORITHME)
C
C INITIALISATIONS SPECIFIQUES POUR HHT COMPLET EN POURSUITE
C
C ----------------------------------------------------------------------
C
C
C -------------- DEBUT DECLARATIONS NORMALISEES  JEVEUX ----------------
C
      INTEGER ZI
      COMMON /IVARJE/ ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C
C -------------- FIN  DECLARATIONS  NORMALISEES  JEVEUX ----------------
C
      INTEGER      IFM,NIV,NOCC,LDCCVG,JLOSD,IRET
      LOGICAL      EVONOL
      REAL*8       INST(5)
      CHARACTER*24 DEPPLU,SIGPLU,VARPLU,COMPLU,VITPLU
      CHARACTER*24 K24BID,ACCPLU,COMMOI,INSMOI,LOSD,INSPLU
C
C
      CALL JEMARQ()
      CALL INFDBG('MECA_NON_LINE',IFM,NIV)
C
C --- AFFICHAGE
C
      IF (NIV.GE.2) THEN
        WRITE (IFM,*) '<MECANONLINE> INITIALISATION HHT COMPLET'
      ENDIF
C      
      CALL GETVID('ETAT_INIT','EVOL_NOLI',1,1,1,EVOL,NOCC)
      EVONOL = NOCC .GT. 0
      IF (EVONOL) THEN
        CALL DESAGG(VALPLU,DEPPLU,SIGPLU,VARPLU,COMPLU,
     &            VITPLU,ACCPLU,K24BID,K24BID)
        CALL DESAGG(VALMOI,K24BID,K24BID,K24BID,COMMOI,
     &            K24BID,K24BID,K24BID,K24BID)
        CALL NMVCEX('INST',COMMOI,INSMOI)
        CALL EXISD('CHAMP_GD',INSMOI,IRET)
        IF ( IRET .NE. 0 ) THEN
          CALL NMVCAF('INST',INSMOI,.TRUE.,COMPLU)
          CALL AGGLOM(DEPPLU,SIGPLU,VARPLU,COMPLU,
     &            VITPLU,ACCPLU,K24BID,K24BID,8,VALPLU)

          CALL NMFINT('FULL_MECA',
     &              MODELE,NUMEDD,MATE  ,CARELE,COMREF,
     &              COMPOR,LISCHA,CARCRI,FONACT,RESOCO,
     &              0,SDDYNA,LDCCVG,VALMOI,VALPLU,
     &              POUGD ,DEPALG,MEELEM(1),MEELEM(6),VEELEM(2),
     &              VEELEM(1),MEASSE(6) ,CNFINT,CNDIRI)
          INST(1)=INSTAM
          INST(2)=0.D0
          INST(5)=0.5D0
          CALL NMCHAR('FIXE',' '   ,MODELE,NUMEDD,MATE  ,
     &            CARELE,COMPOR,LISCHA,CARCRI,INST  ,
     &            FONACT,PARMET,SOLVEU,VALMOI,VALPLU,
     &            POUGD ,SECMBR,DEPALG,VEELEM,MEELEM,
     &            MEASSE,SDSENS,SDDYNA)
          CALL NMCHSV(CNFINT,SECMBR,SDDYNA,1)
          LOSD = SDDYNA(1:15)//'.INFO_SD'
          CALL JEVEUO(LOSD,'E',JLOSD)
          ZL(JLOSD+10-1) = .TRUE.
        ENDIF
      ENDIF
C
      CALL JEDEMA()
      END
