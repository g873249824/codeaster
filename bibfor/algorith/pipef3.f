      SUBROUTINE PIPEF3(NDIM, NNO, NDDL,NPG,LGPG,WREF, VFF,   
     &                  DFDE,   MATE,   GEOM,   VIM,  
     &                  DDEPL,  DEPLM,  DDEPL0, DDEPL1,  
     &                  DTAU,   COPILO, TYPMOD             )

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 12/03/2007   AUTEUR LAVERNE J.LAVERNE 
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C ======================================================================
C COPYRIGHT (C) 2007 NECS - BRUNO ZUBER   WWW.NECS.FR
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================

      IMPLICIT NONE
      INTEGER MATE,NPG,LGPG,NNO,NDIM,NDDL
      REAL*8 GEOM(NDDL), VIM(LGPG,NPG), DDEPL(NDDL), DEPLM(NDDL)
      REAL*8  WREF(NPG),VFF(NNO,NPG),DFDE(2,NNO,NPG)
      REAL*8 DDEPL0(NDDL), DDEPL1(NDDL), DTAU, COPILO(5,NPG) 
      CHARACTER*8 TYPMOD(2)
       
C-----------------------------------------------------------------------
C
C  PILOTAGE PRED_ELAS POUR LES ELEMENTS DE JOINT 3D
C    
C IN  : GEOM, MATE, VIM, DDEPL, DEPLM, DDEPL0, DDELP1, DTAU, NPG
C OUT : COPILO
C-----------------------------------------------------------------------
      
      LOGICAL AXI
      INTEGER I,J,KPG
      REAL*8  UP(NDDL),UD(NDDL),SUP(3),SUD(3),B(3,60),POIDS
      REAL*8  R8VIDE
C-----------------------------------------------------------------------

                                          
C DEPLACEMENT U(ETA) = UP + ETA * UD   
      
      CALL DCOPY(NDDL,DEPLM,1,UP,1)
      CALL DAXPY(NDDL,1.D0,DDEPL,1,UP,1)
      CALL DAXPY(NDDL,1.D0,DDEPL0,1,UP,1)
      CALL DCOPY(NDDL,DDEPL1,1,UD,1)
            
C BOUCLE SUR LES POINTS DE GAUSS :
 
      DO 10 KPG=1,NPG
              
C      SAUT AU POINT DE GAUSS : SU(ETA) = SUP + ETA * SUD
        CALL NMFICI(NNO,NDDL,WREF(KPG),VFF(1,KPG),
     &              DFDE(1,1,KPG),GEOM,POIDS,B)
     
        DO 30 I=1,3
          SUP(I) = 0.D0
          SUD(I) = 0.D0
          DO 40 J=1,NDDL
            SUP(I) = SUP(I) + B(I,J)*UP(J)
            SUD(I) = SUD(I) + B(I,J)*UD(J)
 40       CONTINUE
 30     CONTINUE

C      INITIALISATION DES COEFFICIENTS DE PILOTAGE
        CALL R8INIR(4, 0.D0, COPILO(1,KPG),1)
        COPILO(5,KPG) = R8VIDE()

C      APPEL DU PILOTAGE PRED_ELAS SPECIFIQUE A LA LOI DE COMPORTEMENT
        CALL PIPEBA(3,MATE,SUP,SUD,VIM(1,KPG),DTAU,COPILO(1,KPG))

  10  CONTINUE

      END
