      SUBROUTINE VECHD2(TYPCAL,NOMO  ,MATE  ,CARELE,LISCHA,
     &                  INSTAN,VAPRIN,NOPASE,VECELE)
C
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF ALGORITH  DATE 13/06/2012   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2012  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY  
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY  
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR     
C (AT YOUR OPTION) ANY LATER VERSION.                                   
C                                                                       
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT   
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF            
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU      
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                              
C                                                                       
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE     
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,         
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.         
C ======================================================================
C
      IMPLICIT     NONE
      INCLUDE 'jeveux.h'
      CHARACTER*19 LISCHA,VAPRIN
      CHARACTER*4  TYPCAL
      CHARACTER*8  NOMO,NOPASE
      CHARACTER*24 MATE,CARELE
      REAL*8       INSTAN
      CHARACTER*19 VECELE
C
C ----------------------------------------------------------------------
C
C CALCUL DES VECTEURS ELEMENTAIRES DES CHARGEMENTS DUS A LA DERIVATION
C DE L'EQUATION DE LA MECANIQUE
C
C ----------------------------------------------------------------------
C
C
C IN  TYPCAL : TYPE DU CALCUL :
C               'DYNK', POUR LE CALCUL DE LA DERIVEE RAIDEUR
C               'DYNM', POUR LE CALCUL DE LA DERIVEE MASSE
C IN  NOMO   : NOM DU MODELE
C IN  LISCHA : SD LISTE DES CHARGES
C IN  CARELE : CARACTERISTIQUES DES POUTRES ET COQUES
C IN  MATE   : MATERIAU CODE
C IN  INSTAN : INSTANT COURANT
C IN  VAPRIN : CHAMP DE VARIABLE PRINCIPALE
C IN  NOPASE : NOM DU PARAMETRE SENSIBLE
C OUT VECELE : VECT_ELEM RESULTAT
C
C
C
C
      INTEGER      NBOUT,NBIN
      PARAMETER    (NBOUT=1, NBIN=30)
      CHARACTER*8  LPAOUT(NBOUT),LPAIN(NBIN)
      CHARACTER*19 LCHOUT(NBOUT),LCHIN(NBIN)
C
      CHARACTER*8  K8BID
      COMPLEX*16   C16BID
      INTEGER      IRET,IBID,JLVE
      INTEGER      NH,NCHIN
      CHARACTER*8  NEWNOM,MATERS
      CHARACTER*16 OPTION
      CHARACTER*19 LIGRMO
      CHARACTER*19 CHGEOM,CHCARA(18),CHTIME,CHCARS(18)
      CHARACTER*19 CHPESA
      CHARACTER*24 MATSEN,MATERI,CHHARM
      LOGICAL      EXICAR
C
C ----------------------------------------------------------------------
C
      CALL JEMARQ()
C
C --- INITIALISATIONS
C
      NEWNOM = '.0000000'
      CALL ASSERT(TYPCAL.EQ.'DYNK' .OR. TYPCAL.EQ.'DYNM')
C
C --- RECUPERATION DU MODELE
C
      LIGRMO = NOMO(1:8)//'.MODELE'
C IL FAUT SUPPRIMER LA LIGNE SUIVANTE (CONFLIT FICHE 17958)
      IF (.FALSE.) CALL U2MESS('F','SENSIBILITE_13')
C
C --- INITIALISATION DES CHAMPS POUR CALCUL
C
      CALL INICAL(NBIN  ,LPAIN ,LCHIN ,
     &            NBOUT ,LPAOUT,LCHOUT)
C
C --- DETERMINATION DE CARA_ELEM DERIVE MATERIAU NON CODE MATSEN
C
      MATERI = MATE(1:8)
      CALL PSGENC(CARELE,NOPASE,MATERS,IRET)
      IF (IRET.EQ.0) THEN
        CALL MECARA(MATERS,EXICAR,CHCARS)
        MATSEN(1:24) = MATERI(1:8)//MATE(9:24)
      ELSE
        CALL PSGENC(MATERI,NOPASE,MATERS,IRET)
        CALL ASSERT(IRET.EQ.0)
        MATSEN = ' '
        MATSEN(1:24) = MATERS(1:8)//MATE(9:24)
        CALL MECARA(CARELE,EXICAR,CHCARS)
      ENDIF
C
C --- CHAMP DE GEOMETRIE
C
      CALL MECOOR(NOMO  ,CHGEOM)
C
C --- CARTE DE L'INSTANT
C
      CHTIME = '&&VECHD2.CH_INST_R'
      CALL MECACT('V'   ,CHTIME,'MODELE',LIGRMO,'INST_R',
     &            1     ,'INST',IBID    ,INSTAN,C16BID  ,
     &            K8BID )
C
C --- CARTE DU CHARGEMENT DE PESANTEUR
C
      CALL MEPESA(LISCHA,CHPESA)
C
C --- CHAMP DE CARACTERISTIQUES ELEMENTAIRES
C
      CALL MECARA(CARELE,EXICAR,CHCARA)
C
C --- CHAMP D'HARMONIQUE DE FOURIER
C
      NH = 0
      CALL MEHARM(NOMO  ,NH    ,CHHARM)
C
C --- ALLOCATION DU VECT_ELEM RESULTAT
C
      CALL JEEXIN(VECELE,IRET)
      IF (IRET.EQ.0) THEN
        CALL MEMARE('V',VECELE,NOMO  ,MATE,CARELE,'CHAR_MECA')
        CALL WKVECT(VECELE(1:19)//'.RELR','V V K24',1,JLVE)
      ELSE
        CALL JEVEUO(VECELE(1:19)//'.RELR','E',JLVE)
      END IF
C
C --- PREPARATIONS PROPRES A LA DERIVEE RAIDEUR EN DYNAMIQUE
C
      IF (TYPCAL.EQ.'DYNK') THEN
        LPAIN(1)  = 'PGEOMER'
        LCHIN(1)  = CHGEOM
        LPAIN(2)  = 'PMATERC'
        LCHIN(2)  = MATE(1:19)
        LPAIN(3)  = 'PCAORIE'
        LCHIN(3)  = CHCARA(1)
        LPAIN(4)  = 'PCADISK'
        LCHIN(4)  = CHCARA(2)
        LPAIN(5)  = 'PCAGNPO'
        LCHIN(5)  = CHCARA(6)
        LPAIN(6)  = 'PCACOQU'
        LCHIN(6)  = CHCARA(7)
        LPAIN(7)  = 'PCASECT'
        LCHIN(7)  = CHCARA(8)
        LPAIN(9)  = 'PCAARPO'
        LCHIN(9)  = CHCARA(9)
        LPAIN(10) = 'PHARMON'
        LCHIN(10) = CHHARM(1:19)
        LPAIN(11) = 'PPESANR'
        LCHIN(11) = CHPESA
        LPAIN(12) = 'PGEOME2'
        LCHIN(12) = CHGEOM
        LPAIN(14) = 'PCAGNBA'
        LCHIN(14) = CHCARA(11)
        LPAIN(15) = 'PCAMASS'
        LCHIN(15) = CHCARA(12)
        LPAIN(16) = 'PCAPOUF'
        LCHIN(16) = CHCARA(13)
        LPAIN(17) = 'PCAGEPO'
        LCHIN(17) = CHCARA(5)
        LPAIN(18) = 'PTEMPSR'
        LCHIN(18) = CHTIME
        LPAIN(19) = 'PNBSP_I'
        LCHIN(19) = CHCARA(16)
        LPAIN(20) = 'PFIBRES'
        LCHIN(20) = CHCARA(17)
C ... LA CARTE MATERIAU DERIVEE
        LPAIN(21) = 'PMATSEN'
        LCHIN(21) = MATSEN(1:19)
C ... CHAMPS DE DEPLACEMENTS A T+/T-
        LPAIN(22) = 'PVAPRIN'
        LCHIN(22) = VAPRIN
C ... LA CARTE MATRICE RAIDEUR ELEMENTAIRE DISCRETE DERIVEE
        LPAIN(23) = 'PSEDISK'
        LCHIN(23) = CHCARS(2)
        LPAIN(24) = 'PCINFDI'
        LCHIN(24) = CHCARA(15)
        NCHIN     = 24
        OPTION    = 'RIGI_MECA_SENS_C'
      ENDIF
C
C --- PREPARATIONS PROPRES A LA DERIVEE MASSE EN DYNAMIQUE
C
      IF (TYPCAL.EQ.'DYNM') THEN
        LPAIN(1)  = 'PGEOMER'
        LCHIN(1)  = CHGEOM
        LPAIN(2)  = 'PMATERC'
        LCHIN(2)  = MATE(1:19)
        LPAIN(3)  = 'PCAORIE'
        LCHIN(3)  = CHCARA(1)
        LPAIN(4)  = 'PCADISM'
        LCHIN(4)  = CHCARA(3)
        LPAIN(5)  = 'PCAGNPO'
        LCHIN(5)  = CHCARA(6)
        LPAIN(6)  = 'PCACOQU'
        LCHIN(6)  = CHCARA(7)
        LPAIN(7)  = 'PCASECT'
        LCHIN(7)  = CHCARA(8)
        LPAIN(9)  = 'PCAARPO'
        LCHIN(9)  = CHCARA(9)
        LPAIN(10) = 'PCACABL'
        LCHIN(10) = CHCARA(10)
        LPAIN(11) = 'PCAGEPO'
        LCHIN(11) = CHCARA(5)
        LPAIN(12) = 'PABSCUR'
        LCHIN(12) = CHGEOM(1:8)//'.ABS_CURV'
        LPAIN(13) = 'PCAGNBA'
        LCHIN(13) = CHCARA(11)
        LPAIN(14) = 'PCAPOUF'
        LCHIN(14) = CHCARA(13)
        LPAIN(15) = 'PNBSP_I'
        LCHIN(15) = CHCARA(16)
        LPAIN(16) = 'PFIBRES'
        LCHIN(16) = CHCARA(17)
        LPAIN(17) = 'PVAPRIN'
        LCHIN(17) = VAPRIN
        LPAIN(18) = 'PSEDISM'
        LCHIN(18) = CHCARS(3)
C ... LA CARTE MATERIAU DERIVEE
        LPAIN(19) = 'PMATSEN'
        LCHIN(19) = MATSEN(1:19)
        LPAIN(20) = 'PCINFDI'
        LCHIN(20) = CHCARA(15)
        NCHIN     = 20
        OPTION    = 'MASS_MECA_SENS_C'
      ENDIF
C
C --- CHAMP DE SORTIE
C
      LCHOUT(1) = '&&VECHD2.???????'
      LPAOUT(1) = 'PVECTUC'
      CALL GCNCO2(NEWNOM)
      LCHOUT(1) = '&&VECHD2.'//NEWNOM(2:8)
      CALL CORICH('E',LCHOUT(1),-1,IBID)
C
C --- CALCUL
C
      CALL CALCUL('S',OPTION,LIGRMO,NCHIN,LCHIN ,LPAIN,
     &                              NBOUT,LCHOUT,LPAOUT,'V','OUI')

      ZK24(JLVE) = LCHOUT(1)
      CALL JEECRA(VECELE(1:19)//'.RELR','LONUTI',1,K8BID)
C
      CALL JEDEMA()

      END
