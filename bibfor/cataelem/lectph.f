      SUBROUTINE LECTPH(FLIGN,LLIGN)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF CATAELEM  DATE 11/03/98   AUTEUR CIBHHLV L.VIVAN 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR   
C (AT YOUR OPTION) ANY LATER VERSION.                                 
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT 
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF          
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU    
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.                            
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE   
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,       
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.      
C ======================================================================
C TOLE CRS_512
      IMPLICIT REAL*8 (A-H,O-Z)
C
C     INCLUDE($CIMPERR)
C
      COMMON /CIMP/IMP,IULMES,IULIST,IULVIG
C
C     EXCLUDE($CIMPERR)
C
C
      INTEGER FLIGN,LLIGN
      CHARACTER*80 LIGNE
      LOGICAL PASS1,PASS2,PASS3
      CHARACTER*72 CVAL
      CHARACTER*8 TM
      CHARACTER*16 TE,MODLSA
C
C   LE 10 DE LA DECLARATION CI DESSOUS EST LE NPHEMAX DU COMMON :
C  COCATPH
C
C
C
      INTEGER NMODEL(10)
C
C
C     INCLUDE($FUNJEV)
C
C     FONCTIONS JEVEUX
C
      CHARACTER*32 JEXNUM,JEXNOM,JEXATR
C
C     COMMUNS   JEVEUX
C
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C
C     EXCLUDE($FUNJEV)
C
C     ETATS
C
      INTEGER INIT,FIN
C
C     LABELS
C
      INTEGER PASSE,TRANS,SORTIE,ERRCON,EPILOG
C
C
C     INCLUDE($CDEBUG)
      CHARACTER*8 CLEDBG
      CHARACTER*24 OBJDMP
      INTEGER PASDMP,TYOBDM
      COMMON /CMODBG/CLEDBG
      COMMON /CDEBUG/ICCDBG
      COMMON /CBDMPC/OBJDMP(30)
      COMMON /CBDMPN/NDMP,PASDMP(30),TYOBDM(30)
C
C       NDMP : NOMBRE D OBJETS A DUMPER
C       PASDMP(IDMP)  : PASSE OU ON DUMPE L OBJET IDMP
C       OBJDMP(IDMP)  : NOM DE L OBJET IDMP
C       TYOBDM(IDMP)  : GENRE DE L OBJET IDMP :  0 OBJET SIMPLE
C                                                1 COLLECTION NUMEROTEE
C                                                2 COLLECTION NOMME
C
C     EXCLUDE($CDEBUG)
C
C
C     INCLUDE($EXTF)
C     EXCLUDE($EXTF)
C
C     VARIABLES FORTRANS POUR LES OBJETS
C
C     INCLUDE($OCATPH)
C
C     TABLEAUX FORTRAN CORRESPONDANTS AUX OBJETS DU CATALOGUE DES
C     PHENOMENES-MODELISATION
C
C-----------------------------------------------------------------------
C  OBJET          ! TYPE JEVEUX    ! TABLEAU FORT! FCTION ACCES        !
C-----------------!----------------!-------------!----------------------
C &CATA.PHENOMENE ! POINTEUR DE NOM!             !                     !
C                 ! K16            !             !                     !
C                 !                !             !                     !
C &CATA.PHENOMENE ! C(V(IS))       !PHMOTE(2,PH)!IDPHMO(PH,IPH,IMD,ITM)!
C                 !                !             !                     !
C-----------------!----------------!-------------!----------------------
      INTEGER PHMOTE
      COMMON /COCAPH/NPHEMX,PHMOTE(2,10)
      CHARACTER*1 K1BID
C
C  PHEMOM EST UN REPERTOIRE CONTENANT LES DIFFERENTS PHENOMENS
C  RENCONTRES DANS LE  CATALOGIE DES   PHENOMENES-MODELISATION
C
C IL Y A AUTANT D OBTETS &CATA.PHENOMENE QUE DE PHENOMES RENCONTRES
C DANS LE CATALOGUE
C
C NPHEMAX : NOMBRE MAX DE PHENOMES ACTUELLEMENT 10
C
C
C     EXCLUDE($OCATPH)
C
C  FONCTIONS FORMULES ( ADRESSAGE )
C
C     INCLUDE($ADCATPH)
C
C     ADRESSES DANS LES OBJETS DU CATALOGUE DES PHENOMENES_MODELISATIONS
C
      CHARACTER*16 PH

      IDPHMO(PH,IPH,IMD,ITM) = IDCVNU('&CATA.'//PH,PHMOTE(1,IPH),IMD,
     +                         ITM)
C
C
C  IPH = RANG DANS &CATA.PHENOMENE DE PH
C
C
C
C     EXCLUDE($ADCATPH)
C
      ASSIGN 400 TO PASSE
      ASSIGN 500 TO TRANS
      ASSIGN 600 TO EPILOG
C     ASSIGN 200 TO SORTIE
      ASSIGN 901 TO ERRCON
C
      DO 100 I = 1,10
        NMODEL(I) = 0
  100 CONTINUE
C
      IPASSE = 0
      CALL JELIRA('&CATA.TM.NOMTM','NOMMAX',NTM,K1BID)
  400 CONTINUE
      IPASSE = IPASSE + 1
      IPH = 0
      IF (IPASSE.EQ.1) THEN
        PASS1 = .TRUE.
        PASS2 = .FALSE.
        PASS3 = .FALSE.

      ELSE IF (IPASSE.EQ.2) THEN
        PASS1 = .FALSE.
        PASS2 = .TRUE.
        PASS3 = .FALSE.

      ELSE IF (IPASSE.EQ.3) THEN
        PASS1 = .FALSE.
        PASS2 = .FALSE.
        PASS3 = .TRUE.
      END IF
C
      IF (PASS2) THEN
C
        CALL JECREO('&CATA.PHENOMENE','G N K16')
        CALL JEECRA('&CATA.PHENOMENE','NOMMAX',NPH,' ')
      END IF
C
      CALL LXPOSI(FLIGN,1,0)
C
      FIN = 0
  500 CONTINUE
      INIT = FIN
C
  501 CONTINUE
      IF (NDMP.NE.0) CALL DMPOBJ(IPASSE,FIN,' FIN ')
      CALL TRANPH(INIT,FIN,IVAL,CVAL)
      IF (NDMP.NE.0) CALL DMPOBJ(IPASSE,FIN,' DEBUT ')
      IF (ICCDBG.GE.2) THEN
        WRITE (IMP,*) '  ETAT ',FIN
      END IF

      GO TO (1,2,3,4,5,6,7,8,9,10) FIN
C
    1 CONTINUE
      GO TO TRANS
C
    2 CONTINUE
      IF (PASS1) THEN
        IF (IPH.GE.1) THEN
          NMODEL(IPH) = NMOD
        END IF

      END IF

      IPH = IPH + 1
      IF (IPH.GT.NPHEMX) THEN
        WRITE (IULMES,*) '  NBRE DE PHENOMENES > BORNES BORNE = ',NPHEMX
        GO TO ERRCON

      END IF

      NMOD = 0
      GO TO TRANS
C
    3 CONTINUE
      PH = CVAL(1:IVAL)
      IF (PASS2) THEN
        CALL JECROC(JEXNOM('&CATA.PHENOMENE',PH))

      ELSE IF (PASS3) THEN
        CALL JECREO('&CATA.'//PH(1:13)//'.MODL','G N K16')
        CALL JEECRA('&CATA.'//PH(1:13)//'.MODL','NOMMAX',NMODEL(IPH),
     +               ' ')
        CALL JECREC('&CATA.'//PH,'G V I','NU','CONTIG',
     +              'CONSTANT',NMODEL(IPH))
        CALL JEECRA('&CATA.'//PH,'LONT',NTM*NMODEL(IPH),' ')
      END IF

      GO TO TRANS
C
    4 CONTINUE
      GO TO TRANS
C
    5 CONTINUE
      NMOD = NMOD + 1
      MODLSA = CVAL(1:IVAL)
      IF (PASS3) THEN
        CALL JECROC(JEXNOM('&CATA.'//PH(1:13)//'.MODL',MODLSA))
        CALL JECROC(JEXNUM('&CATA.'//PH,NMOD))
      END IF

      GO TO TRANS
C
    6 CONTINUE
      GO TO TRANS
C
    7 CONTINUE
      IF (PASS3) THEN
        TM = CVAL(1:IVAL)
        CALL JENONU(JEXNOM('&CATA.TM.NOMTM',TM),ITM)
        IF (ITM.LE.0) THEN
          WRITE (IULMES,9001) TM,'&CATA.TM.NOMTM'
          CALL JEIMPO('VIGILE','&CATA.TM.NOMTM',' ',' DANS LECTPH ')
          GO TO ERRCON

        END IF

      END IF

      GO TO TRANS
C
    8 CONTINUE
      GO TO TRANS
C
    9 CONTINUE
      IF (PASS3) THEN
        TE = CVAL(1:IVAL)
        CALL JENONU(JEXNOM('&CATA.TE.NOMTE',TE),ITE)
        IF (ITE.LE.0) THEN
          WRITE (IULMES,9001) TE,'&CATA.TE.NOMTE'
          CALL JEIMPO('VIGILE','&CATA.TE.NOMTE',' ',' DANS LECTPH ')
          GO TO ERRCON

        END IF

        ZI(IDPHMO(PH,IPH,NMOD,ITM)) = ITE
      END IF

      GO TO TRANS
C
C
C   ETATS LIES AUX EOF
C
C
C
C
   10 CONTINUE
      NMODEL(IPH) = NMOD
C     GO TO SORTIE
C
C 200 CONTINUE
      IF (ICCDBG.GT.0) THEN
        WRITE (IMP,*) '  OK  PASSE ',IPASSE
      END IF

      IF (PASS1) THEN
        NPH = IPH
        IF (ICCDBG.GT.0) THEN
          WRITE (IMP,*) '  NPH ',NPH
          DO 210 I = 1,NPH
            WRITE (IMP,*) '  NMODEL(',I,') = ',NMODEL(I)
  210     CONTINUE
        END IF

      END IF

      IF (IPASSE.LT.3) THEN
        GO TO PASSE

      ELSE
C
C     EPILOGUE
C
  600   CONTINUE
        IF (NDMP.NE.0) CALL DMPOBJ(10,FIN,
     +                   '  FIN CATALOGUE DES PHENOMENES_MODELISATIONS '
     +                             )
CCCC   WRITE(IULMES,*) '  FIN CATALOGUE DES PHENOMENES_MODELISATIONS '
        CALL LXINFO(LIGNE,LLIGN,JCOL)
        GOTO 9999

      END IF

  901 CONTINUE
      CALL UTMESS('F','LECTPH','PB. LECTURE CATALOGUES.')
      WRITE (IULMES,*) '  ERREUR  PHENOMENES_MODELISATIONS CONTEXT '
      WRITE (IULMES,*) '  ETAT ',FIN
      CALL JEIMPM('VIGILE','  DUMP MEMOIRE DANS LECTOP ')
      CALL JEIMPR('VIGILE',' ','  DUMP REPERTOIRE DANS LECTOP ')
      CALL UTMESS('F','LECTPH','PB. LECTURE CATALOGUES.')
      GOTO 9999
C
 9001 FORMAT ('   OBJET : ',A32,/,'  NON TROUVE DANS COLLECTION : ',/,
     +       '  ',A32)
 9002 FORMAT ('  LE PARAMETRE SIMPLE : ',A32,/,
     +       '  NE SE TROUVE PAS DANS LE PARAMETRES ',/,
     +       '  DE L OPTION SIMPLE NUMERO : ',I5)

 9999 CONTINUE
      END
