      INTEGER FUNCTION DIGDE4(IGR,IEL,OPT,IPAR,DIM1,CODVOI)
      IMPLICIT NONE

C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF CALCULEL  DATE 26/04/2011   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C   1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C RESPONSABLE PELLET J.PELLET
C ----------------------------------------------------------------------
C     ENTREES:
C        IEL : NUMERO DEL'ELEMENT DANS LE GREL
C        ...
C     SORTIES:
C        DIGDE4 : DIMENSION DE LA MATRICE ELEMENTAIRE POUR IEL

C ----------------------------------------------------------------------
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
C ----------------------------------------------------------------------
      INTEGER IGR,IEL,OPT,IPAR,DIM1
      CHARACTER*16 CODVOI
      INTEGER NVOIMA,NSCOMA,NBVOIS
      PARAMETER(NVOIMA=100,NSCOMA=4)
      INTEGER LIVOIS(1:NVOIMA),TYVOIS(1:NVOIMA),NBNOVO(1:NVOIMA)
      INTEGER NBSOCO(1:NVOIMA),LISOCO(1:NVOIMA,1:NSCOMA,1:2)
      INTEGER        IAMACO,ILMACO,IAMSCO,ILMSCO,IALIEL,ILLIEL

      COMMON /CAII03/IAMACO,ILMACO,IAMSCO,ILMSCO,IALIEL,ILLIEL
      INTEGER EVFINI,CALVOI,JREPE,JPTVOI,JELVOI
      COMMON /CAII19/EVFINI,CALVOI,JREPE,JPTVOI,JELVOI

C     VARIABLES LOCALES:
C     ------------------
      INTEGER LON1,NUMA,NUMAIL
      INTEGER NUMAV,IGR2,TE2,MODE2,DIM2
      INTEGER MODATT,KVOIS,DIGDE3,NEL2P1

      NUMAIL(IGR,IEL) = ZI(IALIEL-1+ZI(ILLIEL+IGR-1)+IEL-1)

C DEB-------------------------------------------------------------------
      CALL ASSERT(EVFINI.EQ.1)
      LON1=0
      NUMA = NUMAIL(IGR,IEL)
      CALL VOIUTI(NUMA,CODVOI,NVOIMA,NSCOMA,JREPE,JPTVOI,JELVOI,
     &                  NBVOIS,LIVOIS,TYVOIS,NBNOVO,NBSOCO,LISOCO)
      DO 22, KVOIS=1,NBVOIS
        NUMAV=LIVOIS(KVOIS)
        IGR2=ZI(JREPE-1+2*(NUMAV-1)+1)
        NEL2P1=ZI(ILLIEL-1+IGR2+1)-ZI(ILLIEL-1+IGR2)
        TE2= ZI(IALIEL-1+ZI(ILLIEL-1+IGR2)-1+NEL2P1)
        MODE2 = MODATT(OPT,TE2,'OUT',IPAR)
        CALL ASSERT(MODE2.GT.0)
        DIM2=DIGDE3(MODE2,'L')
        LON1=LON1+DIM1*DIM2
   22 CONTINUE
      LON1=LON1+DIM1*DIM1
      DIGDE4=LON1
      END
