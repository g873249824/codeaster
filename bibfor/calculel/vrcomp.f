      SUBROUTINE VRCOMP(DCEL,VARMOI)
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF CALCULEL  DATE 11/09/2002   AUTEUR VABHHTS J.PELLET 
C ======================================================================
C COPYRIGHT (C) 1991 - 2001  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C RESPONSABLE VABHHTS J.PELLET
      IMPLICIT NONE
      CHARACTER*(*) DCEL,VARMOI
C ------------------------------------------------------------------
C BUT: VERIFIER LA COHERENCE D'UN CHAMP DE VARIABLES INTERNES AVEC
C      UN CHAMP DE COMPORTEMENT.
C ------------------------------------------------------------------
C     ARGUMENTS:
C DCEL     IN/JXIN  K19 : SD CHAM_ELEM_S (DCEL_I)
C VARMOI   IN/JXIN  K19 : SD CHAM_ELEM   (VARI_R)

C REMARQUES :
C  DCEL EST LE CHAM_ELEM_S OBTENU A PARTIR DE LA CARTE DE COMPORTEMENT
C  PAR LA ROUTINE CESVAR. IL CONTIENT POUR CHAQUE MAILLE LE NOMBRE
C  DE VARIABLES INTERNES ET LE NOMBRE DE SOUS-POINTS.
C
C  - ON EXAMINE SI LE NOMBRE DE VARIABLES INTERNES SUR CHAQUE MAILLE
C    EST BIEN CE QUI EST ATTENDU PAR LA LOI DE COMPORTEMENT

C  - ON VERIFIE EGALEMENT LE NOMBRE DE SOUS-POINTS

C-----------------------------------------------------------------------

C---- COMMUNS NORMALISES  JEVEUX
      INTEGER ZI
      COMMON /IVARJE/ZI(1)
      REAL*8 ZR
      COMMON /RVARJE/ZR(1)
      COMPLEX*16 ZC
      COMMON /CVARJE/ZC(1)
      LOGICAL ZL
      COMMON /LVARJE/ZL(1)
      CHARACTER*8 ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
C     ------------------------------------------------------------------
      INTEGER JCE1D,JCE1V,JCE1L,JCE1K,JCE2D
      INTEGER IAD1,IAD2,NBMA,NBSP1,NBSP2,NBCMP1,NBCMP2
      INTEGER IMA,IRET
      CHARACTER*8 NOMA,NOMAIL
      CHARACTER*19 CES1,CES2
      CHARACTER*32 JEXNOM,JEXNUM
C     ------------------------------------------------------------------
      CALL JEMARQ()


C     1. DANS DCEL, ON RECUPERE LE CHAM_ELEM_S DE DCEL_I :
C     ----------------------------------------------------------------
      CES1 = DCEL

C     2. ON TRANSFORME VARMOI EN CHAM_ELEM_S :
C     ----------------------------------------------------------------
      CES2 = '&&VRCOMP.VARI_R'
      CALL CELCES(VARMOI,'V',CES2)
      CALL CESTAS(CES2)

C     3. ON BOUCLE SUR LES MAILLES POUR VERIFIER :
C     ----------------------------------------------------------------
      CALL JEVEUO(CES1//'.CESD','L',JCE1D)
      CALL JEVEUO(CES1//'.CESV','L',JCE1V)
      CALL JEVEUO(CES1//'.CESL','L',JCE1L)
      CALL JEVEUO(CES1//'.CESK','L',JCE1K)

      CALL JEVEUO(CES2//'.CESD','L',JCE2D)

      NOMA = ZK8(JCE1K-1+1)
      NBMA = ZI(JCE1D-1+1)

      DO 10,IMA = 1,NBMA

C        -- RECUPERATION DANS CES1
C           DU NOMBRE DE SOUS-POINTS ET DU NOMBRE DE CMPS
        CALL CESEXI('C',JCE1D,JCE1L,IMA,1,1,1,IAD1)
        CALL CESEXI('C',JCE1D,JCE1L,IMA,1,1,2,IAD2)
        IF (IAD1.LE.0) THEN
          NBSP1 = 0
          NBCMP1 = 0
        ELSE
          IF (IAD2.LE.0) CALL UTMESS('F','VRCOMP','STOP 1')
          NBSP1 = ZI(JCE1V-1+IAD1)
          NBCMP1 = ZI(JCE1V-1+IAD2)
        END IF

C        -- RECUPERATION DANS CES2
C           DU NOMBRE DE SOUS-POINTS ET DU NOMBRE DE CMPS
        NBSP2 = ZI(JCE2D-1+5+4* (IMA-1)+2)
        NBCMP2 = ZI(JCE2D-1+5+4* (IMA-1)+3)


        IF ((NBSP1.NE.NBSP2) .OR. (NBCMP1.NE.NBCMP2)) THEN
          CALL JENUNO(JEXNUM(NOMA//'.NOMMAI',IMA),NOMAIL)

          IF (NBSP1.NE.NBSP2) THEN
            CALL UTMESS('A','VRCOMP','LE CHAMP DE VARIABLES INTERNES'//
     &      ' N''EST PAS COHERENT (NB SOUS-POINTS) AVEC LE COMPORTEMENT'
     &                  //' POUR LA MAILLE '//NOMAIL)
          END IF

          IF (NBCMP1.LT.NBCMP2) THEN
            CALL UTMESS('A','VRCOMP','LE CHAMP DE VARIABLES INTERNES'//
     &           ' A PLUS DE COMPOSANTES QUE VOULU PAR LE COMPORTEMENT'
     &                  //' POUR LA MAILLE '//NOMAIL)
          END IF

          IF (NBCMP1.GT.NBCMP2) THEN
            CALL UTMESS('F','VRCOMP','LE CHAMP DE VARIABLES INTERNES'//
     &          '  A MOINS DE COMPOSANTES QUE VOULU PAR LE COMPORTEMENT'
     &                  //' POUR LA MAILLE '//NOMAIL)
          END IF

        END IF


   10 CONTINUE


C     4. MENAGE :
C     -----------
      CALL DETRSD('CHAM_ELEM_S',CES2)

      CALL JEDEMA()
      END
