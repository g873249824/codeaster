      SUBROUTINE DEFIEN(NOFIVA,NOMSD,LGCONC,NOMGD,NOSY16,LGCH16,
     +              NOMCMP,LGCOMP,LGNUO1,NORDEN,IORDRE,LRESU,
     +              TYPFIC,TYPVAL,FICH,LGFICH,NOMVAR,LGNOVA,
     +              LGDESC,DESRFV,DESIFV)
      IMPLICIT REAL*8 (A-H,O-Z)
C
      CHARACTER*(*)     NOFIVA,NOMSD,       NOMGD,NOSY16
      INTEGER                        LGCONC,             LGCH16
      CHARACTER*(*) NOMCMP
      INTEGER              LGCOMP,LGNUO1,NORDEN,IORDRE
      LOGICAL                                          LRESU
      CHARACTER*80                FICH
      CHARACTER*(*) TYPFIC,                   NOMVAR
      INTEGER       LGDESC,TYPVAL,     LGFICH,       LGNOVA
      CHARACTER*80         DESRFV,DESIFV
C            CONFIGURATION MANAGEMENT OF EDF VERSION
C MODIF PREPOST  DATE 26/04/2011   AUTEUR COURTOIS M.COURTOIS 
C ======================================================================
C COPYRIGHT (C) 1991 - 2011  EDF R&D                  WWW.CODE-ASTER.ORG
C THIS PROGRAM IS FREE SOFTWARE; YOU CAN REDISTRIBUTE IT AND/OR MODIFY
C IT UNDER THE TERMS OF THE GNU GENERAL PUBLIC LICENSE AS PUBLISHED BY
C THE FREE SOFTWARE FOUNDATION; EITHER VERSION 2 OF THE LICENSE, OR
C (AT YOUR OPTION) ANY LATER VERSION.
C
C THIS PROGRAM IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT
C WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF
C MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. SEE THE GNU
C GENERAL PUBLIC LICENSE FOR MORE DETAILS.
C
C YOU SHOULD HAVE RECEIVED A COPY OF THE GNU GENERAL PUBLIC LICENSE
C ALONG WITH THIS PROGRAM; IF NOT, WRITE TO EDF R&D CODE_ASTER,
C    1 AVENUE DU GENERAL DE GAULLE, 92141 CLAMART CEDEX, FRANCE.
C ======================================================================
C TOLE CRP_21
C--------------------------------------------------------------------
C  DEFINITION DU NOM DU FICHIER CONTENANT LES VALEURS, DU NOM DE LA
C  VARIABLE ENSIGHT ASSOCIEE AINSI QUE DE LA DESCRIPTION DU CONTENU
C  DU FICHIER DE VALEURS
C    ENTREE:
C      NOFIVA: NOM GENERIQUE DU FICHIER DE VALEURS ENSIGHT
C      NOMSD : NOM DE LA SD_RESULTAT DONT EST ISSU LE CHAM_NO
C      LGCONC: LONGUEUR UTILE DE LA CHAINE DE CARACTERES NOMSD
C      NOMGD : NOM DE LA GRANDEUR  DEPL_R, TEMP_R, SIEF_R, EPSI_R,...
C      NOSY16: NOM SYMBOLIQUE DU CHAM_NO
C      LGCH16: LONGUEUR UTILE DE LA CHAINE DE CARACTERES NOSY16
C      NOMCMP: NOM DE LA COMPOSANTE DU CHAM_NO EN COURS D'IMPRESSION
C      LGCOMP: LONGUEUR UTILE DE LA CHAINE DE CARACTERES NOMCMP
C      LGNUO1: LONGUEUR UTILE DE LA CHAINE DE CARACTERES ASSOCIEE AU
C              PREMIER NUMERO D'ORDRE A IMPRIMER
C      NORDEN: NOMBRE DE NUMEROS D'ORDRE A IMPRIMER
C      IORDRE: INDICE DU NUMERO D'ORDRE EN COURS D'IMPRESSION
C              DANS LA LISTE DES NUMEROS D'ORDRE A IMPRIMER
C      LRESU : =.TRUE. INDIQUE IMPRESSION D'UN CONCEPT RESULTAT
C      TYPFIC: DONNE LE TYPE DE FICHIER ET INDIQUE S'IL EST VIDE. VAUT:
C              'SCA_VIDE' (VIDE), 'SCALAIRE', 'VEC_VIDE' OU 'VECTEUR'
C      TYPVAL: DONNE LE TYPE DE VALEURS, REELLES (=0) OU COMPLEXES (=1)
C    SORTIE:
C      FICH  : NOM DU FICHIER DE VALEURS ENSIGHT
C      LGFICH: LONGUEUR DE LA CHAINE DE CARACTERES FICH
C      NOMVAR: NOM DE LA VARIABLE ENSIGHT ASSOCIEE AU FICHIER FICH
C      LGNOVA: LONGUEUR DE LA CHAINE DE CARACTERES NOMVAR
C      DESRFV: LIGNE DE DESCRIPTION D'UN FICHIER DE VALEURS REELLES
C      DESIFV: LIGNE DE DESCRIPTION D'UN FICHIER DE VALEURS IMAGINAIRES
C      LGDESC: LONGUEUR COMMUNE DES CHAINES DE CARACTERES DESRFV,DESIFV
C     ----------- COMMUNS NORMALISES  JEVEUX  --------------------------
      COMMON /IVARJE/ZI(1)
      COMMON /RVARJE/ZR(1)
      COMMON /CVARJE/ZC(1)
      COMMON /LVARJE/ZL(1)
      COMMON /KVARJE/ZK8(1),ZK16(1),ZK24(1),ZK32(1),ZK80(1)
      INTEGER ZI
      REAL*8 ZR
      COMPLEX*16 ZC
      LOGICAL ZL
      CHARACTER*8  ZK8
      CHARACTER*16 ZK16
      CHARACTER*24 ZK24
      CHARACTER*32 ZK32
      CHARACTER*80 ZK80
C     ------------------------------------------------------------------
      CHARACTER*6  CHNBOR,CHNUOR
      CHARACTER*9  NOSY9
      CHARACTER*15 NOMREP
      INTEGER      LGNOGD,LGCH9,LGIORD,LGNORD,NBKSUP,NBKSS2,LGVAMX
      PARAMETER   (LGVRMX=19,LGVIMX=17)
C     ------------------------------------------------------------------
      NOSY9=NOSY16(1:9)
      LGCH9=LXLGUT(NOSY9)
      LGNOGD=LXLGUT(NOMGD)
      FICH=' '
      NOMREP='./RESU_ENSIGHT/'
      IF(.NOT.LRESU) THEN
C     - CHAM_GD: ON DEFINIT LE NOM DU FICHIER CONTENANT LES VALEURS,
C       LE NOM DE LA VARIABLE ENSIGHT ASSOCIEE A CE FICHIER AINSI QUE
C       LA LIGNE DE DESCRIPTION DU CONTENU DU FICHIER DE VALEURS ENSIGHT
        IF(TYPFIC(1:3).EQ.'SCA') THEN
          FICH=NOMREP//NOFIVA(1:LGCH16+1+LGCOMP)
          LGFICH=LXLGUT(FICH)
          LGVAMX=LGVRMX
          IF(TYPVAL.EQ.1) LGVAMX=LGVIMX
          IF((LGCH9+1+LGCOMP).GT.LGVAMX) THEN
            NBKSUP=LGCH9+1+LGCOMP - LGVAMX
            NOMVAR=NOSY9(1:LGCH9-NBKSUP)//'.'//NOMCMP(1:LGCOMP)
          ELSE
            NOMVAR=NOSY9(1:LGCH9)//'.'//NOMCMP(1:LGCOMP)
          ENDIF
          IF(TYPVAL.EQ.0) THEN
            DESRFV='CHAMP='//NOMGD(1:LGNOGD)//' CMP='//NOMCMP(1:LGCOMP)
            LGDESC=LXLGUT(DESRFV)
          ELSEIF(TYPVAL.EQ.1) THEN
            DESRFV='CHAMP='//NOMGD(1:LGNOGD)//
     +             ' CMP='//NOMCMP(1:LGCOMP)//'.R'
            LGDESC=LXLGUT(DESRFV)
            DESIFV=DESRFV(1:LGDESC-2)//'.I'
          ENDIF
        ELSEIF(TYPFIC(1:3).EQ.'VEC') THEN
          FICH=NOMREP//NOFIVA(1:LGCH16)
          LGFICH=LXLGUT(FICH)
          NOMVAR=NOFIVA(1:LGCH16)
          IF(TYPVAL.EQ.0) THEN
            DESRFV='CHAMP VECT='//NOMGD(1:LGNOGD)
            LGDESC=LXLGUT(DESRFV)
          ELSEIF(TYPVAL.EQ.1) THEN
            DESRFV='Re DU CHAMP VECT:'//NOMGD(1:LGNOGD)
            LGDESC=LXLGUT(DESRFV)
            DESIFV='Im'//DESRFV(3:LGDESC)
          ENDIF
        ENDIF
        LGNOVA=LXLGUT(NOMVAR)
        IF(TYPVAL.EQ.1) THEN
          NOMVAR=NOMVAR(1:LGNOVA)//'.R'
          LGNOVA=LGNOVA+2
        ENDIF
      ELSE
C     - DANS LE CAS D'UN CONCEPT RESULTAT IL FAUT INTEGRER DANS LE
C       NOM DU FICHIER DE VALEURS L'INDICE DANS LA LISTE DES
C       NUMEROS D'ORDRE A IMPRIMER DU NUMERO D'ORDRE COURANT
        FICH=NOMREP//NOFIVA(1:LGCONC+1+LGCH16+1+LGNUO1+1)
        LGFICH=LXLGUT(FICH)
        CALL CODENT(NORDEN,'G',CHNBOR)
        LGNORD=LXLGUT(CHNBOR)
        IF(NORDEN.GT.1) THEN
          CALL CODENT(IORDRE-1,'G',CHNUOR)
          LGIORD=LXLGUT(CHNUOR)
          IF(LGIORD.EQ.1) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)//'00000'//CHNUOR(1:1)
             IF(LGNORD.EQ.5) FICH=FICH(1:LGFICH)// '0000'//CHNUOR(1:1)
             IF(LGNORD.EQ.4) FICH=FICH(1:LGFICH)//  '000'//CHNUOR(1:1)
             IF(LGNORD.EQ.3) FICH=FICH(1:LGFICH)//   '00'//CHNUOR(1:1)
             IF(LGNORD.EQ.2) FICH=FICH(1:LGFICH)//    '0'//CHNUOR(1:1)
             IF(LGNORD.EQ.1) FICH=FICH(1:LGFICH)         //CHNUOR(1:1)
          ELSEIF(LGIORD.EQ.2) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)//' 0000'//CHNUOR(1:2)
             IF(LGNORD.EQ.5) FICH=FICH(1:LGFICH)//  '000'//CHNUOR(1:2)
             IF(LGNORD.EQ.4) FICH=FICH(1:LGFICH)//   '00'//CHNUOR(1:2)
             IF(LGNORD.EQ.3) FICH=FICH(1:LGFICH)//    '0'//CHNUOR(1:2)
             IF(LGNORD.EQ.2) FICH=FICH(1:LGFICH)         //CHNUOR(1:2)
          ELSEIF(LGIORD.EQ.3) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)//  '000'//CHNUOR(1:3)
             IF(LGNORD.EQ.5) FICH=FICH(1:LGFICH)//   '00'//CHNUOR(1:3)
             IF(LGNORD.EQ.4) FICH=FICH(1:LGFICH)//    '0'//CHNUOR(1:3)
             IF(LGNORD.EQ.3) FICH=FICH(1:LGFICH)         //CHNUOR(1:3)
          ELSEIF(LGIORD.EQ.4) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)//   '00'//CHNUOR(1:4)
             IF(LGNORD.EQ.5) FICH=FICH(1:LGFICH)//    '0'//CHNUOR(1:4)
             IF(LGNORD.EQ.4) FICH=FICH(1:LGFICH)         //CHNUOR(1:4)
          ELSEIF(LGIORD.EQ.5) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)//    '0'//CHNUOR(1:5)
             IF(LGNORD.EQ.5) FICH=FICH(1:LGFICH)         //CHNUOR(1:5)
          ELSEIF(LGIORD.EQ.6) THEN
             IF(LGNORD.EQ.6) FICH=FICH(1:LGFICH)         //CHNUOR(1:6)
          ENDIF
          IF(TYPFIC(1:3).EQ.'SCA') THEN
            FICH=FICH(1:LGFICH+LGNORD)//'.'//NOMCMP(1:LGCOMP)
            LGFICH=LGFICH+LGNORD+1+LGCOMP
          ELSEIF(TYPFIC(1:3).EQ.'VEC') THEN
            FICH=FICH(1:LGFICH+LGNORD)
            LGFICH=LGFICH+LGNORD
          ENDIF
        ELSE
          IF(TYPFIC(1:3).EQ.'SCA') THEN
            FICH=FICH(1:LGFICH)//NOMCMP(1:LGCOMP)
            LGFICH=LGFICH+LGCOMP
          ELSEIF(TYPFIC(1:3).EQ.'VEC') THEN
            FICH=FICH(1:LGFICH-1)
            LGFICH=LGFICH-1
          ENDIF
        ENDIF
        IF(TYPFIC(4:8).NE.'_VIDE') THEN
          NOMVAR=' '
C         - ON DEFINIT LE NOM DE LA VARIABLE ENSIGHT DU FICHIER
C           EN REDUISANT CE NOM AU NBRE MAXIMUM DE CARACTERES AUTORISE
          LGVAMX=LGVRMX
          IF(TYPVAL.EQ.1) LGVAMX=LGVIMX
          IF(TYPFIC(1:3).EQ.'SCA') THEN
            IF((LGCONC+1+LGCH9+1+LGCOMP).GT.LGVAMX) THEN
              NBKSUP=LGCONC+1+LGCH9+1+LGCOMP - LGVAMX
              NBKSS2=NBKSUP/2
              IF(NBKSS2.GT.0) NBKSS2=NBKSS2-1
              NOMVAR=NOMSD(1:LGCONC-NBKSS2)//'.'//
     +               NOSY9(1:LGCH9-(NBKSUP-NBKSS2))//'.'//
     +               NOMCMP(1:LGCOMP)
            ELSE
              NOMVAR=NOMSD(1:LGCONC)//'.'//
     +               NOSY9(1:LGCH9)//'.'//NOMCMP(1:LGCOMP)
            ENDIF
          ELSEIF(TYPFIC(1:3).EQ.'VEC') THEN
            IF((LGCONC+1+LGCH9).GT.LGVAMX) THEN
              NBKSUP=LGCONC+1+LGCH9 - LGVAMX
              NBKSS2=NBKSUP/2
              IF(NBKSS2.GT.0) NBKSS2=NBKSS2-1
              NOMVAR=NOMSD(1:LGCONC-NBKSS2)//'.'//
     +               NOSY9(1:LGCH9-(NBKSUP-NBKSS2))
            ELSE
              NOMVAR=NOMSD(1:LGCONC)//'.'//NOSY9(1:LGCH9)
            ENDIF
          ENDIF
          LGNOVA=LXLGUT(NOMVAR)
          IF(TYPVAL.EQ.1) THEN
            NOMVAR=NOMVAR(1:LGNOVA)//'.R'
            LGNOVA=LGNOVA+2
          ENDIF
C         - ON DEFINIT LA LIGNE DE DESCRIPTION DU CONTENU DU FICHIER
C           DE VALEURS ENSIGHT
          IF(TYPFIC(1:3).EQ.'SCA') THEN
             DESRFV='CONCEPT='//NOMSD(1:LGCONC)//' CHAMP='//
     +            NOSY16(1:LGCH16)//' CMP='//NOMCMP(1:LGCOMP)
             LGDESC=LXLGUT(DESRFV)
             IF(TYPVAL.EQ.1) THEN
               DESRFV=DESRFV(1:LGDESC)//'.R'
               DESIFV=DESRFV(1:LGDESC)//'.I'
               LGDESC=LGDESC+2
             ENDIF
          ELSEIF(TYPFIC(1:3).EQ.'VEC') THEN
            IF(TYPVAL.EQ.0) THEN
              DESRFV='CONCEPT='//NOMSD(1:LGCONC)//
     +               ' CHAMP VECT='//NOSY16(1:LGCH16)
            ELSEIF(TYPVAL.EQ.1) THEN
              DESRFV='CONCEPT='//NOMSD(1:LGCONC)//
     +               ' Re DU CHAMP:'//NOSY16(1:LGCH16)
              DESIFV='CONCEPT '//NOMSD(1:LGCONC)//
     +               ' Im DU CHAMP:'//NOSY16(1:LGCH16)
            ENDIF
            LGDESC=LXLGUT(DESRFV)
          ENDIF
        ENDIF
      ENDIF
      END
